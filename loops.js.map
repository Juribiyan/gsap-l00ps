{"version":3,"file":"loops.js","names":["defaultPattern","urlprefix","fileFormat","testAudio","document","createElement","canPlayType","conf","barWidth","barHeight","fft_size","absoluteTreshold","historySize","distributionLaw","colorAlphaTreshold","association","osc","topOffset","lightWave","darkWave","detectPassiveEvents","update","window","addEventListener","passive","options","Object","defineProperty","get","noop","removeEventListener","hasSupport","$canvas","drawContext","bufferCanvas","bufferContext","readyset","channel","init","$","getContext","ranges","Grid","mousedown","isMouseDown","on","each","c","data","replaceWith","generateCell","addClass","attr","ev","actions","removeClass","brush","mode","color","click","val","querySelector","handleDragOver","handleFileDrop","handleFileInput","_","targetTouches","touch","el","elementFromPoint","pageX","pageY","hasOwnProperty","_tl","progress","getJSON","done","upconf","fail","err","console","log","parent","find","validations","validateForm","parents","updateCaptcha","ctrlKey","altKey","errBox","closeWithBtn","loopEditor","hide","bind","preventDefault","setLineHeightAsParentHeight","action","hasClass","fd","FormData","append","is_admin","forEach","prop","current","is","date","time","currentCustomTrack","blob","pop","size","max_loop_fszkb","rawData","original_hash","request","XMLHttpRequest","open","send","onload","e","status","res","JSON","parse","response","error","_lib","loop","section","dp","localStorage","success","loopLibs","add","lib_move","lib_from","section_from","del","edit","changes","item","ix","escape","join","unedit","undel","trigger","errtype","extra_data","prepareEdit","msg","name","Math","random","custom","TrackList","defaultLib","title","sectID","contents","filter","patternLibs","PatternGallery","mCustomScrollbar","theme","scrollInertia","$trackName","scrollWidth","offsetWidth","stop","animate","scrollLeft","width","toggleClass","focus","tabgroup","show","hash","libID","playTrackByHash","stopPropagation","query","toLowerCase","replace","injector","remove","length","inject","change","checked","$track","lib","trackData","flatList","patternID","applyPatternByID","$pattern","id","patternData","list","patternEditor","getPattern","currentID","pattern","styles","style","selected","changeStyle","setOsc","recount","alias","css","head","getElementsByTagName","type","styleSheet","cssText","appendChild","createTextNode","getElementById","removeChild","$parent","message","msgType","raw","$errorbox","html","text","visibility","opacity","top","height","off","popError","switch_lang","visible","state","immed","trunc","$datetime","split","swf","associated_loop","associated_pattern","slideDown","slideUp","string","patternStr","enterPaintMode","build","toggle","auth","delpass","max_delpass_length","captcha","filename","max_filename_length","$form","randomfill","revert","defaultStyle","clear","close","exitPaintMode","upload","download","downloadPattern","upload_loop","share_pattern","select_loop","select_pattern","recount_base_color","$el","lineHeight","Colors","g","G","y","Y","o","O","b","B","C","v","V","m","M","j","J","colorMatch","RegExp","escapeRegExp","keys","colorMatchSqBr","legacy","baseColor","toHexString","darkenColor","darken","u","modern","darker","toRgbString","flashes","flat","lighten","brighten","saturate","transitional","globalCSS","xBrowserIsMouseDown","isChrome","navigator","userAgent","match","chromeVersion","animations","backgroundColor","tinycolor","to","boxShadow","_debug_","sel","self","display","resample","shuffler","Rarity","lastOsc","baseStyle","thenBuild","has","primaryColor","$oscC","fromString","indexOf","fillStyle","layer","char","cstring","toHex","_format","_a","$cell","TimelineLite","blink","lastBuild","$cells","$overlays","lines","line","li","chars","compact","ci","appendTo","empty","fadeOut","audio","prepend","saveState","oscMode","newPattern","code","row","output","lc","cells","querySelectorAll","intoRows","cellCount","trimmingConstant","floor","sqrt","cc","invert","max","countBy","pluck","selfHeight","selfWidth","_x","_y","flash","i","cellsArranged","Array","prototype","call","cell","getAttribute","x","reverse","flashXY","cellY","flashRow","flashDensity","direction","amount","isNaN","_remove","includes","drop","dropRight","map","repeat","linelength","times","concat","fromCanvas","px","h","w","getImageData","toCanvas","ceil","Uint8ClampedArray","offset","offsetLeft","offsetRight","unshift","push","_r","_g","_b","clearRect","imageData","createImageData","set","putImageData","toDataURL","_test","N","setInterval","expectedLoop","defaults","freq","db","smoothing","treshold","ionRangeSlider","min","sampleRate","min_interval","drag_interval","grid_num","values_separator","grid","from","onChange","numSamples","hz2samples","sampleOffset","visualizer","analyser","minDecibels","maxDecibels","step","sync","context","fftSize","hz","round","samples2hz","samples","settings","callOnChange","buffer","compatibility","supported","source_loop","source_once","disabled","currentLoop","callback","_playing","TweenLite","gainNode","gain","value","onComplete","_startTime","start","loadLoop","newLoop","req","expectedToken","Date","getTime","decodeAudioData","play","responseType","AudioContext","webkitAudioContext","createBufferSource","createGain","VisualizerSample","connect","AllTracks","fadeIn","noteGrainOn","duration","_drawing","frame","draw","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","record_mode","logIfDown","dir","apply","arguments","createAnalyser","destination","Uint8Array","frequencyBinCount","canvas","ctx","debugOn","history","tick","spectrum","abs","pow","numBands","bands","bandWidths","spectrumLength","n","bandNum","sample","fillRect","shift","average","jumps","band","smoothingTimeConstant","getByteFrequencyData","percent","getFrequencyValue","nyquist","index","freqs","trim","fn","evt","handleFile","ftype","files","dataTransfer","target","f","reader","FileReader","dataUrl","result","readAsDataURL","Blob","fileName","readAsArrayBuffer","alert","dropEffect","dataURL","imageObj","Image","drawImage","src","dataURItoBlob","dataURI","arr","mime","atob","tracklist","$sortButton","sortBy","order","playEnabled","$playEnabler","isFlat","populate","buildSection","scrollAdded","sortOrder","sortedList","sortByOrder","foradmin","entry","swfName","swfLink","swfClass","fresh","isPlaying","safeName","track","processList","flatten","ohash","nobuild","totalSecs","minutes","seconds","sortOptions","processedSection","sortButton","sort","sortState","findIndex","disableAssociation","getAllHashes","tracks","nameList","playList","enabled","pl","reject","nl","reduced","patterns","patternProbe","s","v_offset","h_offset","up","margins","refreshAss","probe","crisp","upstyle","cheet","log2","LN2","$stream","radioMES","set_stream","url","mediaType","connectStream","createMediaElementSource","toggleAnlzOpts","slideToggle"],"sources":["es6/src/loops.js"],"sourcesContent":["\"use strict\";\r\n\r\nvar defaultPattern = \"__JJJJJJJJ__|_JJJJJJJJJJ_|JJjjjjjjjJJJ|JJjjjjjjJJJJ|JJjjjjjJJjJJ|JJjjjjjJJjJJ|JJjjjjJJjjJJ|JJjjjjJJjjJJ|JJjjjJJjjjJJ|JJjjjJJjjjJJ|JJjjJJjjjjJJ|JJjjJJjjjjJJ|JJjJJjjjjjJJ|JJjJJjjjjjJJ|JJJJjjjjjjJJ|JJJjjjjjjjJJ|_JJJJJJJJJJ_|__JJJJJJJJ__\";\r\n\r\nvar urlprefix = \"loops/\";\r\nvar fileFormat = (function() {\r\n\tvar testAudio  = document.createElement(\"audio\");\r\n\treturn (typeof testAudio.canPlayType === \"function\" && testAudio.canPlayType(\"audio/ogg\") !== \"\")\r\n})() ? 'ogg' : 'mp3';\r\n\r\nvar conf = {\r\n\tbarWidth: 850,\r\n\tbarHeight: 240,\r\n\tfft_size: 1024,\r\n\tabsoluteTreshold: 0.5,\r\n\thistorySize: 20,\r\n\tdistributionLaw: 'quadratic',\r\n\tcolorAlphaTreshold: 0.5,\r\n\tassociation: false,\r\n\tosc: true,\r\n  topOffset: 70,\r\n  lightWave: '#eee',\r\n  darkWave: '#999'\r\n};\r\n\r\n// https://github.com/rafrex/detect-passive-events\r\nconst detectPassiveEvents = {\r\n  update() {\r\n    if (typeof window !== 'undefined' && typeof window.addEventListener === 'function') {\r\n      let passive = false;\r\n      const options = Object.defineProperty({}, 'passive', {\r\n        get() { passive = true; },\r\n      });\r\n      const noop = () => {};\r\n      window.addEventListener('testPassiveEventSupport', noop, options);\r\n      window.removeEventListener('testPassiveEventSupport', noop, options);\r\n      detectPassiveEvents.hasSupport = passive;\r\n    }\r\n  },\r\n};\r\ndetectPassiveEvents.update();\r\n\r\nvar $canvas, drawContext, bufferCanvas, bufferContext;\r\n\r\nfunction readyset() {\r\n\tchannel.init()\r\n\t$canvas = $('#bars');\r\n\tdrawContext = $canvas[0].getContext('2d');\r\n\r\n\tbufferCanvas = $('#bufferCanvas')[0];\r\n\tbufferContext = bufferCanvas.getContext('2d');\r\n\t\r\n\tranges.init()\r\n\t\r\n\tGrid.init('#nullgrid');\r\n\r\n\t$('body *').mousedown(function() {\r\n\t\tisMouseDown = true;\r\n\t})\r\n\t.on('mouseup dragend', function() {\r\n\t\tisMouseDown = false;\r\n\t})\r\n\r\n\t// fill the swatches\r\n\t$('#fixed-palette .swatch').each(function() {\r\n\t\tvar c = $(this).data('c');\r\n\t\t$(this).replaceWith(Grid.generateCell(c, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+c));\r\n\t});\r\n\r\n\t// buttons\r\n\t$('body')\r\n\t.on('click', '.action-button', function(ev) {\r\n\t\tactions[$(this).data('act')](ev);\r\n\t})\r\n\t.on('click', '.tool', function() {\r\n\t\t$('.tool').removeClass('selected');\r\n\t\t$(this).addClass('selected');\r\n\t\tbrush.mode = $(this).data('tool');\r\n\t})\r\n\t.on('click', '.swatch', function() {\r\n\t\t$('.swatch').removeClass('selected');\r\n\t\tif($(this).data('c')) {\r\n\t\t\t$(this).addClass('selected');\r\n\t\t\tbrush.color = $(this).data('c');\r\n\t\t\t$('[data-tool=\"draw\"]').click();\r\n\t\t}\r\n\t});\r\n\t$('#colorpicker').on('change', function() {\r\n\t\tbrush.color = '#'+$(this).val();\r\n\t\tbrush.mode = 'draw';\r\n\t\t$(this).addClass('selected');\r\n\t\t$('[data-tool=\"draw\"]').click();\r\n\t});\r\n\r\n\tdocument.querySelector('body').addEventListener('dragover', handleDragOver, false);\r\n\tdocument.querySelector('body').addEventListener('drop', handleFileDrop, false);\r\n\r\n\tdocument.querySelector('#bufferFileInput').addEventListener('change', handleFileInput, false);\r\n\r\n\tdocument.querySelector('#overlays').addEventListener('touchmove', function(ev) {\r\n\t\t_.each(ev.targetTouches, function(touch) {\r\n\t\t\tvar el = document.elementFromPoint(touch.pageX, touch.pageY);\r\n\t\t\tif(el.hasOwnProperty('_tl'))\r\n\t\t\t\tel._tl.progress(0)\r\n\t\t})\r\n\t}, false)\r\n\r\n\t$.getJSON('upload.php?check')\r\n\t.done(function(data) {\r\n\t\tupconf = data;\r\n\t})\r\n\t.fail(function(err) {\r\n\t\tconsole.log(err)\r\n\t});\r\n\r\n\t/*Password reveal*/\r\n\t$('.password-reveal').on('mousedown', function() {\r\n\t\t$(this).parent().find('.delpass').attr('type', 'text')\r\n\t})\r\n\t.on('mouseleave mouseup', function() {\r\n\t\t$(this).parent().find('.delpass').attr('type', 'password')\r\n\t});\r\n\r\n\t/* Input validation */\r\n\t$('.validable').on('input', function() {\r\n\t\tif(validations[$(this).data('tovalid')]($(this).val())) \r\n\t\t\t$(this).removeClass('invalid')\r\n\t\telse \r\n\t\t\t$(this).addClass('invalid');\r\n\t\tvalidateForm($(this).parents('form'), true);\r\n\t});\r\n\r\n\t/* Captcha update */\r\n\t$('.captcha').click(function(ev) {\r\n\t\tupdateCaptcha($(this).parents('.captchablock'), (ev.ctrlKey || ev.altKey));\r\n\t})\r\n\r\n\t/* Error box close */\r\n\t$('.pop-message .i-x-large').click(errBox.closeWithBtn);\r\n\r\n\t/* Loop panel close */\r\n\t$('#loop-upload .panel-close').click(loopEditor.hide.bind(loopEditor));\r\n\r\n\t/* Loop upload form */\r\n\t$('#loop-upload form').on('submit', function(ev) {\r\n\t\tev.preventDefault();\r\n\t\tsetLineHeightAsParentHeight($('#loop-upload .hijab'));\r\n\t\t$('#loop-upload .panel').addClass('p-busy');\r\n\t\tvar action = 'add';\r\n\t\tif($('#loop-upload form').hasClass('action-edit')) \r\n\t\t\taction = 'edit';\r\n\t\tif($('#loop-upload form').hasClass('action-delete')) \r\n\t\t\taction = 'delete';\r\n\t\t\r\n\t\t/* Make XHR2 */\r\n\t\tvar fd = new FormData();\r\n\t\tfd.append('action', action);\r\n\t\tfd.append('datatype', 'loop');\r\n\t\tfd.append('delpass', $(\"#loop-upload .delpass\").val());\r\n\t\tfd.append('captcha', $(\"#loop-upload .captchainput\").val());\r\n\r\n\t\tif(is_admin)\r\n\t\t\tfd.append('is_admin', 1);\r\n\r\n\t\tif(action !== 'delete') {\r\n\t\t\tfd.append('name', $(\"#loop-upload .filename\").val());\r\n\t\t\t;['freq', 'db', 'smoothing', 'treshold'].forEach(prop => fd.append(prop, ranges.current[prop]))\r\n\r\n\t\t\tif($('#assoc_pattern').is(':checked'))\r\n\t\t\t\tfd.append('associated_pattern', $('#pattern-toassoc').val());\r\n\r\n\t\t\tif(is_admin) {\r\n\t\t\t\tfd.append('is_admin', 1);\r\n\t\t\t\tvar date = $('#loop-date').val();\r\n\t\t\t\tif(date) {\r\n\t\t\t\t\tvar time = $('#loop-time').val() || '00:00:00';\r\n\t\t\t\t\tdate = date + ' ' + time;\r\n\t\t\t\t}\r\n\t\t\t\tif(date)\r\n\t\t\t\t\tfd.append('date', date);\r\n\t\t\t\tif($(\"#loop-swf\").val())\r\n\t\t\t\t\tfd.append('swf', $(\"#loop-swf\").val());\r\n\t\t\t\tfd.append('section', $(\"#loop-section\").val());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(action === 'add') {\r\n\t\t\tif(!currentCustomTrack.blob) {\r\n\t\t\t\terrBox.pop($('#loop-upload'), \"Файл отсутствует\");\r\n\t\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\t\treturn \r\n\t\t\t}\r\n\t\t\tif(currentCustomTrack.blob.size / 1024 > upconf.max_loop_fszkb) {\r\n\t\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\t\terrBox.pop($('#loop-upload'), 'Превышен максимальный размер файла ('+upconf.max_loop_fszkb/1024+' МБ).');\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tfd.append('loop', currentCustomTrack.blob);\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tfd.append('original_hash', loopEditor.rawData.original_hash);\r\n\t\t}\r\n\r\n\t\tif(action === 'edit')\r\n\t\t\tfd.append('take_ownership', $('#loop_take_ownership').is(':checked'));\r\n\t\t\t\t\t\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open(\"POST\", \"upload.php\");\r\n\t\trequest.send(fd);\r\n\r\n\t\trequest.onload = function(e) {\r\n\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar res = JSON.parse(this.response);\r\n\t\t\t\t\tif(res.error) {\r\n\t\t\t\t\t\tif(res.errtype === 'prompt_edit') {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tvar data = JSON.parse(res.extra_data);\r\n\t\t\t\t\t\t\t\tloopEditor.prepareEdit(data);\r\n\t\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), _.escape(res.msg)+' <a href=\"javascript:loopEditor.edit();\">Отредактировать луп «'+_.escape(data.name)+'»</a>?', 'prompt', 'raw');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), res.msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvar _lib = (res.loop.section !== 'custom') ? 'default' : 'custom';\r\n\t\t\t\t\t\t// save password\r\n\t\t\t\t\t\tvar dp = $(\"#loop-upload .delpass\").val();\r\n\t\t\t\t\t\tlocalStorage[\"loop_pass\"] = dp;\r\n\t\t\t\t\t\tif(!localStorage[\"pattern_pass\"]) {\r\n\t\t\t\t\t\t\t$(\"#pattern-share .delpass\").val(dp);\r\n\t\t\t\t\t\t\tlocalStorage[\"pattern_pass\"] = dp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/* LOOP XHR RESULTS */ \r\n\t\t\t\t\t\tif(res.success === 'loop_add' && res.hasOwnProperty('loop')) {\r\n\t\t\t\t\t\t\tloopLibs[_lib].add(res.loop);\r\n\t\t\t\t\t\t\tloopEditor.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'loop_edit') {\r\n\t\t\t\t\t\t\tvar lib_move = false;\r\n\t\t\t\t\t\t\tif(res.loop.hasOwnProperty('section_from'))  {\r\n\t\t\t\t\t\t\t\tvar lib_from = (res.loop.section_from !== 'custom') ? 'default' : 'custom';\r\n\t\t\t\t\t\t\t\tif(lib_from !== _lib) \r\n\t\t\t\t\t\t\t\t\tlib_move = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(lib_move) {\r\n\t\t\t\t\t\t\t\tloopLibs[lib_from].del(res.loop.original_hash, res.loop.section_from);\r\n\t\t\t\t\t\t\t\tloopLibs[_lib].add(res.loop);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tloopLibs[_lib].edit(res.loop);\r\n\r\n\t\t\t\t\t\t\t_.each(res.changes, function(item, ix) {res.changes[ix] = _.escape(item)});\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), res.changes.join(';<br>') + '.', 'success', 'raw');\r\n\t\t\t\t\t\t\tloopEditor.unedit();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'loop_delete') {\r\n\t\t\t\t\t\t\tloopLibs[_lib].del(res.loop.original_hash, res.loop.section);\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), \"Луп удален.\", 'success');\r\n\t\t\t\t\t\t\tloopEditor.undel();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$('#loop-library').addClass('open-lib');\r\n\t\t\t\t\t\t$('#ltab-'+_lib).click();\r\n\r\n\t\t\t\t\t\t$(\"#loop-upload .filename\").val('').trigger('input');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e) {\r\n\t\t\t\t\tif(e.name == 'SyntaxError') {\r\n\t\t\t\t\t\terrBox.pop($('#loop-upload'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\tconsole.error(this.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse throw e;\r\n\t\t\t\t}\r\n\t\t\t\tupdateCaptcha($(\"#loop-upload .captchablock\"));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\terrBox.pop($('#loop-upload'), 'Ошибка XHR. Подробности в консоли.');\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/* Loop library */\r\n\t$.getJSON('custom_loops.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tloopLibs.custom = new TrackList(data, '#custom-loops', 'custom', true, $('#ltab-custom i.sorter'), 'date', 'desc', true, $('#ltab-custom i.play-enabler'));\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('default_loops.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tvar defaultLib = [\r\n\t\t\t{ title: 'Период смерти', sectID: 'dead', contents: _.filter(data, {section: 'dead'}) },\r\n\t\t\t{ title: 'Период жизни', sectID: 'live', contents: _.filter(data, {section: 'live'}) }\r\n\t\t]\r\n\t\tloopLibs.default = new TrackList(defaultLib, '#default-loops', 'default', false, $('#ltab-default i.sorter'), 'date', 'desc', true, $('#ltab-default i.play-enabler'));\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('default_patterns.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tpatternLibs.default = new PatternGallery(data, '#default-patterns', 'default', $('#ptab-default i.sorter'), 'date', 'desc');\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('custom_patterns.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tpatternLibs.custom = new PatternGallery(data, '#custom-patterns', 'custom', $('#ptab-custom i.sorter'), 'date', 'desc');\r\n\t})\r\n\t.fail(console.error);\r\n\r\n\t$('.scrollable').mCustomScrollbar({theme:\"minimal-dark\", scrollInertia: 200});\r\n\r\n\t/* Track name autoscroll */\r\n\t$('.lt-contents').on('mouseenter', '.track', function() {\r\n\t\tvar $trackName = $(this).find('.track-name');\r\n\t\tif($trackName[0].scrollWidth <= $trackName[0].offsetWidth) return;\r\n\t\t$trackName.stop().addClass('no-overflow');\r\n\t\t$trackName.animate({\r\n\t\t\tscrollLeft: $trackName.width()\r\n\t\t}, $trackName.width()*15, 'linear');\r\n\t})\r\n\t.on('mouseleave', '.track', function() {\r\n\t\tvar $trackName = $(this).find('.track-name');\r\n\t\tif($trackName[0].scrollWidth <= $trackName[0].offsetWidth) return;\r\n\t\t$trackName.stop().animate({\r\n\t\t\tscrollLeft: 0\r\n\t\t}, 'slow', 'linear', function() {\r\n\t\t\t$trackName.removeClass('no-overflow');\r\n\t\t});\r\n\t})\r\n\r\n\t/* Lib header */\r\n\t$('.lib-search').click(function() {\r\n\t\t$(this).toggleClass('active').parents('.library').toggleClass('search-active').find('input').focus()\r\n\t});\r\n\t$('.ltab-close, .ptab-close').click(function() {\r\n\t\t$(this).parents('.library').removeClass('open-lib select-mode');\r\n\t});\r\n\t$('.tab-switch').click(function() {\r\n\t\tvar tabgroup = $(this).data('tabgroup');\r\n\t\t$('.tab-switch.tabgroup-'+tabgroup).removeClass('active');\r\n\t\tif(!$(this).hasClass('active'))\r\n\t\t\t$(this).addClass('active');\r\n\t\t$('.tab-contents.tabgroup-'+tabgroup).hide();\r\n\t\t$('#'+$(this).data('tab')).show();\r\n\t});\r\n\t$('.tab-to-select-by-default').click();\r\n\r\n\t/* track play on click */\r\n\t$('#loop-library')\r\n\t.on('click', '.track .i-play', function() {\r\n\t\tvar hash = $(this).parents('.track').data('hash')       // unique hashname of the track\r\n\t\t, libID = $(this).parents('.tracklist-section').data('id');     //library ID\r\n\t\tloopLibs[libID].playTrackByHash(hash);\r\n\t}) /* track download menu */\r\n\t.on('click', '.track-options .i-download-menu', function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t\t$(this).parents('.track').addClass('dl-track')\r\n\t})\r\n\t.on('click', '.track-options .i-burger', function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t\t$(this).parents('.track').addClass('ed-track')\r\n\t})\r\n\t.on('click', '.track-name', function(ev) {\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t})\r\n\t.on('click', '.track', function(ev) {\r\n\t\tif($(this).parents('.library').hasClass('select-mode')) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tvar hash = $(this).data('hash');\r\n\t\t\tif($(this).parents('.library').hasClass('select-mode'))\r\n\t\t\t\t$('#loop-toassoc').val(hash);\r\n\t\t}\r\n\t});\r\n\r\n\t/* track search (Jets.js method) */\r\n\t$('#loop-search').on('input', function() {\r\n\t\tvar query = $(this).val().toLowerCase().replace(/\\\"/, '\\\\\"');\r\n\t\ttry {\r\n\t\t\tinjector.remove('loop-search');\r\n\t\t} catch(e) {}\r\n\t\tif(query.length)\r\n\t\t\tinjector.inject('loop-search', '.search-active#loop-library .track:not([data-name *= \"'+query+'\"]) { display:none; }');\r\n\t\telse\r\n\t\t\tinjector.inject('loop-search', '.search-active#loop-library .track { display:none; }');\r\n\t}).trigger('input');\r\n\r\n\t/* pattern search (same) */\r\n\t$('#pattern-search').on('input', function() {\r\n\t\tvar query = $(this).val().toLowerCase().replace(/\\\"/, '\\\\\"');\r\n\t\ttry {\r\n\t\t\tinjector.remove('pattern-search');\r\n\t\t} catch(e) {}\r\n\t\tif(query.length)\r\n\t\t\tinjector.inject('pattern-search', '.search-active#pattern-library .pattern:not([data-name *= \"'+query+'\"]) { display:none; }');\r\n\t\telse\r\n\t\t\tinjector.inject('pattern-search', '.search-active#pattern-library .pattern { display:none; }');\r\n\t}).trigger('input');\r\n\r\n\t/* cancel loop editor */\r\n\t$('#unedit-loop').click(loopEditor.unedit.bind(loopEditor));\r\n\r\n\t$('.oncheck-enable').change(function() {\r\n\t\t$($(this).data('element-toenable')).attr('disabled', !this.checked);\r\n\t})\r\n\r\n\t// track menu\r\n\t$('#loop-library')\r\n\t.on('click', '.dlb-edit', function() {\r\n\t\tvar $track = $(this).parents('.track')\r\n\t\t, hash = $track.data('hash')+''\r\n\t\t, lib = $track.parents('.tabgroup-loops').data('lib')\r\n\t\t, trackData = _.find(loopLibs[lib].flatList, {original_hash: hash});\r\n\t\tif(trackData)\r\n\t\t\tloopEditor.prepareEdit(trackData, true);\r\n\t})\r\n\t.on('click', '.dlb-delete', function() {\r\n\t\tvar $track = $(this).parents('.track')\r\n\t\t, hash = $track.data('hash')\r\n\t\t, lib = $track.parents('.tabgroup-loops').data('lib')\r\n\t\t, trackData = _.find(loopLibs[lib].flatList, {original_hash: hash});\r\n\t\tif(trackData)\r\n\t\t\tloopEditor.del(trackData, true);\r\n\t\t/*loopEditor.del(hash);*/\r\n\t});\r\n\r\n\t/* Pattern applying and menu */\r\n\t$('#pattern-library')\r\n\t.on('click', '.pattern-name', function() {\r\n\t\tvar libID = $(this).parent().data('lib')\r\n\t\t, patternID = $(this).parent().data('id');\r\n\r\n\t\tif($(this).parents('.library').hasClass('select-mode')) \r\n\t\t\t$('#pattern-toassoc').val(patternID);\r\n\t\telse\r\n\t\t\tpatternLibs[libID].applyPatternByID(patternID);\r\n\t})\r\n\t.on('click', '.i-edit', function() {\r\n\t\tvar $pattern = $(this).parents('.pattern')\r\n\t\t, id = $pattern.data('id')\r\n\t\t, lib = $pattern.data('lib')\r\n\t\t, patternData = _.find(patternLibs[lib].list, {id: id});\r\n\t\tif(patternData) \r\n\t\t\tpatternEditor.edit(patternData);\r\n\t})\r\n\t.on('click', '.pattern .i-x-small', function() {\r\n\t\tvar $pattern = $(this).parents('.pattern')\r\n\t\t, id = $pattern.data('id')\r\n\t\t, lib = $pattern.data('lib')\r\n\t\t, patternData = _.find(patternLibs[lib].list, {id: id});\r\n\t\tif(patternData) \r\n\t\t\tpatternEditor.del(patternData);\r\n\t})\r\n\r\n\t/* Pattern share form */\r\n\t$('form#pattern-share').on('submit', function(ev) {\r\n\t\tev.preventDefault();\r\n\t\tsetLineHeightAsParentHeight($('#editmode .hijab'));\r\n\t\t$('#editmode .panel').addClass('p-busy');\r\n\t\tvar action = 'add';\r\n\t\tif($('#pattern-share').hasClass('action-edit')) \r\n\t\t\taction = 'edit';\r\n\t\tif($('#pattern-share').hasClass('action-delete')) \r\n\t\t\taction = 'delete';\r\n\r\n\t\tvar fd = new FormData();\r\n\t\tfd.append('action', action);\r\n\t\tfd.append('datatype', 'pattern');\r\n\t\tfd.append('delpass', $(\"#pattern-share .delpass\").val());\r\n\t\tfd.append('captcha', $(\"#pattern-share .captchainput\").val());\r\n\r\n\t\tif(is_admin)\r\n\t\t\tfd.append('is_admin', 1);\r\n\r\n\t\tif(action !== 'delete') {\r\n\t\t\tfd.append('name', $(\"#pattern-share .filename\").val());\r\n\t\t\tfd.append('pattern_string', Grid.getPattern());\r\n\r\n\t\t\tfd.append('style', $('#cell-style').val());\r\n\t\t\tfd.append('osc', ($('#osc-sel').val() !== 'off') ? $('#osc-color').val() : 'off')\r\n\r\n\t\t\tif($('#assoc_loop').is(':checked'))\r\n\t\t\t\tfd.append('associated_loop', $('#loop-toassoc').val());\r\n\r\n\t\t\tif(is_admin) {\r\n\t\t\t\tfd.append('is_admin', 1);\r\n\t\t\t\tvar date = $('#pattern-date').val();\r\n\t\t\t\tif(date) {\r\n\t\t\t\t\tvar time = $('#pattern-time').val() || '00:00:00';\r\n\t\t\t\t\tdate = date + ' ' + time\r\n\t\t\t\t}\r\n\t\t\t\tif(date)\r\n\t\t\t\t\tfd.append('date', date);\r\n\t\t\t\tfd.append('section', $(\"#pattern-section\").val());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(action !== 'add') {\r\n\t\t\tfd.append('pattern_id', patternEditor.currentID);\r\n\t\t}\r\n\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open(\"POST\", \"upload.php\");\r\n\t\trequest.send(fd);\r\n\r\n\t\trequest.onload = function(e) {\r\n\t\t\t$('#editmode .panel').removeClass('p-busy');\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar res = JSON.parse(this.response);\r\n\t\t\t\t\tif(res.error) {\r\n\t\t\t\t\t\terrBox.pop($('#editmode'), res.msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// save password\r\n\t\t\t\t\t\tvar dp = $(\"#pattern-share .delpass\").val();\r\n\t\t\t\t\t\tlocalStorage[\"pattern_pass\"] = dp;\r\n\t\t\t\t\t\tif(!localStorage[\"loop_pass\"]) {\r\n\t\t\t\t\t\t\t$(\"#loop-upload .delpass\").val(dp);\r\n\t\t\t\t\t\t\tlocalStorage[\"loop_pass\"] = dp;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(res.success === 'pattern_add') {\r\n\t\t\t\t\t\t\tpatternLibs[res.pattern.section].add(res.pattern);\r\n\t\t\t\t\t\t\t// patternEditor.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'pattern_edit') {\r\n\t\t\t\t\t\t\tvar lib_from = res.pattern.section_from || false;\r\n\t\t\t\t\t\t\tif(lib_from) {\r\n\t\t\t\t\t\t\t\tpatternLibs[lib_from].del(res.pattern.id);\r\n\t\t\t\t\t\t\t\tpatternLibs[res.pattern.section].add(res.pattern);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tpatternLibs[res.pattern.section].edit(res.pattern);\r\n\t\t\t\t\t\t\t_.each(res.changes, function(item, ix) {res.changes[ix] = _.escape(item)});\r\n\t\t\t\t\t\t\terrBox.pop($('#editmode'), res.changes.join(';<br>'), 'success', 'raw');\r\n\t\t\t\t\t\t\tpatternEditor.unedit();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'pattern_delete') {\r\n\t\t\t\t\t\t\tpatternLibs[res.pattern.section].del(res.pattern.id);\r\n\t\t\t\t\t\t\terrBox.pop($('#editmode'), \"Паттерн удален.\", 'success');\r\n\t\t\t\t\t\t\tpatternEditor.undel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('#pattern-library').addClass('open-lib');\r\n\t\t\t\t\t\t$('#ptab-'+res.pattern.section).click();\r\n\t\t\t\t\t\t$(\"#loop-upload .filename\").val('').trigger('input');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e) {\r\n\t\t\t\t\tif(e.name == 'SyntaxError') {\r\n\t\t\t\t\t\terrBox.pop($('#editmode'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\tconsole.error(this.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse throw e;\r\n\t\t\t\t}\r\n\t\t\t\tupdateCaptcha($(\"#pattern-share .captchablock\"));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\terrBox.pop($('#editmode'), 'Ошибка XHR. Подробности в консоли.');\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\t/*toggle osc and assoc*/\r\n\tif(localStorage['loops_association'])\r\n\t\ttry {\r\n\t\t\tconf.association = JSON.parse(localStorage['loops_association']);\r\n\t\t\t$('#assoc-toggle')[0].checked = conf.association;\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tthrow e;\r\n\t\t\tlocalStorage['loops_association'] = false;\r\n\t\t}\r\n\t$('#assoc-toggle').change(function() {\r\n\t\tconf.association = localStorage['loops_association'] = $(this)[0].checked;\r\n\t});\r\n\tif(localStorage['osc_enabled'])\r\n\t\ttry {\r\n\t\t\tconf.osc = JSON.parse(localStorage['osc_enabled']);\r\n\t\t\tif(!conf.osc) {\r\n\t\t\t\t$('#osc-toggle')[0].checked = false;\r\n\t\t\t\t$('body').addClass('osc-disabled');\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tthrow e;\r\n\t\t\tlocalStorage['osc_enabled'] = true;\r\n\t\t}\r\n\t$('#osc-toggle').change(function() {\r\n\t\tconf.osc = localStorage['osc_enabled'] = $(this)[0].checked;\r\n\t\tif(!conf.osc)\r\n\t\t\t$('body').addClass('osc-disabled')\r\n\t\telse \r\n\t\t\t$('body').removeClass('osc-disabled')\r\n\t})\r\n\r\n\t/* Cell styles and stuff */\r\n\t_.each(styles, function(val, style) {\r\n\t\tvar selected = (Grid.style === style) ? ' selected' : '';\r\n\t\t$('#cell-style').append('<option val=\"'+style+'\"'+selected+'>'+style+'</option>');\r\n\t});\r\n\r\n\t$('#cell-style').change(function() {\r\n\t\tGrid.changeStyle($(this).val())\r\n\t});\r\n\r\n\t$('#osc-color').change(function() {\r\n\t\tGrid.setOsc($(this).val());\r\n\t})\r\n\r\n\t$('#osc-sel').change(function() {\r\n\t\tvar val = $(this).val();\r\n\t\tif(val === 'off') \r\n\t\t\tGrid.setOsc('off')\r\n\t\telse {\r\n\t\t\t$('body').removeClass('osc-disabled');\r\n\t\t\tconf.osc = true;\r\n\t\t}\r\n\t\tif(val === 'default') {\r\n\t\t\tGrid.recount();\r\n\t\t\t$('#osc-color').attr('disabled', true);\r\n\t\t}\r\n\t\tif(val === 'custom')\r\n\t\t\t$('#osc-color').attr('disabled', false);\r\n\t})\r\n\r\n\t// some local storage shit\r\n\t$(\"#loop-upload .delpass\").val(localStorage[\"loop_pass\"] || '').trigger('input');\r\n\t$(\"#pattern-share .delpass\").val(localStorage[\"pattern_pass\"] || '').trigger('input');\r\n}\r\n\r\nvar injector = {\r\n  inject: function(alias, css) {\r\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t  , style = document.createElement('style');\r\n\t\tstyle.type = 'text/css';\r\n\t\tstyle.id = 'injector:' + alias;\r\n\t\tif (style.styleSheet) {\r\n\t\t  style.styleSheet.cssText = css;\r\n\t\t} else {\r\n\t\t  style.appendChild(document.createTextNode(css));\r\n\t\t}\r\n\t\thead.appendChild(style);\r\n  },\r\n  remove: function(alias) {\r\n\t\tvar style = document.getElementById('injector:' + alias);\r\n\t\tif(style) {\r\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0];\r\n\t\t\tif(head)\r\n\t\t\t\thead.removeChild(document.getElementById('injector:' + alias));\r\n\t\t}\r\n  }\r\n}\r\n\r\nvar loopLibs = {}, patternLibs = {};\r\n\r\nvar errBox = {\r\n\tpop: function($parent, message, msgType, raw) {\r\n\t\tif(typeof msgType === \"undefined\") msgType = \"error\";\r\n\t\tif(typeof raw === \"undefined\" || raw !== 'raw') raw = false;\r\n\t\tlet $errorbox = $parent.find('.emsgwrap');\r\n\t\tif(raw)\r\n\t\t\t$errorbox.find('.emsgbody').html(message);\r\n\t\telse\r\n\t\t\t$errorbox.find('.emsgbody').text(message);\r\n\t\t$errorbox.find('.pop-message').removeClass('emsg-error emsg-prompt emsg-success').addClass('emsg-'+msgType);\r\n\t\t$errorbox.css({visibility: 'visible'});\r\n\t\t$errorbox.animate({\r\n\t\t  opacity: 1,\r\n\t\t  top: '-'+($errorbox.height()-20)+'px'\r\n\t\t}, 200);\r\n\t\treturn $errorbox;\r\n\t},\r\n\tcloseWithBtn: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\terrBox.off($(this).parents('.emsgwrap'))\r\n\t},\r\n\toff: function($parent) {\r\n\t\t$parent.animate({opacity: '0'}, 200, function() {\r\n\t\t\t$parent.css({\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\ttop: '0px'\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction popError($parent, message) {\r\n\t$errorbox = $parent.find('.emsgwrap');\r\n\t$errorbox.find('.emsgbody').html(message);\r\n\t$errorbox.css({visibility: 'visible'});\r\n\t$errorbox.animate({\r\n\t  opacity: 1,\r\n\t  top: '-'+($errorbox.height()-20)+'px'\r\n\t}, 400);\r\n}\r\n\r\nfunction updateCaptcha($parent, switch_lang=false) {\r\n\t$parent.find('img.captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random()+(switch_lang ? '&switch' : ''));\r\n\t$parent.find('input.captchainput').val('').trigger('input');\r\n}\r\n\r\nvar loopEditor = {\r\n\tvisible: false,\r\n\tstate: 'add',\r\n\tprepareEdit: function(data, immed) {\r\n\t\tthis.rawData = data;\r\n\t\tif(typeof immed !== 'undefined' && immed)\r\n\t\t\tthis.edit();\r\n\t},\r\n\tadd: function() {\r\n\t\tthis.unedit();\r\n\t\tthis.undel();\r\n\t\tthis.show();\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t},\r\n\tedit: function() {\r\n\t\tthis.undel();\r\n\t\tthis.state = 'edit'\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t\t$('#loop-upload form').addClass('action-edit');\r\n\t\t$('#loopedit-id').text(_.trunc(this.rawData.name, 18));\r\n\t\t$('#loop-upload .filename').val(this.rawData.name);\r\n\t\t/*$('#loop-upload input[name=tresholdCorrection]')\r\n\t\t.val(this.rawData.treshold_correction).trigger('input');*/\r\n\t\t\r\n\t\tlet $datetime = this.rawData.date.split(' ');\r\n\t\t$('#loop-date').val($datetime[0]);\r\n\t\t$('#loop-time').val($datetime[1]);\r\n\t\t$('#loop-section').val(this.rawData.section);\r\n\t\t$('#loop-swf').val(this.rawData.swf);\r\n\r\n\t\tif(this.rawData.associated_loop) {\r\n\t\t\t$('#pattern-toassoc').val(this.rawData.associated_pattern);\r\n\t\t\t$('#assoc_pattern')[0].checked = true;\r\n\t\t}\r\n\t\telse \r\n\t\t\t$('#assoc_pattern')[0].checked = false;\r\n\t\t$('#assoc_pattern').trigger('change');\r\n\t\t\r\n\t\tthis.show();        \r\n\t},\r\n\tunedit: function() {\r\n\t\tif(this.state !== 'edit') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#loop-upload form').removeClass('action-edit');\r\n\t},\r\n\tdel: function(loop) {\r\n\t\tthis.rawData = loop;\r\n\t\tthis.unedit();\r\n\t\tthis.state = 'delete';\r\n\t\t$('#loopdelete-id').text(_.trunc(loop.name, 40));\r\n\t\t$('#loop-upload form').addClass('action-delete');\r\n\t\tthis.show();\r\n\t},\r\n\tundel: function() {\r\n\t\tif(this.state !== 'delete') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#loop-upload form').removeClass('action-delete');\r\n\t},\r\n\tshow: function() {\r\n\t\t$('#loop-upload .validable').trigger('input');\r\n\t\tif(this.visible) return;\r\n\t\t$('#loop-upload .captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random());\r\n\t\t$('#loop-upload').slideDown('fast');\r\n\t\tthis.visible = true;\r\n\t},\r\n\thide: function() {\r\n\t\t//return here\r\n\t\tif(!this.visible) return;\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t\t$('#loop-upload').slideUp('fast', (function() {\r\n\t\t\tthis.unedit();\r\n\t\t\tthis.undel();\r\n\t\t\tthis.visible = false;\r\n\t\t}).bind(this));\r\n\t}\r\n}\r\n\r\nvar patternEditor = {\r\n\tvisible: false,\r\n\tstate: 'add',\r\n\tcurrentID: 0,\r\n\tedit: function(pattern) {\r\n\t\tthis.undel();\r\n\t\t$('#pattern-share').addClass('action-edit');\r\n\t\t$('#patternedit-id').text(_.trunc(pattern.name, 40));\r\n\t\t$('#pattern-share .filename').val(pattern.name);\r\n\t\tif(pattern.associated_loop) {\r\n\t\t\t$('#loop-toassoc').val(pattern.associated_loop);\r\n\t\t\t$('#assoc_loop')[0].checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$('#assoc_loop')[0].checked = false;\r\n\t\t$('#assoc_loop').trigger('change');\r\n\t\tif(pattern.style) \r\n\t\t\t$('#cell-style').val(pattern.style).trigger('change');\r\n\t\tif(pattern.osc) \r\n\t\t\tGrid.setOsc(pattern.osc);\r\n\t\t\r\n\t\tthis.state = 'edit';\r\n\t\tthis.show(pattern.string);\r\n\t\tthis.currentID = +pattern.id;\r\n\t},\r\n\tunedit: function() {\r\n\t\tif(this.state !== 'edit') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#pattern-share').removeClass('action-edit');\r\n\t},\r\n\tdel: function(pattern) {\r\n\t\tthis.currentID = +pattern.id;\r\n\t\tthis.unedit();\r\n\t\tthis.state = 'delete';\r\n\t\t$('#patterndelete-id').text(_.trunc(pattern.name, 40));\r\n\t\t$('#pattern-share').addClass('action-delete');\r\n\t\tthis.show(pattern.string);\r\n\t},\r\n\tundel: function() {\r\n\t\tif(this.state !== 'delete') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#pattern-share').removeClass('action-delete');\r\n\r\n\t},\r\n\tshow: function(patternStr) {\r\n\t\tif(typeof patternStr === 'undefined') patternStr = false;\r\n\t\tGrid.enterPaintMode();\r\n\t\tif(patternStr) {\r\n\t\t\tGrid.build(patternStr);\r\n\t\t\t$('#pattern-library').removeClass('open-lib');\r\n\t\t}\r\n\t\tif(this.visible) return;\r\n\t\t$('#pattern-share .captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random());\r\n\t\t$('.onshare-show').slideDown('fast');\r\n\t\tthis.visible = true;\r\n\t\t$('#pattern-share .validable').trigger('input');\r\n\r\n\t\tif($('#osc-sel').val() === 'default')\r\n\t\t\tGrid.recount();\r\n\t},\r\n\thide: function() {\r\n\t\tif(!this.visible) return;\r\n\t\t$('.onshare-show').slideUp('fast', (function() {\r\n\t\t\tthis.unedit();\r\n\t\t\tthis.undel();\r\n\t\t\tthis.visible = false;\r\n\t\t}).bind(this));\r\n\t},\r\n\ttoggle: function() {\r\n\t\tif(this.visible) this.hide();\r\n\t\telse this.show();\r\n\t}\r\n}\r\n\r\nvar upconf = { //TODO: merge with conf\r\n\tauth: false\r\n}\r\n\r\nvar validations = {\r\n\tdelpass: function(val) {\r\n\t\treturn !!val && (val.length <= upconf.max_delpass_length)\r\n\t},\r\n\tcaptcha: function(val) {\r\n\t\treturn !!val\r\n\t},\r\n\tfilename: function(val) {\r\n\t\treturn !!val && (val.length <= upconf.max_filename_length)\r\n\t}\r\n}\r\n\r\nfunction validateForm($form, fromInput) {\r\n\t$form.find('button[type=submit]').attr('disabled', !!($form.find('.invalid:visible').length))\r\n}\r\n\r\nvar actions = {\r\n\texport: function() {\r\n\t\t$('#pattern-area').val(Grid.getPattern())\r\n\t},\r\n\timport: function() {\r\n\t\tGrid.build($('#pattern-area').val(), 'under')\r\n\t},\r\n\trandom: function() {\r\n\t\tGrid.randomfill()\r\n\t},\r\n\trevert: function() {\r\n\t\t$('#osc-sel').val('default');\r\n\t\tGrid.changeStyle(defaultStyle, defaultPattern);\r\n\t},\r\n\tclear: function() {\r\n\t\tGrid.clear()\r\n\t},\r\n\tclose: function() {\r\n\t\tGrid.exitPaintMode();\r\n\t},\r\n\tupload: function() {\r\n\t\tdocument.getElementById('bufferFileInput').click();\r\n\t},\r\n\tdownload: function() {\r\n\t\tGrid.downloadPattern()\r\n\t},\r\n\tupload_loop: function() {\r\n\t\tconsole.log('loop upload')\r\n\t},\r\n\tshare_pattern: function() {\r\n\t\tpatternEditor.toggle();\r\n\t},\r\n\tselect_loop: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\t$('#loop-library').addClass('select-mode open-lib');\r\n\t},\r\n\tselect_pattern: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\t$('#pattern-library').addClass('select-mode open-lib');\r\n\t},\r\n\trecount_base_color: function() {\r\n\t\tGrid.recount();\r\n\t}\r\n}\r\n\r\nvar isMouseDown = false;\r\n\r\nfunction setLineHeightAsParentHeight($el) {\r\n\t$el.each(function() {\r\n\t\t$(this).css({lineHeight: $(this).height()+'px'});\r\n\t})\r\n}\r\n\r\nvar Colors = {\r\n\tg: '#35752e', G: '#59c44d',\r\n\ty: '#7b7d25', Y: '#cccf41',\r\n\to: '#805c22', O: '#d2993e',\r\n\tb: '#2e6d90', B: '#4eb6f1',\r\n\tc: '#7b273d', C: '#cc4368',\r\n\tv: '#4e1e84', V: '#8238d8',\r\n\tm: '#686868', M: '#d2d2d2',\r\n\tj: '#468172', J: '#37C999',\r\n\t'.': '_VOID_', '_': '_VOID_'\r\n}\r\nvar colorMatch = new RegExp('(['+_.escapeRegExp(_.keys(Colors).join(''))+'])|\\\\[(.+?)\\\\]', 'g');\r\nvar colorMatchSqBr = new RegExp('(['+_.escapeRegExp(_.keys(Colors).join(''))+'])|(\\\\[.+?\\\\])', 'g');\r\n\r\nvar styles = {\r\n\tlegacy: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(25).toHexString();\r\n\t\treturn {\r\n\t\t\tu: 'background: radial-gradient(ellipse at center, '+baseColor+' 34%, '+darkenColor+' 81%);',\r\n\t\t\to: 'background: '+baseColor\r\n\t\t}\r\n\t},\r\n\tmodern: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(10).toHexString(), darker = color.darken(30).toRgbString();\r\n\t\treturn {\r\n\t\t\tu: 'background: radial-gradient(ellipse at center 7px, '+baseColor+' 0%, '+darkenColor+' 70%);',\r\n\t\t\to: 'background: '+baseColor+'; box-shadow: '+baseColor+' 0px 0px 0px 0px, '+baseColor+' 0px 0px 0px 0px, '+darker+' 0px 0px 0px 0px'\r\n\t\t}\r\n\t},\r\n\tflashes: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(10).toHexString(), darker = color.darken(30).toRgbString();\r\n\t\treturn {\r\n\t\t\tu: 'background: transparent; box-shadow: none;',\r\n\t\t\to: 'background: '+baseColor+'; box-shadow: '+baseColor+' 0px 0px 0px 0px, '+baseColor+' 0px 0px 0px 0px, '+darker+' 0px 0px 0px 0px'\r\n\t\t}\r\n\t},\r\n\tflat: function(color) {\r\n\t\tvar baseColor = color.toHexString(), lighten = color.brighten(25).saturate(15).toHexString();\r\n\t\treturn {\r\n\t\t\tu: 'background: '+baseColor+';',\r\n\t\t\to: 'background: '+lighten+';'\r\n\t\t}\r\n\t}\r\n}, defaultStyle = 'modern';\r\nstyles.transitional = styles.modern;\r\n\r\nvar globalCSS = {\r\n\tlegacy: \"html {\\\r\n\theight: 100%; \\\r\n\tbackground: #000; \\\r\n\tbackground: -webkit-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -ms-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -o-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -moz-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n  }\\\r\n  body {\\\r\n\tfont-family: 'Trebuchet MS',\\\r\n\tTrebuchet, Arial,Helvetica, sans-serif;\\\r\n  }\\\r\n  #shadow {\\\r\n\tbackground: rgba(33, 33, 33, 0.44);\\\r\n\tbox-shadow: 0 0 53px #212121;\\\r\n  }\",\r\n  transitional: \"html {\\\r\n\tbackground: #212121;\\\r\n  }\\\r\n  #shadow {\\\r\n\tbackground: rgba(33, 33, 33, 0.44);\\\r\n\tbox-shadow: 0 0 53px #212121;\\\r\n  }\",\r\n  flat: \"#nullgrid .cell:not(.void) {border-radius: 0; box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);}\\\r\n  #nullgrid .cell.under:not(.void) { box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2); }\"\r\n}\r\n\r\nfunction xBrowserIsMouseDown() {\r\n\treturn isMouseDown;\r\n}\r\n// stupid bug workaround\r\nvar isChrome = navigator.userAgent.match(/chrome\\/([0-9]+)/i);\r\nif(isChrome) {\r\n\tlet chromeVersion = isChrome[1];\r\n\tif(+chromeVersion >= 46)\r\n\txBrowserIsMouseDown = function() {\r\n\t\treturn $('body:active').length;\r\n\t}\r\n}\r\n\r\nvar animations = {\r\n  legacy: function() {\r\n\tvar color = this.style.backgroundColor\r\n\t, darken = tinycolor(color).darken(30).toRgbString();\r\n\tthis._tl.to(this, 0.1, {\r\n\t  opacity: 1,\r\n\t  boxShadow: color+' 0px 0px 2px 2px, '+color+' 0px 0px 10px 10px, '+darken+' 0px 0px 9px 9px',\r\n\t}).to(this, 0.4, {\r\n\t  opacity: 0,\r\n\t  boxShadow: color+' 0px 0px 0px 0px, '+color+' 0px 0px 0px 0px, '+darken+' 0px 0px 0px 0px',\r\n\t})\r\n  },\r\n /* flashes: function() {\r\n\t\tvar color = this.style.backgroundColor\r\n\t\t, darken = tinycolor(color).darken(30).toRgbString();\r\n\t\tthis._tl.to(this, 0.1, {\r\n\t\t  opacity: 1,\r\n\t\t  boxShadow: color+' 0px 0px 2px 2px, '+color+' 0px 0px 10px 10px, '+darken+' 0px 0px 9px 9px',\r\n\t\t}).to(this, 0.4, {\r\n\t\t  opacity: 0,\r\n\t\t  boxShadow: color+' 0px 0px 0px 0px, '+color+' 0px 0px 0px 0px, '+darken+' 0px 0px 0px 0px',\r\n\t\t})\r\n  },*/\r\n  flat: function() {\r\n\tvar color = this.style.backgroundColor;\r\n\tthis._tl.to(this, 0.1, {\r\n\t  opacity: 1,\r\n\t  boxShadow: 'inset 0 0 0 1px rgba(0, 0, 0, 0),' + color + ' 0px 0px 4px 2px',\r\n\t}).to(this, 0.6, {\r\n\t  opacity: 0,\r\n\t  boxShadow: 'inset 0 0 0 1px rgba(0, 0, 0, 0.2),' + color + ' 0px 0px 0px 0px',\r\n\t})\r\n  }\r\n}\r\nanimations.modern = animations.transitional = animations.flashes = animations.legacy;\r\n\r\nvar Grid = {\r\n\tinit: function(sel) {\r\n\t\tthis.$el = $(sel);\r\n\t\tvar self = this;\r\n\t\tthis.$el.find('.triangle-group').css({display: 'inline-block'}).hide();\r\n\t\tthis.$el.find('.tg-top .t-up').click(function() {self.resample('top', 1, 'under')});\r\n\t\tthis.$el.find('.tg-top .t-down').click(function() {self.resample('top', -1, 'under')});\r\n\t\tthis.$el.find('.tg-bottom .t-up').click(function() {self.resample('bottom', -1, 'under')});\r\n\t\tthis.$el.find('.tg-bottom .t-down').click(function() {self.resample('bottom', 1, 'under')});\r\n\t\tthis.$el.find('.tg-left .t-left').click(function() {self.resample('left', 1, 'under')});\r\n\t\tthis.$el.find('.tg-left .t-right').click(function() {self.resample('left', -1, 'under')});\r\n\t\tthis.$el.find('.tg-right .t-left').click(function() {self.resample('right', -1, 'under')});\r\n\t\tthis.$el.find('.tg-right .t-right').click(function() {self.resample('right', 1, 'under')});\r\n\t\tthis.shuffler = new Rarity(50);\r\n\t\tif(this.lastOsc !== 'default')\r\n\t\t\tthis.setOsc(this.lastOsc);\r\n\t\tthis.changeStyle(this.baseStyle, this.pattern);\r\n\t},\r\n\tpattern: localStorage['customPattern'] || defaultPattern,\r\n\tbaseStyle: localStorage['lastStyle'] || defaultStyle,\r\n\tlastOsc: localStorage['lastOsc'] || 'default',\r\n\trevert: function() {\r\n\t\t$('#osc-sel').val('default');\r\n\t\tthis.changeStyle(this.baseStyle, this.pattern);\r\n\t},\r\n\tstyle: this.baseStyle,\r\n\tchangeStyle: function(style,thenBuild) {\r\n\t\tif(!_.has(styles, style))\r\n\t\t\treturn console.error('Не существует такого стиля');\r\n\t\t$('#cell-style').val(style);\r\n\t\tif(typeof thenBuild === 'undefined') thenBuild = false;\r\n\t\tthis.style = style;\r\n\t\tinjector.remove('cellstyle');\r\n\t\tif(_.has(globalCSS, style)) \r\n\t\t\tinjector.inject('cellstyle', globalCSS[style]);\r\n\t\tthis.build(thenBuild);\r\n\t},\r\n\tsetOsc: function(color) {\r\n\t\tif(color === 'off') {\r\n\t\t\t$('#osc-sel').val('off');\r\n\t\t\t$('body').addClass('osc-disabled');\r\n\t\t\tconf.osc = false;\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconf.osc = true;\r\n\t\tif(color === 'default') {\r\n\t\t\t$('#osc-color').attr('disabled', true);\r\n\t\t\tcolor = Grid.primaryColor;\r\n\t\t\t$('#osc-sel').val('default');\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$('#osc-sel').val('custom');\r\n\t\t\t$('#osc-color').attr('disabled', false);\r\n\t\t}\r\n\t\tif($('#osc-toggle')[0].checked)\r\n\t\t\t$('body').removeClass('osc-disabled');\r\n\t\tvar $oscC = $('#osc-color');\r\n\t\tif($oscC[0].hasOwnProperty('color'))\r\n\t\t\t$oscC[0].color.fromString(color);\r\n\t\telse\r\n\t\t\t$oscC.val(color);\r\n\t\tif(color.indexOf('#') == (-1))\r\n\t\t\tcolor = '#'+color;\r\n\t\tdrawContext.fillStyle = color;\r\n\t},\r\n\tgenerateCell: function(color, layer, style) {\r\n\t\tif(typeof style === 'undefined') style = this.style;\r\n\t\tvar char = color.split(/[\\[\\]]/)[1] || color.split(/[\\[\\]]/)[0]\r\n\t\t, color = _.has(Colors, char) ? tinycolor(Colors[char]) : tinycolor(char)\r\n\t\t, cstring = _.has(Colors, char) ? char : ('#'+color.toHex().toLowerCase())\r\n\t\t, style = styles[style](color);\r\n\t\tif(color._format && color._a >= conf.colorAlphaTreshold) {\r\n\t\t\tif(layer == 'under')\r\n\t\t\t\treturn $('<div data-c=\"'+cstring+'\" class=\"cell under\" style=\"'+style.u+'\"></div>');\r\n\t\t\telse {\r\n\t\t\t\tvar $cell = $('<div data-c=\"'+cstring+'\" class=\"cell over\" style=\"'+style.o+'\"></div>');\r\n\t\t\t\t$cell[0]._tl = new TimelineLite()\r\n\t\t\t\tvar blink = function() {\r\n\t\t\t\t\tthis._tl.progress(0)\r\n\t\t\t\t}\r\n        let passive = detectPassiveEvents.hasSupport ? {passive: true} : false;\r\n\t\t\t\t$cell[0].addEventListener('mouseenter', blink, passive);\r\n\t\t\t\t$cell[0].addEventListener('touchstart', blink, passive);\r\n\t\t\t\treturn $cell;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(layer == 'under')\r\n\t\t\t\treturn $('<div class=\"cell under void\" data-c=\"_\"></div>');\r\n\t\t\tif(layer == 'over')\r\n\t\t\t\treturn $('<div class=\"cell void\" data-c=\"_\"></div>');\r\n\t\t}\r\n\t},\r\n\tlastBuild: {\r\n\t\tpattern: '',\r\n\t\tlayer: '',\r\n\t\tstyle: ''\r\n\t},\r\n\tbuild: function(pattern, layer) {\r\n\t\tif(typeof pattern !== 'string') pattern = this.getPattern();\r\n\t\tif(typeof layer === 'undefined') layer = $('#grid-wrap').hasClass('edit-mode') ? 'under' : 'both';\r\n\t\tpattern = pattern\r\n\t\t.replace(/\\s+/g, '')\r\n\t\t.replace(/\\|{2,}/g, '|')\r\n\t\t.replace(/^\\|/g, '')\r\n\t\t.replace(/\\|$/g, '');\r\n\t\t// prevent same pattern rebuilding\r\n\t\tif(pattern === this.lastBuild.pattern && layer === this.lastBuild.layer && this.style === this.lastBuild.style) return;\r\n\t\tthis.lastBuild.pattern = pattern; this.lastBuild.layer = layer; this.lastBuild.style = this.style;\r\n\t\tvar $cells = this.$el.find('#cells'), $overlays = this.$el.find('#overlays');\r\n\t\tif(layer != 'over') $cells.find('.cell, br').remove();\r\n\t\tif(layer != 'under') $overlays.find('.cell, br').remove();\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\t_.each(lines, function(line, li) {\r\n\t\t\tvar chars = _.compact(line.split(colorMatch));\r\n\t\t\t_.each(chars, function(char, ci) {\r\n\t\t\t\tif(layer != 'over')\r\n\t\t\t\t\tthis.generateCell(char, 'under').attr('id', 'cu_'+li+'_'+ci).appendTo($cells)\r\n\t\t\t\tif(layer != 'under')\r\n\t\t\t\t\tthis.generateCell(char, 'over').attr('id', 'co_'+li+'_'+ci).appendTo($overlays)\r\n\t\t\t}, this) // /each\r\n\t\t\tif(layer != 'over')\r\n\t\t\t\t$('<br>').appendTo($cells)\r\n\t\t\tif(layer != 'under')\r\n\t\t\t\t$('<br>').appendTo($overlays)\r\n\t\t}, this)\r\n\t\t//initial blink\r\n\t\tif(layer !== 'under')\r\n\t\t\tvar style = this.style;\r\n\t\t\t$('.over').each(animations[style]);\r\n\t\tthis.recount(layer);\r\n\t},\r\n\tenterPaintMode: function() {\r\n\t\t$('#overlays').empty();\r\n\t\t$('#controls').fadeOut();\r\n\t\t$('#editmode').slideDown();\r\n\t\t// $('#nerdmode').slideUp();\r\n\t\t// toggleAnlzOpts()\r\n\t\taudio.stop(function() {\r\n\t\t\t$('#playSwitcher i').removeClass('i-pause-big').addClass('i-play-big')\r\n\t\t});\r\n\t\t$('#cells').on('mousedown mouseenter', '.cell', function(ev) {\r\n\t\t\tif(!brush.mode || (ev.type == 'mouseenter' && ! xBrowserIsMouseDown()/*isMouseDown*/ /*$('body:active').length*/ ) ) return;\r\n\t\t\tif(brush.mode === 'dropper') {\r\n\t\t\t\tvar color = $(this).data('c');\r\n\t\t\t\t$('.swatch').removeClass('selected');\r\n\t\t\t\tif(_.has(Colors, color)) {\r\n\t\t\t\t\t$('#swatch-'+color).addClass('selected');\r\n\t\t\t\t\tbrush.color = color;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tbrush.color = color;\r\n\t\t\t\t\t$('#colorpicker')[0].color.fromString(tinycolor(color).toHexString()) \r\n\t\t\t\t\t$('#colorpicker').addClass('selected');\r\n\t\t\t\t\tif(!$('#dynamic-palette [data-c='+color.toLowerCase()+']').length) {\r\n\t\t\t\t\t\t$('#dynamic-palette').prepend(Grid.generateCell(color, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+color));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar id = $(this).attr('id');\r\n\t\t\t\tvar color = (brush.mode === 'eraser') ? '_' : brush.color;\r\n\t\t\t\t$(this).replaceWith(Grid.generateCell(color, 'under').attr('id', id));\r\n\t\t\t\tif(!_.has(Colors, color) && !$('#dynamic-palette [data-c='+color.toLowerCase()+']').length) \r\n\t\t\t\t\t$('#dynamic-palette').prepend(Grid.generateCell(color, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+color));\r\n\t\t\t\tGrid.lastBuild.pattern = '';\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.$el.parent().addClass('edit-mode');\r\n\t\t$('.triangle-group').slideDown();\r\n\t},\r\n\tbrush: false,\r\n\tsaveState: function(pattern) {\r\n\t\tif(typeof pattern === 'undefined') pattern = this.getPattern();\r\n\t\tthis.pattern = localStorage['customPattern'] = pattern;\r\n\t\tthis.baseStyle = localStorage['lastStyle'] = this.style;\r\n\t\tvar oscMode = $('#osc-sel').val();\r\n\t\tlocalStorage['lastOsc'] = (oscMode === 'custom') ? $('#osc-color').val() : oscMode;\r\n\t},\r\n\texitPaintMode: function() {\r\n\t\t$('#cells').off();\r\n\t\tvar newPattern = this.getPattern();\r\n\t\tthis.lastBuild.pattern = '';\r\n\t\tthis.build(newPattern, 'over');\r\n\t\tthis.$el.parent().removeClass('edit-mode');\r\n\t\t$('.triangle-group').slideUp();\r\n\t\tthis.saveState(newPattern);\r\n\t\t$('#controls').slideDown();\r\n\t\t$('#editmode').slideUp();\r\n\t},\r\n\tgetPattern: function() {\r\n\t\tvar row = 0, code, output = '';\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tif($(this).attr('id').split('_')[1] > row) {\r\n\t\t\t\toutput += '|'; \r\n\t\t\t\trow++;\r\n\t\t\t}\r\n\t\t\tcode = $(this).data('c');\r\n\t\t\tif(code.length > 1) code = '['+code+']';\r\n\t\t\toutput += code; \r\n\t\t})\r\n\t\treturn output;\r\n\t},\r\n\trecount: function(layer) {\r\n\t\tif(typeof layer === 'undefined') layer = $('#grid-wrap').hasClass('edit-mode') ? 'under' : 'over';\r\n\t\tvar lc = (layer === 'under') ? 'under' : 'over';\r\n\t\tvar cells = document.querySelectorAll('.cell.'+lc+':not(.void)');\r\n\t\tif(layer !== 'under') {\r\n\t\t\tthis.cells = cells; \r\n\t\t\t// this.reshuffle();\r\n\t\t\tthis.intoRows();\r\n\t\t\tthis.cellCount = this.cells.length;\r\n\t\t\tthis.trimmingConstant = Math.floor(Math.sqrt(this.cellCount));\r\n\t\t}\r\n\t\t\r\n\t\tvar primaryColor = (function(cc) {return _.invert(cc)[_.max(cc)]})(_.countBy(_.pluck(_.pluck(cells, 'dataset'), 'c')));\r\n\t\tthis.primaryColor = _.has(Colors, primaryColor) ? Colors[primaryColor] : tinycolor(primaryColor).toHexString();\r\n\t\t\r\n\t\tif($('#osc-sel').val() == 'default') \r\n\t\t\tthis.setOsc('default');\r\n\t\t\r\n\t\t// resample layers\r\n\t\tvar selfHeight = this.$el.find('#cells').height(), selfWidth = this.$el.find('#cells').width();\r\n\t\t$('.wrapper-xh').css({'top': ((selfHeight +  conf.topOffset) - conf.barHeight)+'px'});\r\n\t\t$('#shadow').width(selfWidth + 20);\r\n\t\tthis.height = selfHeight / 20;\r\n\t\tthis.width = selfWidth / 20; // where cell is 20×20\r\n\t\tvar _x = this.width, _y = this.height;\r\n\t\t$('#sizeIndicator').text(_x+' × '+_y)\r\n\t},\r\n\t/*reshuffle: function() {\r\n\t\tthis.cellsShuffled = _.shuffle(this.cells); \r\n\t},\r\n\trareShuffle: function() {\r\n\t\tthis.shuffler.do(this.reshuffle.bind(this))\r\n\t},*/\r\n\tflash: function(i) {\r\n\t\tif(i+1 <= this.cellCount)\r\n\t\t\tthis.cells[i]._tl.progress(0);\r\n\t},\r\n\tintoRows: function() {\r\n\t\tlet cellsArranged = []\r\n\t\tArray.prototype.forEach.call(this.cells, cell => {\r\n\t\t\tlet [_, y, x] = cell.getAttribute('id').split('_')\r\n\t\t\tif (! cellsArranged[y]) {\r\n\t\t\t\tcellsArranged[y] = []\r\n\t\t\t}\r\n\t\t\tcellsArranged[y][x] = cell\r\n\t\t})\r\n\t\tthis.cellsArranged = cellsArranged.reverse()\r\n\t},\r\n\tflashXY: function(x, y) {\r\n\t\tlet cellY = this.cellsArranged[y]\r\n\t\tif (!cellY) return;\r\n\t\tlet cell = cellY[x]\r\n\t\tif (cell && cell.hasOwnProperty('_tl')) {\r\n\t\t\tcell._tl.progress(0)\r\n\t\t}\r\n\t},\r\n\tflashRow: function(y) {\r\n\t\tlet cellY = this.cellsArranged[y]\r\n\t\tif (!cellY) return;\r\n\t\tlet i = 0\r\n\t\twhile (i < this.flashDensity) {\r\n\t\t\tlet cell = cellY[Math.floor(Math.random() * cellY.length)]\r\n\t\t\tif (cell && cell.hasOwnProperty('_tl')) {\r\n\t\t\t\tcell._tl.progress(0)\r\n\t\t\t}\r\n\t\t\ti++\r\n\t\t}\r\n\t},\r\n\tflashDensity: 1,\r\n\t/*flashRow: function(y) {\r\n\t\tif (this.cellsArranged[y] && this.cellsArranged[y].length)\r\n\t\t\tthis.cellsArranged[y].forEach(cell => {\r\n\t\t\t\tif (cell.hasOwnProperty('_tl'))\r\n\t\t\t\t\tcell._tl.progress(0)\r\n\t\t\t})\r\n\t},*/\r\n\t/*fuzzyFlash: function(i) {\r\n\t\tif(i+1 <= this.cellCount)\r\n\t\t\tif(Math.random() > conf.flashFuzziness)\r\n\t\t\t\tthis.cells[i]._tl.progress(0);\r\n\t\t\telse {\r\n\t\t\t\tthis.cellsShuffled[i]._tl.progress(0);\r\n\t\t\t}\r\n\t},*/\r\n\tresample: function(direction, amount, layer) {\r\n\t\tvar pattern = this.getPattern();\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\tvar output = [];\r\n\t\tif(isNaN(amount) || amount === 0) return;\r\n\t\tif(amount < 0) {\r\n\t\t\tvar _remove = _.includes(['left', 'top'], direction) ? _.drop : _.dropRight;\r\n\t\t\tif(_.includes(['left', 'right'], direction)) \r\n\t\t\t\toutput = _.map(lines, function(line) { \r\n\t\t\t\t\tvar chars = _.compact(line.split(colorMatchSqBr));\r\n\t\t\t\t\treturn _remove(chars, (-amount)).join('') \r\n\t\t\t\t});\r\n\t\t\telse \r\n\t\t\t\toutput = _remove(lines, (-amount));\r\n\t\t}\r\n\t\tif(amount > 0) {\r\n\t\t\tif(direction == 'left')\r\n\t\t\t\toutput = _.map(lines, function(line) { return _.repeat('_', amount)+line });\r\n\t\t\tif(direction == 'right')\r\n\t\t\t\toutput = _.map(lines, function(line) { return line+_.repeat('_', amount) });\r\n\t\t\tif(_.includes(['top', 'bottom'], direction)) {\r\n\t\t\t\tvar  linelength = _.compact(_.max(lines, function(line) { \r\n\t\t\t\t\treturn _.compact(line.split(colorMatch)).length \r\n\t\t\t\t}).split(colorMatch)).length;\r\n\t\t\t\tvar add = _.times(amount, function() { return _.repeat('_', linelength) });\r\n\t\t\t\toutput = (direction == 'top') ? add.concat(lines) : lines.concat(add);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.build(output.join('|'), layer)\r\n\t},\r\n\trandomfill: function() {\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tvar color = Math.random() >= 0.5 ? tinycolor.random().toHexString() : '_';\r\n\t\t\tvar id = $(this).attr('id');\r\n\t\t\t$(this).replaceWith(Grid.generateCell(color, 'under').attr('id', id));\r\n\t\t});\r\n\t},\r\n\tclear: function() {\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tvar id = $(this).attr('id');\r\n\t\t\t$(this).replaceWith(Grid.generateCell('_', 'under').attr('id', id));\r\n\t\t});\r\n\t},\r\n\tfromCanvas: function() {\r\n\t\tvar h = bufferCanvas.height, w = bufferCanvas.width;\r\n\t\tvar x, y, px, output = \"\";\r\n\t\tfor(y=0; y < h; y++) {\r\n\t\t\tfor(x=0; x < w; x++) {\r\n\t\t\t\tpx = bufferContext.getImageData(x, y, 1, 1).data;\r\n\t\t\t\toutput += '[rgba(' + px[0] + ',' + px[1] + ',' + px[2] + ',' + px[3] + ')]';\r\n\t\t\t}\r\n\t\t\tif(y != (h-1)) output += '|';\r\n\t\t}\r\n\t\tthis.build(output)\r\n\t},\r\n\tdownloadPattern: function() {\r\n\t\t$('#bufferLink').attr('href', this.toCanvas())[0].click();\r\n\t},\r\n\ttoCanvas: function(pattern, width, height) {\r\n\t\tif(typeof width === \"undefined\") width = this.width;\r\n\t\tif(typeof height === \"undefined\") height = this.height;\r\n\t\tbufferCanvas.width = width;\r\n\t\tbufferCanvas.height = height;\r\n\t\tif(typeof pattern === 'undefined')\r\n\t\t\tpattern = this.getPattern();\r\n\t\tvar output = new Uint8ClampedArray(width * height * 4);\r\n\t\tvar i=0, j;\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\t_.each(lines, function(line, li) {\r\n\t\t\tvar chars = _.compact(line.split(colorMatch));\r\n\t\t\tif(chars.length < width) {\r\n\t\t\t\tlet offset = width - chars.length\r\n\t\t\t\t, offsetLeft = Math.floor(offset/2)\r\n\t\t\t\t, offsetRight = Math.ceil(offset/2)\r\n\t\t\t\t_.times(offsetLeft, function() {\r\n\t\t\t\t\tchars.unshift('_');\r\n\t\t\t\t});\r\n\t\t\t\t_.times(offsetRight, function() {\r\n\t\t\t\t\tchars.push('_');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t_.each(chars, function(char, ci) {\r\n\t\t\t\tvar color = _.has(Colors, char) ? tinycolor((Colors[char] == \"_VOID_\") ? 'rgba(0,0,0,0)': Colors[char]) : tinycolor(char.replace(/[\\[\\]]/g, ''));\r\n\t\t\t\tj = i*4;\r\n\t\t\t\toutput[j] = color._r;\r\n\t\t\t\toutput[j+1] = color._g;\r\n\t\t\t\toutput[j+2] = color._b;\r\n\t\t\t\toutput[j+3] = color._a*255;\r\n\t\t\t\ti++;\r\n\t\t\t})\r\n\t\t});\r\n\t\t_debug_ = {\r\n\t\t\toutput: output,\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t}\r\n\t\tbufferContext.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);\r\n\t\tlet imageData = bufferContext.createImageData(width, height);\r\n\t\timageData.data.set(output);\r\n\t\tbufferContext.putImageData(imageData, 0, 0);\r\n\t\treturn bufferCanvas.toDataURL('image/png');\r\n\t}\r\n};\r\n\r\nvar _debug_;\r\n\r\nvar brush = {\r\n\tmode: false,\r\n\tcolor: 'J'\r\n};\r\n\r\nfunction _test(N) {\r\n\tfor (var i = 0; i < N; i++) {\r\n\t\tsetInterval(function() {Grid.flash(_.random(0, Grid.cellCount-1))}, _.random(400, 3000))\r\n\t};\r\n}\r\n\r\nconst ranges = {\r\n\tdefaults: {\r\n\t\tfreq: [0, 18000],\r\n\t\tdb: [-120, 0],\r\n\t\tsmoothing: 0.1,\r\n\t\ttreshold: 1.5\r\n\t},\r\n\tcurrent: {},\r\n\tinit: function() {\r\n\t\tthis.freq = $(\"#frequency_range\").ionRangeSlider({\r\n\t\t\ttype: 'double',\r\n\t\t\tmin: 0, \r\n\t\t\tmax: this.sampleRate/2,\r\n\t\t\tmin_interval: 1000,\r\n\t\t\tdrag_interval: true,\r\n\t\t\tgrid_num: 6,\r\n\t\t\tvalues_separator: '...',\r\n\t\t\tgrid: true,\r\n\t\t\tfrom: this.defaults.freq[0],\r\n\t\t\tto: this.defaults.freq[1],\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.freq = [data.from, data.to]\r\n\t\t\t\tthis.current.numSamples = this.hz2samples(data.to - data.from)\r\n\t\t\t\tthis.current.sampleOffset = this.hz2samples(data.from)\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.db = $(\"#dynamic_range\").ionRangeSlider({\r\n\t\t\ttype: 'double',\r\n\t\t\tmin: -200, \r\n\t\t\tmax: 0,\r\n\t\t\tfrom: this.defaults.db[0],\r\n\t\t\tto: this.defaults.db[1],\r\n\t\t\tmin_interval: 10,\r\n\t\t\tgrid_num: 5,\r\n\t\t\tvalues_separator: '...',\r\n\t\t\tdrag_interval: true,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.db = [data.from, data.to]\r\n\t\t\t\tvisualizer.analyser.minDecibels = data.from\r\n\t\t\t\tvisualizer.analyser.maxDecibels = data.to\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.smoothing = $('#smoothing').ionRangeSlider({\r\n\t\t\tmin: 0, \r\n\t\t\tmax: 1,\r\n\t\t\tstep: 0.01,\r\n\t\t\tfrom: this.defaults.smoothing,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.smoothing = data.from\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.treshold = $('#treshold').ionRangeSlider({\r\n\t\t\tmin: 0.5, \r\n\t\t\tmax: 3,\r\n\t\t\tstep: 0.01,\r\n\t\t\tgrid_num: 5,\r\n\t\t\tfrom: this.defaults.treshold,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.treshold = data.from\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.sync()\r\n\t},\r\n\tget sampleRate() {\r\n\t\ttry {\r\n\t\t\treturn audio.context.sampleRate\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\treturn 48000\r\n\t\t}\r\n\t},\r\n\tget fftSize() {\r\n\t\ttry {\r\n\t\t\treturn visualizer.analyser.fftSize\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\treturn conf.fftSize\r\n\t\t}\r\n\t},\r\n\thz2samples: function(hz) { return Math.round(hz / (this.sampleRate/this.fftSize)) },\r\n\tsamples2hz: function(samples) { return Math.round(samples * (this.sampleRate/this.fftSize))},\r\n\tsync: function(settings = {}) {\r\n\t\tsettings = _.defaults(settings, this.defaults)\r\n\t\tthis.freq.update({\r\n\t\t\tmax: this.sampleRate/2,\r\n\t\t\tfrom: settings.freq[0],\r\n\t\t\tto: settings.freq[1]\r\n\t\t})\r\n\t\tthis.db.update({\r\n\t\t\tfrom: settings.db[0],\r\n\t\t\tto: settings.db[1]\r\n\t\t})\r\n\t\tthis.smoothing.update({\r\n\t\t\tfrom: settings.smoothing\r\n\t\t})\r\n\t\tthis.treshold.update({\r\n\t\t\tfrom: settings.treshold\r\n\t\t})\r\n\t\t;['freq', 'db', 'smoothing', 'treshold'].forEach(prop => this[prop].callOnChange())\r\n\t}\r\n}\r\n\r\n/* A U D I O */ \r\nvar audio = {\r\n\tbuffer: {},\r\n\tcompatibility: {},\r\n\tsupported: true,\r\n\tsource_loop: {},\r\n\tsource_once: {},\r\n\tdisabled: true\r\n};\r\n\r\nvar currentLoop = {};\r\n\r\nvar expectedLoop;\r\n\r\naudio.stop = function(callback) {\r\n\tif(audio.source_loop._playing) {\r\n\t\tTweenLite.to(gainNode.gain, 0.2, {value: 0, onComplete: function() {\r\n\t\t\taudio.source_loop[audio.compatibility.stop](0);\r\n\t\t\taudio.source_loop._playing = false;\r\n\t\t\taudio.source_loop._startTime = 0;\r\n\t\t\tif (audio.compatibility.start === 'noteOn') {\r\n\t\t\t\taudio.source_once[audio.compatibility.stop](0);\r\n\t\t\t}\r\n\t\t\tif(typeof callback === \"function\") callback();\r\n\t\t}});\r\n\t\t$('.wrapper-decor').fadeOut();\r\n\t}   \r\n\telse if(typeof callback === \"function\") callback();\r\n}\r\n\r\naudio.loadLoop = function(immed, loop) {\r\n\taudio.disabled = true;\r\n\tvar newLoop = {};\r\n\tif(typeof loop === 'object') {\r\n\t\tnewLoop = loop;\r\n\t}\r\n\telse return console.log('unsupported')\r\n\r\n\tvar req = new XMLHttpRequest();\r\n\t\r\n\tvar expectedToken = ''+loop.original_hash+(new Date().getTime());\r\n\texpectedLoop = expectedToken;\r\n\t\t\r\n\treq.onload = function() {\r\n\t\tif(expectedToken === expectedLoop)\r\n\t\taudio.context.decodeAudioData(\r\n\t\t\treq.response,\r\n\t\t\tfunction(buffer) {\r\n\t\t\t\tranges.sync(newLoop)\r\n\t\t\t\taudio.buffer = buffer;\r\n\t\t\t\taudio.source_loop = {};\r\n\t\t\t\tcurrentLoop  = newLoop;\r\n\t\t\t\taudio.disabled = false;\r\n\t\t\t\tif(immed) audio.play();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\taudio.stop(function() {\r\n\t\treq.open('GET', urlprefix+loop.section+'/'+loop.original_hash+'.'+fileFormat, true);\r\n\t\treq.responseType = 'arraybuffer';\r\n\t\treq.send();\r\n\t})\r\n}\r\n\r\ntry {\r\n\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\taudio.context = new window.AudioContext();\r\n} catch(e) {\r\n\taudio.supported = false;\r\n}\r\n\r\nvar visualizer = {}, gainNode;\r\n\r\nif(audio.supported) {\r\n\t(function() {\r\n\t\tvar start = 'start',\r\n\t\t\tstop = 'stop',\r\n\t\t\tbuffer = audio.context.createBufferSource();\r\n\t\tif (typeof buffer.start !== 'function') {\r\n\t\t\tstart = 'noteOn';\r\n\t\t}\r\n\t\taudio.compatibility.start = start;\r\n\t\tif (typeof buffer.stop !== 'function') {\r\n\t\t\tstop = 'noteOff';\r\n\t\t}\r\n\t\taudio.compatibility.stop = stop;\r\n\t})();\r\n\tgainNode = audio.context.createGain();\r\n\tgainNode.gain.value = 1;\r\n\tvisualizer = new VisualizerSample();\r\n\tgainNode.connect(visualizer.analyser);\r\n}\r\n\r\naudio.play = function() {\r\n\tTweenLite.to(gainNode.gain, 0, {value: 1});\r\n\tif(audio.disabled) return AllTracks.random();\r\n\r\n\tif (audio.source_loop._playing) {\r\n\t\taudio.stop();\r\n\t\t$('#playSwitcher i').removeClass('i-pause-big').addClass('i-play-big')\r\n\t} \r\n\telse {\r\n\t\t$('.wrapper-decor').fadeIn();\r\n\r\n\t\taudio.source_loop = audio.context.createBufferSource();\r\n\t\taudio.source_loop.buffer = audio.buffer;\r\n\t\taudio.source_loop.loop = true;\r\n\t\taudio.source_loop.connect(gainNode);\r\n \r\n\t\tif (audio.compatibility.start === 'noteOn') {\r\n\t\t\taudio.source_once = audio.context.createBufferSource();\r\n\t\t\taudio.source_once.buffer = audio.buffer;\r\n\t\t\taudio.source_once.connect(gainNode);\r\n\t\t\taudio.source_once.noteGrainOn(0, 0, audio.buffer.duration);\r\n\r\n\t\t\taudio.source_loop[audio.compatibility.start](audio.buffer.duration);\r\n\t\t} else {\r\n\t\t\taudio.source_loop[audio.compatibility.start](0, 0);\r\n\t\t}\r\n\t\taudio.source_loop._playing = true;\r\n\r\n\t\tif(!visualizer._drawing) {\r\n\t\t\tframe(visualizer.draw.bind(visualizer));\r\n\t\t\tvisualizer._drawing = true;\r\n\t\t}\r\n\t\t$('#playSwitcher i').removeClass('i-play-big').addClass('i-pause-big')\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nvar frame = (function() {\r\nreturn  window.requestAnimationFrame || \r\n\twindow.webkitRequestAnimationFrame || \r\n\twindow.mozRequestAnimationFrame    || \r\n\twindow.oRequestAnimationFrame      || \r\n\twindow.msRequestAnimationFrame     || \r\n\tfunction( callback ) {\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t};\r\n})();\r\n\r\nfunction record_mode() {\r\n  conf.topOffset = 110\r\n  Grid.recount()\r\n  injector.inject('recmode', `#grid-wrap {  margin-top: 66px } .player-controls {opacity: 0} .player-controls:hover {opacity: 1}`)\r\n}\r\n\r\nfunction logIfDown() {\r\n  if (xBrowserIsMouseDown()) {\r\n      console.dir.apply(this, arguments)\r\n  }\r\n}\r\n\r\nfunction VisualizerSample() {\r\n\tthis.analyser = audio.context.createAnalyser();\r\n\r\n\tthis.analyser.connect(audio.context.destination);\r\n\t/*this.analyser.minDecibels = conf.minDecibels;\r\n\tthis.analyser.maxDecibels = 0;*/\r\n\ttry {\r\n\t\tthis.analyser.fftSize = conf.fft_size;\r\n\t\t$('label[for=fft_size] .indicator').removeClass('illegal')\r\n\t}\r\n\tcatch(e) {\r\n\t\t$('label[for=fft_size] .indicator').addClass('illegal')\r\n\t}\r\n\tthis.samples = new Uint8Array(this.analyser.frequencyBinCount);\r\n}\r\nconst channel = {\r\n\tinit: function() {\r\n\t\tthis.canvas = $('#samplecanvas')[0]\r\n\t\tthis.ctx = this.canvas.getContext('2d')\r\n\t\tthis.canvas.width = conf.fft_size / 2\r\n\t},\r\n\tdebugOn: false,\r\n\thistory: [],\r\n\tcurrent: [],\r\n\t// Main function (input + getJumps). Takes spectrum, returns jumps, draws debug graph\r\n\ttick: function(spectrum) {\r\n\t\tlet numSamples = ranges.current.numSamples\r\n\t\t, offset = ranges.current.sampleOffset\r\n\t\t, numBands = Grid.height\r\n\t\t, bands = []\r\n\t\t, bandWidths = []\r\n\t\t, spectrumLength = spectrum.length\r\n\t\t// Fill\r\n\t\tfor (let i = 0; i < spectrumLength; i++) {\r\n\t\t\tif (i >= offset && i < offset + numSamples) { // For all bands in analysis range\r\n\t\t\t\tlet n = i - offset, bandNum\r\n\r\n\t\t\t\tif (this.debugOn) {\r\n\t\t\t\t\tthis.ctx.fillStyle = conf.lightWave\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// determaine which to which band the sample goes\r\n\t\t\t\tif (conf.distributionLaw === 'quadratic')\r\n\t\t\t\t\tbandNum = Math.floor(numBands * Math.abs(Math.pow(n/(numSamples), 2)))\r\n\t\t\t\telse if (conf.distributionLaw === 'reverse-quadratic') //do not use (please)\r\n\t\t\t\t\tbandNum = numBands - Math.floor(numBands * Math.abs(Math.pow((numSamples-n)/(numSamples), 2)))\r\n\t\t\t\telse //linear\r\n\t\t\t\t\tbandNum = Math.floor(n / (numSamples / numBands))\r\n\r\n\t\t\t\tif (!bandWidths[bandNum]) {\r\n\t\t\t\t\tbands[bandNum] = 0;\r\n\t\t\t\t\tbandWidths[bandNum] = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet sample = Math.min(Math.abs(spectrum[i] / 256), 1)\r\n\t\t\t\t// , lastHistoryRecord = _.last(this.history)\r\n\t\t\t\t// , treshold = lastHistoryRecord ? lastHistoryRecord[bandNum] : conf.absoluteTreshold\r\n\r\n\t\t\t\tif (sample < conf.absoluteTreshold) {\r\n\t\t\t\t\tsample = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbands[bandNum] += sample;\r\n\t\t\t\tbandWidths[bandNum] += 1;\r\n\t\t\t}\r\n\t\t\telse if(this.debugOn) { // for samples outside analysis range, draw them darker\r\n\t\t\t\tthis.ctx.fillStyle = conf.darkWave\r\n\t\t\t}\r\n\t\t\tif(this.debugOn) { // building sample graph\r\n\t\t\t\tlet barHeight = Math.round(100 * (spectrum[i] / 256))\r\n\t\t\t\tif (barHeight)\r\n\t\t\t\t\tthis.ctx.fillRect(i, 100-barHeight, 1, barHeight)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Normalize\r\n\t\tfor (let i = 0; i < numBands; i++) {\r\n\t\t\tif (bandWidths[i] > 0) {\r\n\t\t\t\tbands[i] /= bandWidths[i];\r\n\t\t\t} else {\r\n\t\t\t\tbands[i] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.current) {\r\n\t\t\tthis.history.push(this.current);\r\n\t\t}\r\n\r\n\t\twhile (this.history.length > conf.historySize) {\r\n\t\t\tthis.history.shift();\r\n\t\t}\r\n\r\n\t\tthis.current = bands;\r\n\r\n\t\t// ----------- input() function end; getJumps() function begin -----------\r\n\t\tlet average = []\r\n\t\t, jumps = []\r\n\r\n\t\t// Get historical averages for bands\r\n\t\tfor (let i = 0; i < this.history.length; i++) {\r\n\t\t\tfor (let band = 0; band < numBands; band++) {\r\n\t\t\t\tif (!average[band]) {\r\n\t\t\t\t\taverage[band] = 0;\r\n\t\t\t\t}\r\n\t\t\t\taverage[band] += this.history[i][band];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet offsetLeft = offset // reset canvas' x-coordinate counter\r\n\r\n\t\tfor (let band = 0; band < numBands; band++) {\r\n\t\t\t// normalize\r\n\t\t\tif (average[band] > 0) {\r\n\t\t\t\taverage[band] /= this.history.length;\r\n\t\t\t} else {\r\n\t\t\t\taverage[band] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.debugOn) {\r\n\t\t\t\tthis.ctx.fillStyle = band%2 ? 'green': 'purple'\r\n\t\t\t\tthis.ctx.fillRect(offsetLeft, 100, bandWidths[band], 3)\r\n\t\t\t\tthis.ctx.fillRect(offsetLeft, 103, bandWidths[band], bands[band]*57)\r\n\t\t\t}\r\n\r\n\t\t\tif (this.current[band] > average[band] * ranges.current.treshold) {\r\n\t\t\t\tjumps[band] = 1;\r\n\t\t\t\t// Show jumps on graph\r\n\t\t\t\tif (this.debugOn) {\r\n\t\t\t\t\tthis.ctx.fillStyle = band%2 ? 'lime': 'magenta'\r\n\t\t\t\t\tthis.ctx.fillRect(offsetLeft, 105 + bands[band]*57 - 4, bandWidths[band], 4)\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\telse {\r\n\t\t\t\tjumps[band] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.debugOn) {\r\n\t\t\t\toffsetLeft += bandWidths[band]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn jumps\r\n\t}\r\n}\r\n\r\nVisualizerSample.prototype.draw = function() {\r\n\tthis.analyser.smoothingTimeConstant = ranges.current.smoothing;\r\n\r\n\tthis.analyser.getByteFrequencyData(this.samples);\r\n\r\n\tif(conf.osc)\r\n\t\tdrawContext.clearRect(0,0,conf.barWidth,conf.barHeight);\r\n\t\r\n\tfor (var i = 0; i < this.analyser.frequencyBinCount; i++) {\r\n\t\tvar value = this.samples[i];\r\n\t\tvar percent = value / 256;\r\n\r\n\t\t/*if(percent > (conf.treshold + conf.tresholdCorrection) && Math.random() < conf.flashProbability)\r\n\t\t\tGrid.fuzzyFlash(i)*/\r\n\r\n\t\tif(conf.osc) {\r\n\t\t\tvar height = conf.barHeight * percent;\r\n\t\t\tvar y = Math.ceil(conf.barHeight - height);\r\n\t\t\tdrawContext.fillRect(i*4, y, 2, height);\r\n\t\t}\r\n\t}\r\n\r\n\tif (channel.debugOn)\r\n\t\tchannel.ctx.clearRect(0, 0, conf.fft_size, 205)\r\n\r\n\t/*channel.input(this.samples, ranges.current.numSamples, ranges.current.sampleOffset)\r\n\tlet jumps = channel.getJumps()*/\r\n\tlet jumps = channel.tick(this.samples)\r\n\tfor (let i = 0; i < Grid.height; i++) {\r\n\t\tif (!jumps[i]) continue;\r\n\t\t// Grid.flashRow(i)\r\n\t\tGrid.flashRow(/*Math.floor(Math.random() * Grid.width),*/ i);\r\n\t}\r\n\r\n\t// Grid.rareShuffle();\r\n\r\n\tframe(this.draw.bind(this));\r\n}\r\n\r\n\r\n\r\nVisualizerSample.prototype.getFrequencyValue = function(freq) {\r\n\tvar nyquist = audio.context.sampleRate/2;\r\n\tvar index = Math.round(freq/nyquist * this.freqs.length);\r\n\treturn this.freqs[index];\r\n}\r\n\r\nfunction Rarity(trim) {\r\n\tthis.n = 0;\r\n\tthis.trim = trim;\r\n\tthis.do = function(fn) {\r\n\t\tif(this.n >= this.trim) {\r\n\t\t\tfn();\r\n\t\t\tthis.n = 0;\r\n\t\t}\r\n\t\telse this.n++;\r\n\t}\r\n}\r\n\r\nfunction handleFileDrop(evt) {\r\n\thandleFile(evt, \"drop\");\r\n}\r\nfunction handleFileInput(evt) {\r\n\thandleFile(evt, \"input\");\r\n}\r\n\r\nvar currentCustomTrack = {\r\n\tname: null,\r\n\tftype: null,\r\n\tbuffer: null,\r\n\tblob: null\r\n}\r\n\r\nfunction handleFile(evt, type) {\r\n\tevt.stopPropagation();\r\n\tevt.preventDefault();\r\n\r\n\tvar files = (type == \"drop\") ? evt.dataTransfer.files : evt.target.files;\r\n\tvar f = files[0];\r\n\r\n\tif (f.type.match('image.*')) {\r\n\t\tvar reader = new FileReader();\r\n\t\t\r\n\t\treader.onload = (function(theFile) {\r\n\t\t\treturn function(e) {\r\n\t\t\t\tvar dataUrl = e.target.result;\r\n\t\t\t\ttoCanvas(dataUrl);\r\n\t\t\t\t$('#pattern-share .filename').val(f.name.match(/(.+?)\\.([a-z0-9_]+$)/i)[1])\r\n\t\t\t};\r\n\t\t})(f);\r\n\r\n\t\treader.readAsDataURL(f);\r\n\t}\r\n\r\n\telse if(f.type.match('audio.*')) {\r\n\t\tvar reader = new FileReader();\r\n\t\t\r\n\t\treader.onload = (function(theFile) {\r\n\t\t\treturn function(e) {\r\n\t\t\t\tcurrentCustomTrack.buffer = e.target.result;\r\n\t\t\t\tcurrentCustomTrack.ftype = f.type;\r\n\t\t\t\t//prevent Firefox bug (decoding audio buffer empties it)\r\n\t\t\t\tcurrentCustomTrack.blob = new Blob([currentCustomTrack.buffer], { type: currentCustomTrack.ftype });\r\n\t\t\t\tcurrentCustomTrack.name = f.name.match(/(.+?)\\.([a-z0-9_]+$)/i)[1];\r\n\t\t\t\t$('#loop-upload .filename').val(currentCustomTrack.name);\r\n\t\t\t\tloopEditor.add();\r\n\t\t\t\taudio.context.decodeAudioData(\r\n\t\t\t\t\tcurrentCustomTrack.buffer,\r\n\t\t\t\t\tfunction(buffer) {\r\n\t\t\t\t\t\tranges.sync()\r\n\t\t\t\t\t\taudio.stop(function() {\r\n\t\t\t\t\t\t\taudio.buffer = buffer;\r\n\t\t\t\t\t\t\tcurrentLoop.fileName = currentCustomTrack.name;\r\n\t\t\t\t\t\t\taudio.disabled = false;\r\n\t\t\t\t\t\t\taudio.play();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(error) {\r\n\t\t\t\t\t\tconsole.error(\"Ошибка при декодировании аудио\", error)\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t};\r\n\t\t})(f);\r\n\r\n\t\treader.readAsArrayBuffer(f);\r\n\t}\r\n\r\n\telse {\r\n\t\talert('Дропнутый файл не является ни картинкой, ни аудиофайлом.')\r\n\t}\r\n\t\r\n\treturn false\r\n}\r\nfunction handleDragOver(evt) {\r\n\tevt.stopPropagation();\r\n\tevt.preventDefault();\r\n\tevt.dataTransfer.dropEffect = 'copy';\r\n}\r\nfunction toCanvas(dataURL) {\r\n\tvar imageObj = new Image();\r\n\timageObj.onload = function() {\r\n\t\tbufferCanvas.height = this.height;\r\n\t\tbufferCanvas.width = this.width;\r\n\t\tbufferContext.drawImage(this, 0, 0);\r\n\t\tGrid.fromCanvas();\r\n\t};\r\n\timageObj.src = dataURL;\r\n}\r\n\r\nfunction dataURItoBlob(dataURI) {\r\n  var arr = dataURI.split(','), mime = arr[0].match(/:(.*?);/)[1];\r\n  return new Blob([atob(arr[1])], {type:mime});\r\n}\r\n\r\nfunction TrackList(tracklist, sel, id, flat, $sortButton, sortBy, order, playEnabled, $playEnabler) {\r\n\tthis.$el = $(sel);\r\n\tthis.id = id;\r\n\tthis.isFlat = !!flat;\r\n\r\n\tthis.playEnabled = playEnabled;\r\n\tthis.$playEnabler = $playEnabler;\r\n\tthis.$playEnabler.addClass(this.playEnabled ? 'i-play-enabled' : 'i-play-disabled');\r\n\tthis.$playEnabler.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.playEnabled = !this.playEnabled;\r\n\t\tthis.$playEnabler.toggleClass('i-play-enabled i-play-disabled');\r\n\t\tAllTracks.populate(this.id, this.flatList, this.playEnabled);\r\n\t}).bind(this))\r\n\r\n\t// builds tracklist, sorted\r\n\tthis.build = function() {\r\n\t\tvar html = '';\r\n\r\n\t\tif(this.isFlat) {\r\n\t\t\thtml += '<div class=\"tracklist-section\" data-flat=\"1\" data-section=\"'+this.id+'\" data-id=\"'+this.id+'\">';\r\n\t\t\thtml += this.buildSection(this.list, this.id);\r\n\t\t\thtml += '</div>';\r\n\t\t}\r\n\t\telse\r\n\t\t\t_.each(this.list, function(section, sectIndex) {\r\n\t\t\t\thtml += '<div class=\"tracklist-section\" data-flat=\"0\" data-section=\"'+section.sectID+'\" data-id=\"'+this.id+'\">';\r\n\t\t\t\thtml += '<h3 class=\"tls-title\">'+section.title+'</h3>';\r\n\t\t\t\thtml += this.buildSection(section.contents, section.sectID);\r\n\t\t\t\thtml += '</div>';\r\n\t\t\t}, this);\r\n\t\tthis.$el.html(html);\r\n\t\tAllTracks.populate(this.id, this.flatList, this.playEnabled);\r\n\t}\r\n\r\n\tthis.scrollAdded = false;\r\n\r\n\t// builds flat tracklist or its section\r\n\tthis.buildSection = function(list, sectID) {\r\n\t\torder = (typeof this.sortOrder === 'undefined') ? true : ((typeof this.sortOrder === 'string') ? ((this.sortOrder === 'asc') ? true : false) : this.sortOrder);\r\n\t\tvar sortedList = _.sortByOrder(list, [this.sortBy, \"id\"], [order, order])\r\n\t\t, html = ''\r\n\t\t, foradmin = (this.id === 'default') ? ' foradmin-show' : '';\r\n\r\n\t\t_.each(sortedList, function(entry) {\r\n\t\t\tif(entry) {\r\n\t\t\t\tvar swfName = (entry.hasOwnProperty('swf') && entry.swf) ? entry.swf.split('/').reverse()[0] : false\r\n\t\t\t\t, swfLink = swfName ? '<a target=\"_blank\" href=\"loops/swf/'+entry.swf+'\" download=\"'+swfName+'\" class=\"dlo-dlbutton dlb-swf\" title=\"Скачать оригинальный SWF\"><i class=\"i-download-menu\"></i> SWF</a> ' : ''\r\n\t\t\t\t, swfClass = swfName ? ' with-swf' : ''\r\n\t\t\t\t, fresh = (entry.hasOwnProperty('fresh') && entry.fresh) ? ' fresh' : ''\r\n\t\t\t\t, isPlaying = (currentLoop.hasOwnProperty('original_hash') && currentLoop.original_hash === entry.original_hash) ? ' playing' : ''\r\n\t\t\t\t, safeName = _.escape(entry.name)\r\n\t\t\t\t\r\n\t\t\t\thtml += \r\n\t\t\t\t'<div class=\"track'+swfClass+isPlaying+fresh+'\" data-name=\"'+safeName.toLowerCase()+'\" data-hash=\"'+entry.original_hash+'\">\\\r\n\t\t\t\t\t<i class=\"i-play\"></i>\\\r\n\t\t\t\t\t<div class=\"track-name\">'+safeName+'</div>\\\r\n\t\t\t\t\t<div class=\"download-options\">'\r\n\t\t\t\t\t\t+swfLink+\r\n\t\t\t\t\t\t'<a target=\"_blank\" href=\"loops/'+sectID+'/'+entry.original_hash+'.mp3\" download=\"'+safeName+'.mp3\" class=\"dlo-dlbutton dlb-mp3\"><i class=\"i-download-menu\"></i> MP3</a>\\\r\n\t\t\t\t\t\t<a target=\"_blank\" href=\"loops/'+sectID+'/'+entry.original_hash+'.ogg\" download=\"'+safeName+'.ogg\" class=\"dlo-dlbutton dlb-ogg\"><i class=\"i-download-menu\"></i> OGG</a>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class=\"edit-options\">\\\r\n\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-delete\"><i class=\"i-x-small\"></i> Удалить</a>\\\r\n\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-edit\"><i class=\"i-edit\"></i> Править</a>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class=\"track-duration\">'+entry.duration+'</div>\\\r\n\t\t\t\t\t<div class=\"track-options\">\\\r\n\t\t\t\t\t\t<i class=\"i-download-menu\"></i><i class=\"i-burger'+foradmin+'\"></i>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t</div>';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}, this);\r\n\r\n\t\treturn html;\r\n\t}\r\n\r\n\t// add track\r\n\tthis.add = function(track) {\r\n\t\ttrack = this.processList([track])[0];\r\n\t\ttrack.fresh = true;\r\n\t\tif(this.isFlat) {\r\n\t\t\tthis.list.push(track);\r\n\t\t\tthis.flatList = this.list;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t_.find(this.list, {sectID: track.section}).contents.push(track);\r\n\t\t\tthis.flatList = _.flatten(_.pluck(this.list, 'contents'))\r\n\t\t}\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tthis.edit = function(track) {\r\n\t\tthis.del(track.original_hash, track.section_from || track.section, true);\r\n\t\tthis.add(track);\r\n\t}\r\n\r\n\tthis.del = function(ohash, section, nobuild) {\r\n\t\tif(typeof nobuild === 'undefined') nobuild = false;\r\n\t\tif(this.isFlat) \r\n\t\t\t_.remove(this.list, {original_hash: ohash});\r\n\t\telse \r\n\t\t\t_.remove(_.find(this.list, {sectID: section}).contents, {original_hash: ohash})\r\n\t\t_.remove(this.flatList, {original_hash: ohash});\r\n\t\tif(!nobuild) this.build();\r\n\t}\r\n\r\n\tthis.processList = function(list) {\r\n\t\treturn _.each(list, function(entry) {\r\n\t\t\tif(entry.hasOwnProperty('date') && !entry.date instanceof Date)\r\n\t\t\t\tentry.date = new Date(entry.date);\r\n\t\t\tif(entry.hasOwnProperty('duration') && !isNaN(entry.duration)) {\r\n\t\t\t\tvar totalSecs = +entry.duration;\r\n\t\t\t\tvar minutes = Math.floor(totalSecs/60)+'';\r\n\t\t\t\tif(minutes.length == 1) minutes = '0'+minutes;\r\n\t\t\t\tvar seconds = Math.round(totalSecs%60)+'';\r\n\t\t\t\tif(seconds.length == 1) seconds = '0'+seconds;\r\n\t\t\t\tentry.duration = minutes+':'+seconds;\r\n\t\t\t}\r\n\t\t\t['freq', 'db'].forEach(prop => {\r\n\t\t\t\tif (entry[prop] && typeof entry[prop]=='string')\r\n\t\t\t\t\tentry[prop] = entry[prop].split('~').map(v => +v)\r\n\t\t\t})\r\n\t\t\t;['smoothing', 'treshold'].forEach(prop => {\r\n\t\t\t\tif (entry[prop] && typeof entry[prop]=='string')\r\n\t\t\t\t\tentry[prop] = +entry[prop]\r\n\t\t\t})\r\n\t\t\t\r\n\t\t})\r\n\t}\r\n\r\n\tthis.sortOptions = [\r\n\t\t['date', 'desc', 'i-newfirst', \"Сначала новые\"],\r\n\t\t['date', 'asc', 'i-oldfirst', \"Сначала старые\"],\r\n\t\t['name', 'asc', 'i-a-z', \"По алфавиту\"],\r\n\t\t['name', 'desc', 'i-z-a', \"По алфавиту\"],\r\n\t];\r\n\r\n\tif(this.isFlat) {\r\n\t\tthis.list = this.processList(tracklist);\r\n\t\tthis.flatList = this.list;\r\n\t}\r\n\telse {\r\n\t\tthis.list = _.map(tracklist, function(section) {\r\n\t\t\tvar processedSection = section;\r\n\t\t\tprocessedSection.contents = this.processList(section.contents);\r\n\t\t\treturn processedSection;\r\n\t\t}, this);\r\n\t\tthis.flatList = _.flatten(_.pluck(this.list, 'contents'))\r\n\t}\r\n\r\n\tthis.sortButton = $sortButton;\r\n\tthis.sortButton.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.sort()\r\n\t}).bind(this));\r\n\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\r\n\tthis.sort = function(sortBy, order) {\r\n\t\tvar sort;\r\n\t\tif(typeof sortBy === 'undefined') \r\n\t\t\tthis.sortState++;\r\n\t\telse {\r\n\t\t\tif(typeof order === 'undefined') order = 'asc';\r\n\t\t\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\t\t}\r\n\t\tif(this.sortState < 0 || this.sortState >= this.sortOptions.length)\r\n\t\t\tthis.sortState = 0;\r\n\t\tsort = this.sortOptions[this.sortState];\r\n\t\tthis.sortBy = sort[0];\r\n\t\tthis.sortOrder = sort[1];\r\n\t\tthis.build();\r\n\t\tthis.sortButton.removeClass(_.pluck(this.sortOptions, 2).join(' ')).addClass(sort[2]);\r\n\t\tthis.sortButton.attr('title', sort[3]);\r\n\t}\r\n\r\n\tthis.sort(sortBy, order);\r\n\r\n\tthis.playTrackByHash = function(hash, disableAssociation) {\r\n\t\tif(typeof disableAssociation === 'undefined') disableAssociation = false;\r\n\t\tvar track = _.filter(this.flatList, {original_hash: ''+hash})[0];\r\n\t\tif(track) {\r\n\t\t\taudio.loadLoop(true, track);\r\n\t\t\t$('.track').removeClass('playing');\r\n\t\t\t$('.track[data-hash='+hash+']').addClass('playing');\r\n\t\t\tif(conf.association && !disableAssociation) {\r\n\t\t\t\tif(+track.associated_pattern) {\r\n\t\t\t\t\t_.each(patternLibs, function(lib) {\r\n\t\t\t\t\t\tlib.applyPatternByID(+track.associated_pattern, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse Grid.revert();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tthis.getAllHashes = function() {\r\n\t\treturn {\r\n\t\t\tplayEnabled: this.playEnabled,\r\n\t\t\ttracks: _.pluck(this.flatList, 'original_hash')\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar AllTracks = {\r\n\tnameList: [], playList: [],\r\n\tpopulate: function(id, list, enabled) {\r\n\t\tvar pl = _.reject(this.playList, {lib: id})\r\n\t\t, nl = _.reject(this.nameList, {lib: id});\r\n\t\t_.each(list, function(track) {\r\n\t\t\tnl.push({lib: id, hash: track.original_hash, name: track.name})\r\n\t\t\tif(enabled) pl.push({lib: id, hash: track.original_hash})\r\n\t\t});\r\n\t\t$('#loop-toassoc option[data-lib='+id+']').remove();\r\n\t\tthis.nameList = nl;\r\n\t\tthis.playList = pl;\r\n\t\t_.each(nl, function(loop) {\r\n\t\t\t$('#loop-toassoc').append('<option data-lib=\"'+id+'\" value=\"'+loop.hash+'\">'+loop.name+'</option>');\r\n\t\t})\r\n\t},\r\n\trandom: function() {\r\n\t\tif(!this.playList.length) this.init();\r\n\t\tif(!this.playList.length) return;\r\n\t\tif(this.playList.length > 1)\r\n\t\t\tvar reduced = this.playList.filter(function(item) {\r\n\t\t\t\treturn item.hash !== currentLoop.original_hash\r\n\t\t\t});\r\n\t\tvar newLoop = (this.playList.length > 1) ? reduced[Math.floor(Math.random() * reduced.length)] : this.playList[0];\r\n\t\tloopLibs[newLoop.lib].playTrackByHash(newLoop.hash);\r\n\t},\r\n\tplayTrackByHash: function(hash, disableAssociation) {\r\n\t\tloopLibs[_.find(this.nameList, {hash: ''+hash}).lib].playTrackByHash(''+hash, disableAssociation);\r\n\t}\r\n}\r\n\r\nfunction PatternGallery(patterns, sel, id, $sortButton, sortBy, order) {\r\n\tthis.$el = $(sel);\r\n\tthis.id = id;\r\n\r\n\tthis.processList = function(list) {\r\n\t\treturn _.each(list, function(entry) {\r\n\t\t\t\tif(entry.hasOwnProperty('date') && !entry.date instanceof Date)\r\n\t\t\t\t\tentry.date = new Date(entry.date);\r\n\t\t\t\t\tentry.height = +entry.height;\r\n\t\t\t\t\tentry.width = +entry.width;\r\n\t\t\t\t\tentry.id = +entry.id;\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t}\r\n\r\n\tthis.list = this.processList(patterns);\r\n\r\n\tthis.patternProbe = function(width, height) {\r\n\t\tvar s = (width > height) ? width : height;\r\n\t\tif(s < 60) {\r\n\t\t\tvar n = 1;\r\n\t\t\twhile(s*n <= 60) \r\n\t\t\t\tn++;\r\n\t\t\tn--;\r\n\r\n\t\t\tvar w = n*width\r\n\t\t\t, h = n*height\r\n\t\t\t, v_offset = 60 - h\r\n\t\t\t, h_offset = 60 - w;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tup: true,\r\n\t\t\t\twidth: w,\r\n\t\t\t\theight: h,\r\n\t\t\t\tmargins: [Math.floor(v_offset/2), Math.ceil(h_offset/2), Math.ceil(v_offset/2), Math.floor(h_offset/2)]\r\n\t\t\t}\r\n\t\t}\r\n\t\telse \r\n\t\t\treturn {\r\n\t\t\t\tup: false,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t}\r\n\t}\r\n\r\n\tthis.refreshAss = function() {\r\n\t\t$('#pattern-toassoc option[data-lib='+this.id+']').remove();\r\n\t\t_.each(this.list, function(pattern) {\r\n\t\t\t$('#pattern-toassoc').append('<option data-lib=\"'+this.id+'\" value=\"'+pattern.id+'\">'+pattern.name+'</option>');\r\n\t\t}, this)\r\n\t}\r\n\r\n\tthis.build = function() {\r\n\t\tvar order = (typeof this.sortOrder === 'undefined') ? true : ((typeof this.sortOrder === 'string') ? ((this.sortOrder === 'asc') ? true : false) : this.sortOrder)\r\n\t\t, sortedList = _.sortByOrder(this.list, [this.sortBy, \"id\"], [order, order])\r\n\t\t, html = '<div class=\"gallery-section\" data-section=\"'+this.id+'\" data-id=\"'+this.id+'\">'\r\n\t\t, foradmin = (this.id === 'default') ? ' foradmin-show' : '';\r\n\t\t\r\n\t\t_.each(sortedList, function(pattern) {\r\n\t\t\tvar probe = this.patternProbe(pattern.width, pattern.height)\r\n\t\t\t, crisp = probe.up ? ' image-crisp' : ''\r\n\t\t\t, upstyle = probe.up ? ' style=\"margin: '+probe.margins.map(function(i) {return i+\"px\"}).join(' ')+'; width:'+probe.width+'px; height:'+probe.height+'px;\"' : ''\r\n\t\t\t, src = Grid.toCanvas(pattern.string, pattern.width, pattern.height)\r\n\t\t\t, fresh = (pattern.fresh || false) ? ' fresh' : ''\r\n\t\t\t, safeName = _.escape(pattern.name)\r\n\t\t\t, foradmin = (this.id == 'default') ? ' foradmin-show' : '';\r\n\t\t\thtml +=\r\n\t\t\t'<div class=\"pattern'+fresh+'\" title=\"'+safeName+'\" data-id=\"'+pattern.id+'\" data-lib=\"'+this.id+'\" data-name=\"'+safeName+'\">\\\r\n\t\t\t\t<img src=\"'+src+'\" class=\"pattern-pic'+crisp+'\"'+upstyle+' alt=\"'+safeName+'\">\\\r\n\t\t\t\t<div class=\"pattern-name\">'+safeName+'</div>\\\r\n\t\t\t\t<div class=\"pattern-options\">\\\r\n\t\t\t\t\t<a title=\"Править\" href=\"#\" class=\"pattern-menu-item pmi-left'+foradmin+'\"><i class=\"i-edit\"></i></a>\\\r\n\t\t\t\t\t<a title=\"Скачать PNG\" target=\"_blank\" href=\"'+src+'\" download=\"'+safeName+'.png\" class=\"pattern-menu-item pmi-mid\"><i class=\"i-download-menu\"></i></a>\\\r\n\t\t\t\t\t<a title=\"Удалить\" href=\"#\" class=\"pattern-menu-item pmi-right'+foradmin+'\"><i class=\"i-x-small\"></i></a>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t</div>'\r\n\t\t}, this)\r\n\r\n\t\thtml += '</div>';\r\n\t\tthis.$el.html(html);\r\n\r\n\t\tthis.refreshAss();\r\n\t}\r\n\r\n\tthis.add = function(pattern) {\r\n\t\tpattern = this.processList([pattern])[0];\r\n\t\tpattern.fresh = true;\r\n\t\tthis.list.push(pattern);\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tthis.edit = function(pattern) {\r\n\t\tthis.del(+pattern.id, true);\r\n\t\tthis.add(pattern);\r\n\t}\r\n\r\n\tthis.del = function(id, nobuild) {\r\n\t\tif(typeof nobuild === 'undefined') nobuild = false;\r\n\t\t_.remove(this.list, {id: id});\r\n\t\tif(!nobuild) this.build();\r\n\t}\r\n\r\n\tthis.sortOptions = [\r\n\t\t['date', 'desc', 'i-newfirst', \"Сначала новые\"],\r\n\t\t['date', 'asc', 'i-oldfirst', \"Сначала старые\"],\r\n\t\t['name', 'asc', 'i-a-z', \"По алфавиту\"],\r\n\t\t['name', 'desc', 'i-z-a', \"По алфавиту\"],\r\n\t];\r\n\r\n\tthis.sortButton = $sortButton;\r\n\tthis.sortButton.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.sort()\r\n\t}).bind(this));\r\n\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\r\n\tthis.sort = function(sortBy, order) {\r\n\t\tvar sort;\r\n\t\tif(typeof sortBy === 'undefined') \r\n\t\t\tthis.sortState++;\r\n\t\telse {\r\n\t\t\tif(typeof order === 'undefined') order = 'asc';\r\n\t\t\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\t\t}\r\n\t\tif(this.sortState < 0 || this.sortState >= this.sortOptions.length)\r\n\t\t\tthis.sortState = 0;\r\n\t\tsort = this.sortOptions[this.sortState];\r\n\t\tthis.sortBy = sort[0];\r\n\t\tthis.sortOrder = sort[1];\r\n\t\tthis.build();\r\n\t\tthis.sortButton.removeClass(_.pluck(this.sortOptions, 2).join(' ')).addClass(sort[2]);\r\n\t\tthis.sortButton.attr('title', sort[3]);\r\n\t}\r\n\r\n\tthis.sort(sortBy, order);\r\n\t\r\n\tthis.applyPatternByID = function(id, disableAssociation) {\r\n\t\tif(typeof disableAssociation === 'undefined') disableAssociation = false;\r\n\t\tvar pattern = _.find(this.list, {id: +id});\r\n\t\tif(pattern) {\r\n\t\t\tif(pattern.osc) \r\n\t\t\t\tGrid.setOsc(pattern.osc);\r\n\t\t\telse {\r\n\t\t\t\t$('#osc-sel').val('default')\r\n\t\t\t}\r\n\r\n\t\t\tif(pattern.style)\r\n\t\t\t\tGrid.changeStyle(pattern.style, pattern.string);\r\n\t\t\telse\r\n\t\t\t\tGrid.changeStyle(defaultStyle, pattern.string);\r\n\t\t\t\r\n\t\t\tif(pattern.associated_loop && conf.association && !disableAssociation)\r\n\t\t\t\tAllTracks.playTrackByHash(pattern.associated_loop, true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar is_admin = false;\r\ncheet('↑ ↑ ↓ ↓ ← → ← → b a', function () {\r\n  $('body').toggleClass('is-admin');\r\n  is_admin = !!!is_admin;\r\n  console.log('Congratulations!')\r\n});\r\n\r\nMath.log2 = Math.log2 || function(x) {\r\n  return Math.log(x) / Math.LN2;\r\n};\r\n\r\nvar $stream = null, radioMES = null;\r\n\r\nfunction set_stream(url, mediaType) {\r\n\tif(!$stream) {\r\n\t\t$('<audio style=\"display:none\" id=\"stream-victim\"></audio>').appendTo('body');\r\n\t\t$stream = $('#stream-victim');\r\n\t}\r\n\t$stream.html('<source src=\"'+url+'\" type=\"'+mediaType+'\" />');\r\n}\r\n\r\nfunction connectStream() {\r\n\tradioMES = audio.context.createMediaElementSource($('#stream-victim')[0]);\r\n\tradioMES.connect(gainNode);\r\n}\r\n\r\nfunction toggleAnlzOpts() {\r\n\t$('#nerdmode').slideToggle('fast')\r\n\tchannel.debugOn = !channel.debugOn\r\n}"],"mappings":"AAAA,YAAY,CAAC,wgDAETA,eAAc,CAAG,2OAA2O,CAE5PC,SAAS,CAAG,QAAQ,CACpBC,UAAU,CAAI,UAAW,CAC5B,GAAIC,EAAS,CAAIC,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC,CAChD,MAAyC,UAAU,EAA3C,MAAOF,EAAS,CAACG,WAA0B,EAA2C,EAAE,GAAzCH,CAAS,CAACG,WAAW,CAAC,WAAW,CACzF,CAAC,EAAG,CAAG,KAAK,CAAG,KAAK,CAEhBC,IAAI,CAAG,CACVC,QAAQ,CAAE,GAAG,CACbC,SAAS,CAAE,GAAG,CACdC,QAAQ,CAAE,IAAI,CACdC,gBAAgB,CAAE,EAAG,CACrBC,WAAW,CAAE,EAAE,CACfC,eAAe,CAAE,WAAW,CAC5BC,kBAAkB,CAAE,EAAG,CACvBC,WAAW,GAAO,CAClBC,GAAG,GAAM,CACRC,SAAS,CAAE,EAAE,CACbC,SAAS,CAAE,MAAM,CACjBC,QAAQ,CAAE,MACZ,CAAC,CAGKC,mBAAmB,CAAG,CAC1BC,MAAM,kBAAG,CACP,GAAsB,WAAW,EAA7B,MAAOC,OAAsB,EAAuC,UAAU,EAA7C,MAAOA,OAAM,CAACC,gBAA+B,CAAE,IAC9EC,EAAO,GAAQ,CACbC,CAAO,CAAGC,MAAM,CAACC,cAAc,CAAC,CAAC,CAAC,CAAE,SAAS,CAAE,CACnDC,GAAG,eAAG,CAAEJ,CAAO,GAAS,CAC1B,CAAC,CAAC,CACIK,CAAI,CAAG,UAAM,CAAC,CAAC,CACrBP,MAAM,CAACC,gBAAgB,CAAC,yBAAyB,CAAEM,CAAI,CAAEJ,CAAO,CAAC,CACjEH,MAAM,CAACQ,mBAAmB,CAAC,yBAAyB,CAAED,CAAI,CAAEJ,CAAO,CAAC,CACpEL,mBAAmB,CAACW,UAAU,CAAGP,CACnC,CACF,CACF,CAAC,CACDJ,mBAAmB,CAACC,MAAM,EAAE,CAE5B,GAAIW,QAAO,CAAEC,WAAW,CAAEC,YAAY,CAAEC,aAAa,CAErD,QAASC,SAAQ,EAAG,CAmhBnB,GAlhBAC,OAAO,CAACC,IAAI,EAAE,CACdN,OAAO,CAAGO,CAAC,CAAC,OAAO,CAAC,CACpBN,WAAW,CAAGD,OAAO,CAAC,CAAC,CAAC,CAACQ,UAAU,CAAC,IAAI,CAAC,CAEzCN,YAAY,CAAGK,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CACpCJ,aAAa,CAAGD,YAAY,CAACM,UAAU,CAAC,IAAI,CAAC,CAE7CC,MAAM,CAACH,IAAI,EAAE,CAEbI,IAAI,CAACJ,IAAI,CAAC,WAAW,CAAC,CAEtBC,CAAC,CAAC,QAAQ,CAAC,CAACI,SAAS,CAAC,UAAW,CAChCC,WAAW,GACZ,CAAC,CAAC,CACDC,EAAE,CAAC,iBAAiB,CAAE,UAAW,CACjCD,WAAW,GACZ,CAAC,CAAC,CAGFL,CAAC,CAAC,wBAAwB,CAAC,CAACO,IAAI,CAAC,UAAW,CAC3C,GAAIC,EAAC,CAAGR,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC,CACzBT,CAAC,CAAC,IAAI,CAAC,CAACU,WAAW,CAACP,IAAI,CAACQ,YAAY,CAACH,CAAC,CAAE,OAAO,CAAC,CAACI,QAAQ,CAAC,QAAQ,CAAC,CAACH,IAAI,CAAC,KAAK,CAAE,QAAQ,CAAC,CAACI,IAAI,CAAC,IAAI,CAAE,SAAS,CAACL,CAAC,CAAC,CACnH,CAAC,CAAC,CAGFR,CAAC,CAAC,MAAM,CAAC,CACRM,EAAE,CAAC,OAAO,CAAE,gBAAgB,CAAE,SAASQ,CAAE,CAAE,CAC3CC,OAAO,CAACf,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,KAAK,CAAC,CAAC,CAACK,CAAE,CAChC,CAAC,CAAC,CACDR,EAAE,CAAC,OAAO,CAAE,OAAO,CAAE,UAAW,CAChCN,CAAC,CAAC,OAAO,CAAC,CAACgB,WAAW,CAAC,UAAU,CAAC,CAClChB,CAAC,CAAC,IAAI,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CAC5BK,KAAK,CAACC,IAAI,CAAGlB,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,MAAM,CACjC,CAAC,CAAC,CACDH,EAAE,CAAC,OAAO,CAAE,SAAS,CAAE,UAAW,CAClCN,CAAC,CAAC,SAAS,CAAC,CAACgB,WAAW,CAAC,UAAU,CAAC,CACjChB,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC,GACnBT,CAAC,CAAC,IAAI,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CAC5BK,KAAK,CAACE,KAAK,CAAGnB,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC,CAC/BT,CAAC,CAAC,sBAAoB,CAAC,CAACoB,KAAK,EAAE,CAEjC,CAAC,CAAC,CACFpB,CAAC,CAAC,cAAc,CAAC,CAACM,EAAE,CAAC,QAAQ,CAAE,UAAW,CACzCW,KAAK,CAACE,KAAK,CAAG,GAAG,CAACnB,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAC/BJ,KAAK,CAACC,IAAI,CAAG,MAAM,CACnBlB,CAAC,CAAC,IAAI,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CAC5BZ,CAAC,CAAC,sBAAoB,CAAC,CAACoB,KAAK,EAC9B,CAAC,CAAC,CAEFvD,QAAQ,CAACyD,aAAa,CAAC,MAAM,CAAC,CAACtC,gBAAgB,CAAC,UAAU,CAAEuC,cAAc,IAAQ,CAClF1D,QAAQ,CAACyD,aAAa,CAAC,MAAM,CAAC,CAACtC,gBAAgB,CAAC,MAAM,CAAEwC,cAAc,IAAQ,CAE9E3D,QAAQ,CAACyD,aAAa,CAAC,kBAAkB,CAAC,CAACtC,gBAAgB,CAAC,QAAQ,CAAEyC,eAAe,IAAQ,CAE7F5D,QAAQ,CAACyD,aAAa,CAAC,WAAW,CAAC,CAACtC,gBAAgB,CAAC,WAAW,CAAE,SAAS8B,CAAE,CAAE,CAC9EY,CAAC,CAACnB,IAAI,CAACO,CAAE,CAACa,aAAa,CAAE,SAASC,CAAK,CAAE,CACxC,GAAIC,EAAE,CAAGhE,QAAQ,CAACiE,gBAAgB,CAACF,CAAK,CAACG,KAAK,CAAEH,CAAK,CAACI,KAAK,CAAC,CACzDH,CAAE,CAACI,cAAc,CAAC,KAAK,CAAC,EAC1BJ,CAAE,CAACK,GAAG,CAACC,QAAQ,CAAC,CAAC,CACnB,CAAC,CACF,CAAC,IAAQ,CAETnC,CAAC,CAACoC,OAAO,CAAC,kBAAkB,CAAC,CAC5BC,IAAI,CAAC,SAAS5B,CAAI,CAAE,CACpB6B,MAAM,CAAG7B,CACV,CAAC,CAAC,CACD8B,IAAI,CAAC,SAASC,CAAG,CAAE,CACnBC,OAAO,CAACC,GAAG,CAACF,CAAG,CAChB,CAAC,CAAC,CAGFxC,CAAC,CAAC,kBAAkB,CAAC,CAACM,EAAE,CAAC,WAAW,CAAE,UAAW,CAChDN,CAAC,CAAC,IAAI,CAAC,CAAC2C,MAAM,EAAE,CAACC,IAAI,CAAC,UAAU,CAAC,CAAC/B,IAAI,CAAC,MAAM,CAAE,MAAM,CACtD,CAAC,CAAC,CACDP,EAAE,CAAC,oBAAoB,CAAE,UAAW,CACpCN,CAAC,CAAC,IAAI,CAAC,CAAC2C,MAAM,EAAE,CAACC,IAAI,CAAC,UAAU,CAAC,CAAC/B,IAAI,CAAC,MAAM,CAAE,UAAU,CAC1D,CAAC,CAAC,CAGFb,CAAC,CAAC,YAAY,CAAC,CAACM,EAAE,CAAC,OAAO,CAAE,UAAW,CACnCuC,WAAW,CAAC7C,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,SAAS,CAAC,CAAC,CAACT,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAAC,CACrDrB,CAAC,CAAC,IAAI,CAAC,CAACgB,WAAW,CAAC,SAAS,CAAC,CAE9BhB,CAAC,CAAC,IAAI,CAAC,CAACY,QAAQ,CAAC,SAAS,CAAC,CAC5BkC,YAAY,CAAC9C,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,MAAM,CAAC,IACrC,CAAC,CAAC,CAGF/C,CAAC,CAAC,UAAU,CAAC,CAACoB,KAAK,CAAC,SAASN,CAAE,CAAE,CAChCkC,aAAa,CAAChD,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,eAAe,CAAC,CAAGjC,CAAE,CAACmC,OAAO,EAAInC,CAAE,CAACoC,MAAM,CACzE,CAAC,CAAC,CAGFlD,CAAC,CAAC,yBAAyB,CAAC,CAACoB,KAAK,CAAC+B,MAAM,CAACC,YAAY,CAAC,CAGvDpD,CAAC,CAAC,2BAA2B,CAAC,CAACoB,KAAK,CAACiC,UAAU,CAACC,IAAI,CAACC,IAAI,CAACF,UAAU,CAAC,CAAC,CAGtErD,CAAC,CAAC,mBAAmB,CAAC,CAACM,EAAE,CAAC,QAAQ,CAAE,SAASQ,CAAE,CAAE,CAChDA,CAAE,CAAC0C,cAAc,EAAE,CACnBC,2BAA2B,CAACzD,CAAC,CAAC,qBAAqB,CAAC,CAAC,CACrDA,CAAC,CAAC,qBAAqB,CAAC,CAACY,QAAQ,CAAC,QAAQ,CAAC,CAC3C,GAAI8C,EAAM,CAAG,KAAK,CACf1D,CAAC,CAAC,mBAAmB,CAAC,CAAC2D,QAAQ,CAAC,aAAa,CAAC,GAChDD,CAAM,CAAG,MAAM,EACb1D,CAAC,CAAC,mBAAmB,CAAC,CAAC2D,QAAQ,CAAC,eAAe,CAAC,GAClDD,CAAM,CAAG,QAAQ,EAGlB,GAAIE,EAAE,CAAG,GAAIC,SAAU,CASvB,IARAD,CAAE,CAACE,MAAM,CAAC,QAAQ,CAAEJ,CAAM,CAAC,CAC3BE,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,MAAM,CAAC,CAC7BF,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,uBAAuB,CAAC,CAACqB,GAAG,EAAE,CAAC,CACtDuC,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,4BAA4B,CAAC,CAACqB,GAAG,EAAE,CAAC,CAExD0C,QAAQ,EACVH,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,CAAC,CAAC,CAEX,QAAQ,EAAnBJ,CAAmB,IACrBE,CAAE,CAACE,MAAM,CAAC,MAAM,CAAE9D,CAAC,CAAC,wBAAwB,CAAC,CAACqB,GAAG,EAAE,CAAC,CACnD,CAAC,MAAM,CAAE,IAAI,CAAE,WAAW,CAAE,UAAU,CAAC,CAAC2C,OAAO,CAAC,SAAAC,CAAI,QAAIL,EAAE,CAACE,MAAM,CAACG,CAAI,CAAE/D,MAAM,CAACgE,OAAO,CAACD,CAAI,CAAC,CAAC,EAAC,CAE5FjE,CAAC,CAAC,gBAAgB,CAAC,CAACmE,EAAE,CAAC,UAAU,CAAC,EACpCP,CAAE,CAACE,MAAM,CAAC,oBAAoB,CAAE9D,CAAC,CAAC,kBAAkB,CAAC,CAACqB,GAAG,EAAE,CAAC,CAE1D0C,QAAQ,EAAE,CACZH,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,CAAC,CAAC,CACxB,GAAIM,EAAI,CAAGpE,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,EAAE,CAChC,GAAG+C,CAAI,CAAE,CACR,GAAIC,EAAI,CAAGrE,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,EAAE,EAAI,UAAU,CAC9C+C,CAAI,CAAGA,CAAI,CAAG,GAAG,CAAGC,CACrB,CACGD,CAAI,EACNR,CAAE,CAACE,MAAM,CAAC,MAAM,CAAEM,CAAI,CAAC,CACrBpE,CAAC,CAAC,WAAW,CAAC,CAACqB,GAAG,EAAE,EACtBuC,CAAE,CAACE,MAAM,CAAC,KAAK,CAAE9D,CAAC,CAAC,WAAW,CAAC,CAACqB,GAAG,EAAE,CAAC,CACvCuC,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,EAAE,CAC9C,CAGD,GAAc,KAAK,EAAhBqC,CAAgB,CAAE,CACpB,GAAG,CAACY,kBAAkB,CAACC,IAAI,CAG1B,MAFApB,OAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,6FAAkB,CAAC,KACjDA,EAAC,CAAC,qBAAqB,CAAC,CAACgB,WAAW,CAAC,QAAQ,CAAC,CAG/C,GAAGsD,kBAAkB,CAACC,IAAI,CAACE,IAAI,CAAG,IAAI,CAAGnC,MAAM,CAACoC,cAAc,CAG7D,MAFA1E,EAAC,CAAC,qBAAqB,CAAC,CAACgB,WAAW,CAAC,QAAQ,CAAC,KAC9CmC,OAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,iMAAsC,CAACsC,MAAM,CAACoC,cAAc,CAAC,IAAI,CAAC,iBAAO,CAAC,CAGzGd,CAAE,CAACE,MAAM,CAAC,MAAM,CAAEQ,kBAAkB,CAACC,IAAI,CAC1C,CAAC,IAGAX,EAAE,CAACE,MAAM,CAAC,eAAe,CAAET,UAAU,CAACsB,OAAO,CAACC,aAAa,CAAC,CAG/C,MAAM,EAAjBlB,CAAiB,EACnBE,CAAE,CAACE,MAAM,CAAC,gBAAgB,CAAE9D,CAAC,CAAC,sBAAsB,CAAC,CAACmE,EAAE,CAAC,UAAU,CAAC,CAAC,CAEtE,GAAIU,EAAO,CAAG,GAAIC,eAAgB,CAClCD,CAAO,CAACE,IAAI,CAAC,MAAM,CAAE,YAAY,CAAC,CAClCF,CAAO,CAACG,IAAI,CAACpB,CAAE,CAAC,CAEhBiB,CAAO,CAACI,MAAM,CAAG,SAASC,CAAC,CAAE,CAE5B,GADAlF,CAAC,CAAC,qBAAqB,CAAC,CAACgB,WAAW,CAAC,QAAQ,CAAC,CAC5B,GAAG,EAAlB,IAAI,CAACmE,MAAa,CAAE,CACtB,GAAI,CACH,GAAIC,EAAG,CAAGC,IAAI,CAACC,KAAK,CAAC,IAAI,CAACC,QAAQ,CAAC,CACnC,IAAGH,CAAG,CAACI,KAAK,CAgBP,IACAC,EAAI,CAAyB,QAAQ,GAA7BL,CAAG,CAACM,IAAI,CAACC,OAAoB,CAAgB,QAAQ,CAApB,SAAoB,CAE7DC,CAAE,CAAG5F,CAAC,CAAC,uBAAuB,CAAC,CAACqB,GAAG,EAAE,CAWzC,GAVAwE,YAAY,UAAa,CAAGD,CAAE,CAC1BC,YAAY,aAAgB,GAC/B7F,CAAC,CAAC,yBAAyB,CAAC,CAACqB,GAAG,CAACuE,CAAE,CAAC,CACpCC,YAAY,aAAgB,CAAGD,CAAE,EAGf,UAAU,GAA1BR,CAAG,CAACU,OAAsB,EAAIV,CAAG,CAACnD,cAAc,CAAC,MAAM,CAAC,GAC1D8D,QAAQ,CAACN,CAAI,CAAC,CAACO,GAAG,CAACZ,CAAG,CAACM,IAAI,CAAC,CAC5BrC,UAAU,CAACC,IAAI,EAAE,EAEC,WAAW,GAA3B8B,CAAG,CAACU,OAAuB,CAAE,CAC/B,GAAIG,EAAQ,GAAQ,CACpB,GAAGb,CAAG,CAACM,IAAI,CAACzD,cAAc,CAAC,cAAc,CAAC,CAAG,CAC5C,GAAIiE,EAAQ,CAA8B,QAAQ,GAAlCd,CAAG,CAACM,IAAI,CAACS,YAAyB,CAAgB,QAAQ,CAApB,SAAoB,CACvED,CAAQ,GAAKT,CAAI,GACnBQ,CAAQ,GAAO,CACjB,CACGA,CAAQ,EACVF,QAAQ,CAACG,CAAQ,CAAC,CAACE,GAAG,CAAChB,CAAG,CAACM,IAAI,CAACd,aAAa,CAAEQ,CAAG,CAACM,IAAI,CAACS,YAAY,CAAC,CACrEJ,QAAQ,CAACN,CAAI,CAAC,CAACO,GAAG,CAACZ,CAAG,CAACM,IAAI,CAAC,EAG5BK,QAAQ,CAACN,CAAI,CAAC,CAACY,IAAI,CAACjB,CAAG,CAACM,IAAI,CAAC,CAE9BhE,CAAC,CAACnB,IAAI,CAAC6E,CAAG,CAACkB,OAAO,CAAE,SAASC,CAAI,CAAEC,CAAE,CAAE,CAACpB,CAAG,CAACkB,OAAO,CAACE,CAAE,CAAC,CAAG9E,CAAC,CAAC+E,MAAM,CAACF,CAAI,CAAC,CAAC,CAAC,CAC1EpD,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAEoF,CAAG,CAACkB,OAAO,CAACI,IAAI,CAAC,OAAO,CAAC,CAAG,GAAG,CAAE,SAAS,CAAE,KAAK,CAAC,CAChFrD,UAAU,CAACsD,MAAM,EAClB,CACmB,aAAa,GAA7BvB,CAAG,CAACU,OAAyB,GAC/BC,QAAQ,CAACN,CAAI,CAAC,CAACW,GAAG,CAAChB,CAAG,CAACM,IAAI,CAACd,aAAa,CAAEQ,CAAG,CAACM,IAAI,CAACC,OAAO,CAAC,CAC5DxC,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,0DAAa,CAAE,SAAS,CAAC,CACvDqD,UAAU,CAACuD,KAAK,EAAE,EAGnB5G,CAAC,CAAC,eAAe,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CACvCZ,CAAC,CAAC,QAAQ,CAACyF,CAAI,CAAC,CAACrE,KAAK,EAAE,CAExBpB,CAAC,CAAC,wBAAwB,CAAC,CAACqB,GAAG,CAAC,EAAE,CAAC,CAACwF,OAAO,CAAC,OAAO,CACpD,CAAC,IAzDA,IAAmB,aAAa,GAA7BzB,CAAG,CAAC0B,OAAyB,CAC/B,GAAI,CACH,GAAIrG,EAAI,CAAG4E,IAAI,CAACC,KAAK,CAACF,CAAG,CAAC2B,UAAU,CAAC,CACrC1D,UAAU,CAAC2D,WAAW,CAACvG,CAAI,CAAC,CAC5B0C,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE0B,CAAC,CAAC+E,MAAM,CAACrB,CAAG,CAAC6B,GAAG,CAAC,CAAC,+JAAgE,CAACvF,CAAC,CAAC+E,MAAM,CAAChG,CAAI,CAACyG,IAAI,CAAC,CAAC,WAAQ,CAAE,QAAQ,CAAE,KAAK,CAC/J,CACA,MAAMhC,CAAC,CAAE,CACR/B,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,qQAAmD,CAAC,CAClFyC,OAAO,CAACC,GAAG,CAACwC,CAAC,CACd,CAAC,IAGD/B,OAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAEoF,CAAG,CAAC6B,GAAG,CA8CxC,CACA,MAAM/B,CAAC,CAAE,CACR,GAAa,aAAa,EAAvBA,CAAC,CAACgC,IAAqB,CACzB/D,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,qQAAmD,CAAC,CAClFyC,OAAO,CAAC+C,KAAK,CAAC,IAAI,CAACD,QAAQ,CAAC,KAExB,MAAML,EACZ,CACAlC,aAAa,CAAChD,CAAC,CAAC,4BAA4B,CAAC,CAC9C,CAAC,IAEAmD,OAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,cAAc,CAAC,CAAE,iKAAoC,CAAC,CACnEyC,OAAO,CAAC+C,KAAK,CAACN,CAAC,CAEjB,CACD,CAAC,CAAC,CAGFlF,CAAC,CAACoC,OAAO,CAAC,oBAAoB,CAAC+E,IAAI,CAACC,MAAM,EAAE,CAAC,CAC5C/E,IAAI,CAAC,SAAS5B,CAAI,CAAE,CACpBsF,QAAQ,CAACsB,MAAM,CAAG,GAAIC,UAAS,CAAC7G,CAAI,CAAE,eAAe,CAAE,QAAQ,IAAQT,CAAC,CAAC,uBAAuB,CAAC,CAAE,MAAM,CAAE,MAAM,IAAQA,CAAC,CAAC,6BAA6B,CAAC,CAC1J,CAAC,CAAC,CACDuC,IAAI,CAACE,OAAO,CAAC+C,KAAK,CAAC,CACpBxF,CAAC,CAACoC,OAAO,CAAC,qBAAqB,CAAC+E,IAAI,CAACC,MAAM,EAAE,CAAC,CAC7C/E,IAAI,CAAC,SAAS5B,CAAI,CAAE,CACpB,GAAI8G,EAAU,CAAG,CAChB,CAAEC,KAAK,CAAE,2EAAe,CAAEC,MAAM,CAAE,MAAM,CAAEC,QAAQ,CAAEhG,CAAC,CAACiG,MAAM,CAAClH,CAAI,CAAE,CAACkF,OAAO,CAAE,MAAM,CAAC,CAAE,CAAC,CACvF,CAAE6B,KAAK,CAAE,qEAAc,CAAEC,MAAM,CAAE,MAAM,CAAEC,QAAQ,CAAEhG,CAAC,CAACiG,MAAM,CAAClH,CAAI,CAAE,CAACkF,OAAO,CAAE,MAAM,CAAC,CAAE,CAAC,CACtF,CACDI,QAAQ,WAAQ,CAAG,GAAIuB,UAAS,CAACC,CAAU,CAAE,gBAAgB,CAAE,SAAS,IAASvH,CAAC,CAAC,wBAAwB,CAAC,CAAE,MAAM,CAAE,MAAM,IAAQA,CAAC,CAAC,8BAA8B,CAAC,CACtK,CAAC,CAAC,CACDuC,IAAI,CAACE,OAAO,CAAC+C,KAAK,CAAC,CACpBxF,CAAC,CAACoC,OAAO,CAAC,wBAAwB,CAAC+E,IAAI,CAACC,MAAM,EAAE,CAAC,CAChD/E,IAAI,CAAC,SAAS5B,CAAI,CAAE,CACpBmH,WAAW,WAAQ,CAAG,GAAIC,eAAc,CAACpH,CAAI,CAAE,mBAAmB,CAAE,SAAS,CAAET,CAAC,CAAC,wBAAwB,CAAC,CAAE,MAAM,CAAE,MAAM,CAC3H,CAAC,CAAC,CACDuC,IAAI,CAACE,OAAO,CAAC+C,KAAK,CAAC,CACpBxF,CAAC,CAACoC,OAAO,CAAC,uBAAuB,CAAC+E,IAAI,CAACC,MAAM,EAAE,CAAC,CAC/C/E,IAAI,CAAC,SAAS5B,CAAI,CAAE,CACpBmH,WAAW,CAACP,MAAM,CAAG,GAAIQ,eAAc,CAACpH,CAAI,CAAE,kBAAkB,CAAE,QAAQ,CAAET,CAAC,CAAC,uBAAuB,CAAC,CAAE,MAAM,CAAE,MAAM,CACvH,CAAC,CAAC,CACDuC,IAAI,CAACE,OAAO,CAAC+C,KAAK,CAAC,CAEpBxF,CAAC,CAAC,aAAa,CAAC,CAAC8H,gBAAgB,CAAC,CAACC,KAAK,CAAC,cAAc,CAAEC,aAAa,CAAE,GAAG,CAAC,CAAC,CAG7EhI,CAAC,CAAC,cAAc,CAAC,CAACM,EAAE,CAAC,YAAY,CAAE,QAAQ,CAAE,UAAW,CACvD,GAAI2H,EAAU,CAAGjI,CAAC,CAAC,IAAI,CAAC,CAAC4C,IAAI,CAAC,aAAa,CAAC,CACzCqF,CAAU,CAAC,CAAC,CAAC,CAACC,WAAW,EAAID,CAAU,CAAC,CAAC,CAAC,CAACE,WAAW,GACzDF,CAAU,CAACG,IAAI,EAAE,CAACxH,QAAQ,CAAC,aAAa,CAAC,CACzCqH,CAAU,CAACI,OAAO,CAAC,CAClBC,UAAU,CAAEL,CAAU,CAACM,KAAK,EAC7B,CAAC,CAAqB,EAAE,CAArBN,CAAU,CAACM,KAAK,EAAK,CAAE,QAAQ,CAAC,CACpC,CAAC,CAAC,CACDjI,EAAE,CAAC,YAAY,CAAE,QAAQ,CAAE,UAAW,CACtC,GAAI2H,EAAU,CAAGjI,CAAC,CAAC,IAAI,CAAC,CAAC4C,IAAI,CAAC,aAAa,CAAC,CACzCqF,CAAU,CAAC,CAAC,CAAC,CAACC,WAAW,EAAID,CAAU,CAAC,CAAC,CAAC,CAACE,WAAW,EACzDF,CAAU,CAACG,IAAI,EAAE,CAACC,OAAO,CAAC,CACzBC,UAAU,CAAE,CACb,CAAC,CAAE,MAAM,CAAE,QAAQ,CAAE,UAAW,CAC/BL,CAAU,CAACjH,WAAW,CAAC,aAAa,CACrC,CAAC,CACF,CAAC,CAAC,CAGFhB,CAAC,CAAC,aAAa,CAAC,CAACoB,KAAK,CAAC,UAAW,CACjCpB,CAAC,CAAC,IAAI,CAAC,CAACwI,WAAW,CAAC,QAAQ,CAAC,CAACzF,OAAO,CAAC,UAAU,CAAC,CAACyF,WAAW,CAAC,eAAe,CAAC,CAAC5F,IAAI,CAAC,OAAO,CAAC,CAAC6F,KAAK,EACnG,CAAC,CAAC,CACFzI,CAAC,CAAC,0BAA0B,CAAC,CAACoB,KAAK,CAAC,UAAW,CAC9CpB,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CAAC/B,WAAW,CAAC,sBAAsB,CAC/D,CAAC,CAAC,CACFhB,CAAC,CAAC,aAAa,CAAC,CAACoB,KAAK,CAAC,UAAW,CACjC,GAAIsH,EAAQ,CAAG1I,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,UAAU,CAAC,CACvCT,CAAC,CAAC,uBAAuB,CAAC0I,CAAQ,CAAC,CAAC1H,WAAW,CAAC,QAAQ,CAAC,CACrDhB,CAAC,CAAC,IAAI,CAAC,CAAC2D,QAAQ,CAAC,QAAQ,CAAC,EAC7B3D,CAAC,CAAC,IAAI,CAAC,CAACY,QAAQ,CAAC,QAAQ,CAAC,CAC3BZ,CAAC,CAAC,yBAAyB,CAAC0I,CAAQ,CAAC,CAACpF,IAAI,EAAE,CAC5CtD,CAAC,CAAC,GAAG,CAACA,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,KAAK,CAAC,CAAC,CAACkI,IAAI,EAChC,CAAC,CAAC,CACF3I,CAAC,CAAC,2BAA2B,CAAC,CAACoB,KAAK,EAAE,CAGtCpB,CAAC,CAAC,eAAe,CAAC,CACjBM,EAAE,CAAC,OAAO,CAAE,gBAAgB,CAAE,UAAW,CACzC,GAAIsI,EAAI,CAAG5I,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,QAAQ,CAAC,CAACtC,IAAI,CAAC,MAAM,CAAC,CAC/CoI,CAAK,CAAG7I,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,oBAAoB,CAAC,CAACtC,IAAI,CAAC,IAAI,CAAC,CAC1DsF,QAAQ,CAAC8C,CAAK,CAAC,CAACC,eAAe,CAACF,CAAI,CACrC,CAAC,CAAC,CACDtI,EAAE,CAAC,OAAO,CAAE,iCAAiC,CAAE,SAASQ,CAAE,CAAE,CAC5DA,CAAE,CAACiI,eAAe,EAAE,CACpB/I,CAAC,CAAC,QAAQ,CAAC,CAACgB,WAAW,CAAC,mBAAmB,CAAC,CAC5ChB,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,QAAQ,CAAC,CAACnC,QAAQ,CAAC,UAAU,CAC9C,CAAC,CAAC,CACDN,EAAE,CAAC,OAAO,CAAE,0BAA0B,CAAE,SAASQ,CAAE,CAAE,CACrDA,CAAE,CAACiI,eAAe,EAAE,CACpB/I,CAAC,CAAC,QAAQ,CAAC,CAACgB,WAAW,CAAC,mBAAmB,CAAC,CAC5ChB,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,QAAQ,CAAC,CAACnC,QAAQ,CAAC,UAAU,CAC9C,CAAC,CAAC,CACDN,EAAE,CAAC,OAAO,CAAE,aAAa,CAAE,UAAa,CACxCN,CAAC,CAAC,QAAQ,CAAC,CAACgB,WAAW,CAAC,mBAAmB,CAC5C,CAAC,CAAC,CACDV,EAAE,CAAC,OAAO,CAAE,QAAQ,CAAE,SAASQ,CAAE,CAAE,CACnC,GAAGd,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CAACY,QAAQ,CAAC,aAAa,CAAC,CAAE,CACvD7C,CAAE,CAACiI,eAAe,EAAE,CACpB,GAAIH,EAAI,CAAG5I,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,MAAM,CAAC,CAC5BT,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CAACY,QAAQ,CAAC,aAAa,CAAC,EACrD3D,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,CAACuH,CAAI,CAC7B,CACD,CAAC,CAAC,CAGF5I,CAAC,CAAC,cAAc,CAAC,CAACM,EAAE,CAAC,OAAO,CAAE,UAAW,CACxC,GAAI0I,EAAK,CAAGhJ,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAAC4H,WAAW,EAAE,CAACC,OAAO,CAAC,IAAI,CAAE,MAAK,CAAC,CAC5D,GAAI,CACHC,QAAQ,CAACC,MAAM,CAAC,aAAa,CAC9B,CAAE,MAAMlE,CAAC,CAAE,CAAC,CACT8D,CAAK,CAACK,MAAM,CACdF,QAAQ,CAACG,MAAM,CAAC,aAAa,CAAE,yDAAwD,CAACN,CAAK,CAAC,wBAAuB,CAAC,CAEtHG,QAAQ,CAACG,MAAM,CAAC,aAAa,CAAE,sDAAsD,CACvF,CAAC,CAAC,CAACzC,OAAO,CAAC,OAAO,CAAC,CAGnB7G,CAAC,CAAC,iBAAiB,CAAC,CAACM,EAAE,CAAC,OAAO,CAAE,UAAW,CAC3C,GAAI0I,EAAK,CAAGhJ,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAAC4H,WAAW,EAAE,CAACC,OAAO,CAAC,IAAI,CAAE,MAAK,CAAC,CAC5D,GAAI,CACHC,QAAQ,CAACC,MAAM,CAAC,gBAAgB,CACjC,CAAE,MAAMlE,CAAC,CAAE,CAAC,CACT8D,CAAK,CAACK,MAAM,CACdF,QAAQ,CAACG,MAAM,CAAC,gBAAgB,CAAE,8DAA6D,CAACN,CAAK,CAAC,wBAAuB,CAAC,CAE9HG,QAAQ,CAACG,MAAM,CAAC,gBAAgB,CAAE,2DAA2D,CAC/F,CAAC,CAAC,CAACzC,OAAO,CAAC,OAAO,CAAC,CAGnB7G,CAAC,CAAC,cAAc,CAAC,CAACoB,KAAK,CAACiC,UAAU,CAACsD,MAAM,CAACpD,IAAI,CAACF,UAAU,CAAC,CAAC,CAE3DrD,CAAC,CAAC,iBAAiB,CAAC,CAACuJ,MAAM,CAAC,UAAW,CACtCvJ,CAAC,CAACA,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAACI,IAAI,CAAC,UAAU,CAAE,CAAC,IAAI,CAAC2I,OAAO,CACnE,CAAC,CAAC,CAGFxJ,CAAC,CAAC,eAAe,CAAC,CACjBM,EAAE,CAAC,OAAO,CAAE,WAAW,CAAE,UAAW,CACpC,GAAImJ,EAAM,CAAGzJ,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,QAAQ,CAAC,CACpC6F,CAAI,CAAGa,CAAM,CAAChJ,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAC7BiJ,CAAG,CAAGD,CAAM,CAAC1G,OAAO,CAAC,iBAAiB,CAAC,CAACtC,IAAI,CAAC,KAAK,CAAC,CACnDkJ,CAAS,CAAGjI,CAAC,CAACkB,IAAI,CAACmD,QAAQ,CAAC2D,CAAG,CAAC,CAACE,QAAQ,CAAE,CAAChF,aAAa,CAAEgE,CAAI,CAAC,CAAC,CAChEe,CAAS,EACXtG,UAAU,CAAC2D,WAAW,CAAC2C,CAAS,IAClC,CAAC,CAAC,CACDrJ,EAAE,CAAC,OAAO,CAAE,aAAa,CAAE,UAAW,CACtC,GAAImJ,EAAM,CAAGzJ,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,QAAQ,CAAC,CACpC6F,CAAI,CAAGa,CAAM,CAAChJ,IAAI,CAAC,MAAM,CAAC,CAC1BiJ,CAAG,CAAGD,CAAM,CAAC1G,OAAO,CAAC,iBAAiB,CAAC,CAACtC,IAAI,CAAC,KAAK,CAAC,CACnDkJ,CAAS,CAAGjI,CAAC,CAACkB,IAAI,CAACmD,QAAQ,CAAC2D,CAAG,CAAC,CAACE,QAAQ,CAAE,CAAChF,aAAa,CAAEgE,CAAI,CAAC,CAAC,CAChEe,CAAS,EACXtG,UAAU,CAAC+C,GAAG,CAACuD,CAAS,IAE1B,CAAC,CAAC,CAGF3J,CAAC,CAAC,kBAAkB,CAAC,CACpBM,EAAE,CAAC,OAAO,CAAE,eAAe,CAAE,UAAW,CACxC,GAAIuI,EAAK,CAAG7I,CAAC,CAAC,IAAI,CAAC,CAAC2C,MAAM,EAAE,CAAClC,IAAI,CAAC,KAAK,CAAC,CACtCoJ,CAAS,CAAG7J,CAAC,CAAC,IAAI,CAAC,CAAC2C,MAAM,EAAE,CAAClC,IAAI,CAAC,IAAI,CAAC,CAEtCT,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CAACY,QAAQ,CAAC,aAAa,CAAC,CACrD3D,CAAC,CAAC,kBAAkB,CAAC,CAACqB,GAAG,CAACwI,CAAS,CAAC,CAEpCjC,WAAW,CAACiB,CAAK,CAAC,CAACiB,gBAAgB,CAACD,CAAS,CAC/C,CAAC,CAAC,CACDvJ,EAAE,CAAC,OAAO,CAAE,SAAS,CAAE,UAAW,CAClC,GAAIyJ,EAAQ,CAAG/J,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CACxCiH,CAAE,CAAGD,CAAQ,CAACtJ,IAAI,CAAC,IAAI,CAAC,CACxBiJ,CAAG,CAAGK,CAAQ,CAACtJ,IAAI,CAAC,KAAK,CAAC,CAC1BwJ,CAAW,CAAGvI,CAAC,CAACkB,IAAI,CAACgF,WAAW,CAAC8B,CAAG,CAAC,CAACQ,IAAI,CAAE,CAACF,EAAE,CAAEA,CAAE,CAAC,CAAC,CACpDC,CAAW,EACbE,aAAa,CAAC9D,IAAI,CAAC4D,CAAW,CAChC,CAAC,CAAC,CACD3J,EAAE,CAAC,OAAO,CAAE,qBAAqB,CAAE,UAAW,CAC9C,GAAIyJ,EAAQ,CAAG/J,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,UAAU,CAAC,CACxCiH,CAAE,CAAGD,CAAQ,CAACtJ,IAAI,CAAC,IAAI,CAAC,CACxBiJ,CAAG,CAAGK,CAAQ,CAACtJ,IAAI,CAAC,KAAK,CAAC,CAC1BwJ,CAAW,CAAGvI,CAAC,CAACkB,IAAI,CAACgF,WAAW,CAAC8B,CAAG,CAAC,CAACQ,IAAI,CAAE,CAACF,EAAE,CAAEA,CAAE,CAAC,CAAC,CACpDC,CAAW,EACbE,aAAa,CAAC/D,GAAG,CAAC6D,CAAW,CAC/B,CAAC,CAAC,CAGFjK,CAAC,CAAC,oBAAoB,CAAC,CAACM,EAAE,CAAC,QAAQ,CAAE,SAASQ,CAAE,CAAE,CACjDA,CAAE,CAAC0C,cAAc,EAAE,CACnBC,2BAA2B,CAACzD,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAClDA,CAAC,CAAC,kBAAkB,CAAC,CAACY,QAAQ,CAAC,QAAQ,CAAC,CACxC,GAAI8C,EAAM,CAAG,KAAK,CACf1D,CAAC,CAAC,gBAAgB,CAAC,CAAC2D,QAAQ,CAAC,aAAa,CAAC,GAC7CD,CAAM,CAAG,MAAM,EACb1D,CAAC,CAAC,gBAAgB,CAAC,CAAC2D,QAAQ,CAAC,eAAe,CAAC,GAC/CD,CAAM,CAAG,QAAQ,EAElB,GAAIE,EAAE,CAAG,GAAIC,SAAU,CASvB,GARAD,CAAE,CAACE,MAAM,CAAC,QAAQ,CAAEJ,CAAM,CAAC,CAC3BE,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,SAAS,CAAC,CAChCF,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,yBAAyB,CAAC,CAACqB,GAAG,EAAE,CAAC,CACxDuC,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,8BAA8B,CAAC,CAACqB,GAAG,EAAE,CAAC,CAE1D0C,QAAQ,EACVH,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,CAAC,CAAC,CAEX,QAAQ,EAAnBJ,CAAmB,GACrBE,CAAE,CAACE,MAAM,CAAC,MAAM,CAAE9D,CAAC,CAAC,0BAA0B,CAAC,CAACqB,GAAG,EAAE,CAAC,CACtDuC,CAAE,CAACE,MAAM,CAAC,gBAAgB,CAAE3D,IAAI,CAACiK,UAAU,EAAE,CAAC,CAE9CxG,CAAE,CAACE,MAAM,CAAC,OAAO,CAAE9D,CAAC,CAAC,aAAa,CAAC,CAACqB,GAAG,EAAE,CAAC,CAC1CuC,CAAE,CAACE,MAAM,CAAC,KAAK,CAA2B,KAAK,GAA7B9D,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,EAAY,CAA4B,KAAK,CAA7BrB,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,EAAU,CAAC,CAE9ErB,CAAC,CAAC,aAAa,CAAC,CAACmE,EAAE,CAAC,UAAU,CAAC,EACjCP,CAAE,CAACE,MAAM,CAAC,iBAAiB,CAAE9D,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,EAAE,CAAC,CAEpD0C,QAAQ,EAAE,CACZH,CAAE,CAACE,MAAM,CAAC,UAAU,CAAE,CAAC,CAAC,CACxB,GAAIM,EAAI,CAAGpE,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,EAAE,CACnC,GAAG+C,CAAI,CAAE,CACR,GAAIC,EAAI,CAAGrE,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,EAAE,EAAI,UAAU,CACjD+C,CAAI,CAAGA,CAAI,CAAG,GAAG,CAAGC,CACrB,CACGD,CAAI,EACNR,CAAE,CAACE,MAAM,CAAC,MAAM,CAAEM,CAAI,CAAC,CACxBR,CAAE,CAACE,MAAM,CAAC,SAAS,CAAE9D,CAAC,CAAC,kBAAkB,CAAC,CAACqB,GAAG,EAAE,CACjD,CAGa,KAAK,EAAhBqC,CAAgB,EAClBE,CAAE,CAACE,MAAM,CAAC,YAAY,CAAEqG,aAAa,CAACE,SAAS,CAAC,CAGjD,GAAIxF,EAAO,CAAG,GAAIC,eAAgB,CAClCD,CAAO,CAACE,IAAI,CAAC,MAAM,CAAE,YAAY,CAAC,CAClCF,CAAO,CAACG,IAAI,CAACpB,CAAE,CAAC,CAEhBiB,CAAO,CAACI,MAAM,CAAG,SAASC,CAAC,CAAE,CAE5B,GADAlF,CAAC,CAAC,kBAAkB,CAAC,CAACgB,WAAW,CAAC,QAAQ,CAAC,CACzB,GAAG,EAAlB,IAAI,CAACmE,MAAa,CAAE,CACtB,GAAI,CACH,GAAIC,EAAG,CAAGC,IAAI,CAACC,KAAK,CAAC,IAAI,CAACC,QAAQ,CAAC,CACnC,GAAGH,CAAG,CAACI,KAAK,CACXrC,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,WAAW,CAAC,CAAEoF,CAAG,CAAC6B,GAAG,CAAC,KAE/B,CAEJ,GAAIrB,EAAE,CAAG5F,CAAC,CAAC,yBAAyB,CAAC,CAACqB,GAAG,EAAE,CAW3C,GAVAwE,YAAY,aAAgB,CAAGD,CAAE,CAC7BC,YAAY,UAAa,GAC5B7F,CAAC,CAAC,uBAAuB,CAAC,CAACqB,GAAG,CAACuE,CAAE,CAAC,CAClCC,YAAY,UAAa,CAAGD,CAAE,EAGZ,aAAa,GAA7BR,CAAG,CAACU,OAAyB,EAC/B8B,WAAW,CAACxC,CAAG,CAACkF,OAAO,CAAC3E,OAAO,CAAC,CAACK,GAAG,CAACZ,CAAG,CAACkF,OAAO,CAAC,CAG/B,cAAc,GAA9BlF,CAAG,CAACU,OAA0B,CAAE,CAClC,GAAII,EAAQ,CAAGd,CAAG,CAACkF,OAAO,CAACnE,YAAY,IAAS,CAC7CD,CAAQ,EACV0B,WAAW,CAAC1B,CAAQ,CAAC,CAACE,GAAG,CAAChB,CAAG,CAACkF,OAAO,CAACN,EAAE,CAAC,CACzCpC,WAAW,CAACxC,CAAG,CAACkF,OAAO,CAAC3E,OAAO,CAAC,CAACK,GAAG,CAACZ,CAAG,CAACkF,OAAO,CAAC,EAGjD1C,WAAW,CAACxC,CAAG,CAACkF,OAAO,CAAC3E,OAAO,CAAC,CAACU,IAAI,CAACjB,CAAG,CAACkF,OAAO,CAAC,CACnD5I,CAAC,CAACnB,IAAI,CAAC6E,CAAG,CAACkB,OAAO,CAAE,SAASC,CAAI,CAAEC,CAAE,CAAE,CAACpB,CAAG,CAACkB,OAAO,CAACE,CAAE,CAAC,CAAG9E,CAAC,CAAC+E,MAAM,CAACF,CAAI,CAAC,CAAC,CAAC,CAC1EpD,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,WAAW,CAAC,CAAEoF,CAAG,CAACkB,OAAO,CAACI,IAAI,CAAC,OAAO,CAAC,CAAE,SAAS,CAAE,KAAK,CAAC,CACvEyD,aAAa,CAACxD,MAAM,EACrB,CACmB,gBAAgB,GAAhCvB,CAAG,CAACU,OAA4B,GAClC8B,WAAW,CAACxC,CAAG,CAACkF,OAAO,CAAC3E,OAAO,CAAC,CAACS,GAAG,CAAChB,CAAG,CAACkF,OAAO,CAACN,EAAE,CAAC,CACpD7G,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,WAAW,CAAC,CAAE,kFAAiB,CAAE,SAAS,CAAC,CACxDmK,aAAa,CAACvD,KAAK,EAAE,EAEtB5G,CAAC,CAAC,kBAAkB,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CAC1CZ,CAAC,CAAC,QAAQ,CAACoF,CAAG,CAACkF,OAAO,CAAC3E,OAAO,CAAC,CAACvE,KAAK,EAAE,CACvCpB,CAAC,CAAC,wBAAwB,CAAC,CAACqB,GAAG,CAAC,EAAE,CAAC,CAACwF,OAAO,CAAC,OAAO,CACpD,CACD,CACA,MAAM3B,CAAC,CAAE,CACR,GAAa,aAAa,EAAvBA,CAAC,CAACgC,IAAqB,CACzB/D,MAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,WAAW,CAAC,CAAE,qQAAmD,CAAC,CAC/EyC,OAAO,CAAC+C,KAAK,CAAC,IAAI,CAACD,QAAQ,CAAC,KAExB,MAAML,EACZ,CACAlC,aAAa,CAAChD,CAAC,CAAC,8BAA8B,CAAC,CAChD,CAAC,IAEAmD,OAAM,CAACqB,GAAG,CAACxE,CAAC,CAAC,WAAW,CAAC,CAAE,iKAAoC,CAAC,CAChEyC,OAAO,CAAC+C,KAAK,CAACN,CAAC,CAEjB,CACD,CAAC,CAAC,CAGCW,YAAY,kBAAqB,CACnC,GAAI,CACH7H,IAAI,CAACQ,WAAW,CAAG6G,IAAI,CAACC,KAAK,CAACO,YAAY,kBAAqB,CAAC,CAChE7F,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,CAAGxL,IAAI,CAACQ,WACtC,CACA,MAAM0G,CAAC,CAAE,CACR,KAAMA,EAEP,CAID,GAHAlF,CAAC,CAAC,eAAe,CAAC,CAACuJ,MAAM,CAAC,UAAW,CACpCvL,IAAI,CAACQ,WAAW,CAAGqH,YAAY,kBAAqB,CAAG7F,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAACwJ,OACnE,CAAC,CAAC,CACC3D,YAAY,YAAe,CAC7B,GAAI,CACH7H,IAAI,CAACS,GAAG,CAAG4G,IAAI,CAACC,KAAK,CAACO,YAAY,YAAe,CAAC,CAC9C7H,IAAI,CAACS,GAAG,GACXuB,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,GAAQ,CACnCxJ,CAAC,CAAC,MAAM,CAAC,CAACY,QAAQ,CAAC,cAAc,CAAC,CAEpC,CACA,MAAMsE,CAAC,CAAE,CACR,KAAMA,EAEP,CACDlF,CAAC,CAAC,aAAa,CAAC,CAACuJ,MAAM,CAAC,UAAW,CAClCvL,IAAI,CAACS,GAAG,CAAGoH,YAAY,YAAe,CAAG7F,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,CACvDxL,IAAI,CAACS,GAAG,CAGXuB,CAAC,CAAC,MAAM,CAAC,CAACgB,WAAW,CAAC,cAAc,CAAC,CAFrChB,CAAC,CAAC,MAAM,CAAC,CAACY,QAAQ,CAAC,cAAc,CAGnC,CAAC,CAAC,CAGFc,CAAC,CAACnB,IAAI,CAACgK,MAAM,CAAE,SAASlJ,CAAG,CAAEmJ,CAAK,CAAE,CACnC,GAAIC,EAAQ,CAAItK,IAAI,CAACqK,KAAK,GAAKA,CAAK,CAAI,WAAW,CAAG,EAAE,CACxDxK,CAAC,CAAC,aAAa,CAAC,CAAC8D,MAAM,CAAC,gBAAe,CAAC0G,CAAK,CAAC,IAAG,CAACC,CAAQ,CAAC,GAAG,CAACD,CAAK,CAAC,WAAW,CACjF,CAAC,CAAC,CAEFxK,CAAC,CAAC,aAAa,CAAC,CAACuJ,MAAM,CAAC,UAAW,CAClCpJ,IAAI,CAACuK,WAAW,CAAC1K,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAC/B,CAAC,CAAC,CAEFrB,CAAC,CAAC,YAAY,CAAC,CAACuJ,MAAM,CAAC,UAAW,CACjCpJ,IAAI,CAACwK,MAAM,CAAC3K,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CAC1B,CAAC,CAAC,CAEFrB,CAAC,CAAC,UAAU,CAAC,CAACuJ,MAAM,CAAC,UAAW,CAC/B,GAAIlI,EAAG,CAAGrB,CAAC,CAAC,IAAI,CAAC,CAACqB,GAAG,EAAE,CACZ,KAAK,GAAbA,CAAa,CACflB,IAAI,CAACwK,MAAM,CAAC,KAAK,CAAC,EAElB3K,CAAC,CAAC,MAAM,CAAC,CAACgB,WAAW,CAAC,cAAc,CAAC,CACrChD,IAAI,CAACS,GAAG,GAAO,EAEL,SAAS,GAAjB4C,CAAiB,GACnBlB,IAAI,CAACyK,OAAO,EAAE,CACd5K,CAAC,CAAC,YAAY,CAAC,CAACa,IAAI,CAAC,UAAU,IAAO,EAE5B,QAAQ,GAAhBQ,CAAgB,EAClBrB,CAAC,CAAC,YAAY,CAAC,CAACa,IAAI,CAAC,UAAU,IACjC,CAAC,CAAC,CAGFb,CAAC,CAAC,uBAAuB,CAAC,CAACqB,GAAG,CAACwE,YAAY,UAAa,EAAI,EAAE,CAAC,CAACgB,OAAO,CAAC,OAAO,CAAC,CAChF7G,CAAC,CAAC,yBAAyB,CAAC,CAACqB,GAAG,CAACwE,YAAY,aAAgB,EAAI,EAAE,CAAC,CAACgB,OAAO,CAAC,OAAO,CACrF,CAAC,GAEGsC,SAAQ,CAAG,CACbG,MAAM,CAAE,gBAASuB,CAAK,CAAEC,CAAG,CAAE,CAC7B,GAAIC,EAAI,CAAGlN,QAAQ,CAACkN,IAAI,EAAIlN,QAAQ,CAACmN,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAChER,CAAK,CAAG3M,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC,CAC3C0M,CAAK,CAACS,IAAI,CAAG,UAAU,CACvBT,CAAK,CAACR,EAAE,CAAG,WAAW,CAAGa,CAAK,CAC1BL,CAAK,CAACU,UAAU,CAClBV,CAAK,CAACU,UAAU,CAACC,OAAO,CAAGL,CAAG,CAE9BN,CAAK,CAACY,WAAW,CAACvN,QAAQ,CAACwN,cAAc,CAACP,CAAG,CAAC,CAAC,CAEjDC,CAAI,CAACK,WAAW,CAACZ,CAAK,CACtB,CAAC,CACDpB,MAAM,CAAE,gBAASyB,CAAK,CAAE,CACxB,GAAIL,EAAK,CAAG3M,QAAQ,CAACyN,cAAc,CAAC,WAAW,CAAGT,CAAK,CAAC,CACxD,GAAGL,CAAK,CAAE,CACT,GAAIO,EAAI,CAAGlN,QAAQ,CAACkN,IAAI,EAAIlN,QAAQ,CAACmN,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CACjED,CAAI,EACNA,CAAI,CAACQ,WAAW,CAAC1N,QAAQ,CAACyN,cAAc,CAAC,WAAW,CAAGT,CAAK,CAAC,CAC/D,CACA,CACF,CAAC,CAEG9E,QAAQ,CAAG,CAAC,CAAC,CAAE6B,WAAW,CAAG,CAAC,CAAC,CAE/BzE,MAAM,CAAG,CACZqB,GAAG,CAAE,aAASgH,CAAO,CAAEC,CAAO,CAAEC,CAAO,CAAEC,CAAG,CAAE,CACvB,WAAW,EAA9B,MAAOD,EAAuB,GAAEA,CAAO,CAAG,OAAO,GAClC,WAAW,EAA1B,MAAOC,EAAmB,EAAY,KAAK,GAAbA,CAAa,IAAEA,CAAG,GAAQ,EAC3D,GAAIC,EAAS,CAAGJ,CAAO,CAAC5I,IAAI,CAAC,WAAW,CAAC,CAWzC,MAVG+I,EAAG,CACLC,CAAS,CAAChJ,IAAI,CAAC,WAAW,CAAC,CAACiJ,IAAI,CAACJ,CAAO,CAAC,CAEzCG,CAAS,CAAChJ,IAAI,CAAC,WAAW,CAAC,CAACkJ,IAAI,CAACL,CAAO,CAAC,CAC1CG,CAAS,CAAChJ,IAAI,CAAC,cAAc,CAAC,CAAC5B,WAAW,CAAC,qCAAqC,CAAC,CAACJ,QAAQ,CAAC,OAAO,CAAC8K,CAAO,CAAC,CAC3GE,CAAS,CAACd,GAAG,CAAC,CAACiB,UAAU,CAAE,SAAS,CAAC,CAAC,CACtCH,CAAS,CAACvD,OAAO,CAAC,CAChB2D,OAAO,CAAE,CAAC,CACVC,GAAG,CAAE,GAAG,EAAEL,CAAS,CAACM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,IACnC,CAAC,CAAE,GAAG,CAAC,CACAN,CACR,CAAC,CACDxI,YAAY,CAAE,sBAAStC,CAAE,CAAE,CAC1BA,CAAE,CAAC0C,cAAc,EAAE,CACnBL,MAAM,CAACgJ,GAAG,CAACnM,CAAC,CAAC,IAAI,CAAC,CAAC+C,OAAO,CAAC,WAAW,CAAC,CACxC,CAAC,CACDoJ,GAAG,CAAE,aAASX,CAAO,CAAE,CACtBA,CAAO,CAACnD,OAAO,CAAC,CAAC2D,OAAO,CAAE,GAAG,CAAC,CAAE,GAAG,CAAE,UAAW,CAC/CR,CAAO,CAACV,GAAG,CAAC,CACXiB,UAAU,CAAE,QAAQ,CACpBE,GAAG,CAAE,KACN,CAAC,CACF,CAAC,CACF,CACD,CAAC,CAED,QAASG,SAAQ,CAACZ,CAAO,CAAEC,CAAO,CAAE,CACnCG,SAAS,CAAGJ,CAAO,CAAC5I,IAAI,CAAC,WAAW,CAAC,CACrCgJ,SAAS,CAAChJ,IAAI,CAAC,WAAW,CAAC,CAACiJ,IAAI,CAACJ,CAAO,CAAC,CACzCG,SAAS,CAACd,GAAG,CAAC,CAACiB,UAAU,CAAE,SAAS,CAAC,CAAC,CACtCH,SAAS,CAACvD,OAAO,CAAC,CAChB2D,OAAO,CAAE,CAAC,CACVC,GAAG,CAAE,GAAG,EAAEL,SAAS,CAACM,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,IACnC,CAAC,CAAE,GAAG,CACP,CAEA,QAASlJ,cAAa,CAACwI,CAAO,CAAqB,IAAnBa,EAAW,6DAC1Cb,CAAO,CAAC5I,IAAI,CAAC,aAAa,CAAC,CAAC/B,IAAI,CAAC,KAAK,CAAE,wCAAwC,CAACsG,IAAI,CAACC,MAAM,EAAE,EAAEiF,CAAW,CAAG,SAAS,CAAG,EAAE,CAAC,CAAC,CAC9Hb,CAAO,CAAC5I,IAAI,CAAC,oBAAoB,CAAC,CAACvB,GAAG,CAAC,EAAE,CAAC,CAACwF,OAAO,CAAC,OAAO,CAC3D,CAAC,GAEGxD,WAAU,CAAG,CAChBiJ,OAAO,GAAO,CACdC,KAAK,CAAE,KAAK,CACZvF,WAAW,CAAE,qBAASvG,CAAI,CAAE+L,CAAK,CAAE,CAClC,IAAI,CAAC7H,OAAO,CAAGlE,CAAI,CACC,WAAW,EAA5B,MAAO+L,EAAqB,EAAIA,CAAK,EACvC,IAAI,CAACnG,IAAI,EACX,CAAC,CACDL,GAAG,CAAE,cAAW,CACf,IAAI,CAACW,MAAM,EAAE,CACb,IAAI,CAACC,KAAK,EAAE,CACZ,IAAI,CAAC+B,IAAI,EAAE,CACXxF,MAAM,CAACgJ,GAAG,CAACnM,CAAC,CAAC,wBAAwB,CAAC,CACvC,CAAC,CACDqG,IAAI,CAAE,eAAW,CAChB,IAAI,CAACO,KAAK,EAAE,CACZ,IAAI,CAAC2F,KAAK,CAAG,MAAM,CACnBpJ,MAAM,CAACgJ,GAAG,CAACnM,CAAC,CAAC,wBAAwB,CAAC,CAAC,CACvCA,CAAC,CAAC,mBAAmB,CAAC,CAACY,QAAQ,CAAC,aAAa,CAAC,CAC9CZ,CAAC,CAAC,cAAc,CAAC,CAAC8L,IAAI,CAACpK,CAAC,CAAC+K,KAAK,CAAC,IAAI,CAAC9H,OAAO,CAACuC,IAAI,CAAE,EAAE,CAAC,CAAC,CACtDlH,CAAC,CAAC,wBAAwB,CAAC,CAACqB,GAAG,CAAC,IAAI,CAACsD,OAAO,CAACuC,IAAI,CAAC,CAIlD,GAAIwF,EAAS,CAAG,IAAI,CAAC/H,OAAO,CAACP,IAAI,CAACuI,KAAK,CAAC,GAAG,CAAC,CAC5C3M,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,CAACqL,CAAS,CAAC,CAAC,CAAC,CAAC,CACjC1M,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,CAACqL,CAAS,CAAC,CAAC,CAAC,CAAC,CACjC1M,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,CAAC,IAAI,CAACsD,OAAO,CAACgB,OAAO,CAAC,CAC5C3F,CAAC,CAAC,WAAW,CAAC,CAACqB,GAAG,CAAC,IAAI,CAACsD,OAAO,CAACiI,GAAG,CAAC,CAEjC,IAAI,CAACjI,OAAO,CAACkI,eAAe,EAC9B7M,CAAC,CAAC,kBAAkB,CAAC,CAACqB,GAAG,CAAC,IAAI,CAACsD,OAAO,CAACmI,kBAAkB,CAAC,CAC1D9M,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,GAAO,EAGrCxJ,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,GAAQ,CACvCxJ,CAAC,CAAC,gBAAgB,CAAC,CAAC6G,OAAO,CAAC,QAAQ,CAAC,CAErC,IAAI,CAAC8B,IAAI,EACV,CAAC,CACDhC,MAAM,CAAE,iBAAW,CACA,MAAM,GAArB,IAAI,CAAC4F,KAAgB,GACxB,IAAI,CAACA,KAAK,CAAG,KAAK,CAClBvM,CAAC,CAAC,mBAAmB,CAAC,CAACgB,WAAW,CAAC,aAAa,CAAC,CAClD,CAAC,CACDoF,GAAG,CAAE,aAASV,CAAI,CAAE,CACnB,IAAI,CAACf,OAAO,CAAGe,CAAI,CACnB,IAAI,CAACiB,MAAM,EAAE,CACb,IAAI,CAAC4F,KAAK,CAAG,QAAQ,CACrBvM,CAAC,CAAC,gBAAgB,CAAC,CAAC8L,IAAI,CAACpK,CAAC,CAAC+K,KAAK,CAAC/G,CAAI,CAACwB,IAAI,CAAE,EAAE,CAAC,CAAC,CAChDlH,CAAC,CAAC,mBAAmB,CAAC,CAACY,QAAQ,CAAC,eAAe,CAAC,CAChD,IAAI,CAAC+H,IAAI,EACV,CAAC,CACD/B,KAAK,CAAE,gBAAW,CACC,QAAQ,GAAvB,IAAI,CAAC2F,KAAkB,GAC1B,IAAI,CAACA,KAAK,CAAG,KAAK,CAClBvM,CAAC,CAAC,mBAAmB,CAAC,CAACgB,WAAW,CAAC,eAAe,CAAC,CACpD,CAAC,CACD2H,IAAI,CAAE,eAAW,CAChB3I,CAAC,CAAC,yBAAyB,CAAC,CAAC6G,OAAO,CAAC,OAAO,CAAC,CAC1C,IAAI,CAACyF,OAAO,GACftM,CAAC,CAAC,uBAAuB,CAAC,CAACa,IAAI,CAAC,KAAK,CAAE,wCAAwC,CAACsG,IAAI,CAACC,MAAM,EAAE,CAAC,CAC9FpH,CAAC,CAAC,cAAc,CAAC,CAAC+M,SAAS,CAAC,MAAM,CAAC,CACnC,IAAI,CAACT,OAAO,GAAO,CACpB,CAAC,CACDhJ,IAAI,CAAE,eAAW,CAEZ,IAAI,CAACgJ,OAAO,GAChBnJ,MAAM,CAACgJ,GAAG,CAACnM,CAAC,CAAC,wBAAwB,CAAC,CAAC,CACvCA,CAAC,CAAC,cAAc,CAAC,CAACgN,OAAO,CAAC,MAAM,CAAG,UAAW,CAC7C,IAAI,CAACrG,MAAM,EAAE,CACb,IAAI,CAACC,KAAK,EAAE,CACZ,IAAI,CAAC0F,OAAO,GACb,CAAC,CAAE/I,IAAI,CAAC,IAAI,CAAC,CAAC,CACf,CACD,CAAC,CAEG4G,aAAa,CAAG,CACnBmC,OAAO,GAAO,CACdC,KAAK,CAAE,KAAK,CACZlC,SAAS,CAAE,CAAC,CACZhE,IAAI,CAAE,cAASiE,CAAO,CAAE,CACvB,IAAI,CAAC1D,KAAK,EAAE,CACZ5G,CAAC,CAAC,gBAAgB,CAAC,CAACY,QAAQ,CAAC,aAAa,CAAC,CAC3CZ,CAAC,CAAC,iBAAiB,CAAC,CAAC8L,IAAI,CAACpK,CAAC,CAAC+K,KAAK,CAACnC,CAAO,CAACpD,IAAI,CAAE,EAAE,CAAC,CAAC,CACpDlH,CAAC,CAAC,0BAA0B,CAAC,CAACqB,GAAG,CAACiJ,CAAO,CAACpD,IAAI,CAAC,CAC5CoD,CAAO,CAACuC,eAAe,EACzB7M,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,CAACiJ,CAAO,CAACuC,eAAe,CAAC,CAC/C7M,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,GAAO,EAGlCxJ,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,GAAQ,CACpCxJ,CAAC,CAAC,aAAa,CAAC,CAAC6G,OAAO,CAAC,QAAQ,CAAC,CAC/ByD,CAAO,CAACE,KAAK,EACfxK,CAAC,CAAC,aAAa,CAAC,CAACqB,GAAG,CAACiJ,CAAO,CAACE,KAAK,CAAC,CAAC3D,OAAO,CAAC,QAAQ,CAAC,CACnDyD,CAAO,CAAC7L,GAAG,EACb0B,IAAI,CAACwK,MAAM,CAACL,CAAO,CAAC7L,GAAG,CAAC,CAEzB,IAAI,CAAC8N,KAAK,CAAG,MAAM,CACnB,IAAI,CAAC5D,IAAI,CAAC2B,CAAO,CAAC2C,MAAM,CAAC,CACzB,IAAI,CAAC5C,SAAS,CAAG,CAACC,CAAO,CAACN,EAC3B,CAAC,CACDrD,MAAM,CAAE,iBAAW,CACA,MAAM,GAArB,IAAI,CAAC4F,KAAgB,GACxB,IAAI,CAACA,KAAK,CAAG,KAAK,CAClBvM,CAAC,CAAC,gBAAgB,CAAC,CAACgB,WAAW,CAAC,aAAa,CAAC,CAC/C,CAAC,CACDoF,GAAG,CAAE,aAASkE,CAAO,CAAE,CACtB,IAAI,CAACD,SAAS,CAAG,CAACC,CAAO,CAACN,EAAE,CAC5B,IAAI,CAACrD,MAAM,EAAE,CACb,IAAI,CAAC4F,KAAK,CAAG,QAAQ,CACrBvM,CAAC,CAAC,mBAAmB,CAAC,CAAC8L,IAAI,CAACpK,CAAC,CAAC+K,KAAK,CAACnC,CAAO,CAACpD,IAAI,CAAE,EAAE,CAAC,CAAC,CACtDlH,CAAC,CAAC,gBAAgB,CAAC,CAACY,QAAQ,CAAC,eAAe,CAAC,CAC7C,IAAI,CAAC+H,IAAI,CAAC2B,CAAO,CAAC2C,MAAM,CACzB,CAAC,CACDrG,KAAK,CAAE,gBAAW,CACC,QAAQ,GAAvB,IAAI,CAAC2F,KAAkB,GAC1B,IAAI,CAACA,KAAK,CAAG,KAAK,CAClBvM,CAAC,CAAC,gBAAgB,CAAC,CAACgB,WAAW,CAAC,eAAe,CAAC,CAEjD,CAAC,CACD2H,IAAI,CAAE,cAASuE,CAAU,CAAE,CACD,WAAW,EAAjC,MAAOA,EAA0B,GAAEA,CAAU,GAAQ,EACxD/M,IAAI,CAACgN,cAAc,EAAE,CAClBD,CAAU,GACZ/M,IAAI,CAACiN,KAAK,CAACF,CAAU,CAAC,CACtBlN,CAAC,CAAC,kBAAkB,CAAC,CAACgB,WAAW,CAAC,UAAU,CAAC,EAE3C,IAAI,CAACsL,OAAO,GACftM,CAAC,CAAC,yBAAyB,CAAC,CAACa,IAAI,CAAC,KAAK,CAAE,wCAAwC,CAACsG,IAAI,CAACC,MAAM,EAAE,CAAC,CAChGpH,CAAC,CAAC,eAAe,CAAC,CAAC+M,SAAS,CAAC,MAAM,CAAC,CACpC,IAAI,CAACT,OAAO,GAAO,CACnBtM,CAAC,CAAC,2BAA2B,CAAC,CAAC6G,OAAO,CAAC,OAAO,CAAC,CAEpB,SAAS,GAAjC7G,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,EAAgB,EACnClB,IAAI,CAACyK,OAAO,EAAE,CAChB,CAAC,CACDtH,IAAI,CAAE,eAAW,CACZ,IAAI,CAACgJ,OAAO,EAChBtM,CAAC,CAAC,eAAe,CAAC,CAACgN,OAAO,CAAC,MAAM,CAAG,UAAW,CAC9C,IAAI,CAACrG,MAAM,EAAE,CACb,IAAI,CAACC,KAAK,EAAE,CACZ,IAAI,CAAC0F,OAAO,GACb,CAAC,CAAE/I,IAAI,CAAC,IAAI,CAAC,CACd,CAAC,CACD8J,MAAM,CAAE,iBAAW,CACf,IAAI,CAACf,OAAO,CAAE,IAAI,CAAChJ,IAAI,EAAE,CACvB,IAAI,CAACqF,IAAI,EACf,CACD,CAAC,CAEGrG,MAAM,CAAG,CACZgL,IAAI,GACL,CAAC,CAEGzK,WAAW,CAAG,CACjB0K,OAAO,CAAE,iBAASlM,CAAG,CAAE,CACtB,MAAO,CAAC,CAACA,CAAG,EAAKA,CAAG,CAACgI,MAAM,EAAI/G,MAAM,CAACkL,kBACvC,CAAC,CACDC,OAAO,CAAE,iBAASpM,CAAG,CAAE,CACtB,MAAO,CAAC,CAACA,CACV,CAAC,CACDqM,QAAQ,CAAE,kBAASrM,CAAG,CAAE,CACvB,MAAO,CAAC,CAACA,CAAG,EAAKA,CAAG,CAACgI,MAAM,EAAI/G,MAAM,CAACqL,mBACvC,CACD,CAAC,CAED,QAAS7K,aAAY,CAAC8K,CAAK,CAAa,CACvCA,CAAK,CAAChL,IAAI,CAAC,qBAAqB,CAAC,CAAC/B,IAAI,CAAC,UAAU,CAAE,CAAC,CAAE+M,CAAK,CAAChL,IAAI,CAAC,kBAAkB,CAAC,CAACyG,MAAO,CAC7F,CAAC,GAEGtI,QAAO,CAAG,CACb,OAAQ,kBAAW,CAClBf,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,CAAClB,IAAI,CAACiK,UAAU,EAAE,CACzC,CAAC,CACD,OAAQ,kBAAW,CAClBjK,IAAI,CAACiN,KAAK,CAACpN,CAAC,CAAC,eAAe,CAAC,CAACqB,GAAG,EAAE,CAAE,OAAO,CAC7C,CAAC,CACD+F,MAAM,CAAE,iBAAW,CAClBjH,IAAI,CAAC0N,UAAU,EAChB,CAAC,CACDC,MAAM,CAAE,iBAAW,CAClB9N,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,SAAS,CAAC,CAC5BlB,IAAI,CAACuK,WAAW,CAACqD,YAAY,CAAEtQ,cAAc,CAC9C,CAAC,CACDuQ,KAAK,CAAE,gBAAW,CACjB7N,IAAI,CAAC6N,KAAK,EACX,CAAC,CACDC,KAAK,CAAE,gBAAW,CACjB9N,IAAI,CAAC+N,aAAa,EACnB,CAAC,CACDC,MAAM,CAAE,iBAAW,CAClBtQ,QAAQ,CAACyN,cAAc,CAAC,iBAAiB,CAAC,CAAClK,KAAK,EACjD,CAAC,CACDgN,QAAQ,CAAE,mBAAW,CACpBjO,IAAI,CAACkO,eAAe,EACrB,CAAC,CACDC,WAAW,CAAE,sBAAW,CACvB7L,OAAO,CAACC,GAAG,CAAC,aAAa,CAC1B,CAAC,CACD6L,aAAa,CAAE,wBAAW,CACzBpE,aAAa,CAACkD,MAAM,EACrB,CAAC,CACDmB,WAAW,CAAE,qBAAS1N,CAAE,CAAE,CACzBA,CAAE,CAAC0C,cAAc,EAAE,CACnBxD,CAAC,CAAC,eAAe,CAAC,CAACY,QAAQ,CAAC,sBAAsB,CACnD,CAAC,CACD6N,cAAc,CAAE,wBAAS3N,CAAE,CAAE,CAC5BA,CAAE,CAAC0C,cAAc,EAAE,CACnBxD,CAAC,CAAC,kBAAkB,CAAC,CAACY,QAAQ,CAAC,sBAAsB,CACtD,CAAC,CACD8N,kBAAkB,CAAE,6BAAW,CAC9BvO,IAAI,CAACyK,OAAO,EACb,CACD,CAAC,CAEGvK,WAAW,GAAQ,CAEvB,QAASoD,4BAA2B,CAACkL,CAAG,CAAE,CACzCA,CAAG,CAACpO,IAAI,CAAC,UAAW,CACnBP,CAAC,CAAC,IAAI,CAAC,CAAC8K,GAAG,CAAC,CAAC8D,UAAU,CAAE5O,CAAC,CAAC,IAAI,CAAC,CAACkM,MAAM,EAAE,CAAC,IAAI,CAAC,CAChD,CAAC,CACF,CAAC,GAEG2C,OAAM,CAAG,CACZC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1B7O,CAAC,CAAE,SAAS,CAAE8O,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1BC,CAAC,CAAE,SAAS,CAAEC,CAAC,CAAE,SAAS,CAC1B,IAAK,QAAQ,CAAE,EAAK,QACrB,CAAC,CACGC,UAAU,CAAG,GAAIC,OAAM,CAAC,IAAI,CAACpO,CAAC,CAACqO,YAAY,CAACrO,CAAC,CAACsO,IAAI,CAACnB,MAAM,CAAC,CAACnI,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAE,GAAG,CAAC,CAC3FuJ,cAAc,CAAG,GAAIH,OAAM,CAAC,IAAI,CAACpO,CAAC,CAACqO,YAAY,CAACrO,CAAC,CAACsO,IAAI,CAACnB,MAAM,CAAC,CAACnI,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAE,GAAG,CAAC,CAE/F6D,MAAM,CAAG,CACZ2F,MAAM,CAAE,gBAAS/O,CAAK,CAAE,CACvB,GAAIgP,EAAS,CAAGhP,CAAK,CAACiP,WAAW,EAAE,CAAEC,CAAW,CAAGlP,CAAK,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACF,WAAW,EAAE,CACjF,MAAO,CACNG,CAAC,CAAE,iDAAiD,CAACJ,CAAS,CAAC,QAAQ,CAACE,CAAW,CAAC,QAAQ,CAC5FnB,CAAC,CAAE,cAAc,CAACiB,CACnB,CACD,CAAC,CACDK,MAAM,CAAE,gBAASrP,CAAK,CAAE,CACvB,GAAIgP,EAAS,CAAGhP,CAAK,CAACiP,WAAW,EAAE,CAAEC,CAAW,CAAGlP,CAAK,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACF,WAAW,EAAE,CAAEK,CAAM,CAAGtP,CAAK,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACI,WAAW,EAAE,CAC1H,MAAO,CACNH,CAAC,CAAE,qDAAqD,CAACJ,CAAS,CAAC,OAAO,CAACE,CAAW,CAAC,QAAQ,CAC/FnB,CAAC,CAAE,cAAc,CAACiB,CAAS,CAAC,gBAAgB,CAACA,CAAS,CAAC,oBAAoB,CAACA,CAAS,CAAC,oBAAoB,CAACM,CAAM,CAAC,kBACnH,CACD,CAAC,CACDE,OAAO,CAAE,iBAASxP,CAAK,CAAE,CACxB,GAAIgP,EAAS,CAAGhP,CAAK,CAACiP,WAAW,EAAE,CAAEC,CAAW,CAAGlP,CAAK,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACF,WAAW,EAAE,CAAEK,CAAM,CAAGtP,CAAK,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACI,WAAW,EAAE,CAC1H,MAAO,CACNH,CAAC,CAAE,4CAA4C,CAC/CrB,CAAC,CAAE,cAAc,CAACiB,CAAS,CAAC,gBAAgB,CAACA,CAAS,CAAC,oBAAoB,CAACA,CAAS,CAAC,oBAAoB,CAACM,CAAM,CAAC,kBACnH,CACD,CAAC,CACDG,IAAI,CAAE,cAASzP,CAAK,CAAE,CACrB,GAAIgP,EAAS,CAAGhP,CAAK,CAACiP,WAAW,EAAE,CAAES,CAAO,CAAG1P,CAAK,CAAC2P,QAAQ,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACX,WAAW,EAAE,CAC5F,MAAO,CACNG,CAAC,CAAE,cAAc,CAACJ,CAAS,CAAC,GAAG,CAC/BjB,CAAC,CAAE,cAAc,CAAC2B,CAAO,CAAC,GAC3B,CACD,CACD,CAAC,CAAE9C,YAAY,CAAG,QAAQ,CAC1BxD,MAAM,CAACyG,YAAY,CAAGzG,MAAM,CAACiG,MAAM,CAEnC,GAAIS,UAAS,CAAG,CACff,MAAM,CAAE,itBAgBL,CACFc,YAAY,CAAE,mHAMZ,CACFJ,IAAI,CAAE,sLAER,CAAC,CAED,QAASM,oBAAmB,EAAG,CAC9B,MAAO7Q,YACR,CAEA,GAAI8Q,SAAQ,CAAGC,SAAS,CAACC,SAAS,CAACC,KAAK,CAAC,mBAAmB,CAAC,CAC7D,GAAGH,QAAQ,CAAE,CACZ,GAAII,cAAa,CAAGJ,QAAQ,CAAC,CAAC,CAAC,CACV,EAAE,EAApB,CAACI,aAAmB,GACvBL,mBAAmB,CAAG,UAAW,CAChC,MAAOlR,EAAC,CAAC,aAAa,CAAC,CAACqJ,MACzB,CAAC,CACF,CAEA,GAAImI,WAAU,CAAG,CACftB,MAAM,CAAE,iBAAW,CACpB,GAAI/O,EAAK,CAAG,IAAI,CAACqJ,KAAK,CAACiH,eAAe,CACpCnB,CAAM,CAAGoB,SAAS,CAACvQ,CAAK,CAAC,CAACmP,MAAM,CAAC,EAAE,CAAC,CAACI,WAAW,EAAE,CACpD,IAAI,CAACxO,GAAG,CAACyP,EAAE,CAAC,IAAI,CAAE,EAAG,CAAE,CACrB3F,OAAO,CAAE,CAAC,CACV4F,SAAS,CAAEzQ,CAAK,CAAC,oBAAoB,CAACA,CAAK,CAAC,sBAAsB,CAACmP,CAAM,CAAC,kBAC5E,CAAC,CAAC,CAACqB,EAAE,CAAC,IAAI,CAAE,EAAG,CAAE,CACf3F,OAAO,CAAE,CAAC,CACV4F,SAAS,CAAEzQ,CAAK,CAAC,oBAAoB,CAACA,CAAK,CAAC,oBAAoB,CAACmP,CAAM,CAAC,kBAC1E,CAAC,CACA,CAAC,CAYDM,IAAI,CAAE,eAAW,CAClB,GAAIzP,EAAK,CAAG,IAAI,CAACqJ,KAAK,CAACiH,eAAe,CACtC,IAAI,CAACvP,GAAG,CAACyP,EAAE,CAAC,IAAI,CAAE,EAAG,CAAE,CACrB3F,OAAO,CAAE,CAAC,CACV4F,SAAS,CAAE,mCAAmC,CAAGzQ,CAAK,CAAG,kBAC3D,CAAC,CAAC,CAACwQ,EAAE,CAAC,IAAI,CAAE,EAAG,CAAE,CACf3F,OAAO,CAAE,CAAC,CACV4F,SAAS,CAAE,qCAAqC,CAAGzQ,CAAK,CAAG,kBAC7D,CAAC,CACA,CACF,CAAC,CACDqQ,UAAU,CAAChB,MAAM,CAAGgB,UAAU,CAACR,YAAY,CAAGQ,UAAU,CAACb,OAAO,CAAGa,UAAU,CAACtB,MAAM,IAyYhF2B,QAAO,CAvYP1R,IAAI,CAAG,CACVJ,IAAI,CAAE,cAAS+R,CAAG,CAAE,CACnB,IAAI,CAACnD,GAAG,CAAG3O,CAAC,CAAC8R,CAAG,CAAC,CACjB,GAAIC,EAAI,CAAG,IAAI,CACf,IAAI,CAACpD,GAAG,CAAC/L,IAAI,CAAC,iBAAiB,CAAC,CAACkI,GAAG,CAAC,CAACkH,OAAO,CAAE,cAAc,CAAC,CAAC,CAAC1O,IAAI,EAAE,CACtE,IAAI,CAACqL,GAAG,CAAC/L,IAAI,CAAC,eAAe,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,KAAK,CAAE,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CACnF,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,iBAAiB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,KAAK,CAAE,CAAC,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CACtF,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,kBAAkB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,QAAQ,CAAE,CAAC,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CAC1F,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,oBAAoB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,QAAQ,CAAE,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CAC3F,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,kBAAkB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,MAAM,CAAE,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CACvF,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,mBAAmB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,MAAM,CAAE,CAAC,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CACzF,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,mBAAmB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,OAAO,CAAE,CAAC,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CAC1F,IAAI,CAACtD,GAAG,CAAC/L,IAAI,CAAC,oBAAoB,CAAC,CAACxB,KAAK,CAAC,UAAW,CAAC2Q,CAAI,CAACE,QAAQ,CAAC,OAAO,CAAE,CAAC,CAAE,OAAO,CAAC,CAAC,CAAC,CAC1F,IAAI,CAACC,QAAQ,CAAG,GAAIC,OAAM,CAAC,EAAE,CAAC,CACV,SAAS,GAA1B,IAAI,CAACC,OAAqB,EAC5B,IAAI,CAACzH,MAAM,CAAC,IAAI,CAACyH,OAAO,CAAC,CAC1B,IAAI,CAAC1H,WAAW,CAAC,IAAI,CAAC2H,SAAS,CAAE,IAAI,CAAC/H,OAAO,CAC9C,CAAC,CACDA,OAAO,CAAEzE,YAAY,cAAiB,6OAAkB,CACxDwM,SAAS,CAAExM,YAAY,UAAa,EAAIkI,YAAY,CACpDqE,OAAO,CAAEvM,YAAY,QAAW,EAAI,SAAS,CAC7CiI,MAAM,CAAE,iBAAW,CAClB9N,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,SAAS,CAAC,CAC5B,IAAI,CAACqJ,WAAW,CAAC,IAAI,CAAC2H,SAAS,CAAE,IAAI,CAAC/H,OAAO,CAC9C,CAAC,CACDE,KAAK,CAAE,SAAK6H,SAAS,CACrB3H,WAAW,CAAE,qBAASF,CAAK,CAAC8H,CAAS,CAAE,OAClC5Q,EAAC,CAAC6Q,GAAG,CAAChI,MAAM,CAAEC,CAAK,CAAC,MAExBxK,CAAC,CAAC,aAAa,CAAC,CAACqB,GAAG,CAACmJ,CAAK,CAAC,CACH,WAAW,EAAhC,MAAO8H,EAAyB,GAAEA,CAAS,GAAQ,EACtD,IAAI,CAAC9H,KAAK,CAAGA,CAAK,CAClBrB,QAAQ,CAACC,MAAM,CAAC,WAAW,CAAC,CACzB1H,CAAC,CAAC6Q,GAAG,CAACtB,SAAS,CAAEzG,CAAK,CAAC,EACzBrB,QAAQ,CAACG,MAAM,CAAC,WAAW,CAAE2H,SAAS,CAACzG,CAAK,CAAC,CAAC,CAC/C,IAAI,CAAC4C,KAAK,CAACkF,CAAS,CAAC,EAPb7P,OAAO,CAAC+C,KAAK,CAAC,+IAA4B,CAQnD,CAAC,CACDmF,MAAM,CAAE,gBAASxJ,CAAK,CAAE,CACvB,GAAa,KAAK,GAAfA,CAAe,CAIjB,MAHAnB,EAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,KAAK,CAAC,CACxBrB,CAAC,CAAC,MAAM,CAAC,CAACY,QAAQ,CAAC,cAAc,CAAC,MAClC5C,IAAI,CAACS,GAAG,GAAQ,EAGjBT,IAAI,CAACS,GAAG,GAAO,CACF,SAAS,GAAnB0C,CAAmB,EACrBnB,CAAC,CAAC,YAAY,CAAC,CAACa,IAAI,CAAC,UAAU,IAAO,CACtCM,CAAK,CAAGhB,IAAI,CAACqS,YAAY,CACzBxS,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,SAAS,CAAC,GAG5BrB,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,QAAQ,CAAC,CAC3BrB,CAAC,CAAC,YAAY,CAAC,CAACa,IAAI,CAAC,UAAU,IAAQ,EAErCb,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAACwJ,OAAO,EAC7BxJ,CAAC,CAAC,MAAM,CAAC,CAACgB,WAAW,CAAC,cAAc,CAAC,CACtC,GAAIyR,EAAK,CAAGzS,CAAC,CAAC,YAAY,CAAC,CACxByS,CAAK,CAAC,CAAC,CAAC,CAACxQ,cAAc,CAAC,OAAO,CAAC,CAClCwQ,CAAK,CAAC,CAAC,CAAC,CAACtR,KAAK,CAACuR,UAAU,CAACvR,CAAK,CAAC,CAEhCsR,CAAK,CAACpR,GAAG,CAACF,CAAK,CAAC,CACS,CAAC,CAAC,EAAzBA,CAAK,CAACwR,OAAO,CAAC,GAAG,CAAS,GAC5BxR,CAAK,CAAG,GAAG,CAACA,CAAK,EAClBzB,WAAW,CAACkT,SAAS,CAAGzR,CACzB,CAAC,CACDR,YAAY,CAAE,sBAASQ,CAAK,CAAE0R,CAAK,CAAErI,CAAK,CAAE,CACvB,WAAW,EAA5B,MAAOA,EAAqB,GAAEA,CAAK,CAAG,IAAI,CAACA,KAAK,EACnD,GAAIsI,EAAI,CAAG3R,CAAK,CAACwL,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAIxL,CAAK,CAACwL,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC7DxL,CAAK,CAAGO,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAEiE,CAAI,CAAC,CAAGpB,SAAS,CAAC7C,MAAM,CAACiE,CAAI,CAAC,CAAC,CAAGpB,SAAS,CAACoB,CAAI,CAAC,CACvEC,CAAO,CAAGrR,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAEiE,CAAI,CAAC,CAAGA,CAAI,CAAI,GAAG,CAAC3R,CAAK,CAAC6R,KAAK,EAAE,CAAC/J,WAAW,EAAG,CACxEuB,CAAK,CAAGD,MAAM,CAACC,CAAK,CAAC,CAACrJ,CAAK,CAAC,CAC9B,GAAGA,CAAK,CAAC8R,OAAO,EAAI9R,CAAK,CAAC+R,EAAE,EAAIlV,IAAI,CAACO,kBAAkB,CAAE,CACxD,GAAY,OAAO,EAAhBsU,CAAgB,CAClB,MAAO7S,EAAC,CAAC,gBAAe,CAAC+S,CAAO,CAAC,kCAA8B,CAACvI,CAAK,CAAC+F,CAAC,CAAC,WAAU,CAAC,CAEnF,GAAI4C,EAAK,CAAGnT,CAAC,CAAC,gBAAe,CAAC+S,CAAO,CAAC,iCAA6B,CAACvI,CAAK,CAAC0E,CAAC,CAAC,WAAU,CAAC,CACvFiE,CAAK,CAAC,CAAC,CAAC,CAACjR,GAAG,CAAG,GAAIkR,aAAc,IAC7BC,EAAK,CAAG,UAAW,CACtB,IAAI,CAACnR,GAAG,CAACC,QAAQ,CAAC,CAAC,CACpB,CAAC,CACOlD,CAAO,GAAGJ,mBAAmB,CAACW,UAAU,EAAG,CAACP,OAAO,GAAM,CAAS,CAG1E,MAFAkU,EAAK,CAAC,CAAC,CAAC,CAACnU,gBAAgB,CAAC,YAAY,CAAEqU,CAAK,CAAEpU,CAAO,CAAC,CACvDkU,CAAK,CAAC,CAAC,CAAC,CAACnU,gBAAgB,CAAC,YAAY,CAAEqU,CAAK,CAAEpU,CAAO,CAAC,CAChDkU,CAET,CAMC,MAJY,OAAO,EAAhBN,CAAgB,CACX7S,CAAC,CAAC,oDAAgD,CAAC,CAC/C,MAAM,EAAf6S,CAAe,CACV7S,CAAC,CAAC,8CAA0C,CAAC,OAEvD,CAAC,CACDsT,SAAS,CAAE,CACVhJ,OAAO,CAAE,EAAE,CACXuI,KAAK,CAAE,EAAE,CACTrI,KAAK,CAAE,EACR,CAAC,CACD4C,KAAK,CAAE,eAAS9C,CAAO,CAAEuI,CAAK,CAAE,CAS/B,GARsB,QAAQ,EAA3B,MAAOvI,EAAoB,GAAEA,CAAO,CAAG,IAAI,CAACF,UAAU,EAAE,EACvC,WAAW,EAA5B,MAAOyI,EAAqB,GAAEA,CAAK,CAAG7S,CAAC,CAAC,YAAY,CAAC,CAAC2D,QAAQ,CAAC,WAAW,CAAC,CAAG,OAAO,CAAG,MAAM,EACjG2G,CAAO,CAAGA,CAAO,CAChBpB,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CACnBA,OAAO,CAAC,SAAS,CAAE,GAAG,CAAC,CACvBA,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CACnBA,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CAEjBoB,CAAO,GAAK,IAAI,CAACgJ,SAAS,CAAChJ,OAAO,EAAIuI,CAAK,GAAK,IAAI,CAACS,SAAS,CAACT,KAAK,EAAI,IAAI,CAACrI,KAAK,GAAK,IAAI,CAAC8I,SAAS,CAAC9I,KAAK,EAC9G,IAAI,CAAC8I,SAAS,CAAChJ,OAAO,CAAGA,CAAO,CAAE,IAAI,CAACgJ,SAAS,CAACT,KAAK,CAAGA,CAAK,CAAE,IAAI,CAACS,SAAS,CAAC9I,KAAK,CAAG,IAAI,CAACA,KAAK,CACjG,GAAI+I,EAAM,CAAG,IAAI,CAAC5E,GAAG,CAAC/L,IAAI,CAAC,QAAQ,CAAC,CAAE4Q,CAAS,CAAG,IAAI,CAAC7E,GAAG,CAAC/L,IAAI,CAAC,WAAW,CAAC,CAChE,MAAM,EAAfiQ,CAAe,EAAEU,CAAM,CAAC3Q,IAAI,CAAC,WAAW,CAAC,CAACwG,MAAM,EAAE,CACzC,OAAO,EAAhByJ,CAAgB,EAAEW,CAAS,CAAC5Q,IAAI,CAAC,WAAW,CAAC,CAACwG,MAAM,EAAE,CACzD,GAAIqK,EAAK,CAAGnJ,CAAO,CAACqC,KAAK,CAAC,OAAO,CAAC,CAelC,GAdAjL,CAAC,CAACnB,IAAI,CAACkT,CAAK,CAAE,SAASC,CAAI,CAAEC,CAAE,CAAE,CAChC,GAAIC,EAAK,CAAGlS,CAAC,CAACmS,OAAO,CAACH,CAAI,CAAC/G,KAAK,CAACkD,UAAU,CAAC,CAAC,CAC7CnO,CAAC,CAACnB,IAAI,CAACqT,CAAK,CAAE,SAASd,CAAI,CAAEgB,CAAE,CAAE,CACpB,MAAM,EAAfjB,CAAe,EACjB,IAAI,CAAClS,YAAY,CAACmS,CAAI,CAAE,OAAO,CAAC,CAACjS,IAAI,CAAC,IAAI,CAAE,KAAK,CAAC8S,CAAE,CAAC,GAAG,CAACG,CAAE,CAAC,CAACC,QAAQ,CAACR,CAAM,CAAC,CAClE,OAAO,EAAhBV,CAAgB,EAClB,IAAI,CAAClS,YAAY,CAACmS,CAAI,CAAE,MAAM,CAAC,CAACjS,IAAI,CAAC,IAAI,CAAE,KAAK,CAAC8S,CAAE,CAAC,GAAG,CAACG,CAAE,CAAC,CAACC,QAAQ,CAACP,CAAS,CAChF,CAAC,CAAE,IAAI,CAAC,CACI,MAAM,EAAfX,CAAe,EACjB7S,CAAC,CAAC,MAAM,CAAC,CAAC+T,QAAQ,CAACR,CAAM,CAAC,CACf,OAAO,EAAhBV,CAAgB,EAClB7S,CAAC,CAAC,MAAM,CAAC,CAAC+T,QAAQ,CAACP,CAAS,CAC9B,CAAC,CAAE,IAAI,CAAC,CAEK,OAAO,GAAjBX,CAAiB,CACnB,GAAIrI,EAAK,CAAG,IAAI,CAACA,KAAK,CACtBxK,CAAC,CAAC,OAAO,CAAC,CAACO,IAAI,CAACiR,UAAU,CAAChH,CAAK,CAAC,CAAC,CACnC,IAAI,CAACI,OAAO,CAACiI,CAAK,CAAC,CACpB,CAAC,CACD1F,cAAc,CAAE,yBAAW,CAC1BnN,CAAC,CAAC,WAAW,CAAC,CAACgU,KAAK,EAAE,CACtBhU,CAAC,CAAC,WAAW,CAAC,CAACiU,OAAO,EAAE,CACxBjU,CAAC,CAAC,WAAW,CAAC,CAAC+M,SAAS,EAAE,CAG1BmH,KAAK,CAAC9L,IAAI,CAAC,UAAW,CACrBpI,CAAC,CAAC,iBAAiB,CAAC,CAACgB,WAAW,CAAC,aAAa,CAAC,CAACJ,QAAQ,CAAC,YAAY,CACtE,CAAC,CAAC,CACFZ,CAAC,CAAC,QAAQ,CAAC,CAACM,EAAE,CAAC,sBAAsB,CAAE,OAAO,CAAE,SAASQ,CAAE,CAAE,CAC5D,GAAIG,KAAK,CAACC,IAAI,GAAgB,YAAY,EAAvBJ,CAAE,CAACmK,IAAoB,EAAMiG,mBAAmB,EAAE,CAA6C,CAClH,GAAkB,SAAS,GAAxBjQ,KAAK,CAACC,IAAkB,CAAE,CAC5B,GAAIC,EAAK,CAAGnB,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC,CAC7BT,CAAC,CAAC,SAAS,CAAC,CAACgB,WAAW,CAAC,UAAU,CAAC,CACjCU,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAE1N,CAAK,CAAC,EACtBnB,CAAC,CAAC,UAAU,CAACmB,CAAK,CAAC,CAACP,QAAQ,CAAC,UAAU,CAAC,CACxCK,KAAK,CAACE,KAAK,CAAGA,CAAK,GAGnBF,KAAK,CAACE,KAAK,CAAGA,CAAK,CACnBnB,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAACmB,KAAK,CAACuR,UAAU,CAAChB,SAAS,CAACvQ,CAAK,CAAC,CAACiP,WAAW,EAAE,CAAC,CACrEpQ,CAAC,CAAC,cAAc,CAAC,CAACY,QAAQ,CAAC,UAAU,CAAC,CACnC,CAACZ,CAAC,CAAC,2BAA2B,CAACmB,CAAK,CAAC8H,WAAW,EAAE,CAAC,GAAG,CAAC,CAACI,MAAM,EAChErJ,CAAC,CAAC,kBAAkB,CAAC,CAACmU,OAAO,CAAChU,IAAI,CAACQ,YAAY,CAACQ,CAAK,CAAE,OAAO,CAAC,CAACP,QAAQ,CAAC,QAAQ,CAAC,CAACH,IAAI,CAAC,KAAK,CAAE,QAAQ,CAAC,CAACI,IAAI,CAAC,IAAI,CAAE,SAAS,CAACM,CAAK,CAAC,CAAC,CAGxI,CAAC,IACI,IACA6I,EAAE,CAAGhK,CAAC,CAAC,IAAI,CAAC,CAACa,IAAI,CAAC,IAAI,CAAC,CACvBM,CAAK,CAAmB,QAAQ,GAAvBF,KAAK,CAACC,IAAiB,CAAI,GAAG,CAAGD,KAAK,CAACE,KAAK,CACzDnB,CAAC,CAAC,IAAI,CAAC,CAACU,WAAW,CAACP,IAAI,CAACQ,YAAY,CAACQ,CAAK,CAAE,OAAO,CAAC,CAACN,IAAI,CAAC,IAAI,CAAEmJ,CAAE,CAAC,CAAC,CACjEtI,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAE1N,CAAK,CAAC,EAAKnB,CAAC,CAAC,2BAA2B,CAACmB,CAAK,CAAC8H,WAAW,EAAE,CAAC,GAAG,CAAC,CAACI,MAAM,EACzFrJ,CAAC,CAAC,kBAAkB,CAAC,CAACmU,OAAO,CAAChU,IAAI,CAACQ,YAAY,CAACQ,CAAK,CAAE,OAAO,CAAC,CAACP,QAAQ,CAAC,QAAQ,CAAC,CAACH,IAAI,CAAC,KAAK,CAAE,QAAQ,CAAC,CAACI,IAAI,CAAC,IAAI,CAAE,SAAS,CAACM,CAAK,CAAC,CAAC,CACtIhB,IAAI,CAACmT,SAAS,CAAChJ,OAAO,CAAG,EAC1B,CACD,CAAC,CAAC,CACF,IAAI,CAACqE,GAAG,CAAChM,MAAM,EAAE,CAAC/B,QAAQ,CAAC,WAAW,CAAC,CACvCZ,CAAC,CAAC,iBAAiB,CAAC,CAAC+M,SAAS,EAC/B,CAAC,CACD9L,KAAK,GAAO,CACZmT,SAAS,CAAE,mBAAS9J,CAAO,CAAE,CACN,WAAW,EAA9B,MAAOA,EAAuB,GAAEA,CAAO,CAAG,IAAI,CAACF,UAAU,EAAE,EAC9D,IAAI,CAACE,OAAO,CAAGzE,YAAY,cAAiB,CAAGyE,CAAO,CACtD,IAAI,CAAC+H,SAAS,CAAGxM,YAAY,UAAa,CAAG,IAAI,CAAC2E,KAAK,CACvD,GAAI6J,EAAO,CAAGrU,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,EAAE,CACjCwE,YAAY,QAAW,CAAgB,QAAQ,GAApBwO,CAAoB,CAAIrU,CAAC,CAAC,YAAY,CAAC,CAACqB,GAAG,EAAE,CAAGgT,CAC5E,CAAC,CACDnG,aAAa,CAAE,wBAAW,CACzBlO,CAAC,CAAC,QAAQ,CAAC,CAACmM,GAAG,EAAE,CACjB,GAAImI,EAAU,CAAG,IAAI,CAAClK,UAAU,EAAE,CAClC,IAAI,CAACkJ,SAAS,CAAChJ,OAAO,CAAG,EAAE,CAC3B,IAAI,CAAC8C,KAAK,CAACkH,CAAU,CAAE,MAAM,CAAC,CAC9B,IAAI,CAAC3F,GAAG,CAAChM,MAAM,EAAE,CAAC3B,WAAW,CAAC,WAAW,CAAC,CAC1ChB,CAAC,CAAC,iBAAiB,CAAC,CAACgN,OAAO,EAAE,CAC9B,IAAI,CAACoH,SAAS,CAACE,CAAU,CAAC,CAC1BtU,CAAC,CAAC,WAAW,CAAC,CAAC+M,SAAS,EAAE,CAC1B/M,CAAC,CAAC,WAAW,CAAC,CAACgN,OAAO,EACvB,CAAC,CACD5C,UAAU,CAAE,qBAAW,CACtB,GAAamK,EAAI,CAAbC,CAAG,CAAG,CAAC,CAAQC,CAAM,CAAG,EAAE,CAU9B,MATA,KAAI,CAAC9F,GAAG,CAAC/L,IAAI,CAAC,aAAa,CAAC,CAACrC,IAAI,CAAC,UAAW,CACzCP,CAAC,CAAC,IAAI,CAAC,CAACa,IAAI,CAAC,IAAI,CAAC,CAAC8L,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAG6H,CAAG,GACxCC,CAAM,EAAI,GAAG,CACbD,CAAG,EAAE,EAEND,CAAI,CAAGvU,CAAC,CAAC,IAAI,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC,CACP,CAAC,CAAf8T,CAAI,CAAClL,MAAU,GAAEkL,CAAI,CAAG,GAAG,CAACA,CAAI,CAAC,GAAG,EACvCE,CAAM,EAAIF,CACX,CAAC,CAAC,CACKE,CACR,CAAC,CACD7J,OAAO,CAAE,iBAASiI,CAAK,CAAE,CACJ,WAAW,EAA5B,MAAOA,EAAqB,GAAEA,CAAK,CAAG7S,CAAC,CAAC,YAAY,CAAC,CAAC2D,QAAQ,CAAC,WAAW,CAAC,CAAG,OAAO,CAAG,MAAM,KAC7F+Q,EAAE,CAAc,OAAO,GAAjB7B,CAAiB,CAAI,OAAO,CAAG,MAAM,CAC3C8B,CAAK,CAAG9W,QAAQ,CAAC+W,gBAAgB,CAAC,QAAQ,CAACF,CAAE,CAAC,aAAa,CAAC,CACnD,OAAO,GAAjB7B,CAAiB,GACnB,IAAI,CAAC8B,KAAK,CAAGA,CAAK,CAElB,IAAI,CAACE,QAAQ,EAAE,CACf,IAAI,CAACC,SAAS,CAAG,IAAI,CAACH,KAAK,CAACtL,MAAM,CAClC,IAAI,CAAC0L,gBAAgB,CAAG5N,IAAI,CAAC6N,KAAK,CAAC7N,IAAI,CAAC8N,IAAI,CAAC,IAAI,CAACH,SAAS,CAAC,CAAC,EAG9D,GAAItC,EAAY,CAAI,SAAS0C,CAAE,CAAE,CAAC,MAAOxT,EAAC,CAACyT,MAAM,CAACD,CAAE,CAAC,CAACxT,CAAC,CAAC0T,GAAG,CAACF,CAAE,CAAC,CAAC,CAAC,CAAExT,CAAC,CAAC2T,OAAO,CAAC3T,CAAC,CAAC4T,KAAK,CAAC5T,CAAC,CAAC4T,KAAK,CAACX,CAAK,CAAE,SAAS,CAAC,CAAE,GAAG,CAAC,CAAC,CAAC,CACtH,IAAI,CAACnC,YAAY,CAAG9Q,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAE2D,CAAY,CAAC,CAAG3D,MAAM,CAAC2D,CAAY,CAAC,CAAGd,SAAS,CAACc,CAAY,CAAC,CAACpC,WAAW,EAAE,CAEpF,SAAS,EAAhCpQ,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,EAAe,EAClC,IAAI,CAACsJ,MAAM,CAAC,SAAS,CAAC,CAGvB,GAAI4K,EAAU,CAAG,IAAI,CAAC5G,GAAG,CAAC/L,IAAI,CAAC,QAAQ,CAAC,CAACsJ,MAAM,EAAE,CAAEsJ,CAAS,CAAG,IAAI,CAAC7G,GAAG,CAAC/L,IAAI,CAAC,QAAQ,CAAC,CAAC2F,KAAK,EAAE,CAC9FvI,CAAC,CAAC,aAAa,CAAC,CAAC8K,GAAG,CAAC,CAAC,IAASyK,CAAU,CAAIvX,IAAI,CAACU,SAAS,CAAIV,IAAI,CAACE,SAAS,CAAE,IAAI,CAAC,CAAC,CACrF8B,CAAC,CAAC,SAAS,CAAC,CAACuI,KAAK,CAACiN,CAAS,CAAG,EAAE,CAAC,CAClC,IAAI,CAACtJ,MAAM,CAAGqJ,CAAU,CAAG,EAAE,CAC7B,IAAI,CAAChN,KAAK,CAAGiN,CAAS,CAAG,EAAE,CAC3B,GAAIC,EAAE,CAAG,IAAI,CAAClN,KAAK,CAAEmN,CAAE,CAAG,IAAI,CAACxJ,MAAM,CACrClM,CAAC,CAAC,gBAAgB,CAAC,CAAC8L,IAAI,CAAC2J,CAAE,CAAC,QAAK,CAACC,CAAE,CACrC,CAAC,CAODC,KAAK,CAAE,eAASC,CAAC,CAAE,CACfA,CAAC,CAAC,CAAC,EAAI,IAAI,CAACd,SAAS,EACvB,IAAI,CAACH,KAAK,CAACiB,CAAC,CAAC,CAAC1T,GAAG,CAACC,QAAQ,CAAC,CAAC,CAC9B,CAAC,CACD0S,QAAQ,CAAE,mBAAW,CACpB,GAAIgB,EAAa,CAAG,EAAE,CACtBC,KAAK,CAACC,SAAS,CAAC/R,OAAO,CAACgS,IAAI,CAAC,IAAI,CAACrB,KAAK,CAAE,SAAAsB,CAAI,CAAI,CAChD,MAAgBA,CAAI,CAACC,YAAY,CAAC,IAAI,CAAC,CAACvJ,KAAK,CAAC,GAAG,CAAC,uBAA7CjL,CAAC,MAAEsN,CAAC,MAAEmH,CAAC,MACNN,CAAa,CAAC7G,CAAC,CAAC,GACrB6G,CAAa,CAAC7G,CAAC,CAAC,CAAG,EAAE,EAEtB6G,CAAa,CAAC7G,CAAC,CAAC,CAACmH,CAAC,CAAC,CAAGF,CACvB,CAAC,CAAC,CACF,IAAI,CAACJ,aAAa,CAAGA,CAAa,CAACO,OAAO,EAC3C,CAAC,CACDC,OAAO,CAAE,iBAASF,CAAC,CAAEnH,CAAC,CAAE,CACvB,GAAIsH,EAAK,CAAG,IAAI,CAACT,aAAa,CAAC7G,CAAC,CAAC,CACjC,GAAKsH,CAAK,EACV,GAAIL,EAAI,CAAGK,CAAK,CAACH,CAAC,CAAC,CACfF,CAAI,EAAIA,CAAI,CAAChU,cAAc,CAAC,KAAK,CAAC,EACrCgU,CAAI,CAAC/T,GAAG,CAACC,QAAQ,CAAC,CAAC,CAAC,CAEtB,CAAC,CACDoU,QAAQ,CAAE,kBAASvH,CAAC,CAAE,OAKH7H,IAAI,CAAC6N,KAAK,CAJxBsB,CAAK,CAAG,IAAI,CAACT,aAAa,CAAC7G,CAAC,CAAC,CACjC,GAAKsH,CAAK,KACV,GAEKL,EAAI,CAFLL,CAAC,CAAG,CAAC,CACFA,CAAC,CAAG,IAAI,CAACY,YAAY,EACvBP,CAAI,CAAGK,CAAK,CAAC,EAAWnP,IAAI,CAACC,MAAM,EAAE,CAAGkP,CAAK,CAACjN,MAAM,CAAC,CAAC,CACtD4M,CAAI,EAAIA,CAAI,CAAChU,cAAc,CAAC,KAAK,CAAC,EACrCgU,CAAI,CAAC/T,GAAG,CAACC,QAAQ,CAAC,CAAC,CAAC,CAErByT,CAAC,EAEH,CAAC,CACDY,YAAY,CAAE,CAAC,CAgBfvE,QAAQ,CAAE,kBAASwE,CAAS,CAAEC,CAAM,CAAE7D,CAAK,CAAE,IACxCvI,EAAO,CAAG,IAAI,CAACF,UAAU,EAAE,CAC3BqJ,CAAK,CAAGnJ,CAAO,CAACqC,KAAK,CAAC,OAAO,CAAC,CAC9B8H,CAAM,CAAG,EAAE,CACf,KAAGkC,KAAK,CAACD,CAAM,CAAC,EAAe,CAAC,GAAZA,CAAY,GAChC,GAAY,CAAC,CAAVA,CAAU,CAAE,CACd,GAAIE,EAAO,CAAGlV,CAAC,CAACmV,QAAQ,CAAC,CAAC,MAAM,CAAE,KAAK,CAAC,CAAEJ,CAAS,CAAC,CAAG/U,CAAC,CAACoV,IAAI,CAAGpV,CAAC,CAACqV,SAAS,CAE1EtC,CAAM,CADJ/S,CAAC,CAACmV,QAAQ,CAAC,CAAC,MAAM,CAAE,OAAO,CAAC,CAAEJ,CAAS,CAAC,CACjC/U,CAAC,CAACsV,GAAG,CAACvD,CAAK,CAAE,SAASC,CAAI,CAAE,CACpC,GAAIE,EAAK,CAAGlS,CAAC,CAACmS,OAAO,CAACH,CAAI,CAAC/G,KAAK,CAACsD,cAAc,CAAC,CAAC,CACjD,MAAO2G,EAAO,CAAChD,CAAK,CAAG,CAAC8C,CAAM,CAAE,CAAChQ,IAAI,CAAC,EAAE,CACzC,CAAC,CAAC,CAEOkQ,CAAO,CAACnD,CAAK,CAAG,CAACiD,CAAM,CAClC,CACA,GAAY,CAAC,CAAVA,CAAU,GACI,MAAM,EAAnBD,CAAmB,GACrBhC,CAAM,CAAG/S,CAAC,CAACsV,GAAG,CAACvD,CAAK,CAAE,SAASC,CAAI,CAAE,CAAE,MAAOhS,EAAC,CAACuV,MAAM,CAAC,GAAG,CAAEP,CAAM,CAAC,CAAChD,CAAK,CAAC,CAAC,EAC5D,OAAO,EAApB+C,CAAoB,GACtBhC,CAAM,CAAG/S,CAAC,CAACsV,GAAG,CAACvD,CAAK,CAAE,SAASC,CAAI,CAAE,CAAE,MAAOA,EAAI,CAAChS,CAAC,CAACuV,MAAM,CAAC,GAAG,CAAEP,CAAM,CAAE,CAAC,CAAC,EACzEhV,CAAC,CAACmV,QAAQ,CAAC,CAAC,KAAK,CAAE,QAAQ,CAAC,CAAEJ,CAAS,CAAC,EAAE,IACvCS,EAAU,CAAGxV,CAAC,CAACmS,OAAO,CAACnS,CAAC,CAAC0T,GAAG,CAAC3B,CAAK,CAAE,SAASC,CAAI,CAAE,CACvD,MAAOhS,EAAC,CAACmS,OAAO,CAACH,CAAI,CAAC/G,KAAK,CAACkD,UAAU,CAAC,CAAC,CAACxG,MAC1C,CAAC,CAAC,CAACsD,KAAK,CAACkD,UAAU,CAAC,CAAC,CAACxG,MAAM,CACxBrD,CAAG,CAAGtE,CAAC,CAACyV,KAAK,CAACT,CAAM,CAAE,UAAW,CAAE,MAAOhV,EAAC,CAACuV,MAAM,CAAC,GAAG,CAAEC,CAAU,CAAE,CAAC,CAAC,CAC1EzC,CAAM,CAAiB,KAAK,EAAlBgC,CAAkB,CAAIzQ,CAAG,CAACoR,MAAM,CAAC3D,CAAK,CAAC,CAAGA,CAAK,CAAC2D,MAAM,CAACpR,CAAG,CACrE,CAED,IAAI,CAACoH,KAAK,CAACqH,CAAM,CAAC/N,IAAI,CAAC,GAAG,CAAC,CAAEmM,CAAK,CAAC,CACpC,CAAC,CACDhF,UAAU,CAAE,qBAAW,CACtB,IAAI,CAACc,GAAG,CAAC/L,IAAI,CAAC,aAAa,CAAC,CAACrC,IAAI,CAAC,UAAW,IACxCY,EAAK,CAAoB,EAAG,EAApBgG,IAAI,CAACC,MAAM,EAAS,CAAGsK,SAAS,CAACtK,MAAM,EAAE,CAACgJ,WAAW,EAAE,CAAG,GAAG,CACrEpG,CAAE,CAAGhK,CAAC,CAAC,IAAI,CAAC,CAACa,IAAI,CAAC,IAAI,CAAC,CAC3Bb,CAAC,CAAC,IAAI,CAAC,CAACU,WAAW,CAACP,IAAI,CAACQ,YAAY,CAACQ,CAAK,CAAE,OAAO,CAAC,CAACN,IAAI,CAAC,IAAI,CAAEmJ,CAAE,CAAC,CACrE,CAAC,CACF,CAAC,CACDgE,KAAK,CAAE,gBAAW,CACjB,IAAI,CAACW,GAAG,CAAC/L,IAAI,CAAC,aAAa,CAAC,CAACrC,IAAI,CAAC,UAAW,CAC5C,GAAIyJ,EAAE,CAAGhK,CAAC,CAAC,IAAI,CAAC,CAACa,IAAI,CAAC,IAAI,CAAC,CAC3Bb,CAAC,CAAC,IAAI,CAAC,CAACU,WAAW,CAACP,IAAI,CAACQ,YAAY,CAAC,GAAG,CAAE,OAAO,CAAC,CAACE,IAAI,CAAC,IAAI,CAAEmJ,CAAE,CAAC,CACnE,CAAC,CACF,CAAC,CACDqN,UAAU,CAAE,qBAAW,IAElBlB,EAAC,CAAEnH,CAAC,CAAEsI,CAAE,CADRC,CAAC,CAAG5X,YAAY,CAACuM,MAAM,CAAEsL,CAAC,CAAG7X,YAAY,CAAC4I,KAAK,CACrCkM,CAAM,CAAG,EAAE,CACzB,IAAIzF,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAGuI,CAAC,CAAEvI,CAAC,EAAE,CAAE,CACpB,IAAImH,CAAC,CAAC,CAAC,CAAEA,CAAC,CAAGqB,CAAC,CAAErB,CAAC,EAAE,CAClBmB,CAAE,CAAG1X,aAAa,CAAC6X,YAAY,CAACtB,CAAC,CAAEnH,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAACvO,IAAI,CAChDgU,CAAM,EAAI,QAAQ,CAAG6C,CAAE,CAAC,CAAC,CAAC,CAAG,GAAG,CAAGA,CAAE,CAAC,CAAC,CAAC,CAAG,GAAG,CAAGA,CAAE,CAAC,CAAC,CAAC,CAAG,GAAG,CAAGA,CAAE,CAAC,CAAC,CAAC,CAAG,IAAI,CAEzEtI,CAAC,EAAKuI,CAAC,CAAC,CAAE,GAAE9C,CAAM,EAAI,GAAG,CAC7B,CACA,IAAI,CAACrH,KAAK,CAACqH,CAAM,CAClB,CAAC,CACDpG,eAAe,CAAE,0BAAW,CAC3BrO,CAAC,CAAC,aAAa,CAAC,CAACa,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC6W,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAACtW,KAAK,EACxD,CAAC,CACDsW,QAAQ,CAAE,SAASpN,CAAO,CAAE/B,CAAK,CAAE2D,CAAM,CAAE,OAexB/E,IAAI,CAACwQ,IAAI,GADVxQ,IAAI,CAAC6N,KAAK,CAbP,WAAW,EAA5B,MAAOzM,EAAqB,GAAEA,CAAK,CAAG,IAAI,CAACA,KAAK,EAC9B,WAAW,EAA7B,MAAO2D,EAAsB,GAAEA,CAAM,CAAG,IAAI,CAACA,MAAM,EACtDvM,YAAY,CAAC4I,KAAK,CAAGA,CAAK,CAC1B5I,YAAY,CAACuM,MAAM,CAAGA,CAAM,CACN,WAAW,EAA9B,MAAO5B,EAAuB,GAChCA,CAAO,CAAG,IAAI,CAACF,UAAU,EAAE,KAEnBuF,EAAC,CADN8E,CAAM,CAAG,GAAImD,kBAAiB,CAAkB,CAAC,EAAlBrP,CAAK,CAAG2D,CAAM,CAAI,CAAC,CAClD0J,CAAC,CAAC,CAAC,CACHnC,CAAK,CAAGnJ,CAAO,CAACqC,KAAK,CAAC,OAAO,CAAC,CAClCjL,CAAC,CAACnB,IAAI,CAACkT,CAAK,CAAE,SAASC,CAAI,CAAM,CAChC,GAAIE,EAAK,CAAGlS,CAAC,CAACmS,OAAO,CAACH,CAAI,CAAC/G,KAAK,CAACkD,UAAU,CAAC,CAAC,CAC7C,GAAG+D,CAAK,CAACvK,MAAM,CAAGd,CAAK,CAAE,CACxB,GAAIsP,EAAM,CAAGtP,CAAK,CAAGqL,CAAK,CAACvK,MAAM,CAC/ByO,CAAU,CAAG,EAAWD,CAAM,CAAC,CAAC,CAAC,CACjCE,CAAW,CAAG,EAAUF,CAAM,CAAC,CAAC,CAAC,CACnCnW,CAAC,CAACyV,KAAK,CAACW,CAAU,CAAE,UAAW,CAC9BlE,CAAK,CAACoE,OAAO,CAAC,GAAG,CAClB,CAAC,CAAC,CACFtW,CAAC,CAACyV,KAAK,CAACY,CAAW,CAAE,UAAW,CAC/BnE,CAAK,CAACqE,IAAI,CAAC,GAAG,CACf,CAAC,CACF,CACAvW,CAAC,CAACnB,IAAI,CAACqT,CAAK,CAAE,SAASd,CAAI,CAAM,CAChC,GAAI3R,EAAK,CAAGO,CAAC,CAAC6Q,GAAG,CAAC1D,MAAM,CAAEiE,CAAI,CAAC,CAAGpB,SAAS,CAAkB,QAAQ,EAAxB7C,MAAM,CAACiE,CAAI,CAAa,CAAI,eAAe,CAAEjE,MAAM,CAACiE,CAAI,CAAC,CAAC,CAAGpB,SAAS,CAACoB,CAAI,CAAC5J,OAAO,CAAC,SAAS,CAAE,EAAE,CAAC,CAAC,CAChJyG,CAAC,CAAK,CAAC,CAAHiG,CAAG,CACPnB,CAAM,CAAC9E,CAAC,CAAC,CAAGxO,CAAK,CAAC+W,EAAE,CACpBzD,CAAM,CAAC9E,CAAC,CAAC,CAAC,CAAC,CAAGxO,CAAK,CAACgX,EAAE,CACtB1D,CAAM,CAAC9E,CAAC,CAAC,CAAC,CAAC,CAAGxO,CAAK,CAACiX,EAAE,CACtB3D,CAAM,CAAC9E,CAAC,CAAC,CAAC,CAAC,CAAY,GAAG,CAAZxO,CAAK,CAAC+R,EAAM,CAC1B0C,CAAC,EACF,CAAC,CACF,CAAC,CAAC,CACF/D,OAAO,CAAG,CACT4C,MAAM,CAAEA,CAAM,CACdlM,KAAK,CAAEA,CAAK,CACZ2D,MAAM,CAAEA,CACT,CAAC,CACDtM,aAAa,CAACyY,SAAS,CAAC,CAAC,CAAE,CAAC,CAAE1Y,YAAY,CAAC4I,KAAK,CAAE5I,YAAY,CAACuM,MAAM,CAAC,CACtE,GAAIoM,EAAS,CAAG1Y,aAAa,CAAC2Y,eAAe,CAAChQ,CAAK,CAAE2D,CAAM,CAAC,CAG5D,MAFAoM,EAAS,CAAC7X,IAAI,CAAC+X,GAAG,CAAC/D,CAAM,CAAC,CAC1B7U,aAAa,CAAC6Y,YAAY,CAACH,CAAS,CAAE,CAAC,CAAE,CAAC,CAAC,CACpC3Y,YAAY,CAAC+Y,SAAS,CAAC,WAAW,CAC1C,CACD,CAAC,CAIGzX,KAAK,CAAG,CACXC,IAAI,GAAO,CACXC,KAAK,CAAE,GACR,CAAC,CAED,QAASwX,MAAK,CAACC,CAAC,CAAE,CACjB,IAAK,GAAIhD,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAGgD,CAAC,CAAEhD,CAAC,EAAE,CACzBiD,WAAW,CAAC,UAAW,CAAC1Y,IAAI,CAACwV,KAAK,CAACjU,CAAC,CAAC0F,MAAM,CAAC,CAAC,CAAEjH,IAAI,CAAC2U,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAEpT,CAAC,CAAC0F,MAAM,CAAC,GAAG,CAAE,GAAI,CAAC,CAEzF,CAAC,GAuHG0R,aAAY,CArHV5Y,MAAM,CAAG,CACd6Y,QAAQ,CAAE,CACTC,IAAI,CAAE,CAAC,CAAC,CAAE,IAAK,CAAC,CAChBC,EAAE,CAAE,CAAC,CAAC,GAAG,CAAE,CAAC,CAAC,CACbC,SAAS,CAAE,EAAG,CACdC,QAAQ,CAAE,GACX,CAAC,CACDjV,OAAO,CAAE,CAAC,CAAC,CACXnE,IAAI,CAAE,eAAW,YAChB,IAAI,CAACiZ,IAAI,CAAGhZ,CAAC,CAAC,kBAAkB,CAAC,CAACoZ,cAAc,CAAC,CAChDnO,IAAI,CAAE,QAAQ,CACdoO,GAAG,CAAE,CAAC,CACNjE,GAAG,CAAE,IAAI,CAACkE,UAAU,CAAC,CAAC,CACtBC,YAAY,CAAE,GAAI,CAClBC,aAAa,GAAM,CACnBC,QAAQ,CAAE,CAAC,CACXC,gBAAgB,CAAE,KAAK,CACvBC,IAAI,GAAM,CACVC,IAAI,CAAE,IAAI,CAACb,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC,CAC3BrH,EAAE,CAAE,IAAI,CAACoH,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC,CACzBa,QAAQ,CAAE,kBAAApZ,CAAI,CAAI,CACjB,CAAI,CAACyD,OAAO,CAAC8U,IAAI,CAAG,CAACvY,CAAI,CAACmZ,IAAI,CAAEnZ,CAAI,CAACkR,EAAE,CAAC,CACxC,CAAI,CAACzN,OAAO,CAAC4V,UAAU,CAAG,CAAI,CAACC,UAAU,CAACtZ,CAAI,CAACkR,EAAE,CAAGlR,CAAI,CAACmZ,IAAI,CAAC,CAC9D,CAAI,CAAC1V,OAAO,CAAC8V,YAAY,CAAG,CAAI,CAACD,UAAU,CAACtZ,CAAI,CAACmZ,IAAI,CACtD,CACD,CAAC,CAAC,CAACnZ,IAAI,CAAC,gBAAgB,CAAC,CACzB,IAAI,CAACwY,EAAE,CAAGjZ,CAAC,CAAC,gBAAgB,CAAC,CAACoZ,cAAc,CAAC,CAC5CnO,IAAI,CAAE,QAAQ,CACdoO,GAAG,CAAE,CAAC,GAAG,CACTjE,GAAG,CAAE,CAAC,CACNwE,IAAI,CAAE,IAAI,CAACb,QAAQ,CAACE,EAAE,CAAC,CAAC,CAAC,CACzBtH,EAAE,CAAE,IAAI,CAACoH,QAAQ,CAACE,EAAE,CAAC,CAAC,CAAC,CACvBM,YAAY,CAAE,EAAE,CAChBE,QAAQ,CAAE,CAAC,CACXC,gBAAgB,CAAE,KAAK,CACvBF,aAAa,GAAM,CACnBG,IAAI,GAAM,CACVE,QAAQ,CAAE,kBAAApZ,CAAI,CAAI,CACjB,CAAI,CAACyD,OAAO,CAAC+U,EAAE,CAAG,CAACxY,CAAI,CAACmZ,IAAI,CAAEnZ,CAAI,CAACkR,EAAE,CAAC,CACtCsI,UAAU,CAACC,QAAQ,CAACC,WAAW,CAAG1Z,CAAI,CAACmZ,IAAI,CAC3CK,UAAU,CAACC,QAAQ,CAACE,WAAW,CAAG3Z,CAAI,CAACkR,EACxC,CACD,CAAC,CAAC,CAAClR,IAAI,CAAC,gBAAgB,CAAC,CACzB,IAAI,CAACyY,SAAS,CAAGlZ,CAAC,CAAC,YAAY,CAAC,CAACoZ,cAAc,CAAC,CAC/CC,GAAG,CAAE,CAAC,CACNjE,GAAG,CAAE,CAAC,CACNiF,IAAI,CAAE,GAAI,CACVT,IAAI,CAAE,IAAI,CAACb,QAAQ,CAACG,SAAS,CAC7BS,IAAI,GAAM,CACVE,QAAQ,CAAE,kBAAApZ,CAAI,CAAI,CACjB,CAAI,CAACyD,OAAO,CAACgV,SAAS,CAAGzY,CAAI,CAACmZ,IAC/B,CACD,CAAC,CAAC,CAACnZ,IAAI,CAAC,gBAAgB,CAAC,CACzB,IAAI,CAAC0Y,QAAQ,CAAGnZ,CAAC,CAAC,WAAW,CAAC,CAACoZ,cAAc,CAAC,CAC7CC,GAAG,CAAE,EAAG,CACRjE,GAAG,CAAE,CAAC,CACNiF,IAAI,CAAE,GAAI,CACVZ,QAAQ,CAAE,CAAC,CACXG,IAAI,CAAE,IAAI,CAACb,QAAQ,CAACI,QAAQ,CAC5BQ,IAAI,GAAM,CACVE,QAAQ,CAAE,kBAAApZ,CAAI,CAAI,CACjB,CAAI,CAACyD,OAAO,CAACiV,QAAQ,CAAG1Y,CAAI,CAACmZ,IAC9B,CACD,CAAC,CAAC,CAACnZ,IAAI,CAAC,gBAAgB,CAAC,CACzB,IAAI,CAAC6Z,IAAI,EACV,CAAC,CACD,GAAIhB,WAAU,EAAG,CAChB,GAAI,CACH,MAAOpF,MAAK,CAACqG,OAAO,CAACjB,UACtB,CACA,MAAMpU,CAAC,CAAE,CACR,MAAO,KACR,CACD,CAAC,CACD,GAAIsV,QAAO,EAAG,CACb,GAAI,CACH,MAAOP,WAAU,CAACC,QAAQ,CAACM,OAC5B,CACA,MAAMtV,CAAC,CAAE,CACR,MAAOlH,KAAI,CAACwc,OACb,CACD,CAAC,CACDT,UAAU,CAAE,oBAASU,CAAE,CAAE,CAAE,MAAOtT,KAAI,CAACuT,KAAK,CAACD,CAAE,EAAI,IAAI,CAACnB,UAAU,CAAC,IAAI,CAACkB,OAAO,CAAC,CAAE,CAAC,CACnFG,UAAU,CAAE,oBAASC,CAAO,CAAE,CAAE,MAAOzT,KAAI,CAACuT,KAAK,CAACE,CAAO,EAAI,IAAI,CAACtB,UAAU,CAAC,IAAI,CAACkB,OAAO,CAAC,CAAC,CAAC,CAC5FF,IAAI,CAAE,eAAwB,YAAfO,CAAQ,wDAAG,CAAC,CAAC,CAC3BA,CAAQ,CAAGnZ,CAAC,CAACqX,QAAQ,CAAC8B,CAAQ,CAAE,IAAI,CAAC9B,QAAQ,CAAC,CAC9C,IAAI,CAACC,IAAI,CAACla,MAAM,CAAC,CAChBsW,GAAG,CAAE,IAAI,CAACkE,UAAU,CAAC,CAAC,CACtBM,IAAI,CAAEiB,CAAQ,CAAC7B,IAAI,CAAC,CAAC,CAAC,CACtBrH,EAAE,CAAEkJ,CAAQ,CAAC7B,IAAI,CAAC,CAAC,CACpB,CAAC,CAAC,CACF,IAAI,CAACC,EAAE,CAACna,MAAM,CAAC,CACd8a,IAAI,CAAEiB,CAAQ,CAAC5B,EAAE,CAAC,CAAC,CAAC,CACpBtH,EAAE,CAAEkJ,CAAQ,CAAC5B,EAAE,CAAC,CAAC,CAClB,CAAC,CAAC,CACF,IAAI,CAACC,SAAS,CAACpa,MAAM,CAAC,CACrB8a,IAAI,CAAEiB,CAAQ,CAAC3B,SAChB,CAAC,CAAC,CACF,IAAI,CAACC,QAAQ,CAACra,MAAM,CAAC,CACpB8a,IAAI,CAAEiB,CAAQ,CAAC1B,QAChB,CAAC,CAAC,CACD,CAAC,MAAM,CAAE,IAAI,CAAE,WAAW,CAAE,UAAU,CAAC,CAACnV,OAAO,CAAC,SAAAC,CAAI,QAAI,EAAI,CAACA,CAAI,CAAC,CAAC6W,YAAY,EAAE,EACnF,CACD,CAAC,CAGG5G,KAAK,CAAG,CACX6G,MAAM,CAAE,CAAC,CAAC,CACVC,aAAa,CAAE,CAAC,CAAC,CACjBC,SAAS,GAAM,CACfC,WAAW,CAAE,CAAC,CAAC,CACfC,WAAW,CAAE,CAAC,CAAC,CACfC,QAAQ,GACT,CAAC,CAEGC,WAAW,CAAG,CAAC,CAAC,CAIpBnH,KAAK,CAAC9L,IAAI,CAAG,SAASkT,CAAQ,CAAE,CAC5BpH,KAAK,CAACgH,WAAW,CAACK,QAAQ,EAC5BC,SAAS,CAAC7J,EAAE,CAAC8J,QAAQ,CAACC,IAAI,CAAE,EAAG,CAAE,CAACC,KAAK,CAAE,CAAC,CAAEC,UAAU,CAAE,qBAAW,CAClE1H,KAAK,CAACgH,WAAW,CAAChH,KAAK,CAAC8G,aAAa,CAAC5S,IAAI,CAAC,CAAC,CAAC,CAAC,CAC9C8L,KAAK,CAACgH,WAAW,CAACK,QAAQ,GAAQ,CAClCrH,KAAK,CAACgH,WAAW,CAACW,UAAU,CAAG,CAAC,CACE,QAAQ,GAAtC3H,KAAK,CAAC8G,aAAa,CAACc,KAAkB,EACzC5H,KAAK,CAACiH,WAAW,CAACjH,KAAK,CAAC8G,aAAa,CAAC5S,IAAI,CAAC,CAAC,CAAC,CAAC,CAExB,UAAU,EAA9B,MAAOkT,EAAuB,EAAEA,CAAQ,EAC5C,CAAC,CAAC,CAAC,CACHtb,CAAC,CAAC,gBAAgB,CAAC,CAACiU,OAAO,EAAE,EAEF,UAAU,EAA9B,MAAOqH,EAAuB,EAAEA,CAAQ,EACjD,CAAC,CAEDpH,KAAK,CAAC6H,QAAQ,CAAG,SAASvP,CAAK,CAAE9G,CAAI,CAAE,CACtCwO,KAAK,CAACkH,QAAQ,GAAO,CACrB,GAAIY,EAAO,CAAG,CAAC,CAAC,CAChB,GAAmB,QAAQ,WAAjBtW,CAAI,CAAa,CAC1BsW,CAAO,CAAGtW,CAAI,KAEV,OAAOjD,QAAO,CAACC,GAAG,CAAC,aAAa,CAAC,IAElCuZ,EAAG,CAAG,GAAInX,eAAgB,CAE1BoX,CAAa,CAAG,EAAE,CAACxW,CAAI,CAACd,aAAa,CAAE,GAAIuX,KAAI,EAAE,CAACC,OAAO,EAAG,CAChEtD,YAAY,CAAGoD,CAAa,CAE5BD,CAAG,CAAChX,MAAM,CAAG,UAAW,CACpBiX,CAAa,GAAKpD,YAAY,EACjC5E,KAAK,CAACqG,OAAO,CAAC8B,eAAe,CAC5BJ,CAAG,CAAC1W,QAAQ,CACZ,SAASwV,CAAM,CAAE,CAChB7a,MAAM,CAACoa,IAAI,CAAC0B,CAAO,CAAC,CACpB9H,KAAK,CAAC6G,MAAM,CAAGA,CAAM,CACrB7G,KAAK,CAACgH,WAAW,CAAG,CAAC,CAAC,CACtBG,WAAW,CAAIW,CAAO,CACtB9H,KAAK,CAACkH,QAAQ,GAAQ,CACnB5O,CAAK,EAAE0H,KAAK,CAACoI,IAAI,EACrB,CAAC,CAEH,CAAC,CAEDpI,KAAK,CAAC9L,IAAI,CAAC,UAAW,CACrB6T,CAAG,CAAClX,IAAI,CAAC,KAAK,CAAErH,SAAS,CAACgI,CAAI,CAACC,OAAO,CAAC,GAAG,CAACD,CAAI,CAACd,aAAa,CAAC,GAAG,CAACjH,UAAU,IAAO,CACnFse,CAAG,CAACM,YAAY,CAAG,aAAa,CAChCN,CAAG,CAACjX,IAAI,EACT,CAAC,CACF,CAAC,CAED,GAAI,CACHjG,MAAM,CAACyd,YAAY,CAAGzd,MAAM,CAACyd,YAAY,EAAIzd,MAAM,CAAC0d,kBAAkB,CACtEvI,KAAK,CAACqG,OAAO,CAAG,GAAIxb,OAAM,CAACyd,YAC5B,CAAE,MAAMtX,CAAC,CAAE,CACVgP,KAAK,CAAC+G,SAAS,GAChB,CAEA,GAAqBQ,SAAQ,CAAzBxB,UAAU,CAAG,CAAC,CAAC,CAEhB/F,KAAK,CAAC+G,SAAS,GAChB,UAAW,CACX,GAAIa,EAAK,CAAG,OAAO,CAClB1T,CAAI,CAAG,MAAM,CACb2S,CAAM,CAAG7G,KAAK,CAACqG,OAAO,CAACmC,kBAAkB,EAAE,CAChB,UAAU,EAAlC,MAAO3B,EAAM,CAACe,KAAoB,GACrCA,CAAK,CAAG,QAAQ,EAEjB5H,KAAK,CAAC8G,aAAa,CAACc,KAAK,CAAGA,CAAK,CACN,UAAU,EAAjC,MAAOf,EAAM,CAAC3S,IAAmB,GACpCA,CAAI,CAAG,SAAS,EAEjB8L,KAAK,CAAC8G,aAAa,CAAC5S,IAAI,CAAGA,CAC5B,CAAC,EAAG,CACJqT,QAAQ,CAAGvH,KAAK,CAACqG,OAAO,CAACoC,UAAU,EAAE,CACrClB,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAG,CAAC,CACvB1B,UAAU,CAAG,GAAI2C,iBAAkB,CACnCnB,QAAQ,CAACoB,OAAO,CAAC5C,UAAU,CAACC,QAAQ,CAAC,EAGtChG,KAAK,CAACoI,IAAI,CAAG,UAAW,QACvBd,SAAS,CAAC7J,EAAE,CAAC8J,QAAQ,CAACC,IAAI,CAAE,CAAC,CAAE,CAACC,KAAK,CAAE,CAAC,CAAC,CAAC,CACvCzH,KAAK,CAACkH,QAAQ,EAAS0B,SAAS,CAAC1V,MAAM,EAAE,EAExC8M,KAAK,CAACgH,WAAW,CAACK,QAAQ,EAC7BrH,KAAK,CAAC9L,IAAI,EAAE,CACZpI,CAAC,CAAC,iBAAiB,CAAC,CAACgB,WAAW,CAAC,aAAa,CAAC,CAACJ,QAAQ,CAAC,YAAY,CAAC,GAGtEZ,CAAC,CAAC,gBAAgB,CAAC,CAAC+c,MAAM,EAAE,CAE5B7I,KAAK,CAACgH,WAAW,CAAGhH,KAAK,CAACqG,OAAO,CAACmC,kBAAkB,EAAE,CACtDxI,KAAK,CAACgH,WAAW,CAACH,MAAM,CAAG7G,KAAK,CAAC6G,MAAM,CACvC7G,KAAK,CAACgH,WAAW,CAACxV,IAAI,GAAO,CAC7BwO,KAAK,CAACgH,WAAW,CAAC2B,OAAO,CAACpB,QAAQ,CAAC,CAED,QAAQ,GAAtCvH,KAAK,CAAC8G,aAAa,CAACc,KAAkB,EACzC5H,KAAK,CAACiH,WAAW,CAAGjH,KAAK,CAACqG,OAAO,CAACmC,kBAAkB,EAAE,CACtDxI,KAAK,CAACiH,WAAW,CAACJ,MAAM,CAAG7G,KAAK,CAAC6G,MAAM,CACvC7G,KAAK,CAACiH,WAAW,CAAC0B,OAAO,CAACpB,QAAQ,CAAC,CACnCvH,KAAK,CAACiH,WAAW,CAAC6B,WAAW,CAAC,CAAC,CAAE,CAAC,CAAE9I,KAAK,CAAC6G,MAAM,CAACkC,QAAQ,CAAC,CAE1D/I,KAAK,CAACgH,WAAW,CAAChH,KAAK,CAAC8G,aAAa,CAACc,KAAK,CAAC,CAAC5H,KAAK,CAAC6G,MAAM,CAACkC,QAAQ,CAAC,EAEnE/I,KAAK,CAACgH,WAAW,CAAChH,KAAK,CAAC8G,aAAa,CAACc,KAAK,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CAEnD5H,KAAK,CAACgH,WAAW,CAACK,QAAQ,GAAO,CAE9B,CAACtB,UAAU,CAACiD,QAAQ,GACtBC,KAAK,CAAClD,UAAU,CAACmD,IAAI,CAAC7Z,IAAI,CAAC0W,UAAU,CAAC,CAAC,CACvCA,UAAU,CAACiD,QAAQ,GAAO,EAE3Bld,CAAC,CAAC,iBAAiB,CAAC,CAACgB,WAAW,CAAC,YAAY,CAAC,CAACJ,QAAQ,CAAC,aAAa,CAAC,KAIxE,CAAC,CAED,GAAIuc,MAAK,CAAI,UAAW,CACxB,MAAQpe,OAAM,CAACse,qBAAqB,EACnCte,MAAM,CAACue,2BAA2B,EAClCve,MAAM,CAACwe,wBAAwB,EAC/Bxe,MAAM,CAACye,sBAAsB,EAC7Bze,MAAM,CAAC0e,uBAAuB,EAC9B,SAAUnC,CAAQ,CAAG,CACpBvc,MAAM,CAAC2e,UAAU,CAACpC,CAAQ,CAAE,GAAI,CAAG,EAAE,CACtC,CACD,CAAC,EAAG,CAEJ,QAASqC,YAAW,EAAG,CACrB3f,IAAI,CAACU,SAAS,CAAG,GAAG,CACpByB,IAAI,CAACyK,OAAO,EAAE,CACdzB,QAAQ,CAACG,MAAM,CAAC,SAAS,sGAC3B,CAEA,QAASsU,UAAS,EAAG,CACf1M,mBAAmB,EAAE,EACrBzO,OAAO,CAACob,GAAG,CAACC,KAAK,CAAC,IAAI,CAAEC,SAAS,CAEvC,CAEA,QAASnB,iBAAgB,EAAG,CAC3B,IAAI,CAAC1C,QAAQ,CAAGhG,KAAK,CAACqG,OAAO,CAACyD,cAAc,EAAE,CAE9C,IAAI,CAAC9D,QAAQ,CAAC2C,OAAO,CAAC3I,KAAK,CAACqG,OAAO,CAAC0D,WAAW,CAAC,CAGhD,GAAI,CACH,IAAI,CAAC/D,QAAQ,CAACM,OAAO,CAAGxc,IAAI,CAACG,QAAQ,CACrC6B,CAAC,CAAC,gCAAgC,CAAC,CAACgB,WAAW,CAAC,SAAS,CAC1D,CACA,MAAMkE,CAAC,CAAE,CACRlF,CAAC,CAAC,gCAAgC,CAAC,CAACY,QAAQ,CAAC,SAAS,CACvD,CACA,IAAI,CAACga,OAAO,CAAG,GAAIsD,WAAU,CAAC,IAAI,CAAChE,QAAQ,CAACiE,iBAAiB,CAC9D,CACA,GAAMre,QAAO,CAAG,CACfC,IAAI,CAAE,eAAW,CAChB,IAAI,CAACqe,MAAM,CAAGpe,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CACnC,IAAI,CAACqe,GAAG,CAAG,IAAI,CAACD,MAAM,CAACne,UAAU,CAAC,IAAI,CAAC,CACvC,IAAI,CAACme,MAAM,CAAC7V,KAAK,CAAGvK,IAAI,CAACG,QAAQ,CAAG,CACrC,CAAC,CACDmgB,OAAO,GAAO,CACdC,OAAO,CAAE,EAAE,CACXra,OAAO,CAAE,EAAE,CAEXsa,IAAI,CAAE,cAASC,CAAQ,CAAE,CAQxB,UAUmCtX,IAAI,CAACuX,GAAG,GAACvX,IAAI,CAACwX,GAAG,GA0BlCxX,IAAI,CAACuT,KAAK,GA1BfvT,IAAI,CAAC6N,KAAK,CAjBnB8E,CAAU,CAAG5Z,MAAM,CAACgE,OAAO,CAAC4V,UAAU,CACxCjC,CAAM,CAAG3X,MAAM,CAACgE,OAAO,CAAC8V,YAAY,CACpC4E,CAAQ,CAAGze,IAAI,CAAC+L,MAAM,CACtB2S,CAAK,CAAG,EAAE,CACVC,CAAU,CAAG,EAAE,CACfC,CAAc,CAAGN,CAAQ,CAACpV,MAAM,CAEzBuM,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGmJ,CAAc,CAAEnJ,CAAC,EAAE,CAAE,CACxC,GAAIA,CAAC,EAAIiC,CAAM,EAAIjC,CAAC,CAAGiC,CAAM,CAAGiC,CAAU,CAAE,CAC3C,GAAIkF,EAAC,CAAGpJ,CAAC,CAAGiC,CAAM,CAAEoH,CAAO,QAEvB,IAAI,CAACX,OAAO,GACf,IAAI,CAACD,GAAG,CAACzL,SAAS,CAAG5U,IAAI,CAACW,SAAS,EAKnCsgB,CAAO,CADqB,WAAW,GAApCjhB,IAAI,CAACM,eAA+B,CAC7B,EAAWsgB,CAAQ,CAAG,EAAS,EAASI,CAAC,CAAElF,CAAW,CAAE,CAAC,CAAC,CAAC,CAAC,CACrC,mBAAmB,GAA5C9b,IAAI,CAACM,eAAuC,CAC1CsgB,CAAQ,CAAG,EAAWA,CAAQ,CAAG,EAAS,EAAS,CAAC9E,CAAU,CAACkF,CAAC,EAAGlF,CAAW,CAAE,CAAC,CAAC,CAAC,CAAC,CAEpF,EAAWkF,CAAC,EAAIlF,CAAU,CAAG8E,CAAQ,CAAC,CAAC,CAE7CE,CAAU,CAACG,CAAO,CAAC,GACvBJ,CAAK,CAACI,CAAO,CAAC,CAAG,CAAC,CAClBH,CAAU,CAACG,CAAO,CAAC,CAAG,CAAC,EAGxB,GAAIC,EAAM,CAAG/X,IAAI,CAACkS,GAAG,CAAC,EAASoF,CAAQ,CAAC7I,CAAC,CAAC,CAAG,GAAG,CAAC,CAAE,CAAC,CAAC,CAIjDsJ,CAAM,CAAGlhB,IAAI,CAACI,gBAAgB,GACjC8gB,CAAM,CAAG,CAAC,EAGXL,CAAK,CAACI,CAAO,CAAC,EAAIC,CAAM,CACxBJ,CAAU,CAACG,CAAO,CAAC,EAAI,CACxB,CAAC,IACO,KAAI,CAACX,OAAO,GACnB,IAAI,CAACD,GAAG,CAACzL,SAAS,CAAG5U,IAAI,CAACY,QAAQ,EAEnC,GAAG,IAAI,CAAC0f,OAAO,CAAE,CAChB,GAAIpgB,EAAS,CAAG,EAAW,GAAG,EAAIugB,CAAQ,CAAC7I,CAAC,CAAC,CAAG,GAAG,CAAC,CAAC,CACjD1X,CAAS,EACZ,IAAI,CAACmgB,GAAG,CAACc,QAAQ,CAACvJ,CAAC,CAAE,GAAG,CAAC1X,CAAS,CAAE,CAAC,CAAEA,CAAS,CAClD,CACD,CAGA,IAAK,GAAI0X,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAGgJ,CAAQ,CAAEhJ,CAAC,EAAE,CACZ,CAAC,CAAjBkJ,CAAU,CAAClJ,CAAC,CAAK,CACpBiJ,CAAK,CAACjJ,CAAC,CAAC,EAAIkJ,CAAU,CAAClJ,CAAC,CAAC,CAEzBiJ,CAAK,CAACjJ,CAAC,CAAC,CAAG,CAAC,CAEb,IAEG,IAAI,CAAC1R,OAAO,EACf,IAAI,CAACqa,OAAO,CAACtG,IAAI,CAAC,IAAI,CAAC/T,OAAO,CAAC,CAGzB,IAAI,CAACqa,OAAO,CAAClV,MAAM,CAAGrL,IAAI,CAACK,WAAW,EAC5C,IAAI,CAACkgB,OAAO,CAACa,KAAK,EAAE,CAGrB,IAAI,CAAClb,OAAO,CAAG2a,CAAK,CAOpB,OAJIQ,EAAO,CAAG,EAAE,CACdC,CAAK,CAAG,EAAE,CAGH1J,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAAC2I,OAAO,CAAClV,MAAM,CAAEuM,CAAC,EAAE,CAC3C,IAAK,GAAI2J,EAAI,CAAG,CAAC,CAAEA,CAAI,CAAGX,CAAQ,CAAEW,CAAI,EAAE,CACpCF,CAAO,CAACE,CAAI,CAAC,GACjBF,CAAO,CAACE,CAAI,CAAC,CAAG,CAAC,EAElBF,CAAO,CAACE,CAAI,CAAC,EAAI,IAAI,CAAChB,OAAO,CAAC3I,CAAC,CAAC,CAAC2J,CAAI,CAAC,CAMxC,OAFIzH,EAAU,CAAGD,CAAM,CAEd0H,CAAI,CAAG,CAAC,CAAEA,CAAI,CAAGX,CAAQ,CAAEW,CAAI,EAAE,CAErB,CAAC,CAAjBF,CAAO,CAACE,CAAI,CAAK,CACpBF,CAAO,CAACE,CAAI,CAAC,EAAI,IAAI,CAAChB,OAAO,CAAClV,MAAM,CAEpCgW,CAAO,CAACE,CAAI,CAAC,CAAG,CAAC,CAGd,IAAI,CAACjB,OAAO,GACf,IAAI,CAACD,GAAG,CAACzL,SAAS,CAAG2M,CAAI,CAAC,CAAC,CAAG,OAAO,CAAE,QAAQ,CAC/C,IAAI,CAAClB,GAAG,CAACc,QAAQ,CAACrH,CAAU,CAAE,GAAG,CAAEgH,CAAU,CAACS,CAAI,CAAC,CAAE,CAAC,CAAC,CACvD,IAAI,CAAClB,GAAG,CAACc,QAAQ,CAACrH,CAAU,CAAE,GAAG,CAAEgH,CAAU,CAACS,CAAI,CAAC,CAAc,EAAE,CAAdV,CAAK,CAACU,CAAI,CAAI,CAAC,EAGjE,IAAI,CAACrb,OAAO,CAACqb,CAAI,CAAC,CAAGF,CAAO,CAACE,CAAI,CAAC,CAAGrf,MAAM,CAACgE,OAAO,CAACiV,QAAQ,EAC/DmG,CAAK,CAACC,CAAI,CAAC,CAAG,CAAC,CAEX,IAAI,CAACjB,OAAO,GACf,IAAI,CAACD,GAAG,CAACzL,SAAS,CAAG2M,CAAI,CAAC,CAAC,CAAG,MAAM,CAAE,SAAS,CAC/C,IAAI,CAAClB,GAAG,CAACc,QAAQ,CAACrH,CAAU,CAAE,GAAG,CAAe,EAAE,CAAd+G,CAAK,CAACU,CAAI,CAAI,CAAG,CAAC,CAAET,CAAU,CAACS,CAAI,CAAC,CAAE,CAAC,CAAC,GAI7ED,CAAK,CAACC,CAAI,CAAC,CAAG,CAAC,CAGZ,IAAI,CAACjB,OAAO,GACfxG,CAAU,EAAIgH,CAAU,CAACS,CAAI,CAAC,EAIhC,MAAOD,EACR,CACD,CAAC,CAED1C,gBAAgB,CAAC7G,SAAS,CAACqH,IAAI,CAAG,UAAW,CAC5C,IAAI,CAAClD,QAAQ,CAACsF,qBAAqB,CAAGtf,MAAM,CAACgE,OAAO,CAACgV,SAAS,CAE9D,IAAI,CAACgB,QAAQ,CAACuF,oBAAoB,CAAC,IAAI,CAAC7E,OAAO,CAAC,CAE7C5c,IAAI,CAACS,GAAG,EACViB,WAAW,CAAC2Y,SAAS,CAAC,CAAC,CAAC,CAAC,CAACra,IAAI,CAACC,QAAQ,CAACD,IAAI,CAACE,SAAS,CAAC,CAExD,IAAK,GAAI0X,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAACsE,QAAQ,CAACiE,iBAAiB,CAAEvI,CAAC,EAAE,CAAE,IACrD+F,EAAK,CAAG,IAAI,CAACf,OAAO,CAAChF,CAAC,CAAC,CACvB8J,CAAO,CAAG/D,CAAK,CAAG,GAAG,CAKzB,GAAG3d,IAAI,CAACS,GAAG,CAAE,IACRyN,EAAM,CAAGlO,IAAI,CAACE,SAAS,CAAGwhB,CAAO,CACjC1Q,CAAC,CAAG7H,IAAI,CAACwQ,IAAI,CAAC3Z,IAAI,CAACE,SAAS,CAAGgO,CAAM,CAAC,CAC1CxM,WAAW,CAACyf,QAAQ,CAAG,CAAC,CAAHvJ,CAAG,CAAE5G,CAAC,CAAE,CAAC,CAAE9C,CAAM,CACvC,CACD,CAEIpM,OAAO,CAACwe,OAAO,EAClBxe,OAAO,CAACue,GAAG,CAAChG,SAAS,CAAC,CAAC,CAAE,CAAC,CAAEra,IAAI,CAACG,QAAQ,CAAE,GAAG,CAAC,CAKhD,OADImhB,EAAK,CAAGxf,OAAO,CAAC0e,IAAI,CAAC,IAAI,CAAC5D,OAAO,CAAC,CAC7BhF,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGzV,IAAI,CAAC+L,MAAM,CAAE0J,CAAC,EAAE,CAC9B0J,CAAK,CAAC1J,CAAC,CAAC,EAEbzV,IAAI,CAACoW,QAAQ,CAA6CX,CAAC,CAAC,CAK7DuH,KAAK,CAAC,IAAI,CAACC,IAAI,CAAC7Z,IAAI,CAAC,IAAI,CAAC,CAC3B,CAAC,CAIDqZ,gBAAgB,CAAC7G,SAAS,CAAC4J,iBAAiB,CAAG,SAAS3G,CAAI,CAAE,IACzD4G,EAAO,CAAG1L,KAAK,CAACqG,OAAO,CAACjB,UAAU,CAAC,CAAC,CACpCuG,CAAK,CAAG1Y,IAAI,CAACuT,KAAK,CAAC1B,CAAI,CAAC4G,CAAO,CAAG,IAAI,CAACE,KAAK,CAACzW,MAAM,CAAC,CACxD,MAAO,KAAI,CAACyW,KAAK,CAACD,CAAK,CACxB,CAAC,CAED,QAAS1N,OAAM,CAAC4N,CAAI,CAAE,CACrB,IAAI,CAACf,CAAC,CAAG,CAAC,CACV,IAAI,CAACe,IAAI,CAAGA,CAAI,CAChB,IAAI,MAAG,CAAG,SAASC,CAAE,CAAE,CACnB,IAAI,CAAChB,CAAC,EAAI,IAAI,CAACe,IAAI,EACrBC,CAAE,EAAE,CACJ,IAAI,CAAChB,CAAC,CAAG,CAAC,EAEN,IAAI,CAACA,CAAC,EACZ,CACD,CAEA,QAASxd,eAAc,CAACye,CAAG,CAAE,CAC5BC,UAAU,CAACD,CAAG,CAAE,MAAM,CACvB,CACA,QAASxe,gBAAe,CAACwe,CAAG,CAAE,CAC7BC,UAAU,CAACD,CAAG,CAAE,OAAO,CACxB,CAEA,GAAI3b,mBAAkB,CAAG,CACxB4C,IAAI,CAAE,IAAI,CACViZ,KAAK,CAAE,IAAI,CACXpF,MAAM,CAAE,IAAI,CACZxW,IAAI,CAAE,IACP,CAAC,CAED,QAAS2b,WAAU,CAACD,CAAG,CAAEhV,CAAI,CAAE,CAC9BgV,CAAG,CAAClX,eAAe,EAAE,CACrBkX,CAAG,CAACzc,cAAc,EAAE,IAEhB4c,EAAK,CAAY,MAAM,EAAdnV,CAAc,CAAIgV,CAAG,CAACI,YAAY,CAACD,KAAK,CAAGH,CAAG,CAACK,MAAM,CAACF,KAAK,CACpEG,CAAC,CAAGH,CAAK,CAAC,CAAC,CAAC,CAEhB,GAAIG,CAAC,CAACtV,IAAI,CAACqG,KAAK,CAAC,SAAS,CAAC,CAAE,CAC5B,GAAIkP,EAAM,CAAG,GAAIC,WAAY,CAE7BD,CAAM,CAACvb,MAAM,CAAI,UAAkB,CAClC,MAAO,UAASC,CAAC,CAAE,CAClB,GAAIwb,EAAO,CAAGxb,CAAC,CAACob,MAAM,CAACK,MAAM,CAC7BjJ,QAAQ,CAACgJ,CAAO,CAAC,CACjB1gB,CAAC,CAAC,0BAA0B,CAAC,CAACqB,GAAG,CAACkf,CAAC,CAACrZ,IAAI,CAACoK,KAAK,CAAC,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAC3E,CACD,CAAC,CAAEiP,CAAC,CAAC,CAELC,CAAM,CAACI,aAAa,CAACL,CAAC,CACvB,CAAC,IAEI,IAAGA,CAAC,CAACtV,IAAI,CAACqG,KAAK,CAAC,SAAS,CAAC,CAAE,CAChC,GAAIkP,EAAM,CAAG,GAAIC,WAAY,CAE7BD,CAAM,CAACvb,MAAM,CAAI,UAAkB,CAClC,MAAO,UAASC,CAAC,CAAE,CAClBZ,kBAAkB,CAACyW,MAAM,CAAG7V,CAAC,CAACob,MAAM,CAACK,MAAM,CAC3Crc,kBAAkB,CAAC6b,KAAK,CAAGI,CAAC,CAACtV,IAAI,CAEjC3G,kBAAkB,CAACC,IAAI,CAAG,GAAIsc,KAAI,CAAC,CAACvc,kBAAkB,CAACyW,MAAM,CAAC,CAAE,CAAE9P,IAAI,CAAE3G,kBAAkB,CAAC6b,KAAM,CAAC,CAAC,CACnG7b,kBAAkB,CAAC4C,IAAI,CAAGqZ,CAAC,CAACrZ,IAAI,CAACoK,KAAK,CAAC,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAClEtR,CAAC,CAAC,wBAAwB,CAAC,CAACqB,GAAG,CAACiD,kBAAkB,CAAC4C,IAAI,CAAC,CACxD7D,UAAU,CAAC2C,GAAG,EAAE,CAChBkO,KAAK,CAACqG,OAAO,CAAC8B,eAAe,CAC5B/X,kBAAkB,CAACyW,MAAM,CACzB,SAASA,CAAM,CAAE,CAChB7a,MAAM,CAACoa,IAAI,EAAE,CACbpG,KAAK,CAAC9L,IAAI,CAAC,UAAW,CACrB8L,KAAK,CAAC6G,MAAM,CAAGA,CAAM,CACrBM,WAAW,CAACyF,QAAQ,CAAGxc,kBAAkB,CAAC4C,IAAI,CAC9CgN,KAAK,CAACkH,QAAQ,GAAQ,CACtBlH,KAAK,CAACoI,IAAI,EACX,CAAC,CACF,CAAC,CACD,SAAS9W,CAAK,CAAE,CACf/C,OAAO,CAAC+C,KAAK,CAAC,uKAAgC,CAAEA,CAAK,CACtD,CAAC,CAEH,CACD,CAAC,CAAE+a,CAAC,CAAC,CAELC,CAAM,CAACO,iBAAiB,CAACR,CAAC,CAC3B,CAAC,IAGAS,MAAK,CAAC,qSAA0D,CAAC,CAGlE,QACD,CACA,QAASzf,eAAc,CAAC0e,CAAG,CAAE,CAC5BA,CAAG,CAAClX,eAAe,EAAE,CACrBkX,CAAG,CAACzc,cAAc,EAAE,CACpByc,CAAG,CAACI,YAAY,CAACY,UAAU,CAAG,MAC/B,CACA,QAASvJ,SAAQ,CAACwJ,CAAO,CAAE,CAC1B,GAAIC,EAAQ,CAAG,GAAIC,MAAO,CAC1BD,CAAQ,CAAClc,MAAM,CAAG,UAAW,CAC5BtF,YAAY,CAACuM,MAAM,CAAG,IAAI,CAACA,MAAM,CACjCvM,YAAY,CAAC4I,KAAK,CAAG,IAAI,CAACA,KAAK,CAC/B3I,aAAa,CAACyhB,SAAS,CAAC,IAAI,CAAE,CAAC,CAAE,CAAC,CAAC,CACnClhB,IAAI,CAACkX,UAAU,EAChB,CAAC,CACD8J,CAAQ,CAACG,GAAG,CAAGJ,CAChB,CAEA,QAASK,cAAa,CAACC,CAAO,CAAE,CAC9B,GAAIC,EAAG,CAAGD,CAAO,CAAC7U,KAAK,CAAC,GAAG,CAAC,CAAE+U,CAAI,CAAGD,CAAG,CAAC,CAAC,CAAC,CAACnQ,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAC/D,MAAO,IAAIuP,KAAI,CAAC,CAACc,IAAI,CAACF,CAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE,CAACxW,IAAI,CAACyW,CAAI,CAAC,CAC7C,CAEA,QAASpa,UAAS,CAACsa,CAAS,CAAE9P,CAAG,CAAE9H,CAAE,CAAE4G,CAAI,CAAEiR,CAAW,CAAEC,CAAM,CAAEC,CAAK,CAAEC,CAAW,CAAEC,CAAY,CAAE,OAoHlF9a,IAAI,CAACuT,KAAK,GAFVvT,IAAI,CAAC6N,KAAK,CAjH3B,IAAI,CAACrG,GAAG,CAAG3O,CAAC,CAAC8R,CAAG,CAAC,CACjB,IAAI,CAAC9H,EAAE,CAAGA,CAAE,CACZ,IAAI,CAACkY,MAAM,CAAG,CAAC,CAACtR,CAAI,CAEpB,IAAI,CAACoR,WAAW,CAAGA,CAAW,CAC9B,IAAI,CAACC,YAAY,CAAGA,CAAY,CAChC,IAAI,CAACA,YAAY,CAACrhB,QAAQ,CAAC,IAAI,CAACohB,WAAW,CAAG,gBAAgB,CAAG,iBAAiB,CAAC,CACnF,IAAI,CAACC,YAAY,CAAC3hB,EAAE,CAAC,OAAO,CAAG,SAASQ,CAAE,CAAE,CAC3CA,CAAE,CAACiI,eAAe,EAAE,CACpB,IAAI,CAACiZ,WAAW,CAAG,CAAC,IAAI,CAACA,WAAW,CACpC,IAAI,CAACC,YAAY,CAACzZ,WAAW,CAAC,gCAAgC,CAAC,CAC/DsU,SAAS,CAACqF,QAAQ,CAAC,IAAI,CAACnY,EAAE,CAAE,IAAI,CAACJ,QAAQ,CAAE,IAAI,CAACoY,WAAW,CAC5D,CAAC,CAAEze,IAAI,CAAC,IAAI,CAAC,CAAC,CAGd,IAAI,CAAC6J,KAAK,CAAG,UAAW,CACvB,GAAIvB,EAAI,CAAG,EAAE,CAEV,IAAI,CAACqW,MAAM,EACbrW,CAAI,EAAI,kEAA6D,CAAC,IAAI,CAAC7B,EAAE,CAAC,eAAa,CAAC,IAAI,CAACA,EAAE,CAAC,KAAI,CACxG6B,CAAI,EAAI,IAAI,CAACuW,YAAY,CAAC,IAAI,CAAClY,IAAI,CAAE,IAAI,CAACF,EAAE,CAAC,CAC7C6B,CAAI,EAAI,QAAQ,EAGhBnK,CAAC,CAACnB,IAAI,CAAC,IAAI,CAAC2J,IAAI,CAAE,SAASvE,CAAO,CAAa,CAC9CkG,CAAI,EAAI,kEAA6D,CAAClG,CAAO,CAAC8B,MAAM,CAAC,eAAa,CAAC,IAAI,CAACuC,EAAE,CAAC,KAAI,CAC/G6B,CAAI,EAAI,0BAAwB,CAAClG,CAAO,CAAC6B,KAAK,CAAC,OAAO,CACtDqE,CAAI,EAAI,IAAI,CAACuW,YAAY,CAACzc,CAAO,CAAC+B,QAAQ,CAAE/B,CAAO,CAAC8B,MAAM,CAAC,CAC3DoE,CAAI,EAAI,QACT,CAAC,CAAE,IAAI,CAAC,CACT,IAAI,CAAC8C,GAAG,CAAC9C,IAAI,CAACA,CAAI,CAAC,CACnBiR,SAAS,CAACqF,QAAQ,CAAC,IAAI,CAACnY,EAAE,CAAE,IAAI,CAACJ,QAAQ,CAAE,IAAI,CAACoY,WAAW,CAC5D,CAAC,CAED,IAAI,CAACK,WAAW,GAAQ,CAGxB,IAAI,CAACD,YAAY,CAAG,SAASlY,CAAI,CAAEzC,CAAM,CAAE,CAC1Csa,CAAK,CAA8B,WAAW,EAArC,MAAO,KAAI,CAACO,SAAyB,GAAuC,QAAQ,EAAlC,MAAO,KAAI,CAACA,SAAsB,CAAyB,KAAK,GAAxB,IAAI,CAACA,SAAmB,CAAoB,IAAI,CAACA,SAAS,CAAC,CAC9J,GAAIC,EAAU,CAAG7gB,CAAC,CAAC8gB,WAAW,CAACtY,CAAI,CAAE,CAAC,IAAI,CAAC4X,MAAM,CAAE,IAAI,CAAC,CAAE,CAACC,CAAK,CAAEA,CAAK,CAAC,CAAC,CACvElW,CAAI,CAAG,EAAE,CACT4W,CAAQ,CAAgB,SAAS,GAArB,IAAI,CAACzY,EAAgB,CAAI,gBAAgB,CAAG,EAAE,CAiC5D,MA/BAtI,EAAC,CAACnB,IAAI,CAACgiB,CAAU,CAAE,SAASG,CAAK,CAAE,CAClC,GAAGA,CAAK,CAAE,CACT,GAAIC,EAAO,IAAID,CAAK,CAACzgB,cAAc,CAAC,KAAK,CAAC,EAAIygB,CAAK,CAAC9V,GAAG,GAAI8V,CAAK,CAAC9V,GAAG,CAACD,KAAK,CAAC,GAAG,CAAC,CAACyJ,OAAO,EAAE,CAAC,CAAC,CAAS,CAClGwM,CAAO,CAAGD,CAAO,CAAG,wCAAqC,CAACD,CAAK,CAAC9V,GAAG,CAAC,gBAAc,CAAC+V,CAAO,CAAC,gNAA0G,CAAG,EAAE,CAC1ME,CAAQ,CAAGF,CAAO,CAAG,WAAW,CAAG,EAAE,CACrCG,CAAK,CAAIJ,CAAK,CAACzgB,cAAc,CAAC,OAAO,CAAC,EAAIygB,CAAK,CAACI,KAAK,CAAI,QAAQ,CAAG,EAAE,CACtEC,CAAS,CAAI1H,WAAW,CAACpZ,cAAc,CAAC,eAAe,CAAC,EAAIoZ,WAAW,CAACzW,aAAa,GAAK8d,CAAK,CAAC9d,aAAa,CAAI,UAAU,CAAG,EAAE,CAChIoe,CAAQ,CAAGthB,CAAC,CAAC+E,MAAM,CAACic,CAAK,CAACxb,IAAI,CAAC,CAEjC2E,CAAI,EACJ,oBAAmB,CAACgX,CAAQ,CAACE,CAAS,CAACD,CAAK,CAAC,iBAAe,CAACE,CAAQ,CAAC/Z,WAAW,EAAE,CAAC,iBAAe,CAACyZ,CAAK,CAAC9d,aAAa,CAAC,2EAE9F,CAACoe,CAAQ,CAAC,kDACJ,CAC7BJ,CAAO,CACR,oCAAiC,CAACnb,CAAM,CAAC,GAAG,CAACib,CAAK,CAAC9d,aAAa,CAAC,oBAAkB,CAACoe,CAAQ,CAAC,+HAC7D,CAACvb,CAAM,CAAC,GAAG,CAACib,CAAK,CAAC9d,aAAa,CAAC,oBAAkB,CAACoe,CAAQ,CAAC,scAMhE,CAACN,CAAK,CAACzF,QAAQ,CAAC,+GAEM,CAACwF,CAAQ,CAAC,uCAG/D,CAED,CAAC,CAAE,IAAI,CAAC,CAED5W,CACR,CAAC,CAGD,IAAI,CAAC7F,GAAG,CAAG,SAASid,CAAK,CAAE,CAC1BA,CAAK,CAAG,IAAI,CAACC,WAAW,CAAC,CAACD,CAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CACpCA,CAAK,CAACH,KAAK,GAAO,CACf,IAAI,CAACZ,MAAM,EACb,IAAI,CAAChY,IAAI,CAAC+N,IAAI,CAACgL,CAAK,CAAC,CACrB,IAAI,CAACrZ,QAAQ,CAAG,IAAI,CAACM,IAAI,GAGzBxI,CAAC,CAACkB,IAAI,CAAC,IAAI,CAACsH,IAAI,CAAE,CAACzC,MAAM,CAAEwb,CAAK,CAACtd,OAAO,CAAC,CAAC,CAAC+B,QAAQ,CAACuQ,IAAI,CAACgL,CAAK,CAAC,CAC/D,IAAI,CAACrZ,QAAQ,CAAGlI,CAAC,CAACyhB,OAAO,CAACzhB,CAAC,CAAC4T,KAAK,CAAC,IAAI,CAACpL,IAAI,CAAE,UAAU,CAAC,CAAC,EAE1D,IAAI,CAACkD,KAAK,EACX,CAAC,CAED,IAAI,CAAC/G,IAAI,CAAG,SAAS4c,CAAK,CAAE,CAC3B,IAAI,CAAC7c,GAAG,CAAC6c,CAAK,CAACre,aAAa,CAAEqe,CAAK,CAAC9c,YAAY,EAAI8c,CAAK,CAACtd,OAAO,IAAO,CACxE,IAAI,CAACK,GAAG,CAACid,CAAK,CACf,CAAC,CAED,IAAI,CAAC7c,GAAG,CAAG,SAASgd,CAAK,CAAEzd,CAAO,CAAE0d,CAAO,CAAE,CACtB,WAAW,EAA9B,MAAOA,EAAuB,GAAEA,CAAO,GAAQ,EAC/C,IAAI,CAACnB,MAAM,CACbxgB,CAAC,CAAC0H,MAAM,CAAC,IAAI,CAACc,IAAI,CAAE,CAACtF,aAAa,CAAEwe,CAAK,CAAC,CAAC,CAE3C1hB,CAAC,CAAC0H,MAAM,CAAC1H,CAAC,CAACkB,IAAI,CAAC,IAAI,CAACsH,IAAI,CAAE,CAACzC,MAAM,CAAE9B,CAAO,CAAC,CAAC,CAAC+B,QAAQ,CAAE,CAAC9C,aAAa,CAAEwe,CAAK,CAAC,CAAC,CAChF1hB,CAAC,CAAC0H,MAAM,CAAC,IAAI,CAACQ,QAAQ,CAAE,CAAChF,aAAa,CAAEwe,CAAK,CAAC,CAAC,CAC3CC,CAAO,EAAE,IAAI,CAACjW,KAAK,EACxB,CAAC,CAED,IAAI,CAAC8V,WAAW,CAAG,SAAShZ,CAAI,CAAE,CACjC,MAAOxI,EAAC,CAACnB,IAAI,CAAC2J,CAAI,CAAE,SAASwY,CAAK,CAAE,CAGnC,GAFGA,CAAK,CAACzgB,cAAc,CAAC,MAAM,CAAC,EAAI,CAACygB,CAAK,CAACte,IAAI,WAAY+X,KAAI,GAC7DuG,CAAK,CAACte,IAAI,CAAG,GAAI+X,KAAI,CAACuG,CAAK,CAACte,IAAI,CAAC,EAC/Bse,CAAK,CAACzgB,cAAc,CAAC,UAAU,CAAC,EAAI,CAAC0U,KAAK,CAAC+L,CAAK,CAACzF,QAAQ,CAAC,CAAE,IAC1DqG,EAAS,CAAG,CAACZ,CAAK,CAACzF,QAAQ,CAC3BsG,CAAO,CAAG,EAAWD,CAAS,CAAC,EAAE,CAAC,CAAC,EAAE,CACpB,CAAC,EAAnBC,CAAO,CAACla,MAAW,GAAEka,CAAO,CAAG,GAAG,CAACA,CAAO,EAC7C,GAAIC,EAAO,CAAG,EAAWF,CAAS,CAAC,EAAE,CAAC,CAAC,EAAE,CACpB,CAAC,EAAnBE,CAAO,CAACna,MAAW,GAAEma,CAAO,CAAG,GAAG,CAACA,CAAO,EAC7Cd,CAAK,CAACzF,QAAQ,CAAGsG,CAAO,CAAC,GAAG,CAACC,CAC9B,CACA,CAAC,MAAM,CAAE,IAAI,CAAC,CAACxf,OAAO,CAAC,SAAAC,CAAI,CAAI,CAC1Bye,CAAK,CAACze,CAAI,CAAC,EAAwB,QAAQ,EAA5B,MAAOye,EAAK,CAACze,CAAI,CAAW,GAC9Cye,CAAK,CAACze,CAAI,CAAC,CAAGye,CAAK,CAACze,CAAI,CAAC,CAAC0I,KAAK,CAAC,GAAG,CAAC,CAACqK,GAAG,CAAC,SAAAzH,CAAC,QAAI,CAACA,CAAC,EAAC,CACnD,CAAC,CAAC,CACD,CAAC,WAAW,CAAE,UAAU,CAAC,CAACvL,OAAO,CAAC,SAAAC,CAAI,CAAI,CACtCye,CAAK,CAACze,CAAI,CAAC,EAAwB,QAAQ,EAA5B,MAAOye,EAAK,CAACze,CAAI,CAAW,GAC9Cye,CAAK,CAACze,CAAI,CAAC,CAAG,CAACye,CAAK,CAACze,CAAI,CAAC,CAC5B,CAAC,CAEF,CAAC,CACF,CAAC,CAED,IAAI,CAACwf,WAAW,CAAG,CAClB,CAAC,MAAM,CAAE,MAAM,CAAE,YAAY,CAAE,2EAAe,CAAC,CAC/C,CAAC,MAAM,CAAE,KAAK,CAAE,YAAY,CAAE,iFAAgB,CAAC,CAC/C,CAAC,MAAM,CAAE,KAAK,CAAE,OAAO,CAAE,+DAAa,CAAC,CACvC,CAAC,MAAM,CAAE,MAAM,CAAE,OAAO,CAAE,+DAAa,CAAC,CACxC,CAEE,IAAI,CAACvB,MAAM,EACb,IAAI,CAAChY,IAAI,CAAG,IAAI,CAACgZ,WAAW,CAACtB,CAAS,CAAC,CACvC,IAAI,CAAChY,QAAQ,CAAG,IAAI,CAACM,IAAI,GAGzB,IAAI,CAACA,IAAI,CAAGxI,CAAC,CAACsV,GAAG,CAAC4K,CAAS,CAAE,SAASjc,CAAO,CAAE,CAC9C,GAAI+d,EAAgB,CAAG/d,CAAO,CAE9B,MADA+d,EAAgB,CAAChc,QAAQ,CAAG,IAAI,CAACwb,WAAW,CAACvd,CAAO,CAAC+B,QAAQ,CAAC,CACvDgc,CACR,CAAC,CAAE,IAAI,CAAC,CACR,IAAI,CAAC9Z,QAAQ,CAAGlI,CAAC,CAACyhB,OAAO,CAACzhB,CAAC,CAAC4T,KAAK,CAAC,IAAI,CAACpL,IAAI,CAAE,UAAU,CAAC,CAAC,EAG1D,IAAI,CAACyZ,UAAU,CAAG9B,CAAW,CAC7B,IAAI,CAAC8B,UAAU,CAACrjB,EAAE,CAAC,OAAO,CAAG,SAASQ,CAAE,CAAE,CACzCA,CAAE,CAACiI,eAAe,EAAE,CACpB,IAAI,CAAC6a,IAAI,EACV,CAAC,CAAErgB,IAAI,CAAC,IAAI,CAAC,CAAC,CACd,IAAI,CAACsgB,SAAS,CAAGniB,CAAC,CAACoiB,SAAS,CAAC,IAAI,CAACL,WAAW,CAAE,CAAC,CAAC,CAAE3B,CAAM,CAAE,CAAC,CAAEC,CAAK,CAAC,CAAC,CAErE,IAAI,CAAC6B,IAAI,CAAG,SAAS9B,CAAM,CAAEC,CAAK,CAAE,CACnC,GAAI6B,EAAI,CACa,WAAW,EAA7B,MAAO9B,EAAsB,CAC/B,IAAI,CAAC+B,SAAS,EAAE,EAEI,WAAW,EAA5B,MAAO9B,EAAqB,GAAEA,CAAK,CAAG,KAAK,EAC9C,IAAI,CAAC8B,SAAS,CAAGniB,CAAC,CAACoiB,SAAS,CAAC,IAAI,CAACL,WAAW,CAAE,CAAC,CAAC,CAAE3B,CAAM,CAAE,CAAC,CAAEC,CAAK,CAAC,CAAC,GAElD,CAAC,CAAlB,IAAI,CAAC8B,SAAa,EAAI,IAAI,CAACA,SAAS,EAAI,IAAI,CAACJ,WAAW,CAACpa,MAAM,IACjE,IAAI,CAACwa,SAAS,CAAG,CAAC,EACnBD,CAAI,CAAG,IAAI,CAACH,WAAW,CAAC,IAAI,CAACI,SAAS,CAAC,CACvC,IAAI,CAAC/B,MAAM,CAAG8B,CAAI,CAAC,CAAC,CAAC,CACrB,IAAI,CAACtB,SAAS,CAAGsB,CAAI,CAAC,CAAC,CAAC,CACxB,IAAI,CAACxW,KAAK,EAAE,CACZ,IAAI,CAACuW,UAAU,CAAC3iB,WAAW,CAACU,CAAC,CAAC4T,KAAK,CAAC,IAAI,CAACmO,WAAW,CAAE,CAAC,CAAC,CAAC/c,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC9F,QAAQ,CAACgjB,CAAI,CAAC,CAAC,CAAC,CAAC,CACrF,IAAI,CAACD,UAAU,CAAC9iB,IAAI,CAAC,OAAO,CAAE+iB,CAAI,CAAC,CAAC,CAAC,CACtC,CAAC,CAED,IAAI,CAACA,IAAI,CAAC9B,CAAM,CAAEC,CAAK,CAAC,CAExB,IAAI,CAACjZ,eAAe,CAAG,SAASF,CAAI,CAAEmb,CAAkB,CAAE,CACxB,WAAW,EAAzC,MAAOA,EAAkC,GAAEA,CAAkB,GAAQ,EACxE,GAAId,EAAK,CAAGvhB,CAAC,CAACiG,MAAM,CAAC,IAAI,CAACiC,QAAQ,CAAE,CAAChF,aAAa,CAAE,EAAE,CAACgE,CAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAC7Dqa,CAAK,GACP/O,KAAK,CAAC6H,QAAQ,IAAOkH,CAAK,CAAC,CAC3BjjB,CAAC,CAAC,QAAQ,CAAC,CAACgB,WAAW,CAAC,SAAS,CAAC,CAClChB,CAAC,CAAC,mBAAmB,CAAC4I,CAAI,CAAC,GAAG,CAAC,CAAChI,QAAQ,CAAC,SAAS,CAAC,CAChD5C,IAAI,CAACQ,WAAW,EAAI,CAACulB,CAAkB,GACtC,CAACd,CAAK,CAACnW,kBAAkB,CAC3BpL,CAAC,CAACnB,IAAI,CAACqH,WAAW,CAAE,SAAS8B,CAAG,CAAE,CACjCA,CAAG,CAACI,gBAAgB,CAAC,CAACmZ,CAAK,CAACnW,kBAAkB,IAC/C,CAAC,CAAC,CAEE3M,IAAI,CAAC2N,MAAM,EAAE,EAIrB,CAAC,CAED,IAAI,CAACkW,YAAY,CAAG,UAAW,CAC9B,MAAO,CACNhC,WAAW,CAAE,IAAI,CAACA,WAAW,CAC7BiC,MAAM,CAAEviB,CAAC,CAAC4T,KAAK,CAAC,IAAI,CAAC1L,QAAQ,CAAE,eAAe,CAC/C,CACD,CACD,CAEA,GAAIkT,UAAS,CAAG,CACfoH,QAAQ,CAAE,EAAE,CAAEC,QAAQ,CAAE,EAAE,CAC1BhC,QAAQ,CAAE,kBAASnY,CAAE,CAAEE,CAAI,CAAEka,CAAO,CAAE,CACrC,GAAIC,EAAE,CAAG3iB,CAAC,CAAC4iB,MAAM,CAAC,IAAI,CAACH,QAAQ,CAAE,CAACza,GAAG,CAAEM,CAAE,CAAC,CAAC,CACzCua,CAAE,CAAG7iB,CAAC,CAAC4iB,MAAM,CAAC,IAAI,CAACJ,QAAQ,CAAE,CAACxa,GAAG,CAAEM,CAAE,CAAC,CAAC,CACzCtI,CAAC,CAACnB,IAAI,CAAC2J,CAAI,CAAE,SAAS+Y,CAAK,CAAE,CAC5BsB,CAAE,CAACtM,IAAI,CAAC,CAACvO,GAAG,CAAEM,CAAE,CAAEpB,IAAI,CAAEqa,CAAK,CAACre,aAAa,CAAEsC,IAAI,CAAE+b,CAAK,CAAC/b,IAAI,CAAC,CAAC,CAC5Dkd,CAAO,EAAEC,CAAE,CAACpM,IAAI,CAAC,CAACvO,GAAG,CAAEM,CAAE,CAAEpB,IAAI,CAAEqa,CAAK,CAACre,aAAa,CAAC,CACzD,CAAC,CAAC,CACF5E,CAAC,CAAC,gCAAgC,CAACgK,CAAE,CAAC,GAAG,CAAC,CAACZ,MAAM,EAAE,CACnD,IAAI,CAAC8a,QAAQ,CAAGK,CAAE,CAClB,IAAI,CAACJ,QAAQ,CAAGE,CAAE,CAClB3iB,CAAC,CAACnB,IAAI,CAACgkB,CAAE,CAAE,SAAS7e,CAAI,CAAE,CACzB1F,CAAC,CAAC,eAAe,CAAC,CAAC8D,MAAM,CAAC,qBAAoB,CAACkG,CAAE,CAAC,aAAW,CAACtE,CAAI,CAACkD,IAAI,CAAC,KAAI,CAAClD,CAAI,CAACwB,IAAI,CAAC,WAAW,CACnG,CAAC,CACF,CAAC,CACDE,MAAM,CAAE,iBAAW,OAOiCD,IAAI,CAAC6N,KAAK,CAL7D,GADI,IAAI,CAACmP,QAAQ,CAAC9a,MAAM,EAAE,IAAI,CAACtJ,IAAI,EAAE,EAClC,CAAC,IAAI,CAACokB,QAAQ,CAAC9a,MAAM,EACxB,GAA0B,CAAC,CAAxB,IAAI,CAAC8a,QAAQ,CAAC9a,MAAU,CAC1B,GAAImb,EAAO,CAAG,IAAI,CAACL,QAAQ,CAACxc,MAAM,CAAC,SAASpB,CAAI,CAAE,CACjD,MAAOA,EAAI,CAACqC,IAAI,GAAKyS,WAAW,CAACzW,aAClC,CAAC,CAAC,CACH,GAAIoX,EAAO,CAA2B,CAAC,CAAxB,IAAI,CAACmI,QAAQ,CAAC9a,MAAU,CAAImb,CAAO,CAAC,EAAWrd,IAAI,CAACC,MAAM,EAAE,CAAGod,CAAO,CAACnb,MAAM,CAAC,CAAC,CAAG,IAAI,CAAC8a,QAAQ,CAAC,CAAC,CAAC,CACjHpe,QAAQ,CAACiW,CAAO,CAACtS,GAAG,CAAC,CAACZ,eAAe,CAACkT,CAAO,CAACpT,IAAI,CAAC,CACpD,CAAC,CACDE,eAAe,CAAE,yBAASF,CAAI,CAAEmb,CAAkB,CAAE,CACnDhe,QAAQ,CAACrE,CAAC,CAACkB,IAAI,CAAC,IAAI,CAACshB,QAAQ,CAAE,CAACtb,IAAI,CAAE,EAAE,CAACA,CAAI,CAAC,CAAC,CAACc,GAAG,CAAC,CAACZ,eAAe,CAAC,EAAE,CAACF,CAAI,CAAEmb,CAAkB,CACjG,CACD,CAAC,CAED,QAASlc,eAAc,CAAC4c,CAAQ,CAAE3S,CAAG,CAAE9H,CAAE,CAAE6X,CAAW,CAAEC,CAAM,CAAEC,CAAK,CAAE,OAkCjC5a,IAAI,CAACwQ,IAAI,GAAjCxQ,IAAI,CAAC6N,KAAK,CAjCvB,IAAI,CAACrG,GAAG,CAAG3O,CAAC,CAAC8R,CAAG,CAAC,CACjB,IAAI,CAAC9H,EAAE,CAAGA,CAAE,CAEZ,IAAI,CAACkZ,WAAW,CAAG,SAAShZ,CAAI,CAAE,CACjC,MAAOxI,EAAC,CAACnB,IAAI,CAAC2J,CAAI,CAAE,SAASwY,CAAK,CAAE,CAC/BA,CAAK,CAACzgB,cAAc,CAAC,MAAM,CAAC,EAAI,CAACygB,CAAK,CAACte,IAAI,WAAY+X,KAAI,GAC7DuG,CAAK,CAACte,IAAI,CAAG,GAAI+X,KAAI,CAACuG,CAAK,CAACte,IAAI,CAAC,EACjCse,CAAK,CAACxW,MAAM,CAAG,CAACwW,CAAK,CAACxW,MAAM,CAC5BwW,CAAK,CAACna,KAAK,CAAG,CAACma,CAAK,CAACna,KAAK,CAC1Bma,CAAK,CAAC1Y,EAAE,CAAG,CAAC0Y,CAAK,CAAC1Y,EACnB,CAAC,CAEJ,CAAC,CAED,IAAI,CAACE,IAAI,CAAG,IAAI,CAACgZ,WAAW,CAACuB,CAAQ,CAAC,CAEtC,IAAI,CAACC,YAAY,CAAG,SAASnc,CAAK,CAAE2D,CAAM,CAAE,CAC3C,GAAIyY,EAAC,CAAIpc,CAAK,CAAG2D,CAAM,CAAI3D,CAAK,CAAG2D,CAAM,CACzC,GAAO,EAAE,CAANyY,CAAM,CAAE,KACV,GAAI3F,EAAC,CAAG,CAAE,CACG,EAAE,EAAT2F,CAAC,CAAC3F,CAAO,EACdA,CAAC,EAAE,CACJA,CAAC,EAAE,CAEH,GAAIxH,EAAC,CAAGwH,CAAC,CAACzW,CAAK,CACbgP,CAAC,CAAGyH,CAAC,CAAC9S,CAAM,CACZ0Y,CAAQ,CAAG,EAAE,CAAGrN,CAAC,CACjBsN,CAAQ,CAAG,EAAE,CAAGrN,CAAC,CAEnB,MAAO,CACNsN,EAAE,GAAM,CACRvc,KAAK,CAAEiP,CAAC,CACRtL,MAAM,CAAEqL,CAAC,CACTwN,OAAO,CAAE,CAAC,EAAWH,CAAQ,CAAC,CAAC,CAAC,CAAE,EAAUC,CAAQ,CAAC,CAAC,CAAC,CAAE,EAAUD,CAAQ,CAAC,CAAC,CAAC,CAAE,EAAWC,CAAQ,CAAC,CAAC,CAAC,CACvG,CACD,CAEC,MAAO,CACNC,EAAE,GAAO,CACTvc,KAAK,CAAEA,CAAK,CACZ2D,MAAM,CAAEA,CACT,CACF,CAAC,CAED,IAAI,CAAC8Y,UAAU,CAAG,UAAW,CAC5BhlB,CAAC,CAAC,mCAAmC,CAAC,IAAI,CAACgK,EAAE,CAAC,GAAG,CAAC,CAACZ,MAAM,EAAE,CAC3D1H,CAAC,CAACnB,IAAI,CAAC,IAAI,CAAC2J,IAAI,CAAE,SAASI,CAAO,CAAE,CACnCtK,CAAC,CAAC,kBAAkB,CAAC,CAAC8D,MAAM,CAAC,qBAAoB,CAAC,IAAI,CAACkG,EAAE,CAAC,aAAW,CAACM,CAAO,CAACN,EAAE,CAAC,KAAI,CAACM,CAAO,CAACpD,IAAI,CAAC,WAAW,CAC/G,CAAC,CAAE,IAAI,CACR,CAAC,CAED,IAAI,CAACkG,KAAK,CAAG,UAAW,CACvB,GAAI2U,EAAK,GAA8B,WAAW,EAArC,MAAO,KAAI,CAACO,SAAyB,IAAuC,QAAQ,EAAlC,MAAO,KAAI,CAACA,SAAsB,GAAyB,KAAK,GAAxB,IAAI,CAACA,SAAmB,EAAoB,IAAI,CAACA,SAAS,CAAC,CAChKC,CAAU,CAAG7gB,CAAC,CAAC8gB,WAAW,CAAC,IAAI,CAACtY,IAAI,CAAE,CAAC,IAAI,CAAC4X,MAAM,CAAE,IAAI,CAAC,CAAE,CAACC,CAAK,CAAEA,CAAK,CAAC,CAAC,CAC1ElW,CAAI,CAAG,gDAA6C,CAAC,IAAI,CAAC7B,EAAE,CAAC,eAAa,CAAC,IAAI,CAACA,EAAE,CAAC,KAAI,CACvFyY,CAAQ,CAAgB,SAAS,GAArB,IAAI,CAACzY,EAAgB,CAAI,gBAAgB,CAAG,EAAE,CAE5DtI,CAAC,CAACnB,IAAI,CAACgiB,CAAU,CAAE,SAASjY,CAAO,CAAE,CACpC,GAAI2a,EAAK,CAAG,IAAI,CAACP,YAAY,CAACpa,CAAO,CAAC/B,KAAK,CAAE+B,CAAO,CAAC4B,MAAM,CAAC,CAC1DgZ,CAAK,CAAGD,CAAK,CAACH,EAAE,CAAG,cAAc,CAAG,EAAE,CACtCK,CAAO,CAAGF,CAAK,CAACH,EAAE,CAAG,mBAAkB,CAACG,CAAK,CAACF,OAAO,CAAC/N,GAAG,CAAC,SAASpB,CAAC,CAAE,CAAC,MAAOA,EAAC,CAAC,IAAI,CAAC,CAAC,CAAClP,IAAI,CAAC,GAAG,CAAC,CAAC,UAAU,CAACue,CAAK,CAAC1c,KAAK,CAAC,aAAa,CAAC0c,CAAK,CAAC/Y,MAAM,CAAC,OAAM,CAAG,EAAE,CAC9JoV,CAAG,CAAGnhB,IAAI,CAACuX,QAAQ,CAACpN,CAAO,CAAC2C,MAAM,CAAE3C,CAAO,CAAC/B,KAAK,CAAE+B,CAAO,CAAC4B,MAAM,CAAC,CAClE4W,CAAK,CAAIxY,CAAO,CAACwY,KAAK,IAAS,CAAI,QAAQ,CAAG,EAAE,CAChDE,CAAQ,CAAGthB,CAAC,CAAC+E,MAAM,CAAC6D,CAAO,CAACpD,IAAI,CAAC,CACjCub,CAAQ,CAAe,SAAS,EAApB,IAAI,CAACzY,EAAe,CAAI,gBAAgB,CAAG,EAAE,CAC3D6B,CAAI,EACJ,sBAAqB,CAACiX,CAAK,CAAC,aAAW,CAACE,CAAQ,CAAC,eAAa,CAAC1Y,CAAO,CAACN,EAAE,CAAC,gBAAc,CAAC,IAAI,CAACA,EAAE,CAAC,iBAAe,CAACgZ,CAAQ,CAAC,wBAC9G,CAAC1B,CAAG,CAAC,wBAAsB,CAAC4D,CAAK,CAAC,IAAG,CAACC,CAAO,CAAC,SAAQ,CAACnC,CAAQ,CAAC,yCAChD,CAACA,CAAQ,CAAC,8JAE0B,CAACP,CAAQ,CAAC,gIAC1B,CAACnB,CAAG,CAAC,gBAAc,CAAC0B,CAAQ,CAAC,kMACZ,CAACP,CAAQ,CAAC,8DAG5E,CAAC,CAAE,IAAI,CAAC,CAER5W,CAAI,EAAI,QAAQ,CAChB,IAAI,CAAC8C,GAAG,CAAC9C,IAAI,CAACA,CAAI,CAAC,CAEnB,IAAI,CAACmZ,UAAU,EAChB,CAAC,CAED,IAAI,CAAChf,GAAG,CAAG,SAASsE,CAAO,CAAE,CAC5BA,CAAO,CAAG,IAAI,CAAC4Y,WAAW,CAAC,CAAC5Y,CAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CACxCA,CAAO,CAACwY,KAAK,GAAO,CACpB,IAAI,CAAC5Y,IAAI,CAAC+N,IAAI,CAAC3N,CAAO,CAAC,CACvB,IAAI,CAAC8C,KAAK,EACX,CAAC,CAED,IAAI,CAAC/G,IAAI,CAAG,SAASiE,CAAO,CAAE,CAC7B,IAAI,CAAClE,GAAG,CAAC,CAACkE,CAAO,CAACN,EAAE,IAAO,CAC3B,IAAI,CAAChE,GAAG,CAACsE,CAAO,CACjB,CAAC,CAED,IAAI,CAAClE,GAAG,CAAG,SAAS4D,CAAE,CAAEqZ,CAAO,CAAE,CACV,WAAW,EAA9B,MAAOA,EAAuB,GAAEA,CAAO,GAAQ,EAClD3hB,CAAC,CAAC0H,MAAM,CAAC,IAAI,CAACc,IAAI,CAAE,CAACF,EAAE,CAAEA,CAAE,CAAC,CAAC,CACzBqZ,CAAO,EAAE,IAAI,CAACjW,KAAK,EACxB,CAAC,CAED,IAAI,CAACqW,WAAW,CAAG,CAClB,CAAC,MAAM,CAAE,MAAM,CAAE,YAAY,CAAE,2EAAe,CAAC,CAC/C,CAAC,MAAM,CAAE,KAAK,CAAE,YAAY,CAAE,iFAAgB,CAAC,CAC/C,CAAC,MAAM,CAAE,KAAK,CAAE,OAAO,CAAE,+DAAa,CAAC,CACvC,CAAC,MAAM,CAAE,MAAM,CAAE,OAAO,CAAE,+DAAa,CAAC,CACxC,CAED,IAAI,CAACE,UAAU,CAAG9B,CAAW,CAC7B,IAAI,CAAC8B,UAAU,CAACrjB,EAAE,CAAC,OAAO,CAAG,SAASQ,CAAE,CAAE,CACzCA,CAAE,CAACiI,eAAe,EAAE,CACpB,IAAI,CAAC6a,IAAI,EACV,CAAC,CAAErgB,IAAI,CAAC,IAAI,CAAC,CAAC,CACd,IAAI,CAACsgB,SAAS,CAAGniB,CAAC,CAACoiB,SAAS,CAAC,IAAI,CAACL,WAAW,CAAE,CAAC,CAAC,CAAE3B,CAAM,CAAE,CAAC,CAAEC,CAAK,CAAC,CAAC,CAErE,IAAI,CAAC6B,IAAI,CAAG,SAAS9B,CAAM,CAAEC,CAAK,CAAE,CACnC,GAAI6B,EAAI,CACa,WAAW,EAA7B,MAAO9B,EAAsB,CAC/B,IAAI,CAAC+B,SAAS,EAAE,EAEI,WAAW,EAA5B,MAAO9B,EAAqB,GAAEA,CAAK,CAAG,KAAK,EAC9C,IAAI,CAAC8B,SAAS,CAAGniB,CAAC,CAACoiB,SAAS,CAAC,IAAI,CAACL,WAAW,CAAE,CAAC,CAAC,CAAE3B,CAAM,CAAE,CAAC,CAAEC,CAAK,CAAC,CAAC,GAElD,CAAC,CAAlB,IAAI,CAAC8B,SAAa,EAAI,IAAI,CAACA,SAAS,EAAI,IAAI,CAACJ,WAAW,CAACpa,MAAM,IACjE,IAAI,CAACwa,SAAS,CAAG,CAAC,EACnBD,CAAI,CAAG,IAAI,CAACH,WAAW,CAAC,IAAI,CAACI,SAAS,CAAC,CACvC,IAAI,CAAC/B,MAAM,CAAG8B,CAAI,CAAC,CAAC,CAAC,CACrB,IAAI,CAACtB,SAAS,CAAGsB,CAAI,CAAC,CAAC,CAAC,CACxB,IAAI,CAACxW,KAAK,EAAE,CACZ,IAAI,CAACuW,UAAU,CAAC3iB,WAAW,CAACU,CAAC,CAAC4T,KAAK,CAAC,IAAI,CAACmO,WAAW,CAAE,CAAC,CAAC,CAAC/c,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC9F,QAAQ,CAACgjB,CAAI,CAAC,CAAC,CAAC,CAAC,CACrF,IAAI,CAACD,UAAU,CAAC9iB,IAAI,CAAC,OAAO,CAAE+iB,CAAI,CAAC,CAAC,CAAC,CACtC,CAAC,CAED,IAAI,CAACA,IAAI,CAAC9B,CAAM,CAAEC,CAAK,CAAC,CAExB,IAAI,CAACjY,gBAAgB,CAAG,SAASE,CAAE,CAAE+Z,CAAkB,CAAE,CACvB,WAAW,EAAzC,MAAOA,EAAkC,GAAEA,CAAkB,GAAQ,EACxE,GAAIzZ,EAAO,CAAG5I,CAAC,CAACkB,IAAI,CAAC,IAAI,CAACsH,IAAI,CAAE,CAACF,EAAE,CAAE,CAACA,CAAE,CAAC,CAAC,CACvCM,CAAO,GACNA,CAAO,CAAC7L,GAAG,CACb0B,IAAI,CAACwK,MAAM,CAACL,CAAO,CAAC7L,GAAG,CAAC,CAExBuB,CAAC,CAAC,UAAU,CAAC,CAACqB,GAAG,CAAC,SAAS,CAAC,CAG1BiJ,CAAO,CAACE,KAAK,CACfrK,IAAI,CAACuK,WAAW,CAACJ,CAAO,CAACE,KAAK,CAAEF,CAAO,CAAC2C,MAAM,CAAC,CAE/C9M,IAAI,CAACuK,WAAW,CAACqD,YAAY,CAAEzD,CAAO,CAAC2C,MAAM,CAAC,CAE5C3C,CAAO,CAACuC,eAAe,EAAI7O,IAAI,CAACQ,WAAW,EAAI,CAACulB,CAAkB,EACpEjH,SAAS,CAAChU,eAAe,CAACwB,CAAO,CAACuC,eAAe,IAAO,CAE3D,CACD,CAEA,GAAI9I,SAAQ,GAAQ,CACpBqhB,KAAK,CAAC,6DAAqB,CAAE,UAAY,CACvCplB,CAAC,CAAC,MAAM,CAAC,CAACwI,WAAW,CAAC,UAAU,CAAC,CACjCzE,QAAQ,CAAG,CAAC,CAAC,CAACA,QAAQ,CACtBtB,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAChC,CAAC,CAAC,CAEFyE,IAAI,CAACke,IAAI,CAAGle,IAAI,CAACke,IAAI,EAAI,SAASlP,CAAC,CAAE,CACnC,MAAOhP,KAAI,CAACzE,GAAG,CAACyT,CAAC,CAAC,CAAGhP,IAAI,CAACme,GAC5B,CAAC,CAED,GAAIC,QAAO,CAAG,IAAI,CAAEC,QAAQ,CAAG,IAAI,CAEnC,QAASC,WAAU,CAACC,CAAG,CAAEC,CAAS,CAAE,CAC/BJ,OAAO,GACVvlB,CAAC,CAAC,6DAAyD,CAAC,CAAC+T,QAAQ,CAAC,MAAM,CAAC,CAC7EwR,OAAO,CAAGvlB,CAAC,CAAC,gBAAgB,CAAC,EAE9BulB,OAAO,CAAC1Z,IAAI,CAAC,gBAAe,CAAC6Z,CAAG,CAAC,YAAU,CAACC,CAAS,CAAC,OAAM,CAC7D,CAEA,QAASC,cAAa,EAAG,CACxBJ,QAAQ,CAAGtR,KAAK,CAACqG,OAAO,CAACsL,wBAAwB,CAAC7lB,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CACzEwlB,QAAQ,CAAC3I,OAAO,CAACpB,QAAQ,CAC1B,CAEA,QAASqK,eAAc,EAAG,CACzB9lB,CAAC,CAAC,WAAW,CAAC,CAAC+lB,WAAW,CAAC,MAAM,CAAC,CAClCjmB,OAAO,CAACwe,OAAO,CAAG,CAACxe,OAAO,CAACwe,OAC5B"}