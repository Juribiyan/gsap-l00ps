{"version":3,"sources":["es6/src/loops.js"],"names":["defaultPattern","urlprefix","fileFormat","testAudio","document","createElement","canPlayType","conf","barWidth","barHeight","fft_size","absoluteTreshold","historySize","distributionLaw","colorAlphaTreshold","association","osc","topOffset","lightWave","darkWave","detectPassiveEvents","update","window","addEventListener","passive","options","Object","defineProperty","get","noop","removeEventListener","hasSupport","$canvas","drawContext","bufferCanvas","bufferContext","readyset","channel","init","$","getContext","ranges","Grid","mousedown","isMouseDown","on","each","c","data","replaceWith","generateCell","addClass","attr","ev","actions","removeClass","brush","mode","color","click","val","querySelector","handleDragOver","handleFileDrop","handleFileInput","_","targetTouches","touch","el","elementFromPoint","pageX","pageY","hasOwnProperty","_tl","progress","getJSON","done","upconf","fail","err","console","log","parent","find","validations","validateForm","parents","updateCaptcha","ctrlKey","altKey","errBox","closeWithBtn","loopEditor","hide","bind","preventDefault","setLineHeightAsParentHeight","action","hasClass","fd","FormData","append","is_admin","forEach","prop","current","is","date","time","currentCustomTrack","blob","pop","size","max_loop_fszkb","rawData","original_hash","request","XMLHttpRequest","open","send","onload","e","status","res","JSON","parse","response","error","_lib","loop","section","dp","localStorage","success","loopLibs","add","lib_move","lib_from","section_from","del","edit","changes","item","ix","escape","join","unedit","undel","trigger","errtype","extra_data","prepareEdit","msg","name","Math","random","custom","TrackList","defaultLib","title","sectID","contents","filter","default","patternLibs","PatternGallery","mCustomScrollbar","theme","scrollInertia","$trackName","scrollWidth","offsetWidth","stop","animate","scrollLeft","width","toggleClass","focus","tabgroup","show","hash","libID","playTrackByHash","stopPropagation","query","toLowerCase","replace","injector","remove","length","inject","change","checked","$track","lib","trackData","flatList","patternID","applyPatternByID","$pattern","id","patternData","list","patternEditor","getPattern","currentID","pattern","styles","style","selected","changeStyle","setOsc","recount","alias","css","head","getElementsByTagName","type","styleSheet","cssText","appendChild","createTextNode","getElementById","removeChild","$parent","message","msgType","raw","$errorbox","html","text","visibility","opacity","top","height","off","popError","switch_lang","visible","state","immed","trunc","$datetime","split","swf","associated_loop","associated_pattern","slideDown","slideUp","string","patternStr","enterPaintMode","build","toggle","auth","delpass","max_delpass_length","captcha","filename","max_filename_length","$form","export","import","randomfill","revert","defaultStyle","clear","close","exitPaintMode","upload","download","downloadPattern","upload_loop","share_pattern","select_loop","select_pattern","recount_base_color","$el","lineHeight","Colors","g","G","y","Y","o","O","b","B","C","v","V","m","M","j","J","colorMatch","RegExp","escapeRegExp","keys","colorMatchSqBr","legacy","baseColor","toHexString","darkenColor","darken","u","modern","darker","toRgbString","flashes","flat","lighten","brighten","saturate","transitional","globalCSS","xBrowserIsMouseDown","isChrome","navigator","userAgent","match","chromeVersion","animations","backgroundColor","tinycolor","to","boxShadow","_debug_","sel","self","display","resample","shuffler","Rarity","lastOsc","baseStyle","thenBuild","has","primaryColor","$oscC","fromString","indexOf","fillStyle","layer","char","cstring","toHex","_format","_a","$cell","TimelineLite","blink","lastBuild","$cells","$overlays","lines","line","li","chars","compact","ci","appendTo","empty","fadeOut","audio","prepend","saveState","oscMode","newPattern","code","row","output","lc","cells","querySelectorAll","intoRows","cellCount","trimmingConstant","floor","sqrt","cc","invert","max","countBy","pluck","selfHeight","selfWidth","_x","_y","flash","i","cellsArranged","Array","prototype","call","cell","getAttribute","x","reverse","flashXY","cellY","flashRow","flashDensity","direction","amount","isNaN","_remove","includes","drop","dropRight","map","repeat","linelength","times","concat","fromCanvas","px","h","w","getImageData","toCanvas","Uint8ClampedArray","offset","offsetLeft","offsetRight","ceil","unshift","push","_r","_g","_b","clearRect","imageData","createImageData","set","putImageData","toDataURL","_test","N","setInterval","expectedLoop","defaults","freq","db","smoothing","treshold","ionRangeSlider","min","sampleRate","min_interval","drag_interval","grid_num","values_separator","grid","from","onChange","numSamples","hz2samples","sampleOffset","visualizer","analyser","minDecibels","maxDecibels","step","sync","context","fftSize","hz","round","samples2hz","samples","settings","callOnChange","buffer","compatibility","supported","source_loop","source_once","disabled","currentLoop","callback","_playing","TweenLite","gainNode","gain","value","onComplete","_startTime","start","loadLoop","newLoop","req","expectedToken","Date","getTime","decodeAudioData","play","responseType","AudioContext","webkitAudioContext","createBufferSource","createGain","VisualizerSample","connect","AllTracks","fadeIn","noteGrainOn","duration","_drawing","frame","draw","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","record_mode","logIfDown","dir","apply","arguments","createAnalyser","destination","Uint8Array","frequencyBinCount","canvas","ctx","debugOn","history","tick","spectrum","abs","pow","numBands","bands","bandWidths","spectrumLength","n","bandNum","sample","fillRect","shift","average","jumps","band","smoothingTimeConstant","getByteFrequencyData","getFrequencyValue","nyquist","index","freqs","trim","do","fn","evt","handleFile","ftype","files","dataTransfer","target","f","reader","FileReader","dataUrl","result","readAsDataURL","Blob","fileName","readAsArrayBuffer","alert","dropEffect","dataURL","imageObj","Image","drawImage","src","dataURItoBlob","dataURI","arr","mime","atob","tracklist","$sortButton","sortBy","order","playEnabled","$playEnabler","isFlat","populate","buildSection","scrollAdded","sortOrder","sortedList","sortByOrder","foradmin","entry","swfName","swfLink","swfClass","fresh","isPlaying","safeName","track","processList","flatten","ohash","nobuild","totalSecs","minutes","seconds","sortOptions","processedSection","sortButton","sort","sortState","findIndex","disableAssociation","getAllHashes","tracks","nameList","playList","enabled","pl","reject","nl","reduced","patterns","patternProbe","s","v_offset","h_offset","up","margins","refreshAss","probe","crisp","upstyle","cheet","log2","LN2","$stream","radioMES","set_stream","url","mediaType","connectStream","createMediaElementSource","toggleAnlzOpts","slideToggle"],"mappings":"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","file":"loops.js","sourcesContent":["\"use strict\";\r\n\r\nvar defaultPattern = \"__JJJJJJJJ__|_JJJJJJJJJJ_|JJjjjjjjjJJJ|JJjjjjjjJJJJ|JJjjjjjJJjJJ|JJjjjjjJJjJJ|JJjjjjJJjjJJ|JJjjjjJJjjJJ|JJjjjJJjjjJJ|JJjjjJJjjjJJ|JJjjJJjjjjJJ|JJjjJJjjjjJJ|JJjJJjjjjjJJ|JJjJJjjjjjJJ|JJJJjjjjjjJJ|JJJjjjjjjjJJ|_JJJJJJJJJJ_|__JJJJJJJJ__\";\r\n\r\nvar urlprefix = \"loops/\";\r\nvar fileFormat = (function() {\r\n\tvar testAudio  = document.createElement(\"audio\");\r\n\treturn (typeof testAudio.canPlayType === \"function\" && testAudio.canPlayType(\"audio/ogg\") !== \"\")\r\n})() ? 'ogg' : 'mp3';\r\n\r\nvar conf = {\r\n\tbarWidth: 850,\r\n\tbarHeight: 240,\r\n\tfft_size: 1024,\r\n\tabsoluteTreshold: 0.5,\r\n\thistorySize: 20,\r\n\tdistributionLaw: 'quadratic',\r\n\tcolorAlphaTreshold: 0.5,\r\n\tassociation: false,\r\n\tosc: true,\r\n  topOffset: 70,\r\n  lightWave: '#eee',\r\n  darkWave: '#999'\r\n};\r\n\r\n// https://github.com/rafrex/detect-passive-events\r\nconst detectPassiveEvents = {\r\n  update() {\r\n    if (typeof window !== 'undefined' && typeof window.addEventListener === 'function') {\r\n      let passive = false;\r\n      const options = Object.defineProperty({}, 'passive', {\r\n        get() { passive = true; },\r\n      });\r\n      const noop = () => {};\r\n      window.addEventListener('testPassiveEventSupport', noop, options);\r\n      window.removeEventListener('testPassiveEventSupport', noop, options);\r\n      detectPassiveEvents.hasSupport = passive;\r\n    }\r\n  },\r\n};\r\ndetectPassiveEvents.update();\r\n\r\nvar $canvas, drawContext, bufferCanvas, bufferContext;\r\n\r\nfunction readyset() {\r\n\tchannel.init()\r\n\t$canvas = $('#bars');\r\n\tdrawContext = $canvas[0].getContext('2d');\r\n\r\n\tbufferCanvas = $('#bufferCanvas')[0];\r\n\tbufferContext = bufferCanvas.getContext('2d');\r\n\t\r\n\tranges.init()\r\n\t\r\n\tGrid.init('#nullgrid');\r\n\r\n\t$('body *').mousedown(function() {\r\n\t\tisMouseDown = true;\r\n\t})\r\n\t.on('mouseup dragend', function() {\r\n\t\tisMouseDown = false;\r\n\t})\r\n\r\n\t// fill the swatches\r\n\t$('#fixed-palette .swatch').each(function() {\r\n\t\tvar c = $(this).data('c');\r\n\t\t$(this).replaceWith(Grid.generateCell(c, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+c));\r\n\t});\r\n\r\n\t// buttons\r\n\t$('body')\r\n\t.on('click', '.action-button', function(ev) {\r\n\t\tactions[$(this).data('act')](ev);\r\n\t})\r\n\t.on('click', '.tool', function() {\r\n\t\t$('.tool').removeClass('selected');\r\n\t\t$(this).addClass('selected');\r\n\t\tbrush.mode = $(this).data('tool');\r\n\t})\r\n\t.on('click', '.swatch', function() {\r\n\t\t$('.swatch').removeClass('selected');\r\n\t\tif($(this).data('c')) {\r\n\t\t\t$(this).addClass('selected');\r\n\t\t\tbrush.color = $(this).data('c');\r\n\t\t\t$('[data-tool=\"draw\"]').click();\r\n\t\t}\r\n\t});\r\n\t$('#colorpicker').on('change', function() {\r\n\t\tbrush.color = '#'+$(this).val();\r\n\t\tbrush.mode = 'draw';\r\n\t\t$(this).addClass('selected');\r\n\t\t$('[data-tool=\"draw\"]').click();\r\n\t});\r\n\r\n\tdocument.querySelector('body').addEventListener('dragover', handleDragOver, false);\r\n\tdocument.querySelector('body').addEventListener('drop', handleFileDrop, false);\r\n\r\n\tdocument.querySelector('#bufferFileInput').addEventListener('change', handleFileInput, false);\r\n\r\n\tdocument.querySelector('#overlays').addEventListener('touchmove', function(ev) {\r\n\t\t_.each(ev.targetTouches, function(touch) {\r\n\t\t\tvar el = document.elementFromPoint(touch.pageX, touch.pageY);\r\n\t\t\tif(el.hasOwnProperty('_tl'))\r\n\t\t\t\tel._tl.progress(0)\r\n\t\t})\r\n\t}, false)\r\n\r\n\t$.getJSON('upload.php?check')\r\n\t.done(function(data) {\r\n\t\tupconf = data;\r\n\t})\r\n\t.fail(function(err) {\r\n\t\tconsole.log(err)\r\n\t});\r\n\r\n\t/*Password reveal*/\r\n\t$('.password-reveal').on('mousedown', function() {\r\n\t\t$(this).parent().find('.delpass').attr('type', 'text')\r\n\t})\r\n\t.on('mouseleave mouseup', function() {\r\n\t\t$(this).parent().find('.delpass').attr('type', 'password')\r\n\t});\r\n\r\n\t/* Input validation */\r\n\t$('.validable').on('input', function() {\r\n\t\tif(validations[$(this).data('tovalid')]($(this).val())) \r\n\t\t\t$(this).removeClass('invalid')\r\n\t\telse \r\n\t\t\t$(this).addClass('invalid');\r\n\t\tvalidateForm($(this).parents('form'), true);\r\n\t});\r\n\r\n\t/* Captcha update */\r\n\t$('.captcha').click(function(ev) {\r\n\t\tupdateCaptcha($(this).parents('.captchablock'), (ev.ctrlKey || ev.altKey));\r\n\t})\r\n\r\n\t/* Error box close */\r\n\t$('.pop-message .i-x-large').click(errBox.closeWithBtn);\r\n\r\n\t/* Loop panel close */\r\n\t$('#loop-upload .panel-close').click(loopEditor.hide.bind(loopEditor));\r\n\r\n\t/* Loop upload form */\r\n\t$('#loop-upload form').on('submit', function(ev) {\r\n\t\tev.preventDefault();\r\n\t\tsetLineHeightAsParentHeight($('#loop-upload .hijab'));\r\n\t\t$('#loop-upload .panel').addClass('p-busy');\r\n\t\tvar action = 'add';\r\n\t\tif($('#loop-upload form').hasClass('action-edit')) \r\n\t\t\taction = 'edit';\r\n\t\tif($('#loop-upload form').hasClass('action-delete')) \r\n\t\t\taction = 'delete';\r\n\t\t\r\n\t\t/* Make XHR2 */\r\n\t\tvar fd = new FormData();\r\n\t\tfd.append('action', action);\r\n\t\tfd.append('datatype', 'loop');\r\n\t\tfd.append('delpass', $(\"#loop-upload .delpass\").val());\r\n\t\tfd.append('captcha', $(\"#loop-upload .captchainput\").val());\r\n\r\n\t\tif(is_admin)\r\n\t\t\tfd.append('is_admin', 1);\r\n\r\n\t\tif(action !== 'delete') {\r\n\t\t\tfd.append('name', $(\"#loop-upload .filename\").val());\r\n\t\t\t;['freq', 'db', 'smoothing', 'treshold'].forEach(prop => fd.append(prop, ranges.current[prop]))\r\n\r\n\t\t\tif($('#assoc_pattern').is(':checked'))\r\n\t\t\t\tfd.append('associated_pattern', $('#pattern-toassoc').val());\r\n\r\n\t\t\tif(is_admin) {\r\n\t\t\t\tfd.append('is_admin', 1);\r\n\t\t\t\tvar date = $('#loop-date').val();\r\n\t\t\t\tif(date) {\r\n\t\t\t\t\tvar time = $('#loop-time').val() || '00:00:00';\r\n\t\t\t\t\tdate = date + ' ' + time;\r\n\t\t\t\t}\r\n\t\t\t\tif(date)\r\n\t\t\t\t\tfd.append('date', date);\r\n\t\t\t\tif($(\"#loop-swf\").val())\r\n\t\t\t\t\tfd.append('swf', $(\"#loop-swf\").val());\r\n\t\t\t\tfd.append('section', $(\"#loop-section\").val());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(action === 'add') {\r\n\t\t\tif(!currentCustomTrack.blob) {\r\n\t\t\t\terrBox.pop($('#loop-upload'), \"Файл отсутствует\");\r\n\t\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\t\treturn \r\n\t\t\t}\r\n\t\t\tif(currentCustomTrack.blob.size / 1024 > upconf.max_loop_fszkb) {\r\n\t\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\t\terrBox.pop($('#loop-upload'), 'Превышен максимальный размер файла ('+upconf.max_loop_fszkb/1024+' МБ).');\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tfd.append('loop', currentCustomTrack.blob);\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tfd.append('original_hash', loopEditor.rawData.original_hash);\r\n\t\t}\r\n\r\n\t\tif(action === 'edit')\r\n\t\t\tfd.append('take_ownership', $('#loop_take_ownership').is(':checked'));\r\n\t\t\t\t\t\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open(\"POST\", \"upload.php\");\r\n\t\trequest.send(fd);\r\n\r\n\t\trequest.onload = function(e) {\r\n\t\t\t$('#loop-upload .panel').removeClass('p-busy');\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar res = JSON.parse(this.response);\r\n\t\t\t\t\tif(res.error) {\r\n\t\t\t\t\t\tif(res.errtype === 'prompt_edit') {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tvar data = JSON.parse(res.extra_data);\r\n\t\t\t\t\t\t\t\tloopEditor.prepareEdit(data);\r\n\t\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), _.escape(res.msg)+' <a href=\"javascript:loopEditor.edit();\">Отредактировать луп «'+_.escape(data.name)+'»</a>?', 'prompt', 'raw');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), res.msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvar _lib = (res.loop.section !== 'custom') ? 'default' : 'custom';\r\n\t\t\t\t\t\t// save password\r\n\t\t\t\t\t\tvar dp = $(\"#loop-upload .delpass\").val();\r\n\t\t\t\t\t\tlocalStorage[\"loop_pass\"] = dp;\r\n\t\t\t\t\t\tif(!localStorage[\"pattern_pass\"]) {\r\n\t\t\t\t\t\t\t$(\"#pattern-share .delpass\").val(dp);\r\n\t\t\t\t\t\t\tlocalStorage[\"pattern_pass\"] = dp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/* LOOP XHR RESULTS */ \r\n\t\t\t\t\t\tif(res.success === 'loop_add' && res.hasOwnProperty('loop')) {\r\n\t\t\t\t\t\t\tloopLibs[_lib].add(res.loop);\r\n\t\t\t\t\t\t\tloopEditor.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'loop_edit') {\r\n\t\t\t\t\t\t\tvar lib_move = false;\r\n\t\t\t\t\t\t\tif(res.loop.hasOwnProperty('section_from'))  {\r\n\t\t\t\t\t\t\t\tvar lib_from = (res.loop.section_from !== 'custom') ? 'default' : 'custom';\r\n\t\t\t\t\t\t\t\tif(lib_from !== _lib) \r\n\t\t\t\t\t\t\t\t\tlib_move = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(lib_move) {\r\n\t\t\t\t\t\t\t\tloopLibs[lib_from].del(res.loop.original_hash, res.loop.section_from);\r\n\t\t\t\t\t\t\t\tloopLibs[_lib].add(res.loop);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tloopLibs[_lib].edit(res.loop);\r\n\r\n\t\t\t\t\t\t\t_.each(res.changes, function(item, ix) {res.changes[ix] = _.escape(item)});\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), res.changes.join(';<br>') + '.', 'success', 'raw');\r\n\t\t\t\t\t\t\tloopEditor.unedit();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'loop_delete') {\r\n\t\t\t\t\t\t\tloopLibs[_lib].del(res.loop.original_hash, res.loop.section);\r\n\t\t\t\t\t\t\terrBox.pop($('#loop-upload'), \"Луп удален.\", 'success');\r\n\t\t\t\t\t\t\tloopEditor.undel();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$('#loop-library').addClass('open-lib');\r\n\t\t\t\t\t\t$('#ltab-'+_lib).click();\r\n\r\n\t\t\t\t\t\t$(\"#loop-upload .filename\").val('').trigger('input');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e) {\r\n\t\t\t\t\tif(e.name == 'SyntaxError') {\r\n\t\t\t\t\t\terrBox.pop($('#loop-upload'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\tconsole.error(this.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse throw e;\r\n\t\t\t\t}\r\n\t\t\t\tupdateCaptcha($(\"#loop-upload .captchablock\"));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\terrBox.pop($('#loop-upload'), 'Ошибка XHR. Подробности в консоли.');\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/* Loop library */\r\n\t$.getJSON('custom_loops.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tloopLibs.custom = new TrackList(data, '#custom-loops', 'custom', true, $('#ltab-custom i.sorter'), 'date', 'desc', true, $('#ltab-custom i.play-enabler'));\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('default_loops.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tvar defaultLib = [\r\n\t\t\t{ title: 'Период смерти', sectID: 'dead', contents: _.filter(data, {section: 'dead'}) },\r\n\t\t\t{ title: 'Период жизни', sectID: 'live', contents: _.filter(data, {section: 'live'}) }\r\n\t\t]\r\n\t\tloopLibs.default = new TrackList(defaultLib, '#default-loops', 'default', false, $('#ltab-default i.sorter'), 'date', 'desc', true, $('#ltab-default i.play-enabler'));\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('default_patterns.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tpatternLibs.default = new PatternGallery(data, '#default-patterns', 'default', $('#ptab-default i.sorter'), 'date', 'desc');\r\n\t})\r\n\t.fail(console.error);\r\n\t$.getJSON('custom_patterns.json?'+Math.random())\r\n\t.done(function(data) {\r\n\t\tpatternLibs.custom = new PatternGallery(data, '#custom-patterns', 'custom', $('#ptab-custom i.sorter'), 'date', 'desc');\r\n\t})\r\n\t.fail(console.error);\r\n\r\n\t$('.scrollable').mCustomScrollbar({theme:\"minimal-dark\", scrollInertia: 200});\r\n\r\n\t/* Track name autoscroll */\r\n\t$('.lt-contents').on('mouseenter', '.track', function() {\r\n\t\tvar $trackName = $(this).find('.track-name');\r\n\t\tif($trackName[0].scrollWidth <= $trackName[0].offsetWidth) return;\r\n\t\t$trackName.stop().addClass('no-overflow');\r\n\t\t$trackName.animate({\r\n\t\t\tscrollLeft: $trackName.width()\r\n\t\t}, $trackName.width()*15, 'linear');\r\n\t})\r\n\t.on('mouseleave', '.track', function() {\r\n\t\tvar $trackName = $(this).find('.track-name');\r\n\t\tif($trackName[0].scrollWidth <= $trackName[0].offsetWidth) return;\r\n\t\t$trackName.stop().animate({\r\n\t\t\tscrollLeft: 0\r\n\t\t}, 'slow', 'linear', function() {\r\n\t\t\t$trackName.removeClass('no-overflow');\r\n\t\t});\r\n\t})\r\n\r\n\t/* Lib header */\r\n\t$('.lib-search').click(function() {\r\n\t\t$(this).toggleClass('active').parents('.library').toggleClass('search-active').find('input').focus()\r\n\t});\r\n\t$('.ltab-close, .ptab-close').click(function() {\r\n\t\t$(this).parents('.library').removeClass('open-lib select-mode');\r\n\t});\r\n\t$('.tab-switch').click(function() {\r\n\t\tvar tabgroup = $(this).data('tabgroup');\r\n\t\t$('.tab-switch.tabgroup-'+tabgroup).removeClass('active');\r\n\t\tif(!$(this).hasClass('active'))\r\n\t\t\t$(this).addClass('active');\r\n\t\t$('.tab-contents.tabgroup-'+tabgroup).hide();\r\n\t\t$('#'+$(this).data('tab')).show();\r\n\t});\r\n\t$('.tab-to-select-by-default').click();\r\n\r\n\t/* track play on click */\r\n\t$('#loop-library')\r\n\t.on('click', '.track .i-play', function() {\r\n\t\tvar hash = $(this).parents('.track').data('hash')       // unique hashname of the track\r\n\t\t, libID = $(this).parents('.tracklist-section').data('id');     //library ID\r\n\t\tloopLibs[libID].playTrackByHash(hash);\r\n\t}) /* track download menu */\r\n\t.on('click', '.track-options .i-download-menu', function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t\t$(this).parents('.track').addClass('dl-track')\r\n\t})\r\n\t.on('click', '.track-options .i-burger', function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t\t$(this).parents('.track').addClass('ed-track')\r\n\t})\r\n\t.on('click', '.track-name', function(ev) {\r\n\t\t$('.track').removeClass('dl-track ed-track')\r\n\t})\r\n\t.on('click', '.track', function(ev) {\r\n\t\tif($(this).parents('.library').hasClass('select-mode')) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tvar hash = $(this).data('hash');\r\n\t\t\tif($(this).parents('.library').hasClass('select-mode'))\r\n\t\t\t\t$('#loop-toassoc').val(hash);\r\n\t\t}\r\n\t});\r\n\r\n\t/* track search (Jets.js method) */\r\n\t$('#loop-search').on('input', function() {\r\n\t\tvar query = $(this).val().toLowerCase().replace(/\\\"/, '\\\\\"');\r\n\t\ttry {\r\n\t\t\tinjector.remove('loop-search');\r\n\t\t} catch(e) {}\r\n\t\tif(query.length)\r\n\t\t\tinjector.inject('loop-search', '.search-active#loop-library .track:not([data-name *= \"'+query+'\"]) { display:none; }');\r\n\t\telse\r\n\t\t\tinjector.inject('loop-search', '.search-active#loop-library .track { display:none; }');\r\n\t}).trigger('input');\r\n\r\n\t/* pattern search (same) */\r\n\t$('#pattern-search').on('input', function() {\r\n\t\tvar query = $(this).val().toLowerCase().replace(/\\\"/, '\\\\\"');\r\n\t\ttry {\r\n\t\t\tinjector.remove('pattern-search');\r\n\t\t} catch(e) {}\r\n\t\tif(query.length)\r\n\t\t\tinjector.inject('pattern-search', '.search-active#pattern-library .pattern:not([data-name *= \"'+query+'\"]) { display:none; }');\r\n\t\telse\r\n\t\t\tinjector.inject('pattern-search', '.search-active#pattern-library .pattern { display:none; }');\r\n\t}).trigger('input');\r\n\r\n\t/* cancel loop editor */\r\n\t$('#unedit-loop').click(loopEditor.unedit.bind(loopEditor));\r\n\r\n\t$('.oncheck-enable').change(function() {\r\n\t\t$($(this).data('element-toenable')).attr('disabled', !this.checked);\r\n\t})\r\n\r\n\t// track menu\r\n\t$('#loop-library')\r\n\t.on('click', '.dlb-edit', function() {\r\n\t\tvar $track = $(this).parents('.track')\r\n\t\t, hash = $track.data('hash')+''\r\n\t\t, lib = $track.parents('.tabgroup-loops').data('lib')\r\n\t\t, trackData = _.find(loopLibs[lib].flatList, {original_hash: hash});\r\n\t\tif(trackData)\r\n\t\t\tloopEditor.prepareEdit(trackData, true);\r\n\t})\r\n\t.on('click', '.dlb-delete', function() {\r\n\t\tvar $track = $(this).parents('.track')\r\n\t\t, hash = $track.data('hash')\r\n\t\t, lib = $track.parents('.tabgroup-loops').data('lib')\r\n\t\t, trackData = _.find(loopLibs[lib].flatList, {original_hash: hash});\r\n\t\tif(trackData)\r\n\t\t\tloopEditor.del(trackData, true);\r\n\t\t/*loopEditor.del(hash);*/\r\n\t});\r\n\r\n\t/* Pattern applying and menu */\r\n\t$('#pattern-library')\r\n\t.on('click', '.pattern-name', function() {\r\n\t\tvar libID = $(this).parent().data('lib')\r\n\t\t, patternID = $(this).parent().data('id');\r\n\r\n\t\tif($(this).parents('.library').hasClass('select-mode')) \r\n\t\t\t$('#pattern-toassoc').val(patternID);\r\n\t\telse\r\n\t\t\tpatternLibs[libID].applyPatternByID(patternID);\r\n\t})\r\n\t.on('click', '.i-edit', function() {\r\n\t\tvar $pattern = $(this).parents('.pattern')\r\n\t\t, id = $pattern.data('id')\r\n\t\t, lib = $pattern.data('lib')\r\n\t\t, patternData = _.find(patternLibs[lib].list, {id: id});\r\n\t\tif(patternData) \r\n\t\t\tpatternEditor.edit(patternData);\r\n\t})\r\n\t.on('click', '.pattern .i-x-small', function() {\r\n\t\tvar $pattern = $(this).parents('.pattern')\r\n\t\t, id = $pattern.data('id')\r\n\t\t, lib = $pattern.data('lib')\r\n\t\t, patternData = _.find(patternLibs[lib].list, {id: id});\r\n\t\tif(patternData) \r\n\t\t\tpatternEditor.del(patternData);\r\n\t})\r\n\r\n\t/* Pattern share form */\r\n\t$('form#pattern-share').on('submit', function(ev) {\r\n\t\tev.preventDefault();\r\n\t\tsetLineHeightAsParentHeight($('#editmode .hijab'));\r\n\t\t$('#editmode .panel').addClass('p-busy');\r\n\t\tvar action = 'add';\r\n\t\tif($('#pattern-share').hasClass('action-edit')) \r\n\t\t\taction = 'edit';\r\n\t\tif($('#pattern-share').hasClass('action-delete')) \r\n\t\t\taction = 'delete';\r\n\r\n\t\tvar fd = new FormData();\r\n\t\tfd.append('action', action);\r\n\t\tfd.append('datatype', 'pattern');\r\n\t\tfd.append('delpass', $(\"#pattern-share .delpass\").val());\r\n\t\tfd.append('captcha', $(\"#pattern-share .captchainput\").val());\r\n\r\n\t\tif(is_admin)\r\n\t\t\tfd.append('is_admin', 1);\r\n\r\n\t\tif(action !== 'delete') {\r\n\t\t\tfd.append('name', $(\"#pattern-share .filename\").val());\r\n\t\t\tfd.append('pattern_string', Grid.getPattern());\r\n\r\n\t\t\tfd.append('style', $('#cell-style').val());\r\n\t\t\tfd.append('osc', ($('#osc-sel').val() !== 'off') ? $('#osc-color').val() : 'off')\r\n\r\n\t\t\tif($('#assoc_loop').is(':checked'))\r\n\t\t\t\tfd.append('associated_loop', $('#loop-toassoc').val());\r\n\r\n\t\t\tif(is_admin) {\r\n\t\t\t\tfd.append('is_admin', 1);\r\n\t\t\t\tvar date = $('#pattern-date').val();\r\n\t\t\t\tif(date) {\r\n\t\t\t\t\tvar time = $('#pattern-time').val() || '00:00:00';\r\n\t\t\t\t\tdate = date + ' ' + time\r\n\t\t\t\t}\r\n\t\t\t\tif(date)\r\n\t\t\t\t\tfd.append('date', date);\r\n\t\t\t\tfd.append('section', $(\"#pattern-section\").val());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(action !== 'add') {\r\n\t\t\tfd.append('pattern_id', patternEditor.currentID);\r\n\t\t}\r\n\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open(\"POST\", \"upload.php\");\r\n\t\trequest.send(fd);\r\n\r\n\t\trequest.onload = function(e) {\r\n\t\t\t$('#editmode .panel').removeClass('p-busy');\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar res = JSON.parse(this.response);\r\n\t\t\t\t\tif(res.error) {\r\n\t\t\t\t\t\terrBox.pop($('#editmode'), res.msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// save password\r\n\t\t\t\t\t\tvar dp = $(\"#pattern-share .delpass\").val();\r\n\t\t\t\t\t\tlocalStorage[\"pattern_pass\"] = dp;\r\n\t\t\t\t\t\tif(!localStorage[\"loop_pass\"]) {\r\n\t\t\t\t\t\t\t$(\"#loop-upload .delpass\").val(dp);\r\n\t\t\t\t\t\t\tlocalStorage[\"loop_pass\"] = dp;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(res.success === 'pattern_add') {\r\n\t\t\t\t\t\t\tpatternLibs[res.pattern.section].add(res.pattern);\r\n\t\t\t\t\t\t\t// patternEditor.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'pattern_edit') {\r\n\t\t\t\t\t\t\tvar lib_from = res.pattern.section_from || false;\r\n\t\t\t\t\t\t\tif(lib_from) {\r\n\t\t\t\t\t\t\t\tpatternLibs[lib_from].del(res.pattern.id);\r\n\t\t\t\t\t\t\t\tpatternLibs[res.pattern.section].add(res.pattern);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tpatternLibs[res.pattern.section].edit(res.pattern);\r\n\t\t\t\t\t\t\t_.each(res.changes, function(item, ix) {res.changes[ix] = _.escape(item)});\r\n\t\t\t\t\t\t\terrBox.pop($('#editmode'), res.changes.join(';<br>'), 'success', 'raw');\r\n\t\t\t\t\t\t\tpatternEditor.unedit();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(res.success === 'pattern_delete') {\r\n\t\t\t\t\t\t\tpatternLibs[res.pattern.section].del(res.pattern.id);\r\n\t\t\t\t\t\t\terrBox.pop($('#editmode'), \"Паттерн удален.\", 'success');\r\n\t\t\t\t\t\t\tpatternEditor.undel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$('#pattern-library').addClass('open-lib');\r\n\t\t\t\t\t\t$('#ptab-'+res.pattern.section).click();\r\n\t\t\t\t\t\t$(\"#loop-upload .filename\").val('').trigger('input');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e) {\r\n\t\t\t\t\tif(e.name == 'SyntaxError') {\r\n\t\t\t\t\t\terrBox.pop($('#editmode'), 'Неожиданный ответ сервера. Подробности в консоли.');\r\n\t\t\t\t\t\tconsole.error(this.response);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse throw e;\r\n\t\t\t\t}\r\n\t\t\t\tupdateCaptcha($(\"#pattern-share .captchablock\"));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\terrBox.pop($('#editmode'), 'Ошибка XHR. Подробности в консоли.');\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\t/*toggle osc and assoc*/\r\n\tif(localStorage['loops_association'])\r\n\t\ttry {\r\n\t\t\tconf.association = JSON.parse(localStorage['loops_association']);\r\n\t\t\t$('#assoc-toggle')[0].checked = conf.association;\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tthrow e;\r\n\t\t\tlocalStorage['loops_association'] = false;\r\n\t\t}\r\n\t$('#assoc-toggle').change(function() {\r\n\t\tconf.association = localStorage['loops_association'] = $(this)[0].checked;\r\n\t});\r\n\tif(localStorage['osc_enabled'])\r\n\t\ttry {\r\n\t\t\tconf.osc = JSON.parse(localStorage['osc_enabled']);\r\n\t\t\tif(!conf.osc) {\r\n\t\t\t\t$('#osc-toggle')[0].checked = false;\r\n\t\t\t\t$('body').addClass('osc-disabled');\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tthrow e;\r\n\t\t\tlocalStorage['osc_enabled'] = true;\r\n\t\t}\r\n\t$('#osc-toggle').change(function() {\r\n\t\tconf.osc = localStorage['osc_enabled'] = $(this)[0].checked;\r\n\t\tif(!conf.osc)\r\n\t\t\t$('body').addClass('osc-disabled')\r\n\t\telse \r\n\t\t\t$('body').removeClass('osc-disabled')\r\n\t})\r\n\r\n\t/* Cell styles and stuff */\r\n\t_.each(styles, function(val, style) {\r\n\t\tvar selected = (Grid.style === style) ? ' selected' : '';\r\n\t\t$('#cell-style').append('<option val=\"'+style+'\"'+selected+'>'+style+'</option>');\r\n\t});\r\n\r\n\t$('#cell-style').change(function() {\r\n\t\tGrid.changeStyle($(this).val())\r\n\t});\r\n\r\n\t$('#osc-color').change(function() {\r\n\t\tGrid.setOsc($(this).val());\r\n\t})\r\n\r\n\t$('#osc-sel').change(function() {\r\n\t\tvar val = $(this).val();\r\n\t\tif(val === 'off') \r\n\t\t\tGrid.setOsc('off')\r\n\t\telse {\r\n\t\t\t$('body').removeClass('osc-disabled');\r\n\t\t\tconf.osc = true;\r\n\t\t}\r\n\t\tif(val === 'default') {\r\n\t\t\tGrid.recount();\r\n\t\t\t$('#osc-color').attr('disabled', true);\r\n\t\t}\r\n\t\tif(val === 'custom')\r\n\t\t\t$('#osc-color').attr('disabled', false);\r\n\t})\r\n\r\n\t// some local storage shit\r\n\t$(\"#loop-upload .delpass\").val(localStorage[\"loop_pass\"] || '').trigger('input');\r\n\t$(\"#pattern-share .delpass\").val(localStorage[\"pattern_pass\"] || '').trigger('input');\r\n}\r\n\r\nvar injector = {\r\n  inject: function(alias, css) {\r\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t  , style = document.createElement('style');\r\n\t\tstyle.type = 'text/css';\r\n\t\tstyle.id = 'injector:' + alias;\r\n\t\tif (style.styleSheet) {\r\n\t\t  style.styleSheet.cssText = css;\r\n\t\t} else {\r\n\t\t  style.appendChild(document.createTextNode(css));\r\n\t\t}\r\n\t\thead.appendChild(style);\r\n  },\r\n  remove: function(alias) {\r\n\t\tvar style = document.getElementById('injector:' + alias);\r\n\t\tif(style) {\r\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0];\r\n\t\t\tif(head)\r\n\t\t\t\thead.removeChild(document.getElementById('injector:' + alias));\r\n\t\t}\r\n  }\r\n}\r\n\r\nvar loopLibs = {}, patternLibs = {};\r\n\r\nvar errBox = {\r\n\tpop: function($parent, message, msgType, raw) {\r\n\t\tif(typeof msgType === \"undefined\") msgType = \"error\";\r\n\t\tif(typeof raw === \"undefined\" || raw !== 'raw') raw = false;\r\n\t\tlet $errorbox = $parent.find('.emsgwrap');\r\n\t\tif(raw)\r\n\t\t\t$errorbox.find('.emsgbody').html(message);\r\n\t\telse\r\n\t\t\t$errorbox.find('.emsgbody').text(message);\r\n\t\t$errorbox.find('.pop-message').removeClass('emsg-error emsg-prompt emsg-success').addClass('emsg-'+msgType);\r\n\t\t$errorbox.css({visibility: 'visible'});\r\n\t\t$errorbox.animate({\r\n\t\t  opacity: 1,\r\n\t\t  top: '-'+($errorbox.height()-20)+'px'\r\n\t\t}, 200);\r\n\t\treturn $errorbox;\r\n\t},\r\n\tcloseWithBtn: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\terrBox.off($(this).parents('.emsgwrap'))\r\n\t},\r\n\toff: function($parent) {\r\n\t\t$parent.animate({opacity: '0'}, 200, function() {\r\n\t\t\t$parent.css({\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\ttop: '0px'\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction popError($parent, message) {\r\n\t$errorbox = $parent.find('.emsgwrap');\r\n\t$errorbox.find('.emsgbody').html(message);\r\n\t$errorbox.css({visibility: 'visible'});\r\n\t$errorbox.animate({\r\n\t  opacity: 1,\r\n\t  top: '-'+($errorbox.height()-20)+'px'\r\n\t}, 400);\r\n}\r\n\r\nfunction updateCaptcha($parent, switch_lang=false) {\r\n\t$parent.find('img.captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random()+(switch_lang ? '&switch' : ''));\r\n\t$parent.find('input.captchainput').val('').trigger('input');\r\n}\r\n\r\nvar loopEditor = {\r\n\tvisible: false,\r\n\tstate: 'add',\r\n\tprepareEdit: function(data, immed) {\r\n\t\tthis.rawData = data;\r\n\t\tif(typeof immed !== 'undefined' && immed)\r\n\t\t\tthis.edit();\r\n\t},\r\n\tadd: function() {\r\n\t\tthis.unedit();\r\n\t\tthis.undel();\r\n\t\tthis.show();\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t},\r\n\tedit: function() {\r\n\t\tthis.undel();\r\n\t\tthis.state = 'edit'\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t\t$('#loop-upload form').addClass('action-edit');\r\n\t\t$('#loopedit-id').text(_.trunc(this.rawData.name, 18));\r\n\t\t$('#loop-upload .filename').val(this.rawData.name);\r\n\t\t/*$('#loop-upload input[name=tresholdCorrection]')\r\n\t\t.val(this.rawData.treshold_correction).trigger('input');*/\r\n\t\t\r\n\t\tlet $datetime = this.rawData.date.split(' ');\r\n\t\t$('#loop-date').val($datetime[0]);\r\n\t\t$('#loop-time').val($datetime[1]);\r\n\t\t$('#loop-section').val(this.rawData.section);\r\n\t\t$('#loop-swf').val(this.rawData.swf);\r\n\r\n\t\tif(this.rawData.associated_loop) {\r\n\t\t\t$('#pattern-toassoc').val(this.rawData.associated_pattern);\r\n\t\t\t$('#assoc_pattern')[0].checked = true;\r\n\t\t}\r\n\t\telse \r\n\t\t\t$('#assoc_pattern')[0].checked = false;\r\n\t\t$('#assoc_pattern').trigger('change');\r\n\t\t\r\n\t\tthis.show();        \r\n\t},\r\n\tunedit: function() {\r\n\t\tif(this.state !== 'edit') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#loop-upload form').removeClass('action-edit');\r\n\t},\r\n\tdel: function(loop) {\r\n\t\tthis.rawData = loop;\r\n\t\tthis.unedit();\r\n\t\tthis.state = 'delete';\r\n\t\t$('#loopdelete-id').text(_.trunc(loop.name, 40));\r\n\t\t$('#loop-upload form').addClass('action-delete');\r\n\t\tthis.show();\r\n\t},\r\n\tundel: function() {\r\n\t\tif(this.state !== 'delete') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#loop-upload form').removeClass('action-delete');\r\n\t},\r\n\tshow: function() {\r\n\t\t$('#loop-upload .validable').trigger('input');\r\n\t\tif(this.visible) return;\r\n\t\t$('#loop-upload .captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random());\r\n\t\t$('#loop-upload').slideDown('fast');\r\n\t\tthis.visible = true;\r\n\t},\r\n\thide: function() {\r\n\t\t//return here\r\n\t\tif(!this.visible) return;\r\n\t\terrBox.off($('#loop-upload .emsgwrap'));\r\n\t\t$('#loop-upload').slideUp('fast', (function() {\r\n\t\t\tthis.unedit();\r\n\t\t\tthis.undel();\r\n\t\t\tthis.visible = false;\r\n\t\t}).bind(this));\r\n\t}\r\n}\r\n\r\nvar patternEditor = {\r\n\tvisible: false,\r\n\tstate: 'add',\r\n\tcurrentID: 0,\r\n\tedit: function(pattern) {\r\n\t\tthis.undel();\r\n\t\t$('#pattern-share').addClass('action-edit');\r\n\t\t$('#patternedit-id').text(_.trunc(pattern.name, 40));\r\n\t\t$('#pattern-share .filename').val(pattern.name);\r\n\t\tif(pattern.associated_loop) {\r\n\t\t\t$('#loop-toassoc').val(pattern.associated_loop);\r\n\t\t\t$('#assoc_loop')[0].checked = true;\r\n\t\t}\r\n\t\telse\r\n\t\t\t$('#assoc_loop')[0].checked = false;\r\n\t\t$('#assoc_loop').trigger('change');\r\n\t\tif(pattern.style) \r\n\t\t\t$('#cell-style').val(pattern.style).trigger('change');\r\n\t\tif(pattern.osc) \r\n\t\t\tGrid.setOsc(pattern.osc);\r\n\t\t\r\n\t\tthis.state = 'edit';\r\n\t\tthis.show(pattern.string);\r\n\t\tthis.currentID = +pattern.id;\r\n\t},\r\n\tunedit: function() {\r\n\t\tif(this.state !== 'edit') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#pattern-share').removeClass('action-edit');\r\n\t},\r\n\tdel: function(pattern) {\r\n\t\tthis.currentID = +pattern.id;\r\n\t\tthis.unedit();\r\n\t\tthis.state = 'delete';\r\n\t\t$('#patterndelete-id').text(_.trunc(pattern.name, 40));\r\n\t\t$('#pattern-share').addClass('action-delete');\r\n\t\tthis.show(pattern.string);\r\n\t},\r\n\tundel: function() {\r\n\t\tif(this.state !== 'delete') return;\r\n\t\tthis.state = 'add';\r\n\t\t$('#pattern-share').removeClass('action-delete');\r\n\r\n\t},\r\n\tshow: function(patternStr) {\r\n\t\tif(typeof patternStr === 'undefined') patternStr = false;\r\n\t\tGrid.enterPaintMode();\r\n\t\tif(patternStr) {\r\n\t\t\tGrid.build(patternStr);\r\n\t\t\t$('#pattern-library').removeClass('open-lib');\r\n\t\t}\r\n\t\tif(this.visible) return;\r\n\t\t$('#pattern-share .captcha').attr('src', 'captcha/captcha.php?color=200,200,200&'+Math.random());\r\n\t\t$('.onshare-show').slideDown('fast');\r\n\t\tthis.visible = true;\r\n\t\t$('#pattern-share .validable').trigger('input');\r\n\r\n\t\tif($('#osc-sel').val() === 'default')\r\n\t\t\tGrid.recount();\r\n\t},\r\n\thide: function() {\r\n\t\tif(!this.visible) return;\r\n\t\t$('.onshare-show').slideUp('fast', (function() {\r\n\t\t\tthis.unedit();\r\n\t\t\tthis.undel();\r\n\t\t\tthis.visible = false;\r\n\t\t}).bind(this));\r\n\t},\r\n\ttoggle: function() {\r\n\t\tif(this.visible) this.hide();\r\n\t\telse this.show();\r\n\t}\r\n}\r\n\r\nvar upconf = { //TODO: merge with conf\r\n\tauth: false\r\n}\r\n\r\nvar validations = {\r\n\tdelpass: function(val) {\r\n\t\treturn !!val && (val.length <= upconf.max_delpass_length)\r\n\t},\r\n\tcaptcha: function(val) {\r\n\t\treturn !!val\r\n\t},\r\n\tfilename: function(val) {\r\n\t\treturn !!val && (val.length <= upconf.max_filename_length)\r\n\t}\r\n}\r\n\r\nfunction validateForm($form, fromInput) {\r\n\t$form.find('button[type=submit]').attr('disabled', !!($form.find('.invalid:visible').length))\r\n}\r\n\r\nvar actions = {\r\n\texport: function() {\r\n\t\t$('#pattern-area').val(Grid.getPattern())\r\n\t},\r\n\timport: function() {\r\n\t\tGrid.build($('#pattern-area').val(), 'under')\r\n\t},\r\n\trandom: function() {\r\n\t\tGrid.randomfill()\r\n\t},\r\n\trevert: function() {\r\n\t\t$('#osc-sel').val('default');\r\n\t\tGrid.changeStyle(defaultStyle, defaultPattern);\r\n\t},\r\n\tclear: function() {\r\n\t\tGrid.clear()\r\n\t},\r\n\tclose: function() {\r\n\t\tGrid.exitPaintMode();\r\n\t},\r\n\tupload: function() {\r\n\t\tdocument.getElementById('bufferFileInput').click();\r\n\t},\r\n\tdownload: function() {\r\n\t\tGrid.downloadPattern()\r\n\t},\r\n\tupload_loop: function() {\r\n\t\tconsole.log('loop upload')\r\n\t},\r\n\tshare_pattern: function() {\r\n\t\tpatternEditor.toggle();\r\n\t},\r\n\tselect_loop: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\t$('#loop-library').addClass('select-mode open-lib');\r\n\t},\r\n\tselect_pattern: function(ev) {\r\n\t\tev.preventDefault();\r\n\t\t$('#pattern-library').addClass('select-mode open-lib');\r\n\t},\r\n\trecount_base_color: function() {\r\n\t\tGrid.recount();\r\n\t}\r\n}\r\n\r\nvar isMouseDown = false;\r\n\r\nfunction setLineHeightAsParentHeight($el) {\r\n\t$el.each(function() {\r\n\t\t$(this).css({lineHeight: $(this).height()+'px'});\r\n\t})\r\n}\r\n\r\nvar Colors = {\r\n\tg: '#35752e', G: '#59c44d',\r\n\ty: '#7b7d25', Y: '#cccf41',\r\n\to: '#805c22', O: '#d2993e',\r\n\tb: '#2e6d90', B: '#4eb6f1',\r\n\tc: '#7b273d', C: '#cc4368',\r\n\tv: '#4e1e84', V: '#8238d8',\r\n\tm: '#686868', M: '#d2d2d2',\r\n\tj: '#468172', J: '#37C999',\r\n\t'.': '_VOID_', '_': '_VOID_'\r\n}\r\nvar colorMatch = new RegExp('(['+_.escapeRegExp(_.keys(Colors).join(''))+'])|\\\\[(.+?)\\\\]', 'g');\r\nvar colorMatchSqBr = new RegExp('(['+_.escapeRegExp(_.keys(Colors).join(''))+'])|(\\\\[.+?\\\\])', 'g');\r\n\r\nvar styles = {\r\n\tlegacy: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(25).toHexString();\r\n\t\treturn {\r\n\t\t\tu: 'background: radial-gradient(ellipse at center, '+baseColor+' 34%, '+darkenColor+' 81%);',\r\n\t\t\to: 'background: '+baseColor\r\n\t\t}\r\n\t},\r\n\tmodern: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(10).toHexString(), darker = color.darken(30).toRgbString();\r\n\t\treturn {\r\n\t\t\tu: 'background: radial-gradient(ellipse at center 7px, '+baseColor+' 0%, '+darkenColor+' 70%);',\r\n\t\t\to: 'background: '+baseColor+'; box-shadow: '+baseColor+' 0px 0px 0px 0px, '+baseColor+' 0px 0px 0px 0px, '+darker+' 0px 0px 0px 0px'\r\n\t\t}\r\n\t},\r\n\tflashes: function(color) {\r\n\t\tvar baseColor = color.toHexString(), darkenColor = color.darken(10).toHexString(), darker = color.darken(30).toRgbString();\r\n\t\treturn {\r\n\t\t\tu: 'background: transparent; box-shadow: none;',\r\n\t\t\to: 'background: '+baseColor+'; box-shadow: '+baseColor+' 0px 0px 0px 0px, '+baseColor+' 0px 0px 0px 0px, '+darker+' 0px 0px 0px 0px'\r\n\t\t}\r\n\t},\r\n\tflat: function(color) {\r\n\t\tvar baseColor = color.toHexString(), lighten = color.brighten(25).saturate(15).toHexString();\r\n\t\treturn {\r\n\t\t\tu: 'background: '+baseColor+';',\r\n\t\t\to: 'background: '+lighten+';'\r\n\t\t}\r\n\t}\r\n}, defaultStyle = 'modern';\r\nstyles.transitional = styles.modern;\r\n\r\nvar globalCSS = {\r\n\tlegacy: \"html {\\\r\n\theight: 100%; \\\r\n\tbackground: #000; \\\r\n\tbackground: -webkit-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -ms-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -o-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: -moz-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n\tbackground: linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \\\r\n  }\\\r\n  body {\\\r\n\tfont-family: 'Trebuchet MS',\\\r\n\tTrebuchet, Arial,Helvetica, sans-serif;\\\r\n  }\\\r\n  #shadow {\\\r\n\tbackground: rgba(33, 33, 33, 0.44);\\\r\n\tbox-shadow: 0 0 53px #212121;\\\r\n  }\",\r\n  transitional: \"html {\\\r\n\tbackground: #212121;\\\r\n  }\\\r\n  #shadow {\\\r\n\tbackground: rgba(33, 33, 33, 0.44);\\\r\n\tbox-shadow: 0 0 53px #212121;\\\r\n  }\",\r\n  flat: \"#nullgrid .cell:not(.void) {border-radius: 0; box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);}\\\r\n  #nullgrid .cell.under:not(.void) { box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2); }\"\r\n}\r\n\r\nfunction xBrowserIsMouseDown() {\r\n\treturn isMouseDown;\r\n}\r\n// stupid bug workaround\r\nvar isChrome = navigator.userAgent.match(/chrome\\/([0-9]+)/i);\r\nif(isChrome) {\r\n\tlet chromeVersion = isChrome[1];\r\n\tif(+chromeVersion >= 46)\r\n\txBrowserIsMouseDown = function() {\r\n\t\treturn $('body:active').length;\r\n\t}\r\n}\r\n\r\nvar animations = {\r\n  legacy: function() {\r\n\tvar color = this.style.backgroundColor\r\n\t, darken = tinycolor(color).darken(30).toRgbString();\r\n\tthis._tl.to(this, 0.1, {\r\n\t  opacity: 1,\r\n\t  boxShadow: color+' 0px 0px 2px 2px, '+color+' 0px 0px 10px 10px, '+darken+' 0px 0px 9px 9px',\r\n\t}).to(this, 0.4, {\r\n\t  opacity: 0,\r\n\t  boxShadow: color+' 0px 0px 0px 0px, '+color+' 0px 0px 0px 0px, '+darken+' 0px 0px 0px 0px',\r\n\t})\r\n  },\r\n /* flashes: function() {\r\n\t\tvar color = this.style.backgroundColor\r\n\t\t, darken = tinycolor(color).darken(30).toRgbString();\r\n\t\tthis._tl.to(this, 0.1, {\r\n\t\t  opacity: 1,\r\n\t\t  boxShadow: color+' 0px 0px 2px 2px, '+color+' 0px 0px 10px 10px, '+darken+' 0px 0px 9px 9px',\r\n\t\t}).to(this, 0.4, {\r\n\t\t  opacity: 0,\r\n\t\t  boxShadow: color+' 0px 0px 0px 0px, '+color+' 0px 0px 0px 0px, '+darken+' 0px 0px 0px 0px',\r\n\t\t})\r\n  },*/\r\n  flat: function() {\r\n\tvar color = this.style.backgroundColor;\r\n\tthis._tl.to(this, 0.1, {\r\n\t  opacity: 1,\r\n\t  boxShadow: 'inset 0 0 0 1px rgba(0, 0, 0, 0),' + color + ' 0px 0px 4px 2px',\r\n\t}).to(this, 0.6, {\r\n\t  opacity: 0,\r\n\t  boxShadow: 'inset 0 0 0 1px rgba(0, 0, 0, 0.2),' + color + ' 0px 0px 0px 0px',\r\n\t})\r\n  }\r\n}\r\nanimations.modern = animations.transitional = animations.flashes = animations.legacy;\r\n\r\nvar Grid = {\r\n\tinit: function(sel) {\r\n\t\tthis.$el = $(sel);\r\n\t\tvar self = this;\r\n\t\tthis.$el.find('.triangle-group').css({display: 'inline-block'}).hide();\r\n\t\tthis.$el.find('.tg-top .t-up').click(function() {self.resample('top', 1, 'under')});\r\n\t\tthis.$el.find('.tg-top .t-down').click(function() {self.resample('top', -1, 'under')});\r\n\t\tthis.$el.find('.tg-bottom .t-up').click(function() {self.resample('bottom', -1, 'under')});\r\n\t\tthis.$el.find('.tg-bottom .t-down').click(function() {self.resample('bottom', 1, 'under')});\r\n\t\tthis.$el.find('.tg-left .t-left').click(function() {self.resample('left', 1, 'under')});\r\n\t\tthis.$el.find('.tg-left .t-right').click(function() {self.resample('left', -1, 'under')});\r\n\t\tthis.$el.find('.tg-right .t-left').click(function() {self.resample('right', -1, 'under')});\r\n\t\tthis.$el.find('.tg-right .t-right').click(function() {self.resample('right', 1, 'under')});\r\n\t\tthis.shuffler = new Rarity(50);\r\n\t\tif(this.lastOsc !== 'default')\r\n\t\t\tthis.setOsc(this.lastOsc);\r\n\t\tthis.changeStyle(this.baseStyle, this.pattern);\r\n\t},\r\n\tpattern: localStorage['customPattern'] || defaultPattern,\r\n\tbaseStyle: localStorage['lastStyle'] || defaultStyle,\r\n\tlastOsc: localStorage['lastOsc'] || 'default',\r\n\trevert: function() {\r\n\t\t$('#osc-sel').val('default');\r\n\t\tthis.changeStyle(this.baseStyle, this.pattern);\r\n\t},\r\n\tstyle: this.baseStyle,\r\n\tchangeStyle: function(style,thenBuild) {\r\n\t\tif(!_.has(styles, style))\r\n\t\t\treturn console.error('Не существует такого стиля');\r\n\t\t$('#cell-style').val(style);\r\n\t\tif(typeof thenBuild === 'undefined') thenBuild = false;\r\n\t\tthis.style = style;\r\n\t\tinjector.remove('cellstyle');\r\n\t\tif(_.has(globalCSS, style)) \r\n\t\t\tinjector.inject('cellstyle', globalCSS[style]);\r\n\t\tthis.build(thenBuild);\r\n\t},\r\n\tsetOsc: function(color) {\r\n\t\tif(color === 'off') {\r\n\t\t\t$('#osc-sel').val('off');\r\n\t\t\t$('body').addClass('osc-disabled');\r\n\t\t\tconf.osc = false;\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconf.osc = true;\r\n\t\tif(color === 'default') {\r\n\t\t\t$('#osc-color').attr('disabled', true);\r\n\t\t\tcolor = Grid.primaryColor;\r\n\t\t\t$('#osc-sel').val('default');\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$('#osc-sel').val('custom');\r\n\t\t\t$('#osc-color').attr('disabled', false);\r\n\t\t}\r\n\t\tif($('#osc-toggle')[0].checked)\r\n\t\t\t$('body').removeClass('osc-disabled');\r\n\t\tvar $oscC = $('#osc-color');\r\n\t\tif($oscC[0].hasOwnProperty('color'))\r\n\t\t\t$oscC[0].color.fromString(color);\r\n\t\telse\r\n\t\t\t$oscC.val(color);\r\n\t\tif(color.indexOf('#') == (-1))\r\n\t\t\tcolor = '#'+color;\r\n\t\tdrawContext.fillStyle = color;\r\n\t},\r\n\tgenerateCell: function(color, layer, style) {\r\n\t\tif(typeof style === 'undefined') style = this.style;\r\n\t\tvar char = color.split(/[\\[\\]]/)[1] || color.split(/[\\[\\]]/)[0]\r\n\t\t, color = _.has(Colors, char) ? tinycolor(Colors[char]) : tinycolor(char)\r\n\t\t, cstring = _.has(Colors, char) ? char : ('#'+color.toHex().toLowerCase())\r\n\t\t, style = styles[style](color);\r\n\t\tif(color._format && color._a >= conf.colorAlphaTreshold) {\r\n\t\t\tif(layer == 'under')\r\n\t\t\t\treturn $('<div data-c=\"'+cstring+'\" class=\"cell under\" style=\"'+style.u+'\"></div>');\r\n\t\t\telse {\r\n\t\t\t\tvar $cell = $('<div data-c=\"'+cstring+'\" class=\"cell over\" style=\"'+style.o+'\"></div>');\r\n\t\t\t\t$cell[0]._tl = new TimelineLite()\r\n\t\t\t\tvar blink = function() {\r\n\t\t\t\t\tthis._tl.progress(0)\r\n\t\t\t\t}\r\n        let passive = detectPassiveEvents.hasSupport ? {passive: true} : false;\r\n\t\t\t\t$cell[0].addEventListener('mouseenter', blink, passive);\r\n\t\t\t\t$cell[0].addEventListener('touchstart', blink, passive);\r\n\t\t\t\treturn $cell;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif(layer == 'under')\r\n\t\t\t\treturn $('<div class=\"cell under void\" data-c=\"_\"></div>');\r\n\t\t\tif(layer == 'over')\r\n\t\t\t\treturn $('<div class=\"cell void\" data-c=\"_\"></div>');\r\n\t\t}\r\n\t},\r\n\tlastBuild: {\r\n\t\tpattern: '',\r\n\t\tlayer: '',\r\n\t\tstyle: ''\r\n\t},\r\n\tbuild: function(pattern, layer) {\r\n\t\tif(typeof pattern !== 'string') pattern = this.getPattern();\r\n\t\tif(typeof layer === 'undefined') layer = $('#grid-wrap').hasClass('edit-mode') ? 'under' : 'both';\r\n\t\tpattern = pattern\r\n\t\t.replace(/\\s+/g, '')\r\n\t\t.replace(/\\|{2,}/g, '|')\r\n\t\t.replace(/^\\|/g, '')\r\n\t\t.replace(/\\|$/g, '');\r\n\t\t// prevent same pattern rebuilding\r\n\t\tif(pattern === this.lastBuild.pattern && layer === this.lastBuild.layer && this.style === this.lastBuild.style) return;\r\n\t\tthis.lastBuild.pattern = pattern; this.lastBuild.layer = layer; this.lastBuild.style = this.style;\r\n\t\tvar $cells = this.$el.find('#cells'), $overlays = this.$el.find('#overlays');\r\n\t\tif(layer != 'over') $cells.find('.cell, br').remove();\r\n\t\tif(layer != 'under') $overlays.find('.cell, br').remove();\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\t_.each(lines, function(line, li) {\r\n\t\t\tvar chars = _.compact(line.split(colorMatch));\r\n\t\t\t_.each(chars, function(char, ci) {\r\n\t\t\t\tif(layer != 'over')\r\n\t\t\t\t\tthis.generateCell(char, 'under').attr('id', 'cu_'+li+'_'+ci).appendTo($cells)\r\n\t\t\t\tif(layer != 'under')\r\n\t\t\t\t\tthis.generateCell(char, 'over').attr('id', 'co_'+li+'_'+ci).appendTo($overlays)\r\n\t\t\t}, this) // /each\r\n\t\t\tif(layer != 'over')\r\n\t\t\t\t$('<br>').appendTo($cells)\r\n\t\t\tif(layer != 'under')\r\n\t\t\t\t$('<br>').appendTo($overlays)\r\n\t\t}, this)\r\n\t\t//initial blink\r\n\t\tif(layer !== 'under')\r\n\t\t\tvar style = this.style;\r\n\t\t\t$('.over').each(animations[style]);\r\n\t\tthis.recount(layer);\r\n\t},\r\n\tenterPaintMode: function() {\r\n\t\t$('#overlays').empty();\r\n\t\t$('#controls').fadeOut();\r\n\t\t$('#editmode').slideDown();\r\n\t\t// $('#nerdmode').slideUp();\r\n\t\t// toggleAnlzOpts()\r\n\t\taudio.stop(function() {\r\n\t\t\t$('#playSwitcher i').removeClass('i-pause-big').addClass('i-play-big')\r\n\t\t});\r\n\t\t$('#cells').on('mousedown mouseenter', '.cell', function(ev) {\r\n\t\t\tif(!brush.mode || (ev.type == 'mouseenter' && ! xBrowserIsMouseDown()/*isMouseDown*/ /*$('body:active').length*/ ) ) return;\r\n\t\t\tif(brush.mode === 'dropper') {\r\n\t\t\t\tvar color = $(this).data('c');\r\n\t\t\t\t$('.swatch').removeClass('selected');\r\n\t\t\t\tif(_.has(Colors, color)) {\r\n\t\t\t\t\t$('#swatch-'+color).addClass('selected');\r\n\t\t\t\t\tbrush.color = color;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tbrush.color = color;\r\n\t\t\t\t\t$('#colorpicker')[0].color.fromString(tinycolor(color).toHexString()) \r\n\t\t\t\t\t$('#colorpicker').addClass('selected');\r\n\t\t\t\t\tif(!$('#dynamic-palette [data-c='+color.toLowerCase()+']').length) {\r\n\t\t\t\t\t\t$('#dynamic-palette').prepend(Grid.generateCell(color, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+color));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar id = $(this).attr('id');\r\n\t\t\t\tvar color = (brush.mode === 'eraser') ? '_' : brush.color;\r\n\t\t\t\t$(this).replaceWith(Grid.generateCell(color, 'under').attr('id', id));\r\n\t\t\t\tif(!_.has(Colors, color) && !$('#dynamic-palette [data-c='+color.toLowerCase()+']').length) \r\n\t\t\t\t\t$('#dynamic-palette').prepend(Grid.generateCell(color, 'under').addClass('swatch').data('act', 'swatch').attr('id', 'swatch-'+color));\r\n\t\t\t\tGrid.lastBuild.pattern = '';\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.$el.parent().addClass('edit-mode');\r\n\t\t$('.triangle-group').slideDown();\r\n\t},\r\n\tbrush: false,\r\n\tsaveState: function(pattern) {\r\n\t\tif(typeof pattern === 'undefined') pattern = this.getPattern();\r\n\t\tthis.pattern = localStorage['customPattern'] = pattern;\r\n\t\tthis.baseStyle = localStorage['lastStyle'] = this.style;\r\n\t\tvar oscMode = $('#osc-sel').val();\r\n\t\tlocalStorage['lastOsc'] = (oscMode === 'custom') ? $('#osc-color').val() : oscMode;\r\n\t},\r\n\texitPaintMode: function() {\r\n\t\t$('#cells').off();\r\n\t\tvar newPattern = this.getPattern();\r\n\t\tthis.lastBuild.pattern = '';\r\n\t\tthis.build(newPattern, 'over');\r\n\t\tthis.$el.parent().removeClass('edit-mode');\r\n\t\t$('.triangle-group').slideUp();\r\n\t\tthis.saveState(newPattern);\r\n\t\t$('#controls').slideDown();\r\n\t\t$('#editmode').slideUp();\r\n\t},\r\n\tgetPattern: function() {\r\n\t\tvar row = 0, code, output = '';\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tif($(this).attr('id').split('_')[1] > row) {\r\n\t\t\t\toutput += '|'; \r\n\t\t\t\trow++;\r\n\t\t\t}\r\n\t\t\tcode = $(this).data('c');\r\n\t\t\tif(code.length > 1) code = '['+code+']';\r\n\t\t\toutput += code; \r\n\t\t})\r\n\t\treturn output;\r\n\t},\r\n\trecount: function(layer) {\r\n\t\tif(typeof layer === 'undefined') layer = $('#grid-wrap').hasClass('edit-mode') ? 'under' : 'over';\r\n\t\tvar lc = (layer === 'under') ? 'under' : 'over';\r\n\t\tvar cells = document.querySelectorAll('.cell.'+lc+':not(.void)');\r\n\t\tif(layer !== 'under') {\r\n\t\t\tthis.cells = cells; \r\n\t\t\t// this.reshuffle();\r\n\t\t\tthis.intoRows();\r\n\t\t\tthis.cellCount = this.cells.length;\r\n\t\t\tthis.trimmingConstant = Math.floor(Math.sqrt(this.cellCount));\r\n\t\t}\r\n\t\t\r\n\t\tvar primaryColor = (function(cc) {return _.invert(cc)[_.max(cc)]})(_.countBy(_.pluck(_.pluck(cells, 'dataset'), 'c')));\r\n\t\tthis.primaryColor = _.has(Colors, primaryColor) ? Colors[primaryColor] : tinycolor(primaryColor).toHexString();\r\n\t\t\r\n\t\tif($('#osc-sel').val() == 'default') \r\n\t\t\tthis.setOsc('default');\r\n\t\t\r\n\t\t// resample layers\r\n\t\tvar selfHeight = this.$el.find('#cells').height(), selfWidth = this.$el.find('#cells').width();\r\n\t\t$('.wrapper-xh').css({'top': ((selfHeight +  conf.topOffset) - conf.barHeight)+'px'});\r\n\t\t$('#shadow').width(selfWidth + 20);\r\n\t\tthis.height = selfHeight / 20;\r\n\t\tthis.width = selfWidth / 20; // where cell is 20×20\r\n\t\tvar _x = this.width, _y = this.height;\r\n\t\t$('#sizeIndicator').text(_x+' × '+_y)\r\n\t},\r\n\t/*reshuffle: function() {\r\n\t\tthis.cellsShuffled = _.shuffle(this.cells); \r\n\t},\r\n\trareShuffle: function() {\r\n\t\tthis.shuffler.do(this.reshuffle.bind(this))\r\n\t},*/\r\n\tflash: function(i) {\r\n\t\tif(i+1 <= this.cellCount)\r\n\t\t\tthis.cells[i]._tl.progress(0);\r\n\t},\r\n\tintoRows: function() {\r\n\t\tlet cellsArranged = []\r\n\t\tArray.prototype.forEach.call(this.cells, cell => {\r\n\t\t\tlet [_, y, x] = cell.getAttribute('id').split('_')\r\n\t\t\tif (! cellsArranged[y]) {\r\n\t\t\t\tcellsArranged[y] = []\r\n\t\t\t}\r\n\t\t\tcellsArranged[y][x] = cell\r\n\t\t})\r\n\t\tthis.cellsArranged = cellsArranged.reverse()\r\n\t},\r\n\tflashXY: function(x, y) {\r\n\t\tlet cellY = this.cellsArranged[y]\r\n\t\tif (!cellY) return;\r\n\t\tlet cell = cellY[x]\r\n\t\tif (cell && cell.hasOwnProperty('_tl')) {\r\n\t\t\tcell._tl.progress(0)\r\n\t\t}\r\n\t},\r\n\tflashRow: function(y) {\r\n\t\tlet cellY = this.cellsArranged[y]\r\n\t\tif (!cellY) return;\r\n\t\tlet i = 0\r\n\t\twhile (i < this.flashDensity) {\r\n\t\t\tlet cell = cellY[Math.floor(Math.random() * cellY.length)]\r\n\t\t\tif (cell && cell.hasOwnProperty('_tl')) {\r\n\t\t\t\tcell._tl.progress(0)\r\n\t\t\t}\r\n\t\t\ti++\r\n\t\t}\r\n\t},\r\n\tflashDensity: 1,\r\n\t/*flashRow: function(y) {\r\n\t\tif (this.cellsArranged[y] && this.cellsArranged[y].length)\r\n\t\t\tthis.cellsArranged[y].forEach(cell => {\r\n\t\t\t\tif (cell.hasOwnProperty('_tl'))\r\n\t\t\t\t\tcell._tl.progress(0)\r\n\t\t\t})\r\n\t},*/\r\n\t/*fuzzyFlash: function(i) {\r\n\t\tif(i+1 <= this.cellCount)\r\n\t\t\tif(Math.random() > conf.flashFuzziness)\r\n\t\t\t\tthis.cells[i]._tl.progress(0);\r\n\t\t\telse {\r\n\t\t\t\tthis.cellsShuffled[i]._tl.progress(0);\r\n\t\t\t}\r\n\t},*/\r\n\tresample: function(direction, amount, layer) {\r\n\t\tvar pattern = this.getPattern();\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\tvar output = [];\r\n\t\tif(isNaN(amount) || amount === 0) return;\r\n\t\tif(amount < 0) {\r\n\t\t\tvar _remove = _.includes(['left', 'top'], direction) ? _.drop : _.dropRight;\r\n\t\t\tif(_.includes(['left', 'right'], direction)) \r\n\t\t\t\toutput = _.map(lines, function(line) { \r\n\t\t\t\t\tvar chars = _.compact(line.split(colorMatchSqBr));\r\n\t\t\t\t\treturn _remove(chars, (-amount)).join('') \r\n\t\t\t\t});\r\n\t\t\telse \r\n\t\t\t\toutput = _remove(lines, (-amount));\r\n\t\t}\r\n\t\tif(amount > 0) {\r\n\t\t\tif(direction == 'left')\r\n\t\t\t\toutput = _.map(lines, function(line) { return _.repeat('_', amount)+line });\r\n\t\t\tif(direction == 'right')\r\n\t\t\t\toutput = _.map(lines, function(line) { return line+_.repeat('_', amount) });\r\n\t\t\tif(_.includes(['top', 'bottom'], direction)) {\r\n\t\t\t\tvar  linelength = _.compact(_.max(lines, function(line) { \r\n\t\t\t\t\treturn _.compact(line.split(colorMatch)).length \r\n\t\t\t\t}).split(colorMatch)).length;\r\n\t\t\t\tvar add = _.times(amount, function() { return _.repeat('_', linelength) });\r\n\t\t\t\toutput = (direction == 'top') ? add.concat(lines) : lines.concat(add);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.build(output.join('|'), layer)\r\n\t},\r\n\trandomfill: function() {\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tvar color = Math.random() >= 0.5 ? tinycolor.random().toHexString() : '_';\r\n\t\t\tvar id = $(this).attr('id');\r\n\t\t\t$(this).replaceWith(Grid.generateCell(color, 'under').attr('id', id));\r\n\t\t});\r\n\t},\r\n\tclear: function() {\r\n\t\tthis.$el.find('.cell.under').each(function() {\r\n\t\t\tvar id = $(this).attr('id');\r\n\t\t\t$(this).replaceWith(Grid.generateCell('_', 'under').attr('id', id));\r\n\t\t});\r\n\t},\r\n\tfromCanvas: function() {\r\n\t\tvar h = bufferCanvas.height, w = bufferCanvas.width;\r\n\t\tvar x, y, px, output = \"\";\r\n\t\tfor(y=0; y < h; y++) {\r\n\t\t\tfor(x=0; x < w; x++) {\r\n\t\t\t\tpx = bufferContext.getImageData(x, y, 1, 1).data;\r\n\t\t\t\toutput += '[rgba(' + px[0] + ',' + px[1] + ',' + px[2] + ',' + px[3] + ')]';\r\n\t\t\t}\r\n\t\t\tif(y != (h-1)) output += '|';\r\n\t\t}\r\n\t\tthis.build(output)\r\n\t},\r\n\tdownloadPattern: function() {\r\n\t\t$('#bufferLink').attr('href', this.toCanvas())[0].click();\r\n\t},\r\n\ttoCanvas: function(pattern, width, height) {\r\n\t\tif(typeof width === \"undefined\") width = this.width;\r\n\t\tif(typeof height === \"undefined\") height = this.height;\r\n\t\tbufferCanvas.width = width;\r\n\t\tbufferCanvas.height = height;\r\n\t\tif(typeof pattern === 'undefined')\r\n\t\t\tpattern = this.getPattern();\r\n\t\tvar output = new Uint8ClampedArray(width * height * 4);\r\n\t\tvar i=0, j;\r\n\t\tvar lines = pattern.split(/[|\\/]/);\r\n\t\t_.each(lines, function(line, li) {\r\n\t\t\tvar chars = _.compact(line.split(colorMatch));\r\n\t\t\tif(chars.length < width) {\r\n\t\t\t\tlet offset = width - chars.length\r\n\t\t\t\t, offsetLeft = Math.floor(offset/2)\r\n\t\t\t\t, offsetRight = Math.ceil(offset/2)\r\n\t\t\t\t_.times(offsetLeft, function() {\r\n\t\t\t\t\tchars.unshift('_');\r\n\t\t\t\t});\r\n\t\t\t\t_.times(offsetRight, function() {\r\n\t\t\t\t\tchars.push('_');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t_.each(chars, function(char, ci) {\r\n\t\t\t\tvar color = _.has(Colors, char) ? tinycolor((Colors[char] == \"_VOID_\") ? 'rgba(0,0,0,0)': Colors[char]) : tinycolor(char.replace(/[\\[\\]]/g, ''));\r\n\t\t\t\tj = i*4;\r\n\t\t\t\toutput[j] = color._r;\r\n\t\t\t\toutput[j+1] = color._g;\r\n\t\t\t\toutput[j+2] = color._b;\r\n\t\t\t\toutput[j+3] = color._a*255;\r\n\t\t\t\ti++;\r\n\t\t\t})\r\n\t\t});\r\n\t\t_debug_ = {\r\n\t\t\toutput: output,\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t}\r\n\t\tbufferContext.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);\r\n\t\tlet imageData = bufferContext.createImageData(width, height);\r\n\t\timageData.data.set(output);\r\n\t\tbufferContext.putImageData(imageData, 0, 0);\r\n\t\treturn bufferCanvas.toDataURL('image/png');\r\n\t}\r\n};\r\n\r\nvar _debug_;\r\n\r\nvar brush = {\r\n\tmode: false,\r\n\tcolor: 'J'\r\n};\r\n\r\nfunction _test(N) {\r\n\tfor (var i = 0; i < N; i++) {\r\n\t\tsetInterval(function() {Grid.flash(_.random(0, Grid.cellCount-1))}, _.random(400, 3000))\r\n\t};\r\n}\r\n\r\nconst ranges = {\r\n\tdefaults: {\r\n\t\tfreq: [0, 18000],\r\n\t\tdb: [-120, 0],\r\n\t\tsmoothing: 0.1,\r\n\t\ttreshold: 1.5\r\n\t},\r\n\tcurrent: {},\r\n\tinit: function() {\r\n\t\tthis.freq = $(\"#frequency_range\").ionRangeSlider({\r\n\t\t\ttype: 'double',\r\n\t\t\tmin: 0, \r\n\t\t\tmax: this.sampleRate/2,\r\n\t\t\tmin_interval: 1000,\r\n\t\t\tdrag_interval: true,\r\n\t\t\tgrid_num: 6,\r\n\t\t\tvalues_separator: '...',\r\n\t\t\tgrid: true,\r\n\t\t\tfrom: this.defaults.freq[0],\r\n\t\t\tto: this.defaults.freq[1],\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.freq = [data.from, data.to]\r\n\t\t\t\tthis.current.numSamples = this.hz2samples(data.to - data.from)\r\n\t\t\t\tthis.current.sampleOffset = this.hz2samples(data.from)\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.db = $(\"#dynamic_range\").ionRangeSlider({\r\n\t\t\ttype: 'double',\r\n\t\t\tmin: -200, \r\n\t\t\tmax: 0,\r\n\t\t\tfrom: this.defaults.db[0],\r\n\t\t\tto: this.defaults.db[1],\r\n\t\t\tmin_interval: 10,\r\n\t\t\tgrid_num: 5,\r\n\t\t\tvalues_separator: '...',\r\n\t\t\tdrag_interval: true,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.db = [data.from, data.to]\r\n\t\t\t\tvisualizer.analyser.minDecibels = data.from\r\n\t\t\t\tvisualizer.analyser.maxDecibels = data.to\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.smoothing = $('#smoothing').ionRangeSlider({\r\n\t\t\tmin: 0, \r\n\t\t\tmax: 1,\r\n\t\t\tstep: 0.01,\r\n\t\t\tfrom: this.defaults.smoothing,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.smoothing = data.from\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.treshold = $('#treshold').ionRangeSlider({\r\n\t\t\tmin: 0.5, \r\n\t\t\tmax: 3,\r\n\t\t\tstep: 0.01,\r\n\t\t\tgrid_num: 5,\r\n\t\t\tfrom: this.defaults.treshold,\r\n\t\t\tgrid: true,\r\n\t\t\tonChange: data => {\r\n\t\t\t\tthis.current.treshold = data.from\r\n\t\t\t}\r\n\t\t}).data('ionRangeSlider')\r\n\t\tthis.sync()\r\n\t},\r\n\tget sampleRate() {\r\n\t\ttry {\r\n\t\t\treturn audio.context.sampleRate\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\treturn 48000\r\n\t\t}\r\n\t},\r\n\tget fftSize() {\r\n\t\ttry {\r\n\t\t\treturn visualizer.analyser.fftSize\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\treturn conf.fftSize\r\n\t\t}\r\n\t},\r\n\thz2samples: function(hz) { return Math.round(hz / (this.sampleRate/this.fftSize)) },\r\n\tsamples2hz: function(samples) { return Math.round(samples * (this.sampleRate/this.fftSize))},\r\n\tsync: function(settings = {}) {\r\n\t\tsettings = _.defaults(settings, this.defaults)\r\n\t\tthis.freq.update({\r\n\t\t\tmax: this.sampleRate/2,\r\n\t\t\tfrom: settings.freq[0],\r\n\t\t\tto: settings.freq[1]\r\n\t\t})\r\n\t\tthis.db.update({\r\n\t\t\tfrom: settings.db[0],\r\n\t\t\tto: settings.db[1]\r\n\t\t})\r\n\t\tthis.smoothing.update({\r\n\t\t\tfrom: settings.smoothing\r\n\t\t})\r\n\t\tthis.treshold.update({\r\n\t\t\tfrom: settings.treshold\r\n\t\t})\r\n\t\t;['freq', 'db', 'smoothing', 'treshold'].forEach(prop => this[prop].callOnChange())\r\n\t}\r\n}\r\n\r\n/* A U D I O */ \r\nvar audio = {\r\n\tbuffer: {},\r\n\tcompatibility: {},\r\n\tsupported: true,\r\n\tsource_loop: {},\r\n\tsource_once: {},\r\n\tdisabled: true\r\n};\r\n\r\nvar currentLoop = {};\r\n\r\nvar expectedLoop;\r\n\r\naudio.stop = function(callback) {\r\n\tif(audio.source_loop._playing) {\r\n\t\tTweenLite.to(gainNode.gain, 0.2, {value: 0, onComplete: function() {\r\n\t\t\taudio.source_loop[audio.compatibility.stop](0);\r\n\t\t\taudio.source_loop._playing = false;\r\n\t\t\taudio.source_loop._startTime = 0;\r\n\t\t\tif (audio.compatibility.start === 'noteOn') {\r\n\t\t\t\taudio.source_once[audio.compatibility.stop](0);\r\n\t\t\t}\r\n\t\t\tif(typeof callback === \"function\") callback();\r\n\t\t}});\r\n\t\t$('.wrapper-decor').fadeOut();\r\n\t}   \r\n\telse if(typeof callback === \"function\") callback();\r\n}\r\n\r\naudio.loadLoop = function(immed, loop) {\r\n\taudio.disabled = true;\r\n\tvar newLoop = {};\r\n\tif(typeof loop === 'object') {\r\n\t\tnewLoop = loop;\r\n\t}\r\n\telse return console.log('unsupported')\r\n\r\n\tvar req = new XMLHttpRequest();\r\n\t\r\n\tvar expectedToken = ''+loop.original_hash+(new Date().getTime());\r\n\texpectedLoop = expectedToken;\r\n\t\t\r\n\treq.onload = function() {\r\n\t\tif(expectedToken === expectedLoop)\r\n\t\taudio.context.decodeAudioData(\r\n\t\t\treq.response,\r\n\t\t\tfunction(buffer) {\r\n\t\t\t\tranges.sync(newLoop)\r\n\t\t\t\taudio.buffer = buffer;\r\n\t\t\t\taudio.source_loop = {};\r\n\t\t\t\tcurrentLoop  = newLoop;\r\n\t\t\t\taudio.disabled = false;\r\n\t\t\t\tif(immed) audio.play();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\taudio.stop(function() {\r\n\t\treq.open('GET', urlprefix+loop.section+'/'+loop.original_hash+'.'+fileFormat, true);\r\n\t\treq.responseType = 'arraybuffer';\r\n\t\treq.send();\r\n\t})\r\n}\r\n\r\ntry {\r\n\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\taudio.context = new window.AudioContext();\r\n} catch(e) {\r\n\taudio.supported = false;\r\n}\r\n\r\nvar visualizer = {}, gainNode;\r\n\r\nif(audio.supported) {\r\n\t(function() {\r\n\t\tvar start = 'start',\r\n\t\t\tstop = 'stop',\r\n\t\t\tbuffer = audio.context.createBufferSource();\r\n\t\tif (typeof buffer.start !== 'function') {\r\n\t\t\tstart = 'noteOn';\r\n\t\t}\r\n\t\taudio.compatibility.start = start;\r\n\t\tif (typeof buffer.stop !== 'function') {\r\n\t\t\tstop = 'noteOff';\r\n\t\t}\r\n\t\taudio.compatibility.stop = stop;\r\n\t})();\r\n\tgainNode = audio.context.createGain();\r\n\tgainNode.gain.value = 1;\r\n\tvisualizer = new VisualizerSample();\r\n\tgainNode.connect(visualizer.analyser);\r\n}\r\n\r\naudio.play = function() {\r\n\tTweenLite.to(gainNode.gain, 0, {value: 1});\r\n\tif(audio.disabled) return AllTracks.random();\r\n\r\n\tif (audio.source_loop._playing) {\r\n\t\taudio.stop();\r\n\t\t$('#playSwitcher i').removeClass('i-pause-big').addClass('i-play-big')\r\n\t} \r\n\telse {\r\n\t\t$('.wrapper-decor').fadeIn();\r\n\r\n\t\taudio.source_loop = audio.context.createBufferSource();\r\n\t\taudio.source_loop.buffer = audio.buffer;\r\n\t\taudio.source_loop.loop = true;\r\n\t\taudio.source_loop.connect(gainNode);\r\n \r\n\t\tif (audio.compatibility.start === 'noteOn') {\r\n\t\t\taudio.source_once = audio.context.createBufferSource();\r\n\t\t\taudio.source_once.buffer = audio.buffer;\r\n\t\t\taudio.source_once.connect(gainNode);\r\n\t\t\taudio.source_once.noteGrainOn(0, 0, audio.buffer.duration);\r\n\r\n\t\t\taudio.source_loop[audio.compatibility.start](audio.buffer.duration);\r\n\t\t} else {\r\n\t\t\taudio.source_loop[audio.compatibility.start](0, 0);\r\n\t\t}\r\n\t\taudio.source_loop._playing = true;\r\n\r\n\t\tif(!visualizer._drawing) {\r\n\t\t\tframe(visualizer.draw.bind(visualizer));\r\n\t\t\tvisualizer._drawing = true;\r\n\t\t}\r\n\t\t$('#playSwitcher i').removeClass('i-play-big').addClass('i-pause-big')\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nvar frame = (function() {\r\nreturn  window.requestAnimationFrame || \r\n\twindow.webkitRequestAnimationFrame || \r\n\twindow.mozRequestAnimationFrame    || \r\n\twindow.oRequestAnimationFrame      || \r\n\twindow.msRequestAnimationFrame     || \r\n\tfunction( callback ) {\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t};\r\n})();\r\n\r\nfunction record_mode() {\r\n  conf.topOffset = 110\r\n  Grid.recount()\r\n  injector.inject('recmode', `#grid-wrap {  margin-top: 66px } .player-controls {opacity: 0} .player-controls:hover {opacity: 1}`)\r\n}\r\n\r\nfunction logIfDown() {\r\n  if (xBrowserIsMouseDown()) {\r\n      console.dir.apply(this, arguments)\r\n  }\r\n}\r\n\r\nfunction VisualizerSample() {\r\n\tthis.analyser = audio.context.createAnalyser();\r\n\r\n\tthis.analyser.connect(audio.context.destination);\r\n\t/*this.analyser.minDecibels = conf.minDecibels;\r\n\tthis.analyser.maxDecibels = 0;*/\r\n\ttry {\r\n\t\tthis.analyser.fftSize = conf.fft_size;\r\n\t\t$('label[for=fft_size] .indicator').removeClass('illegal')\r\n\t}\r\n\tcatch(e) {\r\n\t\t$('label[for=fft_size] .indicator').addClass('illegal')\r\n\t}\r\n\tthis.samples = new Uint8Array(this.analyser.frequencyBinCount);\r\n}\r\nconst channel = {\r\n\tinit: function() {\r\n\t\tthis.canvas = $('#samplecanvas')[0]\r\n\t\tthis.ctx = this.canvas.getContext('2d')\r\n\t\tthis.canvas.width = conf.fft_size / 2\r\n\t},\r\n\tdebugOn: false,\r\n\thistory: [],\r\n\tcurrent: [],\r\n\t// Main function (input + getJumps). Takes spectrum, returns jumps, draws debug graph\r\n\ttick: function(spectrum) {\r\n\t\tlet numSamples = ranges.current.numSamples\r\n\t\t, offset = ranges.current.sampleOffset\r\n\t\t, numBands = Grid.height\r\n\t\t, bands = []\r\n\t\t, bandWidths = []\r\n\t\t, spectrumLength = spectrum.length\r\n\t\t// Fill\r\n\t\tfor (let i = 0; i < spectrumLength; i++) {\r\n\t\t\tif (i >= offset && i < offset + numSamples) { // For all bands in analysis range\r\n\t\t\t\tlet n = i - offset, bandNum\r\n\r\n\t\t\t\tif (this.debugOn) {\r\n\t\t\t\t\tthis.ctx.fillStyle = conf.lightWave\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// determaine which to which band the sample goes\r\n\t\t\t\tif (conf.distributionLaw === 'quadratic')\r\n\t\t\t\t\tbandNum = Math.floor(numBands * Math.abs(Math.pow(n/(numSamples), 2)))\r\n\t\t\t\telse if (conf.distributionLaw === 'reverse-quadratic') //do not use (please)\r\n\t\t\t\t\tbandNum = numBands - Math.floor(numBands * Math.abs(Math.pow((numSamples-n)/(numSamples), 2)))\r\n\t\t\t\telse //linear\r\n\t\t\t\t\tbandNum = Math.floor(n / (numSamples / numBands))\r\n\r\n\t\t\t\tif (!bandWidths[bandNum]) {\r\n\t\t\t\t\tbands[bandNum] = 0;\r\n\t\t\t\t\tbandWidths[bandNum] = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet sample = Math.min(Math.abs(spectrum[i] / 256), 1)\r\n\t\t\t\t// , lastHistoryRecord = _.last(this.history)\r\n\t\t\t\t// , treshold = lastHistoryRecord ? lastHistoryRecord[bandNum] : conf.absoluteTreshold\r\n\r\n\t\t\t\tif (sample < conf.absoluteTreshold) {\r\n\t\t\t\t\tsample = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbands[bandNum] += sample;\r\n\t\t\t\tbandWidths[bandNum] += 1;\r\n\t\t\t}\r\n\t\t\telse if(this.debugOn) { // for samples outside analysis range, draw them darker\r\n\t\t\t\tthis.ctx.fillStyle = conf.darkWave\r\n\t\t\t}\r\n\t\t\tif(this.debugOn) { // building sample graph\r\n\t\t\t\tlet barHeight = Math.round(100 * (spectrum[i] / 256))\r\n\t\t\t\tif (barHeight)\r\n\t\t\t\t\tthis.ctx.fillRect(i, 100-barHeight, 1, barHeight)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Normalize\r\n\t\tfor (let i = 0; i < numBands; i++) {\r\n\t\t\tif (bandWidths[i] > 0) {\r\n\t\t\t\tbands[i] /= bandWidths[i];\r\n\t\t\t} else {\r\n\t\t\t\tbands[i] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.current) {\r\n\t\t\tthis.history.push(this.current);\r\n\t\t}\r\n\r\n\t\twhile (this.history.length > conf.historySize) {\r\n\t\t\tthis.history.shift();\r\n\t\t}\r\n\r\n\t\tthis.current = bands;\r\n\r\n\t\t// ----------- input() function end; getJumps() function begin -----------\r\n\t\tlet average = []\r\n\t\t, jumps = []\r\n\r\n\t\t// Get historical averages for bands\r\n\t\tfor (let i = 0; i < this.history.length; i++) {\r\n\t\t\tfor (let band = 0; band < numBands; band++) {\r\n\t\t\t\tif (!average[band]) {\r\n\t\t\t\t\taverage[band] = 0;\r\n\t\t\t\t}\r\n\t\t\t\taverage[band] += this.history[i][band];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet offsetLeft = offset // reset canvas' x-coordinate counter\r\n\r\n\t\tfor (let band = 0; band < numBands; band++) {\r\n\t\t\t// normalize\r\n\t\t\tif (average[band] > 0) {\r\n\t\t\t\taverage[band] /= this.history.length;\r\n\t\t\t} else {\r\n\t\t\t\taverage[band] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.debugOn) {\r\n\t\t\t\tthis.ctx.fillStyle = band%2 ? 'green': 'purple'\r\n\t\t\t\tthis.ctx.fillRect(offsetLeft, 100, bandWidths[band], 3)\r\n\t\t\t\tthis.ctx.fillRect(offsetLeft, 103, bandWidths[band], bands[band]*57)\r\n\t\t\t}\r\n\r\n\t\t\tif (this.current[band] > average[band] * ranges.current.treshold) {\r\n\t\t\t\tjumps[band] = 1;\r\n\t\t\t\t// Show jumps on graph\r\n\t\t\t\tif (this.debugOn) {\r\n\t\t\t\t\tthis.ctx.fillStyle = band%2 ? 'lime': 'magenta'\r\n\t\t\t\t\tthis.ctx.fillRect(offsetLeft, 105 + bands[band]*57 - 4, bandWidths[band], 4)\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\telse {\r\n\t\t\t\tjumps[band] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.debugOn) {\r\n\t\t\t\toffsetLeft += bandWidths[band]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn jumps\r\n\t}\r\n}\r\n\r\nVisualizerSample.prototype.draw = function() {\r\n\tthis.analyser.smoothingTimeConstant = ranges.current.smoothing;\r\n\r\n\tthis.analyser.getByteFrequencyData(this.samples);\r\n\r\n\tif(conf.osc)\r\n\t\tdrawContext.clearRect(0,0,conf.barWidth,conf.barHeight);\r\n\t\r\n\tfor (var i = 0; i < this.analyser.frequencyBinCount; i++) {\r\n\t\tvar value = this.samples[i];\r\n\t\tvar percent = value / 256;\r\n\r\n\t\t/*if(percent > (conf.treshold + conf.tresholdCorrection) && Math.random() < conf.flashProbability)\r\n\t\t\tGrid.fuzzyFlash(i)*/\r\n\r\n\t\tif(conf.osc) {\r\n\t\t\tvar height = conf.barHeight * percent;\r\n\t\t\tvar y = Math.ceil(conf.barHeight - height);\r\n\t\t\tdrawContext.fillRect(i*4, y, 2, height);\r\n\t\t}\r\n\t}\r\n\r\n\tif (channel.debugOn)\r\n\t\tchannel.ctx.clearRect(0, 0, conf.fft_size, 205)\r\n\r\n\t/*channel.input(this.samples, ranges.current.numSamples, ranges.current.sampleOffset)\r\n\tlet jumps = channel.getJumps()*/\r\n\tlet jumps = channel.tick(this.samples)\r\n\tfor (let i = 0; i < Grid.height; i++) {\r\n\t\tif (!jumps[i]) continue;\r\n\t\t// Grid.flashRow(i)\r\n\t\tGrid.flashRow(/*Math.floor(Math.random() * Grid.width),*/ i);\r\n\t}\r\n\r\n\t// Grid.rareShuffle();\r\n\r\n\tframe(this.draw.bind(this));\r\n}\r\n\r\n\r\n\r\nVisualizerSample.prototype.getFrequencyValue = function(freq) {\r\n\tvar nyquist = audio.context.sampleRate/2;\r\n\tvar index = Math.round(freq/nyquist * this.freqs.length);\r\n\treturn this.freqs[index];\r\n}\r\n\r\nfunction Rarity(trim) {\r\n\tthis.n = 0;\r\n\tthis.trim = trim;\r\n\tthis.do = function(fn) {\r\n\t\tif(this.n >= this.trim) {\r\n\t\t\tfn();\r\n\t\t\tthis.n = 0;\r\n\t\t}\r\n\t\telse this.n++;\r\n\t}\r\n}\r\n\r\nfunction handleFileDrop(evt) {\r\n\thandleFile(evt, \"drop\");\r\n}\r\nfunction handleFileInput(evt) {\r\n\thandleFile(evt, \"input\");\r\n}\r\n\r\nvar currentCustomTrack = {\r\n\tname: null,\r\n\tftype: null,\r\n\tbuffer: null,\r\n\tblob: null\r\n}\r\n\r\nfunction handleFile(evt, type) {\r\n\tevt.stopPropagation();\r\n\tevt.preventDefault();\r\n\r\n\tvar files = (type == \"drop\") ? evt.dataTransfer.files : evt.target.files;\r\n\tvar f = files[0];\r\n\r\n\tif (f.type.match('image.*')) {\r\n\t\tvar reader = new FileReader();\r\n\t\t\r\n\t\treader.onload = (function(theFile) {\r\n\t\t\treturn function(e) {\r\n\t\t\t\tvar dataUrl = e.target.result;\r\n\t\t\t\ttoCanvas(dataUrl);\r\n\t\t\t\t$('#pattern-share .filename').val(f.name.match(/(.+?)\\.([a-z0-9_]+$)/i)[1])\r\n\t\t\t};\r\n\t\t})(f);\r\n\r\n\t\treader.readAsDataURL(f);\r\n\t}\r\n\r\n\telse if(f.type.match('audio.*')) {\r\n\t\tvar reader = new FileReader();\r\n\t\t\r\n\t\treader.onload = (function(theFile) {\r\n\t\t\treturn function(e) {\r\n\t\t\t\tcurrentCustomTrack.buffer = e.target.result;\r\n\t\t\t\tcurrentCustomTrack.ftype = f.type;\r\n\t\t\t\t//prevent Firefox bug (decoding audio buffer empties it)\r\n\t\t\t\tcurrentCustomTrack.blob = new Blob([currentCustomTrack.buffer], { type: currentCustomTrack.ftype });\r\n\t\t\t\tcurrentCustomTrack.name = f.name.match(/(.+?)\\.([a-z0-9_]+$)/i)[1];\r\n\t\t\t\t$('#loop-upload .filename').val(currentCustomTrack.name);\r\n\t\t\t\tloopEditor.add();\r\n\t\t\t\taudio.context.decodeAudioData(\r\n\t\t\t\t\tcurrentCustomTrack.buffer,\r\n\t\t\t\t\tfunction(buffer) {\r\n\t\t\t\t\t\tranges.sync()\r\n\t\t\t\t\t\taudio.stop(function() {\r\n\t\t\t\t\t\t\taudio.buffer = buffer;\r\n\t\t\t\t\t\t\tcurrentLoop.fileName = currentCustomTrack.name;\r\n\t\t\t\t\t\t\taudio.disabled = false;\r\n\t\t\t\t\t\t\taudio.play();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(error) {\r\n\t\t\t\t\t\tconsole.error(\"Ошибка при декодировании аудио\", error)\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t};\r\n\t\t})(f);\r\n\r\n\t\treader.readAsArrayBuffer(f);\r\n\t}\r\n\r\n\telse {\r\n\t\talert('Дропнутый файл не является ни картинкой, ни аудиофайлом.')\r\n\t}\r\n\t\r\n\treturn false\r\n}\r\nfunction handleDragOver(evt) {\r\n\tevt.stopPropagation();\r\n\tevt.preventDefault();\r\n\tevt.dataTransfer.dropEffect = 'copy';\r\n}\r\nfunction toCanvas(dataURL) {\r\n\tvar imageObj = new Image();\r\n\timageObj.onload = function() {\r\n\t\tbufferCanvas.height = this.height;\r\n\t\tbufferCanvas.width = this.width;\r\n\t\tbufferContext.drawImage(this, 0, 0);\r\n\t\tGrid.fromCanvas();\r\n\t};\r\n\timageObj.src = dataURL;\r\n}\r\n\r\nfunction dataURItoBlob(dataURI) {\r\n  var arr = dataURI.split(','), mime = arr[0].match(/:(.*?);/)[1];\r\n  return new Blob([atob(arr[1])], {type:mime});\r\n}\r\n\r\nfunction TrackList(tracklist, sel, id, flat, $sortButton, sortBy, order, playEnabled, $playEnabler) {\r\n\tthis.$el = $(sel);\r\n\tthis.id = id;\r\n\tthis.isFlat = !!flat;\r\n\r\n\tthis.playEnabled = playEnabled;\r\n\tthis.$playEnabler = $playEnabler;\r\n\tthis.$playEnabler.addClass(this.playEnabled ? 'i-play-enabled' : 'i-play-disabled');\r\n\tthis.$playEnabler.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.playEnabled = !this.playEnabled;\r\n\t\tthis.$playEnabler.toggleClass('i-play-enabled i-play-disabled');\r\n\t\tAllTracks.populate(this.id, this.flatList, this.playEnabled);\r\n\t}).bind(this))\r\n\r\n\t// builds tracklist, sorted\r\n\tthis.build = function() {\r\n\t\tvar html = '';\r\n\r\n\t\tif(this.isFlat) {\r\n\t\t\thtml += '<div class=\"tracklist-section\" data-flat=\"1\" data-section=\"'+this.id+'\" data-id=\"'+this.id+'\">';\r\n\t\t\thtml += this.buildSection(this.list, this.id);\r\n\t\t\thtml += '</div>';\r\n\t\t}\r\n\t\telse\r\n\t\t\t_.each(this.list, function(section, sectIndex) {\r\n\t\t\t\thtml += '<div class=\"tracklist-section\" data-flat=\"0\" data-section=\"'+section.sectID+'\" data-id=\"'+this.id+'\">';\r\n\t\t\t\thtml += '<h3 class=\"tls-title\">'+section.title+'</h3>';\r\n\t\t\t\thtml += this.buildSection(section.contents, section.sectID);\r\n\t\t\t\thtml += '</div>';\r\n\t\t\t}, this);\r\n\t\tthis.$el.html(html);\r\n\t\tAllTracks.populate(this.id, this.flatList, this.playEnabled);\r\n\t}\r\n\r\n\tthis.scrollAdded = false;\r\n\r\n\t// builds flat tracklist or its section\r\n\tthis.buildSection = function(list, sectID) {\r\n\t\torder = (typeof this.sortOrder === 'undefined') ? true : ((typeof this.sortOrder === 'string') ? ((this.sortOrder === 'asc') ? true : false) : this.sortOrder);\r\n\t\tvar sortedList = _.sortByOrder(list, [this.sortBy, \"id\"], [order, order])\r\n\t\t, html = ''\r\n\t\t, foradmin = (this.id === 'default') ? ' foradmin-show' : '';\r\n\r\n\t\t_.each(sortedList, function(entry) {\r\n\t\t\tif(entry) {\r\n\t\t\t\tvar swfName = (entry.hasOwnProperty('swf') && entry.swf) ? entry.swf.split('/').reverse()[0] : false\r\n\t\t\t\t, swfLink = swfName ? '<a target=\"_blank\" href=\"loops/swf/'+entry.swf+'\" download=\"'+swfName+'\" class=\"dlo-dlbutton dlb-swf\" title=\"Скачать оригинальный SWF\"><i class=\"i-download-menu\"></i> SWF</a> ' : ''\r\n\t\t\t\t, swfClass = swfName ? ' with-swf' : ''\r\n\t\t\t\t, fresh = (entry.hasOwnProperty('fresh') && entry.fresh) ? ' fresh' : ''\r\n\t\t\t\t, isPlaying = (currentLoop.hasOwnProperty('original_hash') && currentLoop.original_hash === entry.original_hash) ? ' playing' : ''\r\n\t\t\t\t, safeName = _.escape(entry.name)\r\n\t\t\t\t\r\n\t\t\t\thtml += \r\n\t\t\t\t'<div class=\"track'+swfClass+isPlaying+fresh+'\" data-name=\"'+safeName.toLowerCase()+'\" data-hash=\"'+entry.original_hash+'\">\\\r\n\t\t\t\t\t<i class=\"i-play\"></i>\\\r\n\t\t\t\t\t<div class=\"track-name\">'+safeName+'</div>\\\r\n\t\t\t\t\t<div class=\"download-options\">'\r\n\t\t\t\t\t\t+swfLink+\r\n\t\t\t\t\t\t'<a target=\"_blank\" href=\"loops/'+sectID+'/'+entry.original_hash+'.mp3\" download=\"'+safeName+'.mp3\" class=\"dlo-dlbutton dlb-mp3\"><i class=\"i-download-menu\"></i> MP3</a>\\\r\n\t\t\t\t\t\t<a target=\"_blank\" href=\"loops/'+sectID+'/'+entry.original_hash+'.ogg\" download=\"'+safeName+'.ogg\" class=\"dlo-dlbutton dlb-ogg\"><i class=\"i-download-menu\"></i> OGG</a>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class=\"edit-options\">\\\r\n\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-delete\"><i class=\"i-x-small\"></i> Удалить</a>\\\r\n\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-edit\"><i class=\"i-edit\"></i> Править</a>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t\t<div class=\"track-duration\">'+entry.duration+'</div>\\\r\n\t\t\t\t\t<div class=\"track-options\">\\\r\n\t\t\t\t\t\t<i class=\"i-download-menu\"></i><i class=\"i-burger'+foradmin+'\"></i>\\\r\n\t\t\t\t\t</div>\\\r\n\t\t\t\t</div>';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}, this);\r\n\r\n\t\treturn html;\r\n\t}\r\n\r\n\t// add track\r\n\tthis.add = function(track) {\r\n\t\ttrack = this.processList([track])[0];\r\n\t\ttrack.fresh = true;\r\n\t\tif(this.isFlat) {\r\n\t\t\tthis.list.push(track);\r\n\t\t\tthis.flatList = this.list;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t_.find(this.list, {sectID: track.section}).contents.push(track);\r\n\t\t\tthis.flatList = _.flatten(_.pluck(this.list, 'contents'))\r\n\t\t}\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tthis.edit = function(track) {\r\n\t\tthis.del(track.original_hash, track.section_from || track.section, true);\r\n\t\tthis.add(track);\r\n\t}\r\n\r\n\tthis.del = function(ohash, section, nobuild) {\r\n\t\tif(typeof nobuild === 'undefined') nobuild = false;\r\n\t\tif(this.isFlat) \r\n\t\t\t_.remove(this.list, {original_hash: ohash});\r\n\t\telse \r\n\t\t\t_.remove(_.find(this.list, {sectID: section}).contents, {original_hash: ohash})\r\n\t\t_.remove(this.flatList, {original_hash: ohash});\r\n\t\tif(!nobuild) this.build();\r\n\t}\r\n\r\n\tthis.processList = function(list) {\r\n\t\treturn _.each(list, function(entry) {\r\n\t\t\tif(entry.hasOwnProperty('date') && !entry.date instanceof Date)\r\n\t\t\t\tentry.date = new Date(entry.date);\r\n\t\t\tif(entry.hasOwnProperty('duration') && !isNaN(entry.duration)) {\r\n\t\t\t\tvar totalSecs = +entry.duration;\r\n\t\t\t\tvar minutes = Math.floor(totalSecs/60)+'';\r\n\t\t\t\tif(minutes.length == 1) minutes = '0'+minutes;\r\n\t\t\t\tvar seconds = Math.round(totalSecs%60)+'';\r\n\t\t\t\tif(seconds.length == 1) seconds = '0'+seconds;\r\n\t\t\t\tentry.duration = minutes+':'+seconds;\r\n\t\t\t}\r\n\t\t\t['freq', 'db'].forEach(prop => {\r\n\t\t\t\tif (entry[prop] && typeof entry[prop]=='string')\r\n\t\t\t\t\tentry[prop] = entry[prop].split('~').map(v => +v)\r\n\t\t\t})\r\n\t\t\t;['smoothing', 'treshold'].forEach(prop => {\r\n\t\t\t\tif (entry[prop] && typeof entry[prop]=='string')\r\n\t\t\t\t\tentry[prop] = +entry[prop]\r\n\t\t\t})\r\n\t\t\t\r\n\t\t})\r\n\t}\r\n\r\n\tthis.sortOptions = [\r\n\t\t['date', 'desc', 'i-newfirst', \"Сначала новые\"],\r\n\t\t['date', 'asc', 'i-oldfirst', \"Сначала старые\"],\r\n\t\t['name', 'asc', 'i-a-z', \"По алфавиту\"],\r\n\t\t['name', 'desc', 'i-z-a', \"По алфавиту\"],\r\n\t];\r\n\r\n\tif(this.isFlat) {\r\n\t\tthis.list = this.processList(tracklist);\r\n\t\tthis.flatList = this.list;\r\n\t}\r\n\telse {\r\n\t\tthis.list = _.map(tracklist, function(section) {\r\n\t\t\tvar processedSection = section;\r\n\t\t\tprocessedSection.contents = this.processList(section.contents);\r\n\t\t\treturn processedSection;\r\n\t\t}, this);\r\n\t\tthis.flatList = _.flatten(_.pluck(this.list, 'contents'))\r\n\t}\r\n\r\n\tthis.sortButton = $sortButton;\r\n\tthis.sortButton.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.sort()\r\n\t}).bind(this));\r\n\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\r\n\tthis.sort = function(sortBy, order) {\r\n\t\tvar sort;\r\n\t\tif(typeof sortBy === 'undefined') \r\n\t\t\tthis.sortState++;\r\n\t\telse {\r\n\t\t\tif(typeof order === 'undefined') order = 'asc';\r\n\t\t\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\t\t}\r\n\t\tif(this.sortState < 0 || this.sortState >= this.sortOptions.length)\r\n\t\t\tthis.sortState = 0;\r\n\t\tsort = this.sortOptions[this.sortState];\r\n\t\tthis.sortBy = sort[0];\r\n\t\tthis.sortOrder = sort[1];\r\n\t\tthis.build();\r\n\t\tthis.sortButton.removeClass(_.pluck(this.sortOptions, 2).join(' ')).addClass(sort[2]);\r\n\t\tthis.sortButton.attr('title', sort[3]);\r\n\t}\r\n\r\n\tthis.sort(sortBy, order);\r\n\r\n\tthis.playTrackByHash = function(hash, disableAssociation) {\r\n\t\tif(typeof disableAssociation === 'undefined') disableAssociation = false;\r\n\t\tvar track = _.filter(this.flatList, {original_hash: ''+hash})[0];\r\n\t\tif(track) {\r\n\t\t\taudio.loadLoop(true, track);\r\n\t\t\t$('.track').removeClass('playing');\r\n\t\t\t$('.track[data-hash='+hash+']').addClass('playing');\r\n\t\t\tif(conf.association && !disableAssociation) {\r\n\t\t\t\tif(+track.associated_pattern) {\r\n\t\t\t\t\t_.each(patternLibs, function(lib) {\r\n\t\t\t\t\t\tlib.applyPatternByID(+track.associated_pattern, true);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse Grid.revert();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tthis.getAllHashes = function() {\r\n\t\treturn {\r\n\t\t\tplayEnabled: this.playEnabled,\r\n\t\t\ttracks: _.pluck(this.flatList, 'original_hash')\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar AllTracks = {\r\n\tnameList: [], playList: [],\r\n\tpopulate: function(id, list, enabled) {\r\n\t\tvar pl = _.reject(this.playList, {lib: id})\r\n\t\t, nl = _.reject(this.nameList, {lib: id});\r\n\t\t_.each(list, function(track) {\r\n\t\t\tnl.push({lib: id, hash: track.original_hash, name: track.name})\r\n\t\t\tif(enabled) pl.push({lib: id, hash: track.original_hash})\r\n\t\t});\r\n\t\t$('#loop-toassoc option[data-lib='+id+']').remove();\r\n\t\tthis.nameList = nl;\r\n\t\tthis.playList = pl;\r\n\t\t_.each(nl, function(loop) {\r\n\t\t\t$('#loop-toassoc').append('<option data-lib=\"'+id+'\" value=\"'+loop.hash+'\">'+loop.name+'</option>');\r\n\t\t})\r\n\t},\r\n\trandom: function() {\r\n\t\tif(!this.playList.length) this.init();\r\n\t\tif(!this.playList.length) return;\r\n\t\tif(this.playList.length > 1)\r\n\t\t\tvar reduced = this.playList.filter(function(item) {\r\n\t\t\t\treturn item.hash !== currentLoop.original_hash\r\n\t\t\t});\r\n\t\tvar newLoop = (this.playList.length > 1) ? reduced[Math.floor(Math.random() * reduced.length)] : this.playList[0];\r\n\t\tloopLibs[newLoop.lib].playTrackByHash(newLoop.hash);\r\n\t},\r\n\tplayTrackByHash: function(hash, disableAssociation) {\r\n\t\tloopLibs[_.find(this.nameList, {hash: ''+hash}).lib].playTrackByHash(''+hash, disableAssociation);\r\n\t}\r\n}\r\n\r\nfunction PatternGallery(patterns, sel, id, $sortButton, sortBy, order) {\r\n\tthis.$el = $(sel);\r\n\tthis.id = id;\r\n\r\n\tthis.processList = function(list) {\r\n\t\treturn _.each(list, function(entry) {\r\n\t\t\t\tif(entry.hasOwnProperty('date') && !entry.date instanceof Date)\r\n\t\t\t\t\tentry.date = new Date(entry.date);\r\n\t\t\t\t\tentry.height = +entry.height;\r\n\t\t\t\t\tentry.width = +entry.width;\r\n\t\t\t\t\tentry.id = +entry.id;\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t}\r\n\r\n\tthis.list = this.processList(patterns);\r\n\r\n\tthis.patternProbe = function(width, height) {\r\n\t\tvar s = (width > height) ? width : height;\r\n\t\tif(s < 60) {\r\n\t\t\tvar n = 1;\r\n\t\t\twhile(s*n <= 60) \r\n\t\t\t\tn++;\r\n\t\t\tn--;\r\n\r\n\t\t\tvar w = n*width\r\n\t\t\t, h = n*height\r\n\t\t\t, v_offset = 60 - h\r\n\t\t\t, h_offset = 60 - w;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tup: true,\r\n\t\t\t\twidth: w,\r\n\t\t\t\theight: h,\r\n\t\t\t\tmargins: [Math.floor(v_offset/2), Math.ceil(h_offset/2), Math.ceil(v_offset/2), Math.floor(h_offset/2)]\r\n\t\t\t}\r\n\t\t}\r\n\t\telse \r\n\t\t\treturn {\r\n\t\t\t\tup: false,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t}\r\n\t}\r\n\r\n\tthis.refreshAss = function() {\r\n\t\t$('#pattern-toassoc option[data-lib='+this.id+']').remove();\r\n\t\t_.each(this.list, function(pattern) {\r\n\t\t\t$('#pattern-toassoc').append('<option data-lib=\"'+this.id+'\" value=\"'+pattern.id+'\">'+pattern.name+'</option>');\r\n\t\t}, this)\r\n\t}\r\n\r\n\tthis.build = function() {\r\n\t\tvar order = (typeof this.sortOrder === 'undefined') ? true : ((typeof this.sortOrder === 'string') ? ((this.sortOrder === 'asc') ? true : false) : this.sortOrder)\r\n\t\t, sortedList = _.sortByOrder(this.list, [this.sortBy, \"id\"], [order, order])\r\n\t\t, html = '<div class=\"gallery-section\" data-section=\"'+this.id+'\" data-id=\"'+this.id+'\">'\r\n\t\t, foradmin = (this.id === 'default') ? ' foradmin-show' : '';\r\n\t\t\r\n\t\t_.each(sortedList, function(pattern) {\r\n\t\t\tvar probe = this.patternProbe(pattern.width, pattern.height)\r\n\t\t\t, crisp = probe.up ? ' image-crisp' : ''\r\n\t\t\t, upstyle = probe.up ? ' style=\"margin: '+probe.margins.map(function(i) {return i+\"px\"}).join(' ')+'; width:'+probe.width+'px; height:'+probe.height+'px;\"' : ''\r\n\t\t\t, src = Grid.toCanvas(pattern.string, pattern.width, pattern.height)\r\n\t\t\t, fresh = (pattern.fresh || false) ? ' fresh' : ''\r\n\t\t\t, safeName = _.escape(pattern.name)\r\n\t\t\t, foradmin = (this.id == 'default') ? ' foradmin-show' : '';\r\n\t\t\thtml +=\r\n\t\t\t'<div class=\"pattern'+fresh+'\" title=\"'+safeName+'\" data-id=\"'+pattern.id+'\" data-lib=\"'+this.id+'\" data-name=\"'+safeName+'\">\\\r\n\t\t\t\t<img src=\"'+src+'\" class=\"pattern-pic'+crisp+'\"'+upstyle+' alt=\"'+safeName+'\">\\\r\n\t\t\t\t<div class=\"pattern-name\">'+safeName+'</div>\\\r\n\t\t\t\t<div class=\"pattern-options\">\\\r\n\t\t\t\t\t<a title=\"Править\" href=\"#\" class=\"pattern-menu-item pmi-left'+foradmin+'\"><i class=\"i-edit\"></i></a>\\\r\n\t\t\t\t\t<a title=\"Скачать PNG\" target=\"_blank\" href=\"'+src+'\" download=\"'+safeName+'.png\" class=\"pattern-menu-item pmi-mid\"><i class=\"i-download-menu\"></i></a>\\\r\n\t\t\t\t\t<a title=\"Удалить\" href=\"#\" class=\"pattern-menu-item pmi-right'+foradmin+'\"><i class=\"i-x-small\"></i></a>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t</div>'\r\n\t\t}, this)\r\n\r\n\t\thtml += '</div>';\r\n\t\tthis.$el.html(html);\r\n\r\n\t\tthis.refreshAss();\r\n\t}\r\n\r\n\tthis.add = function(pattern) {\r\n\t\tpattern = this.processList([pattern])[0];\r\n\t\tpattern.fresh = true;\r\n\t\tthis.list.push(pattern);\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tthis.edit = function(pattern) {\r\n\t\tthis.del(+pattern.id, true);\r\n\t\tthis.add(pattern);\r\n\t}\r\n\r\n\tthis.del = function(id, nobuild) {\r\n\t\tif(typeof nobuild === 'undefined') nobuild = false;\r\n\t\t_.remove(this.list, {id: id});\r\n\t\tif(!nobuild) this.build();\r\n\t}\r\n\r\n\tthis.sortOptions = [\r\n\t\t['date', 'desc', 'i-newfirst', \"Сначала новые\"],\r\n\t\t['date', 'asc', 'i-oldfirst', \"Сначала старые\"],\r\n\t\t['name', 'asc', 'i-a-z', \"По алфавиту\"],\r\n\t\t['name', 'desc', 'i-z-a', \"По алфавиту\"],\r\n\t];\r\n\r\n\tthis.sortButton = $sortButton;\r\n\tthis.sortButton.on('click', (function(ev) {\r\n\t\tev.stopPropagation();\r\n\t\tthis.sort()\r\n\t}).bind(this));\r\n\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\r\n\tthis.sort = function(sortBy, order) {\r\n\t\tvar sort;\r\n\t\tif(typeof sortBy === 'undefined') \r\n\t\t\tthis.sortState++;\r\n\t\telse {\r\n\t\t\tif(typeof order === 'undefined') order = 'asc';\r\n\t\t\tthis.sortState = _.findIndex(this.sortOptions, {0: sortBy, 1: order});\r\n\t\t}\r\n\t\tif(this.sortState < 0 || this.sortState >= this.sortOptions.length)\r\n\t\t\tthis.sortState = 0;\r\n\t\tsort = this.sortOptions[this.sortState];\r\n\t\tthis.sortBy = sort[0];\r\n\t\tthis.sortOrder = sort[1];\r\n\t\tthis.build();\r\n\t\tthis.sortButton.removeClass(_.pluck(this.sortOptions, 2).join(' ')).addClass(sort[2]);\r\n\t\tthis.sortButton.attr('title', sort[3]);\r\n\t}\r\n\r\n\tthis.sort(sortBy, order);\r\n\t\r\n\tthis.applyPatternByID = function(id, disableAssociation) {\r\n\t\tif(typeof disableAssociation === 'undefined') disableAssociation = false;\r\n\t\tvar pattern = _.find(this.list, {id: +id});\r\n\t\tif(pattern) {\r\n\t\t\tif(pattern.osc) \r\n\t\t\t\tGrid.setOsc(pattern.osc);\r\n\t\t\telse {\r\n\t\t\t\t$('#osc-sel').val('default')\r\n\t\t\t}\r\n\r\n\t\t\tif(pattern.style)\r\n\t\t\t\tGrid.changeStyle(pattern.style, pattern.string);\r\n\t\t\telse\r\n\t\t\t\tGrid.changeStyle(defaultStyle, pattern.string);\r\n\t\t\t\r\n\t\t\tif(pattern.associated_loop && conf.association && !disableAssociation)\r\n\t\t\t\tAllTracks.playTrackByHash(pattern.associated_loop, true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar is_admin = false;\r\ncheet('↑ ↑ ↓ ↓ ← → ← → b a', function () {\r\n  $('body').toggleClass('is-admin');\r\n  is_admin = !!!is_admin;\r\n});\r\n\r\nMath.log2 = Math.log2 || function(x) {\r\n  return Math.log(x) / Math.LN2;\r\n};\r\n\r\nvar $stream = null, radioMES = null;\r\n\r\nfunction set_stream(url, mediaType) {\r\n\tif(!$stream) {\r\n\t\t$('<audio style=\"display:none\" id=\"stream-victim\"></audio>').appendTo('body');\r\n\t\t$stream = $('#stream-victim');\r\n\t}\r\n\t$stream.html('<source src=\"'+url+'\" type=\"'+mediaType+'\" />');\r\n}\r\n\r\nfunction connectStream() {\r\n\tradioMES = audio.context.createMediaElementSource($('#stream-victim')[0]);\r\n\tradioMES.connect(gainNode);\r\n}\r\n\r\nfunction toggleAnlzOpts() {\r\n\t$('#nerdmode').slideToggle('fast')\r\n\tchannel.debugOn = !channel.debugOn\r\n}"]}