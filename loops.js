"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!(i&&_arr.length===i));_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),defaultPattern="__JJJJJJJJ__|_JJJJJJJJJJ_|JJjjjjjjjJJJ|JJjjjjjjJJJJ|JJjjjjjJJjJJ|JJjjjjjJJjJJ|JJjjjjJJjjJJ|JJjjjjJJjjJJ|JJjjjJJjjjJJ|JJjjjJJjjjJJ|JJjjJJjjjjJJ|JJjjJJjjjjJJ|JJjJJjjjjjJJ|JJjJJjjjjjJJ|JJJJjjjjjjJJ|JJJjjjjjjjJJ|_JJJJJJJJJJ_|__JJJJJJJJ__",urlprefix="loops/",fileFormat=function(){var testAudio=document.createElement("audio");return"function"==typeof testAudio.canPlayType&&""!==testAudio.canPlayType("audio/ogg")}()?"ogg":"mp3",conf={barWidth:850,barHeight:240,fft_size:1024,absoluteTreshold:.5,historySize:20,distributionLaw:"quadratic",colorAlphaTreshold:.5,association:!1,osc:!0,topOffset:70,lightWave:"#eee",darkWave:"#999"},detectPassiveEvents={update:function update(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener){var passive=!1,options=Object.defineProperty({},"passive",{get:function get(){passive=!0}}),noop=function(){};window.addEventListener("testPassiveEventSupport",noop,options),window.removeEventListener("testPassiveEventSupport",noop,options),detectPassiveEvents.hasSupport=passive}}};detectPassiveEvents.update();var $canvas,drawContext,bufferCanvas,bufferContext;function readyset(){if(channel.init(),$canvas=$("#bars"),drawContext=$canvas[0].getContext("2d"),bufferCanvas=$("#bufferCanvas")[0],bufferContext=bufferCanvas.getContext("2d"),ranges.init(),Grid.init("#nullgrid"),$("body *").mousedown(function(){isMouseDown=!0}).on("mouseup dragend",function(){isMouseDown=!1}),$("#fixed-palette .swatch").each(function(){var c=$(this).data("c");$(this).replaceWith(Grid.generateCell(c,"under").addClass("swatch").data("act","swatch").attr("id","swatch-"+c))}),$("body").on("click",".action-button",function(ev){actions[$(this).data("act")](ev)}).on("click",".tool",function(){$(".tool").removeClass("selected"),$(this).addClass("selected"),brush.mode=$(this).data("tool")}).on("click",".swatch",function(){$(".swatch").removeClass("selected"),$(this).data("c")&&($(this).addClass("selected"),brush.color=$(this).data("c"),$("[data-tool=\"draw\"]").click())}),$("#colorpicker").on("change",function(){brush.color="#"+$(this).val(),brush.mode="draw",$(this).addClass("selected"),$("[data-tool=\"draw\"]").click()}),document.querySelector("body").addEventListener("dragover",handleDragOver,!1),document.querySelector("body").addEventListener("drop",handleFileDrop,!1),document.querySelector("#bufferFileInput").addEventListener("change",handleFileInput,!1),document.querySelector("#overlays").addEventListener("touchmove",function(ev){_.each(ev.targetTouches,function(touch){var el=document.elementFromPoint(touch.pageX,touch.pageY);el.hasOwnProperty("_tl")&&el._tl.progress(0)})},!1),$.getJSON("upload.php?check").done(function(data){upconf=data}).fail(function(err){console.log(err)}),$(".password-reveal").on("mousedown",function(){$(this).parent().find(".delpass").attr("type","text")}).on("mouseleave mouseup",function(){$(this).parent().find(".delpass").attr("type","password")}),$(".validable").on("input",function(){validations[$(this).data("tovalid")]($(this).val())?$(this).removeClass("invalid"):$(this).addClass("invalid"),validateForm($(this).parents("form"),!0)}),$(".captcha").click(function(ev){updateCaptcha($(this).parents(".captchablock"),ev.ctrlKey||ev.altKey)}),$(".pop-message .i-x-large").click(errBox.closeWithBtn),$("#loop-upload .panel-close").click(loopEditor.hide.bind(loopEditor)),$("#loop-upload form").on("submit",function(ev){ev.preventDefault(),setLineHeightAsParentHeight($("#loop-upload .hijab")),$("#loop-upload .panel").addClass("p-busy");var action="add";$("#loop-upload form").hasClass("action-edit")&&(action="edit"),$("#loop-upload form").hasClass("action-delete")&&(action="delete");var fd=new FormData;if((fd.append("action",action),fd.append("datatype","loop"),fd.append("delpass",$("#loop-upload .delpass").val()),fd.append("captcha",$("#loop-upload .captchainput").val()),is_admin&&fd.append("is_admin",1),"delete"!=action)&&(fd.append("name",$("#loop-upload .filename").val()),["freq","db","smoothing","treshold"].forEach(function(prop){return fd.append(prop,ranges.current[prop])}),$("#assoc_pattern").is(":checked")&&fd.append("associated_pattern",$("#pattern-toassoc").val()),is_admin)){fd.append("is_admin",1);var date=$("#loop-date").val();if(date){var time=$("#loop-time").val()||"00:00:00";date=date+" "+time}date&&fd.append("date",date),$("#loop-swf").val()&&fd.append("swf",$("#loop-swf").val()),fd.append("section",$("#loop-section").val())}if("add"==action){if(!currentCustomTrack.blob)return errBox.pop($("#loop-upload"),"\u0424\u0430\u0439\u043B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442"),void $("#loop-upload .panel").removeClass("p-busy");if(currentCustomTrack.blob.size/1024>upconf.max_loop_fszkb)return $("#loop-upload .panel").removeClass("p-busy"),void errBox.pop($("#loop-upload"),"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 ("+upconf.max_loop_fszkb/1024+" \u041C\u0411).");fd.append("loop",currentCustomTrack.blob)}else fd.append("original_hash",loopEditor.rawData.original_hash);"edit"==action&&fd.append("take_ownership",$("#loop_take_ownership").is(":checked"));var request=new XMLHttpRequest;request.open("POST","upload.php"),request.send(fd),request.onload=function(e){if($("#loop-upload .panel").removeClass("p-busy"),200==this.status){try{var res=JSON.parse(this.response);if(!res.error){var _lib="custom"===res.loop.section?"custom":"default",dp=$("#loop-upload .delpass").val();if(localStorage.loop_pass=dp,localStorage.pattern_pass||($("#pattern-share .delpass").val(dp),localStorage.pattern_pass=dp),"loop_add"===res.success&&res.hasOwnProperty("loop")&&(loopLibs[_lib].add(res.loop),loopEditor.hide()),"loop_edit"===res.success){var lib_move=!1;if(res.loop.hasOwnProperty("section_from")){var lib_from="custom"===res.loop.section_from?"custom":"default";lib_from!=_lib&&(lib_move=!0)}lib_move?(loopLibs[lib_from].del(res.loop.original_hash,res.loop.section_from),loopLibs[_lib].add(res.loop)):loopLibs[_lib].edit(res.loop),_.each(res.changes,function(item,ix){res.changes[ix]=_.escape(item)}),errBox.pop($("#loop-upload"),res.changes.join(";<br>")+".","success","raw"),loopEditor.unedit()}"loop_delete"===res.success&&(loopLibs[_lib].del(res.loop.original_hash,res.loop.section),errBox.pop($("#loop-upload"),"\u041B\u0443\u043F \u0443\u0434\u0430\u043B\u0435\u043D.","success"),loopEditor.undel()),$("#loop-library").addClass("open-lib"),$("#ltab-"+_lib).click(),$("#loop-upload .filename").val("").trigger("input")}else if("prompt_edit"===res.errtype)try{var data=JSON.parse(res.extra_data);loopEditor.prepareEdit(data),errBox.pop($("#loop-upload"),_.escape(res.msg)+" <a href=\"javascript:loopEditor.edit();\">\u041E\u0442\u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043B\u0443\u043F \xAB"+_.escape(data.name)+"\xBB</a>?","prompt","raw")}catch(e){errBox.pop($("#loop-upload"),"\u041D\u0435\u043E\u0436\u0438\u0434\u0430\u043D\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438."),console.log(e)}else errBox.pop($("#loop-upload"),res.msg)}catch(e){if("SyntaxError"==e.name)errBox.pop($("#loop-upload"),"\u041D\u0435\u043E\u0436\u0438\u0434\u0430\u043D\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438."),console.error(this.response);else throw e}updateCaptcha($("#loop-upload .captchablock"))}else errBox.pop($("#loop-upload"),"\u041E\u0448\u0438\u0431\u043A\u0430 XHR. \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438."),console.error(e)}}),$.getJSON("custom_loops.json?"+Math.random()).done(function(data){loopLibs.custom=new TrackList(data,"#custom-loops","custom",!0,$("#ltab-custom i.sorter"),"date","desc",!0,$("#ltab-custom i.play-enabler"))}).fail(console.error),$.getJSON("default_loops.json?"+Math.random()).done(function(data){var defaultLib=[{title:"\u041F\u0435\u0440\u0438\u043E\u0434 \u0441\u043C\u0435\u0440\u0442\u0438",sectID:"dead",contents:_.filter(data,{section:"dead"})},{title:"\u041F\u0435\u0440\u0438\u043E\u0434 \u0436\u0438\u0437\u043D\u0438",sectID:"live",contents:_.filter(data,{section:"live"})}];loopLibs.default=new TrackList(defaultLib,"#default-loops","default",!1,$("#ltab-default i.sorter"),"date","desc",!0,$("#ltab-default i.play-enabler"))}).fail(console.error),$.getJSON("default_patterns.json?"+Math.random()).done(function(data){patternLibs.default=new PatternGallery(data,"#default-patterns","default",$("#ptab-default i.sorter"),"date","desc")}).fail(console.error),$.getJSON("custom_patterns.json?"+Math.random()).done(function(data){patternLibs.custom=new PatternGallery(data,"#custom-patterns","custom",$("#ptab-custom i.sorter"),"date","desc")}).fail(console.error),$(".scrollable").mCustomScrollbar({theme:"minimal-dark",scrollInertia:200}),$(".lt-contents").on("mouseenter",".track",function(){var $trackName=$(this).find(".track-name");$trackName[0].scrollWidth<=$trackName[0].offsetWidth||($trackName.stop().addClass("no-overflow"),$trackName.animate({scrollLeft:$trackName.width()},15*$trackName.width(),"linear"))}).on("mouseleave",".track",function(){var $trackName=$(this).find(".track-name");$trackName[0].scrollWidth<=$trackName[0].offsetWidth||$trackName.stop().animate({scrollLeft:0},"slow","linear",function(){$trackName.removeClass("no-overflow")})}),$(".lib-search").click(function(){$(this).toggleClass("active").parents(".library").toggleClass("search-active").find("input").focus()}),$(".ltab-close, .ptab-close").click(function(){$(this).parents(".library").removeClass("open-lib select-mode")}),$(".tab-switch").click(function(){var tabgroup=$(this).data("tabgroup");$(".tab-switch.tabgroup-"+tabgroup).removeClass("active"),$(this).hasClass("active")||$(this).addClass("active"),$(".tab-contents.tabgroup-"+tabgroup).hide(),$("#"+$(this).data("tab")).show()}),$(".tab-to-select-by-default").click(),$("#loop-library").on("click",".track .i-play",function(){var hash=$(this).parents(".track").data("hash"),libID=$(this).parents(".tracklist-section").data("id");loopLibs[libID].playTrackByHash(hash)}).on("click",".track-options .i-download-menu",function(ev){ev.stopPropagation(),$(".track").removeClass("dl-track ed-track"),$(this).parents(".track").addClass("dl-track")}).on("click",".track-options .i-burger",function(ev){ev.stopPropagation(),$(".track").removeClass("dl-track ed-track"),$(this).parents(".track").addClass("ed-track")}).on("click",".track-name",function(){$(".track").removeClass("dl-track ed-track")}).on("click",".track",function(ev){if($(this).parents(".library").hasClass("select-mode")){ev.stopPropagation();var hash=$(this).data("hash");$(this).parents(".library").hasClass("select-mode")&&$("#loop-toassoc").val(hash)}}),$("#loop-search").on("input",function(){var query=$(this).val().toLowerCase().replace(/\"/,"\\\"");try{injector.remove("loop-search")}catch(e){}query.length?injector.inject("loop-search",".search-active#loop-library .track:not([data-name *= \""+query+"\"]) { display:none; }"):injector.inject("loop-search",".search-active#loop-library .track { display:none; }")}).trigger("input"),$("#pattern-search").on("input",function(){var query=$(this).val().toLowerCase().replace(/\"/,"\\\"");try{injector.remove("pattern-search")}catch(e){}query.length?injector.inject("pattern-search",".search-active#pattern-library .pattern:not([data-name *= \""+query+"\"]) { display:none; }"):injector.inject("pattern-search",".search-active#pattern-library .pattern { display:none; }")}).trigger("input"),$("#unedit-loop").click(loopEditor.unedit.bind(loopEditor)),$(".oncheck-enable").change(function(){$($(this).data("element-toenable")).attr("disabled",!this.checked)}),$("#loop-library").on("click",".dlb-edit",function(){var $track=$(this).parents(".track"),hash=$track.data("hash")+"",lib=$track.parents(".tabgroup-loops").data("lib"),trackData=_.find(loopLibs[lib].flatList,{original_hash:hash});trackData&&loopEditor.prepareEdit(trackData,!0)}).on("click",".dlb-delete",function(){var $track=$(this).parents(".track"),hash=$track.data("hash"),lib=$track.parents(".tabgroup-loops").data("lib"),trackData=_.find(loopLibs[lib].flatList,{original_hash:hash});trackData&&loopEditor.del(trackData,!0)}),$("#pattern-library").on("click",".pattern-name",function(){var libID=$(this).parent().data("lib"),patternID=$(this).parent().data("id");$(this).parents(".library").hasClass("select-mode")?$("#pattern-toassoc").val(patternID):patternLibs[libID].applyPatternByID(patternID)}).on("click",".i-edit",function(){var $pattern=$(this).parents(".pattern"),id=$pattern.data("id"),lib=$pattern.data("lib"),patternData=_.find(patternLibs[lib].list,{id:id});patternData&&patternEditor.edit(patternData)}).on("click",".pattern .i-x-small",function(){var $pattern=$(this).parents(".pattern"),id=$pattern.data("id"),lib=$pattern.data("lib"),patternData=_.find(patternLibs[lib].list,{id:id});patternData&&patternEditor.del(patternData)}),$("form#pattern-share").on("submit",function(ev){ev.preventDefault(),setLineHeightAsParentHeight($("#editmode .hijab")),$("#editmode .panel").addClass("p-busy");var action="add";$("#pattern-share").hasClass("action-edit")&&(action="edit"),$("#pattern-share").hasClass("action-delete")&&(action="delete");var fd=new FormData;if(fd.append("action",action),fd.append("datatype","pattern"),fd.append("delpass",$("#pattern-share .delpass").val()),fd.append("captcha",$("#pattern-share .captchainput").val()),is_admin&&fd.append("is_admin",1),"delete"!=action&&(fd.append("name",$("#pattern-share .filename").val()),fd.append("pattern_string",Grid.getPattern()),fd.append("style",$("#cell-style").val()),fd.append("osc","off"===$("#osc-sel").val()?"off":$("#osc-color").val()),$("#assoc_loop").is(":checked")&&fd.append("associated_loop",$("#loop-toassoc").val()),is_admin)){fd.append("is_admin",1);var date=$("#pattern-date").val();if(date){var time=$("#pattern-time").val()||"00:00:00";date=date+" "+time}date&&fd.append("date",date),fd.append("section",$("#pattern-section").val())}"add"!=action&&fd.append("pattern_id",patternEditor.currentID);var request=new XMLHttpRequest;request.open("POST","upload.php"),request.send(fd),request.onload=function(e){if($("#editmode .panel").removeClass("p-busy"),200==this.status){try{var res=JSON.parse(this.response);if(res.error)errBox.pop($("#editmode"),res.msg);else{var dp=$("#pattern-share .delpass").val();if(localStorage.pattern_pass=dp,localStorage.loop_pass||($("#loop-upload .delpass").val(dp),localStorage.loop_pass=dp),"pattern_add"===res.success&&patternLibs[res.pattern.section].add(res.pattern),"pattern_edit"===res.success){var lib_from=res.pattern.section_from||!1;lib_from?(patternLibs[lib_from].del(res.pattern.id),patternLibs[res.pattern.section].add(res.pattern)):patternLibs[res.pattern.section].edit(res.pattern),_.each(res.changes,function(item,ix){res.changes[ix]=_.escape(item)}),errBox.pop($("#editmode"),res.changes.join(";<br>"),"success","raw"),patternEditor.unedit()}"pattern_delete"===res.success&&(patternLibs[res.pattern.section].del(res.pattern.id),errBox.pop($("#editmode"),"\u041F\u0430\u0442\u0442\u0435\u0440\u043D \u0443\u0434\u0430\u043B\u0435\u043D.","success"),patternEditor.undel()),$("#pattern-library").addClass("open-lib"),$("#ptab-"+res.pattern.section).click(),$("#loop-upload .filename").val("").trigger("input")}}catch(e){if("SyntaxError"==e.name)errBox.pop($("#editmode"),"\u041D\u0435\u043E\u0436\u0438\u0434\u0430\u043D\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438."),console.error(this.response);else throw e}updateCaptcha($("#pattern-share .captchablock"))}else errBox.pop($("#editmode"),"\u041E\u0448\u0438\u0431\u043A\u0430 XHR. \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438."),console.error(e)}}),localStorage.loops_association)try{conf.association=JSON.parse(localStorage.loops_association),$("#assoc-toggle")[0].checked=conf.association}catch(e){throw e}if($("#assoc-toggle").change(function(){conf.association=localStorage.loops_association=$(this)[0].checked}),localStorage.osc_enabled)try{conf.osc=JSON.parse(localStorage.osc_enabled),conf.osc||($("#osc-toggle")[0].checked=!1,$("body").addClass("osc-disabled"))}catch(e){throw e}$("#osc-toggle").change(function(){conf.osc=localStorage.osc_enabled=$(this)[0].checked,conf.osc?$("body").removeClass("osc-disabled"):$("body").addClass("osc-disabled")}),_.each(styles,function(val,style){var selected=Grid.style===style?" selected":"";$("#cell-style").append("<option val=\""+style+"\""+selected+">"+style+"</option>")}),$("#cell-style").change(function(){Grid.changeStyle($(this).val())}),$("#osc-color").change(function(){Grid.setOsc($(this).val())}),$("#osc-sel").change(function(){var val=$(this).val();"off"===val?Grid.setOsc("off"):($("body").removeClass("osc-disabled"),conf.osc=!0),"default"===val&&(Grid.recount(),$("#osc-color").attr("disabled",!0)),"custom"===val&&$("#osc-color").attr("disabled",!1)}),$("#loop-upload .delpass").val(localStorage.loop_pass||"").trigger("input"),$("#pattern-share .delpass").val(localStorage.pattern_pass||"").trigger("input")}var injector={inject:function inject(alias,css){var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css",style.id="injector:"+alias,style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css)),head.appendChild(style)},remove:function remove(alias){var style=document.getElementById("injector:"+alias);if(style){var head=document.head||document.getElementsByTagName("head")[0];head&&head.removeChild(document.getElementById("injector:"+alias))}}},loopLibs={},patternLibs={},errBox={pop:function pop($parent,message,msgType,raw){"undefined"==typeof msgType&&(msgType="error"),("undefined"==typeof raw||"raw"!==raw)&&(raw=!1);var $errorbox=$parent.find(".emsgwrap");return raw?$errorbox.find(".emsgbody").html(message):$errorbox.find(".emsgbody").text(message),$errorbox.find(".pop-message").removeClass("emsg-error emsg-prompt emsg-success").addClass("emsg-"+msgType),$errorbox.css({visibility:"visible"}),$errorbox.animate({opacity:1,top:"-"+($errorbox.height()-20)+"px"},200),$errorbox},closeWithBtn:function closeWithBtn(ev){ev.preventDefault(),errBox.off($(this).parents(".emsgwrap"))},off:function off($parent){$parent.animate({opacity:"0"},200,function(){$parent.css({visibility:"hidden",top:"0px"})})}};function popError($parent,message){$errorbox=$parent.find(".emsgwrap"),$errorbox.find(".emsgbody").html(message),$errorbox.css({visibility:"visible"}),$errorbox.animate({opacity:1,top:"-"+($errorbox.height()-20)+"px"},400)}function updateCaptcha($parent){var switch_lang=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1];$parent.find("img.captcha").attr("src","captcha/captcha.php?color=200,200,200&"+Math.random()+(switch_lang?"&switch":"")),$parent.find("input.captchainput").val("").trigger("input")}var loopEditor={visible:!1,state:"add",prepareEdit:function prepareEdit(data,immed){this.rawData=data,"undefined"!=typeof immed&&immed&&this.edit()},add:function add(){this.unedit(),this.undel(),this.show(),errBox.off($("#loop-upload .emsgwrap"))},edit:function edit(){this.undel(),this.state="edit",errBox.off($("#loop-upload .emsgwrap")),$("#loop-upload form").addClass("action-edit"),$("#loopedit-id").text(_.trunc(this.rawData.name,18)),$("#loop-upload .filename").val(this.rawData.name);var $datetime=this.rawData.date.split(" ");$("#loop-date").val($datetime[0]),$("#loop-time").val($datetime[1]),$("#loop-section").val(this.rawData.section),$("#loop-swf").val(this.rawData.swf),this.rawData.associated_loop?($("#pattern-toassoc").val(this.rawData.associated_pattern),$("#assoc_pattern")[0].checked=!0):$("#assoc_pattern")[0].checked=!1,$("#assoc_pattern").trigger("change"),this.show()},unedit:function unedit(){"edit"!==this.state||(this.state="add",$("#loop-upload form").removeClass("action-edit"))},del:function del(loop){this.rawData=loop,this.unedit(),this.state="delete",$("#loopdelete-id").text(_.trunc(loop.name,40)),$("#loop-upload form").addClass("action-delete"),this.show()},undel:function undel(){"delete"!==this.state||(this.state="add",$("#loop-upload form").removeClass("action-delete"))},show:function show(){$("#loop-upload .validable").trigger("input");this.visible||($("#loop-upload .captcha").attr("src","captcha/captcha.php?color=200,200,200&"+Math.random()),$("#loop-upload").slideDown("fast"),this.visible=!0)},hide:function hide(){this.visible&&(errBox.off($("#loop-upload .emsgwrap")),$("#loop-upload").slideUp("fast",function(){this.unedit(),this.undel(),this.visible=!1}.bind(this)))}},patternEditor={visible:!1,state:"add",currentID:0,edit:function edit(pattern){this.undel(),$("#pattern-share").addClass("action-edit"),$("#patternedit-id").text(_.trunc(pattern.name,40)),$("#pattern-share .filename").val(pattern.name),pattern.associated_loop?($("#loop-toassoc").val(pattern.associated_loop),$("#assoc_loop")[0].checked=!0):$("#assoc_loop")[0].checked=!1,$("#assoc_loop").trigger("change"),pattern.style&&$("#cell-style").val(pattern.style).trigger("change"),pattern.osc&&Grid.setOsc(pattern.osc),this.state="edit",this.show(pattern.string),this.currentID=+pattern.id},unedit:function unedit(){"edit"!==this.state||(this.state="add",$("#pattern-share").removeClass("action-edit"))},del:function del(pattern){this.currentID=+pattern.id,this.unedit(),this.state="delete",$("#patterndelete-id").text(_.trunc(pattern.name,40)),$("#pattern-share").addClass("action-delete"),this.show(pattern.string)},undel:function undel(){"delete"!==this.state||(this.state="add",$("#pattern-share").removeClass("action-delete"))},show:function show(patternStr){"undefined"==typeof patternStr&&(patternStr=!1),Grid.enterPaintMode(),patternStr&&(Grid.build(patternStr),$("#pattern-library").removeClass("open-lib"));this.visible||($("#pattern-share .captcha").attr("src","captcha/captcha.php?color=200,200,200&"+Math.random()),$(".onshare-show").slideDown("fast"),this.visible=!0,$("#pattern-share .validable").trigger("input"),"default"===$("#osc-sel").val()&&Grid.recount())},hide:function hide(){this.visible&&$(".onshare-show").slideUp("fast",function(){this.unedit(),this.undel(),this.visible=!1}.bind(this))},toggle:function toggle(){this.visible?this.hide():this.show()}},upconf={auth:!1},validations={delpass:function delpass(val){return!!val&&val.length<=upconf.max_delpass_length},captcha:function captcha(val){return!!val},filename:function filename(val){return!!val&&val.length<=upconf.max_filename_length}};function validateForm($form){$form.find("button[type=submit]").attr("disabled",!!$form.find(".invalid:visible").length)}var actions={export:function _export(){$("#pattern-area").val(Grid.getPattern())},import:function _import(){Grid.build($("#pattern-area").val(),"under")},random:function random(){Grid.randomfill()},revert:function revert(){$("#osc-sel").val("default"),Grid.changeStyle(defaultStyle,defaultPattern)},clear:function clear(){Grid.clear()},close:function close(){Grid.exitPaintMode()},upload:function upload(){document.getElementById("bufferFileInput").click()},download:function download(){Grid.downloadPattern()},upload_loop:function upload_loop(){console.log("loop upload")},share_pattern:function share_pattern(){patternEditor.toggle()},select_loop:function select_loop(ev){ev.preventDefault(),$("#loop-library").addClass("select-mode open-lib")},select_pattern:function select_pattern(ev){ev.preventDefault(),$("#pattern-library").addClass("select-mode open-lib")},recount_base_color:function recount_base_color(){Grid.recount()}},isMouseDown=!1;function setLineHeightAsParentHeight($el){$el.each(function(){$(this).css({lineHeight:$(this).height()+"px"})})}var Colors={g:"#35752e",G:"#59c44d",y:"#7b7d25",Y:"#cccf41",o:"#805c22",O:"#d2993e",b:"#2e6d90",B:"#4eb6f1",c:"#7b273d",C:"#cc4368",v:"#4e1e84",V:"#8238d8",m:"#686868",M:"#d2d2d2",j:"#468172",J:"#37C999",".":"_VOID_",_:"_VOID_"},colorMatch=new RegExp("(["+_.escapeRegExp(_.keys(Colors).join(""))+"])|\\[(.+?)\\]","g"),colorMatchSqBr=new RegExp("(["+_.escapeRegExp(_.keys(Colors).join(""))+"])|(\\[.+?\\])","g"),styles={legacy:function legacy(color){var baseColor=color.toHexString(),darkenColor=color.darken(25).toHexString();return{u:"background: radial-gradient(ellipse at center, "+baseColor+" 34%, "+darkenColor+" 81%);",o:"background: "+baseColor}},modern:function modern(color){var baseColor=color.toHexString(),darkenColor=color.darken(10).toHexString(),darker=color.darken(30).toRgbString();return{u:"background: radial-gradient(ellipse at center 7px, "+baseColor+" 0%, "+darkenColor+" 70%);",o:"background: "+baseColor+"; box-shadow: "+baseColor+" 0px 0px 0px 0px, "+baseColor+" 0px 0px 0px 0px, "+darker+" 0px 0px 0px 0px"}},flashes:function flashes(color){var baseColor=color.toHexString(),darkenColor=color.darken(10).toHexString(),darker=color.darken(30).toRgbString();return{u:"background: transparent; box-shadow: none;",o:"background: "+baseColor+"; box-shadow: "+baseColor+" 0px 0px 0px 0px, "+baseColor+" 0px 0px 0px 0px, "+darker+" 0px 0px 0px 0px"}},flat:function flat(color){var baseColor=color.toHexString(),lighten=color.brighten(25).saturate(15).toHexString();return{u:"background: "+baseColor+";",o:"background: "+lighten+";"}}},defaultStyle="modern";styles.transitional=styles.modern;var globalCSS={legacy:"html {\theight: 100%; \tbackground: #000; \tbackground: -webkit-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \tbackground: -ms-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \tbackground: -o-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \tbackground: -moz-linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B; \tbackground: linear-gradient(top,#404040,#000 195px,#000 380px,#2B2B2B 418px) no-repeat,#2B2B2B;   }  body {\tfont-family: 'Trebuchet MS',\tTrebuchet, Arial,Helvetica, sans-serif;  }  #shadow {\tbackground: rgba(33, 33, 33, 0.44);\tbox-shadow: 0 0 53px #212121;  }",transitional:"html {\tbackground: #212121;  }  #shadow {\tbackground: rgba(33, 33, 33, 0.44);\tbox-shadow: 0 0 53px #212121;  }",flat:"#nullgrid .cell:not(.void) {border-radius: 0; box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);}  #nullgrid .cell.under:not(.void) { box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2); }"};function xBrowserIsMouseDown(){return isMouseDown}var isChrome=navigator.userAgent.match(/chrome\/([0-9]+)/i);if(isChrome){var chromeVersion=isChrome[1];46<=+chromeVersion&&(xBrowserIsMouseDown=function(){return $("body:active").length})}var animations={legacy:function legacy(){var color=this.style.backgroundColor,darken=tinycolor(color).darken(30).toRgbString();this._tl.to(this,.1,{opacity:1,boxShadow:color+" 0px 0px 2px 2px, "+color+" 0px 0px 10px 10px, "+darken+" 0px 0px 9px 9px"}).to(this,.4,{opacity:0,boxShadow:color+" 0px 0px 0px 0px, "+color+" 0px 0px 0px 0px, "+darken+" 0px 0px 0px 0px"})},flat:function flat(){var color=this.style.backgroundColor;this._tl.to(this,.1,{opacity:1,boxShadow:"inset 0 0 0 1px rgba(0, 0, 0, 0),"+color+" 0px 0px 4px 2px"}).to(this,.6,{opacity:0,boxShadow:"inset 0 0 0 1px rgba(0, 0, 0, 0.2),"+color+" 0px 0px 0px 0px"})}};animations.modern=animations.transitional=animations.flashes=animations.legacy;var _debug_,Grid={init:function init(sel){this.$el=$(sel);var self=this;this.$el.find(".triangle-group").css({display:"inline-block"}).hide(),this.$el.find(".tg-top .t-up").click(function(){self.resample("top",1,"under")}),this.$el.find(".tg-top .t-down").click(function(){self.resample("top",-1,"under")}),this.$el.find(".tg-bottom .t-up").click(function(){self.resample("bottom",-1,"under")}),this.$el.find(".tg-bottom .t-down").click(function(){self.resample("bottom",1,"under")}),this.$el.find(".tg-left .t-left").click(function(){self.resample("left",1,"under")}),this.$el.find(".tg-left .t-right").click(function(){self.resample("left",-1,"under")}),this.$el.find(".tg-right .t-left").click(function(){self.resample("right",-1,"under")}),this.$el.find(".tg-right .t-right").click(function(){self.resample("right",1,"under")}),this.shuffler=new Rarity(50),"default"!==this.lastOsc&&this.setOsc(this.lastOsc),this.changeStyle(this.baseStyle,this.pattern)},pattern:localStorage.customPattern||"__JJJJJJJJ__|_JJJJJJJJJJ_|JJjjjjjjjJJJ|JJjjjjjjJJJJ|JJjjjjjJJjJJ|JJjjjjjJJjJJ|JJjjjjJJjjJJ|JJjjjjJJjjJJ|JJjjjJJjjjJJ|JJjjjJJjjjJJ|JJjjJJjjjjJJ|JJjjJJjjjjJJ|JJjJJjjjjjJJ|JJjJJjjjjjJJ|JJJJjjjjjjJJ|JJJjjjjjjjJJ|_JJJJJJJJJJ_|__JJJJJJJJ__",baseStyle:localStorage.lastStyle||"modern",lastOsc:localStorage.lastOsc||"default",revert:function revert(){$("#osc-sel").val("default"),this.changeStyle(this.baseStyle,this.pattern)},style:this.baseStyle,changeStyle:function changeStyle(style,thenBuild){return _.has(styles,style)?void($("#cell-style").val(style),"undefined"==typeof thenBuild&&(thenBuild=!1),this.style=style,injector.remove("cellstyle"),_.has(globalCSS,style)&&injector.inject("cellstyle",globalCSS[style]),this.build(thenBuild)):console.error("\u041D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0442\u0430\u043A\u043E\u0433\u043E \u0441\u0442\u0438\u043B\u044F")},setOsc:function setOsc(color){if("off"===color)return $("#osc-sel").val("off"),$("body").addClass("osc-disabled"),void(conf.osc=!1);conf.osc=!0,"default"===color?($("#osc-color").attr("disabled",!0),color=Grid.primaryColor,$("#osc-sel").val("default")):($("#osc-sel").val("custom"),$("#osc-color").attr("disabled",!1)),$("#osc-toggle")[0].checked&&$("body").removeClass("osc-disabled");var $oscC=$("#osc-color");$oscC[0].hasOwnProperty("color")?$oscC[0].color.fromString(color):$oscC.val(color),-1==color.indexOf("#")&&(color="#"+color),drawContext.fillStyle=color},generateCell:function generateCell(color,layer,style){"undefined"==typeof style&&(style=this.style);var char=color.split(/[\[\]]/)[1]||color.split(/[\[\]]/)[0],color=_.has(Colors,char)?tinycolor(Colors[char]):tinycolor(char),cstring=_.has(Colors,char)?char:"#"+color.toHex().toLowerCase(),style=styles[style](color);if(color._format&&color._a>=conf.colorAlphaTreshold){if("under"==layer)return $("<div data-c=\""+cstring+"\" class=\"cell under\" style=\""+style.u+"\"></div>");var $cell=$("<div data-c=\""+cstring+"\" class=\"cell over\" style=\""+style.o+"\"></div>");$cell[0]._tl=new TimelineLite;var blink=function(){this._tl.progress(0)},passive=!!detectPassiveEvents.hasSupport&&{passive:!0};return $cell[0].addEventListener("mouseenter",blink,passive),$cell[0].addEventListener("touchstart",blink,passive),$cell}return"under"==layer?$("<div class=\"cell under void\" data-c=\"_\"></div>"):"over"==layer?$("<div class=\"cell void\" data-c=\"_\"></div>"):void 0},lastBuild:{pattern:"",layer:"",style:""},build:function build(pattern,layer){if("string"!=typeof pattern&&(pattern=this.getPattern()),"undefined"==typeof layer&&(layer=$("#grid-wrap").hasClass("edit-mode")?"under":"both"),pattern=pattern.replace(/\s+/g,"").replace(/\|{2,}/g,"|").replace(/^\|/g,"").replace(/\|$/g,""),pattern!==this.lastBuild.pattern||layer!==this.lastBuild.layer||this.style!==this.lastBuild.style){this.lastBuild.pattern=pattern,this.lastBuild.layer=layer,this.lastBuild.style=this.style;var $cells=this.$el.find("#cells"),$overlays=this.$el.find("#overlays");"over"!=layer&&$cells.find(".cell, br").remove(),"under"!=layer&&$overlays.find(".cell, br").remove();var lines=pattern.split(/[|\/]/);if(_.each(lines,function(line,li){var chars=_.compact(line.split(colorMatch));_.each(chars,function(char,ci){"over"!=layer&&this.generateCell(char,"under").attr("id","cu_"+li+"_"+ci).appendTo($cells),"under"!=layer&&this.generateCell(char,"over").attr("id","co_"+li+"_"+ci).appendTo($overlays)},this),"over"!=layer&&$("<br>").appendTo($cells),"under"!=layer&&$("<br>").appendTo($overlays)},this),"under"!==layer)var style=this.style;$(".over").each(animations[style]),this.recount(layer)}},enterPaintMode:function enterPaintMode(){$("#overlays").empty(),$("#controls").fadeOut(),$("#editmode").slideDown(),audio.stop(function(){$("#playSwitcher i").removeClass("i-pause-big").addClass("i-play-big")}),$("#cells").on("mousedown mouseenter",".cell",function(ev){if(brush.mode&&("mouseenter"!=ev.type||xBrowserIsMouseDown()))if("dropper"===brush.mode){var color=$(this).data("c");$(".swatch").removeClass("selected"),_.has(Colors,color)?($("#swatch-"+color).addClass("selected"),brush.color=color):(brush.color=color,$("#colorpicker")[0].color.fromString(tinycolor(color).toHexString()),$("#colorpicker").addClass("selected"),!$("#dynamic-palette [data-c="+color.toLowerCase()+"]").length&&$("#dynamic-palette").prepend(Grid.generateCell(color,"under").addClass("swatch").data("act","swatch").attr("id","swatch-"+color)))}else{var id=$(this).attr("id"),color="eraser"===brush.mode?"_":brush.color;$(this).replaceWith(Grid.generateCell(color,"under").attr("id",id)),_.has(Colors,color)||$("#dynamic-palette [data-c="+color.toLowerCase()+"]").length||$("#dynamic-palette").prepend(Grid.generateCell(color,"under").addClass("swatch").data("act","swatch").attr("id","swatch-"+color)),Grid.lastBuild.pattern=""}}),this.$el.parent().addClass("edit-mode"),$(".triangle-group").slideDown()},brush:!1,saveState:function saveState(pattern){"undefined"==typeof pattern&&(pattern=this.getPattern()),this.pattern=localStorage.customPattern=pattern,this.baseStyle=localStorage.lastStyle=this.style;var oscMode=$("#osc-sel").val();localStorage.lastOsc="custom"===oscMode?$("#osc-color").val():oscMode},exitPaintMode:function exitPaintMode(){$("#cells").off();var newPattern=this.getPattern();this.lastBuild.pattern="",this.build(newPattern,"over"),this.$el.parent().removeClass("edit-mode"),$(".triangle-group").slideUp(),this.saveState(newPattern),$("#controls").slideDown(),$("#editmode").slideUp()},getPattern:function getPattern(){var code,row=0,output="";return this.$el.find(".cell.under").each(function(){$(this).attr("id").split("_")[1]>row&&(output+="|",row++),code=$(this).data("c"),1<code.length&&(code="["+code+"]"),output+=code}),output},recount:function recount(layer){"undefined"==typeof layer&&(layer=$("#grid-wrap").hasClass("edit-mode")?"under":"over");var lc="under"===layer?"under":"over",cells=document.querySelectorAll(".cell."+lc+":not(.void)");"under"!==layer&&(this.cells=cells,this.intoRows(),this.cellCount=this.cells.length,this.trimmingConstant=Math.floor(Math.sqrt(this.cellCount)));var primaryColor=function(cc){return _.invert(cc)[_.max(cc)]}(_.countBy(_.pluck(_.pluck(cells,"dataset"),"c")));this.primaryColor=_.has(Colors,primaryColor)?Colors[primaryColor]:tinycolor(primaryColor).toHexString(),"default"==$("#osc-sel").val()&&this.setOsc("default");var selfHeight=this.$el.find("#cells").height(),selfWidth=this.$el.find("#cells").width();$(".wrapper-xh").css({top:selfHeight+conf.topOffset-conf.barHeight+"px"}),$("#shadow").width(selfWidth+20),this.height=selfHeight/20,this.width=selfWidth/20;var _x=this.width,_y=this.height;$("#sizeIndicator").text(_x+" \xD7 "+_y)},flash:function flash(i){i+1<=this.cellCount&&this.cells[i]._tl.progress(0)},intoRows:function intoRows(){var cellsArranged=[];Array.prototype.forEach.call(this.cells,function(cell){var _cell$getAttribute$sp=cell.getAttribute("id").split("_"),_cell$getAttribute$sp2=_slicedToArray(_cell$getAttribute$sp,3),_=_cell$getAttribute$sp2[0],y=_cell$getAttribute$sp2[1],x=_cell$getAttribute$sp2[2];cellsArranged[y]||(cellsArranged[y]=[]),cellsArranged[y][x]=cell}),this.cellsArranged=cellsArranged.reverse()},flashXY:function flashXY(x,y){var cellY=this.cellsArranged[y];if(cellY){var cell=cellY[x];cell&&cell.hasOwnProperty("_tl")&&cell._tl.progress(0)}},flashRow:function flashRow(y){var cellY=this.cellsArranged[y];if(cellY)for(var cell,i=0;i<this.flashDensity;)cell=cellY[Math.floor(Math.random()*cellY.length)],cell&&cell.hasOwnProperty("_tl")&&cell._tl.progress(0),i++},flashDensity:1,resample:function resample(direction,amount,layer){var pattern=this.getPattern(),lines=pattern.split(/[|\/]/),output=[];if(!(isNaN(amount)||0===amount)){if(0>amount){var _remove=_.includes(["left","top"],direction)?_.drop:_.dropRight;output=_.includes(["left","right"],direction)?_.map(lines,function(line){var chars=_.compact(line.split(colorMatchSqBr));return _remove(chars,-amount).join("")}):_remove(lines,-amount)}if(0<amount&&("left"==direction&&(output=_.map(lines,function(line){return _.repeat("_",amount)+line})),"right"==direction&&(output=_.map(lines,function(line){return line+_.repeat("_",amount)})),_.includes(["top","bottom"],direction))){var linelength=_.compact(_.max(lines,function(line){return _.compact(line.split(colorMatch)).length}).split(colorMatch)).length,add=_.times(amount,function(){return _.repeat("_",linelength)});output="top"==direction?add.concat(lines):lines.concat(add)}this.build(output.join("|"),layer)}},randomfill:function randomfill(){this.$el.find(".cell.under").each(function(){var color=.5<=Math.random()?tinycolor.random().toHexString():"_",id=$(this).attr("id");$(this).replaceWith(Grid.generateCell(color,"under").attr("id",id))})},clear:function clear(){this.$el.find(".cell.under").each(function(){var id=$(this).attr("id");$(this).replaceWith(Grid.generateCell("_","under").attr("id",id))})},fromCanvas:function fromCanvas(){var x,y,px,h=bufferCanvas.height,w=bufferCanvas.width,output="";for(y=0;y<h;y++){for(x=0;x<w;x++)px=bufferContext.getImageData(x,y,1,1).data,output+="[rgba("+px[0]+","+px[1]+","+px[2]+","+px[3]+")]";y!=h-1&&(output+="|")}this.build(output)},downloadPattern:function downloadPattern(){$("#bufferLink").attr("href",this.toCanvas())[0].click()},toCanvas:function(pattern,width,height){"undefined"==typeof width&&(width=this.width),"undefined"==typeof height&&(height=this.height),bufferCanvas.width=width,bufferCanvas.height=height,"undefined"==typeof pattern&&(pattern=this.getPattern());var j,output=new Uint8ClampedArray(4*(width*height)),i=0,lines=pattern.split(/[|\/]/);_.each(lines,function(line){var chars=_.compact(line.split(colorMatch));if(chars.length<width){var offset=width-chars.length,offsetLeft=Math.floor(offset/2),offsetRight=Math.ceil(offset/2);_.times(offsetLeft,function(){chars.unshift("_")}),_.times(offsetRight,function(){chars.push("_")})}_.each(chars,function(char){var color=_.has(Colors,char)?tinycolor("_VOID_"==Colors[char]?"rgba(0,0,0,0)":Colors[char]):tinycolor(char.replace(/[\[\]]/g,""));j=4*i,output[j]=color._r,output[j+1]=color._g,output[j+2]=color._b,output[j+3]=255*color._a,i++})}),_debug_={output:output,width:width,height:height},bufferContext.clearRect(0,0,bufferCanvas.width,bufferCanvas.height);var imageData=bufferContext.createImageData(width,height);return imageData.data.set(output),bufferContext.putImageData(imageData,0,0),bufferCanvas.toDataURL("image/png")}},brush={mode:!1,color:"J"};function _test(N){for(var i=0;i<N;i++)setInterval(function(){Grid.flash(_.random(0,Grid.cellCount-1))},_.random(400,3e3))}var expectedLoop,ranges={defaults:{freq:[0,18e3],db:[-120,0],smoothing:.1,treshold:1.5},current:{},init:function init(){var _this=this;this.freq=$("#frequency_range").ionRangeSlider({type:"double",min:0,max:this.sampleRate/2,min_interval:1e3,drag_interval:!0,grid_num:6,values_separator:"...",grid:!0,from:this.defaults.freq[0],to:this.defaults.freq[1],onChange:function onChange(data){_this.current.freq=[data.from,data.to],_this.current.numSamples=_this.hz2samples(data.to-data.from),_this.current.sampleOffset=_this.hz2samples(data.from)}}).data("ionRangeSlider"),this.db=$("#dynamic_range").ionRangeSlider({type:"double",min:-200,max:0,from:this.defaults.db[0],to:this.defaults.db[1],min_interval:10,grid_num:5,values_separator:"...",drag_interval:!0,grid:!0,onChange:function onChange(data){_this.current.db=[data.from,data.to],visualizer.analyser.minDecibels=data.from,visualizer.analyser.maxDecibels=data.to}}).data("ionRangeSlider"),this.smoothing=$("#smoothing").ionRangeSlider({min:0,max:1,step:.01,from:this.defaults.smoothing,grid:!0,onChange:function onChange(data){_this.current.smoothing=data.from}}).data("ionRangeSlider"),this.treshold=$("#treshold").ionRangeSlider({min:.5,max:3,step:.01,grid_num:5,from:this.defaults.treshold,grid:!0,onChange:function onChange(data){_this.current.treshold=data.from}}).data("ionRangeSlider"),this.sync()},get sampleRate(){try{return audio.context.sampleRate}catch(e){return 48e3}},get fftSize(){try{return visualizer.analyser.fftSize}catch(e){return conf.fftSize}},hz2samples:function hz2samples(hz){return Math.round(hz/(this.sampleRate/this.fftSize))},samples2hz:function samples2hz(samples){return Math.round(samples*(this.sampleRate/this.fftSize))},sync:function sync(){var _this2=this,settings=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};settings=_.defaults(settings,this.defaults),this.freq.update({max:this.sampleRate/2,from:settings.freq[0],to:settings.freq[1]}),this.db.update({from:settings.db[0],to:settings.db[1]}),this.smoothing.update({from:settings.smoothing}),this.treshold.update({from:settings.treshold}),["freq","db","smoothing","treshold"].forEach(function(prop){return _this2[prop].callOnChange()})}},audio={buffer:{},compatibility:{},supported:!0,source_loop:{},source_once:{},disabled:!0},currentLoop={};audio.stop=function(callback){audio.source_loop._playing?(TweenLite.to(gainNode.gain,.2,{value:0,onComplete:function onComplete(){audio.source_loop[audio.compatibility.stop](0),audio.source_loop._playing=!1,audio.source_loop._startTime=0,"noteOn"===audio.compatibility.start&&audio.source_once[audio.compatibility.stop](0),"function"==typeof callback&&callback()}}),$(".wrapper-decor").fadeOut()):"function"==typeof callback&&callback()},audio.loadLoop=function(immed,loop){audio.disabled=!0;var newLoop={};if("object"===("undefined"==typeof loop?"undefined":_typeof(loop)))newLoop=loop;else return console.log("unsupported");var req=new XMLHttpRequest,expectedToken=""+loop.original_hash+new Date().getTime();expectedLoop=expectedToken,req.onload=function(){expectedToken===expectedLoop&&audio.context.decodeAudioData(req.response,function(buffer){ranges.sync(newLoop),audio.buffer=buffer,audio.source_loop={},currentLoop=newLoop,audio.disabled=!1,immed&&audio.play()})},audio.stop(function(){req.open("GET",urlprefix+loop.section+"/"+loop.original_hash+"."+fileFormat,!0),req.responseType="arraybuffer",req.send()})};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,audio.context=new window.AudioContext}catch(e){audio.supported=!1}var gainNode,visualizer={};audio.supported&&(function(){var start="start",stop="stop",buffer=audio.context.createBufferSource();"function"!=typeof buffer.start&&(start="noteOn"),audio.compatibility.start=start,"function"!=typeof buffer.stop&&(stop="noteOff"),audio.compatibility.stop=stop}(),gainNode=audio.context.createGain(),gainNode.gain.value=1,visualizer=new VisualizerSample,gainNode.connect(visualizer.analyser)),audio.play=function(){return(TweenLite.to(gainNode.gain,0,{value:1}),audio.disabled)?AllTracks.random():(audio.source_loop._playing?(audio.stop(),$("#playSwitcher i").removeClass("i-pause-big").addClass("i-play-big")):($(".wrapper-decor").fadeIn(),audio.source_loop=audio.context.createBufferSource(),audio.source_loop.buffer=audio.buffer,audio.source_loop.loop=!0,audio.source_loop.connect(gainNode),"noteOn"===audio.compatibility.start?(audio.source_once=audio.context.createBufferSource(),audio.source_once.buffer=audio.buffer,audio.source_once.connect(gainNode),audio.source_once.noteGrainOn(0,0,audio.buffer.duration),audio.source_loop[audio.compatibility.start](audio.buffer.duration)):audio.source_loop[audio.compatibility.start](0,0),audio.source_loop._playing=!0,!visualizer._drawing&&(frame(visualizer.draw.bind(visualizer)),visualizer._drawing=!0),$("#playSwitcher i").removeClass("i-play-big").addClass("i-pause-big")),!1)};var frame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();function record_mode(){conf.topOffset=110,Grid.recount(),injector.inject("recmode","#grid-wrap {  margin-top: 66px } .player-controls {opacity: 0} .player-controls:hover {opacity: 1}")}function logIfDown(){xBrowserIsMouseDown()&&console.dir.apply(this,arguments)}function VisualizerSample(){this.analyser=audio.context.createAnalyser(),this.analyser.connect(audio.context.destination);try{this.analyser.fftSize=conf.fft_size,$("label[for=fft_size] .indicator").removeClass("illegal")}catch(e){$("label[for=fft_size] .indicator").addClass("illegal")}this.samples=new Uint8Array(this.analyser.frequencyBinCount)}var channel={init:function init(){this.canvas=$("#samplecanvas")[0],this.ctx=this.canvas.getContext("2d"),this.canvas.width=conf.fft_size/2},debugOn:!1,history:[],current:[],tick:function tick(spectrum){for(var _Mathabs=Math.abs,_Mathpow=Math.pow,_Mathfloor=Math.floor,numSamples=ranges.current.numSamples,offset=ranges.current.sampleOffset,numBands=Grid.height,bands=[],bandWidths=[],spectrumLength=spectrum.length,i=0;i<spectrumLength;i++){if(i>=offset&&i<offset+numSamples){var n=i-offset,bandNum=void 0;this.debugOn&&(this.ctx.fillStyle=conf.lightWave),bandNum="quadratic"===conf.distributionLaw?_Mathfloor(numBands*_Mathabs(_Mathpow(n/numSamples,2))):"reverse-quadratic"===conf.distributionLaw?numBands-_Mathfloor(numBands*_Mathabs(_Mathpow((numSamples-n)/numSamples,2))):_Mathfloor(n/(numSamples/numBands)),bandWidths[bandNum]||(bands[bandNum]=0,bandWidths[bandNum]=0);var sample=Math.min(_Mathabs(spectrum[i]/256),1);sample<conf.absoluteTreshold&&(sample=0),bands[bandNum]+=sample,bandWidths[bandNum]+=1}else this.debugOn&&(this.ctx.fillStyle=conf.darkWave);if(this.debugOn){var barHeight=Math.round(100*(spectrum[i]/256));barHeight&&this.ctx.fillRect(i,100-barHeight,1,barHeight)}}for(var _i=0;_i<numBands;_i++)0<bandWidths[_i]?bands[_i]/=bandWidths[_i]:bands[_i]=0;for(this.current&&this.history.push(this.current);this.history.length>conf.historySize;)this.history.shift();this.current=bands;for(var average=[],jumps=[],_i2=0;_i2<this.history.length;_i2++)for(var band=0;band<numBands;band++)average[band]||(average[band]=0),average[band]+=this.history[_i2][band];for(var offsetLeft=offset,_band=0;_band<numBands;_band++)0<average[_band]?average[_band]/=this.history.length:average[_band]=0,this.debugOn&&(this.ctx.fillStyle=_band%2?"green":"purple",this.ctx.fillRect(offsetLeft,100,bandWidths[_band],3),this.ctx.fillRect(offsetLeft,103,bandWidths[_band],57*bands[_band])),this.current[_band]>average[_band]*ranges.current.treshold?(jumps[_band]=1,this.debugOn&&(this.ctx.fillStyle=_band%2?"lime":"magenta",this.ctx.fillRect(offsetLeft,105+57*bands[_band]-4,bandWidths[_band],4))):jumps[_band]=0,this.debugOn&&(offsetLeft+=bandWidths[_band]);return jumps}};VisualizerSample.prototype.draw=function(){this.analyser.smoothingTimeConstant=ranges.current.smoothing,this.analyser.getByteFrequencyData(this.samples),conf.osc&&drawContext.clearRect(0,0,conf.barWidth,conf.barHeight);for(var i=0;i<this.analyser.frequencyBinCount;i++){var value=this.samples[i];if(conf.osc){var height=conf.barHeight*(value/256),y=Math.ceil(conf.barHeight-height);drawContext.fillRect(4*i,y,2,height)}}channel.debugOn&&channel.ctx.clearRect(0,0,conf.fft_size,205);for(var jumps=channel.tick(this.samples),_i3=0;_i3<Grid.height;_i3++)jumps[_i3]&&Grid.flashRow(_i3);frame(this.draw.bind(this))},VisualizerSample.prototype.getFrequencyValue=function(freq){var nyquist=audio.context.sampleRate/2,index=Math.round(freq/nyquist*this.freqs.length);return this.freqs[index]};function Rarity(trim){this.n=0,this.trim=trim,this.do=function(fn){this.n>=this.trim?(fn(),this.n=0):this.n++}}function handleFileDrop(evt){handleFile(evt,"drop")}function handleFileInput(evt){handleFile(evt,"input")}var currentCustomTrack={name:null,ftype:null,buffer:null,blob:null};function handleFile(evt,type){evt.stopPropagation(),evt.preventDefault();var files="drop"==type?evt.dataTransfer.files:evt.target.files,f=files[0];if(f.type.match("image.*")){var reader=new FileReader;reader.onload=function(){return function(e){var dataUrl=e.target.result;toCanvas(dataUrl),$("#pattern-share .filename").val(f.name.match(/(.+?)\.([a-z0-9_]+$)/i)[1])}}(f),reader.readAsDataURL(f)}else if(f.type.match("audio.*")){var reader=new FileReader;reader.onload=function(){return function(e){currentCustomTrack.buffer=e.target.result,currentCustomTrack.ftype=f.type,currentCustomTrack.blob=new Blob([currentCustomTrack.buffer],{type:currentCustomTrack.ftype}),currentCustomTrack.name=f.name.match(/(.+?)\.([a-z0-9_]+$)/i)[1],$("#loop-upload .filename").val(currentCustomTrack.name),loopEditor.add(),audio.context.decodeAudioData(currentCustomTrack.buffer,function(buffer){ranges.sync(),audio.stop(function(){audio.buffer=buffer,currentLoop.fileName=currentCustomTrack.name,audio.disabled=!1,audio.play()})},function(error){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u0435\u043A\u043E\u0434\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0438 \u0430\u0443\u0434\u0438\u043E",error)})}}(f),reader.readAsArrayBuffer(f)}else alert("\u0414\u0440\u043E\u043F\u043D\u0443\u0442\u044B\u0439 \u0444\u0430\u0439\u043B \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043D\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u043E\u0439, \u043D\u0438 \u0430\u0443\u0434\u0438\u043E\u0444\u0430\u0439\u043B\u043E\u043C.");return!1}function handleDragOver(evt){evt.stopPropagation(),evt.preventDefault(),evt.dataTransfer.dropEffect="copy"}function toCanvas(dataURL){var imageObj=new Image;imageObj.onload=function(){bufferCanvas.height=this.height,bufferCanvas.width=this.width,bufferContext.drawImage(this,0,0),Grid.fromCanvas()},imageObj.src=dataURL}function dataURItoBlob(dataURI){var arr=dataURI.split(","),mime=arr[0].match(/:(.*?);/)[1];return new Blob([atob(arr[1])],{type:mime})}function TrackList(tracklist,sel,id,flat,$sortButton,sortBy,order,playEnabled,$playEnabler){this.$el=$(sel),this.id=id,this.isFlat=!!flat,this.playEnabled=playEnabled,this.$playEnabler=$playEnabler,this.$playEnabler.addClass(this.playEnabled?"i-play-enabled":"i-play-disabled"),this.$playEnabler.on("click",function(ev){ev.stopPropagation(),this.playEnabled=!this.playEnabled,this.$playEnabler.toggleClass("i-play-enabled i-play-disabled"),AllTracks.populate(this.id,this.flatList,this.playEnabled)}.bind(this)),this.build=function(){var html="";this.isFlat?(html+="<div class=\"tracklist-section\" data-flat=\"1\" data-section=\""+this.id+"\" data-id=\""+this.id+"\">",html+=this.buildSection(this.list,this.id),html+="</div>"):_.each(this.list,function(section){html+="<div class=\"tracklist-section\" data-flat=\"0\" data-section=\""+section.sectID+"\" data-id=\""+this.id+"\">",html+="<h3 class=\"tls-title\">"+section.title+"</h3>",html+=this.buildSection(section.contents,section.sectID),html+="</div>"},this),this.$el.html(html),AllTracks.populate(this.id,this.flatList,this.playEnabled)},this.scrollAdded=!1,this.buildSection=function(list,sectID){order="undefined"==typeof this.sortOrder||("string"==typeof this.sortOrder?"asc"===this.sortOrder:this.sortOrder);var sortedList=_.sortByOrder(list,[this.sortBy,"id"],[order,order]),html="",foradmin="default"===this.id?" foradmin-show":"";return _.each(sortedList,function(entry){if(entry){var swfName=!!(entry.hasOwnProperty("swf")&&entry.swf)&&entry.swf.split("/").reverse()[0],swfLink=swfName?"<a target=\"_blank\" href=\"loops/swf/"+entry.swf+"\" download=\""+swfName+"\" class=\"dlo-dlbutton dlb-swf\" title=\"\u0421\u043A\u0430\u0447\u0430\u0442\u044C \u043E\u0440\u0438\u0433\u0438\u043D\u0430\u043B\u044C\u043D\u044B\u0439 SWF\"><i class=\"i-download-menu\"></i> SWF</a> ":"",swfClass=swfName?" with-swf":"",fresh=entry.hasOwnProperty("fresh")&&entry.fresh?" fresh":"",isPlaying=currentLoop.hasOwnProperty("original_hash")&&currentLoop.original_hash===entry.original_hash?" playing":"",safeName=_.escape(entry.name);html+="<div class=\"track"+swfClass+isPlaying+fresh+"\" data-name=\""+safeName.toLowerCase()+"\" data-hash=\""+entry.original_hash+"\">\t\t\t\t\t<i class=\"i-play\"></i>\t\t\t\t\t<div class=\"track-name\">"+safeName+"</div>\t\t\t\t\t<div class=\"download-options\">"+swfLink+"<a target=\"_blank\" href=\"loops/"+sectID+"/"+entry.original_hash+".mp3\" download=\""+safeName+".mp3\" class=\"dlo-dlbutton dlb-mp3\"><i class=\"i-download-menu\"></i> MP3</a>\t\t\t\t\t\t<a target=\"_blank\" href=\"loops/"+sectID+"/"+entry.original_hash+".ogg\" download=\""+safeName+".ogg\" class=\"dlo-dlbutton dlb-ogg\"><i class=\"i-download-menu\"></i> OGG</a>\t\t\t\t\t</div>\t\t\t\t\t<div class=\"edit-options\">\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-delete\"><i class=\"i-x-small\"></i> \u0423\u0434\u0430\u043B\u0438\u0442\u044C</a>\t\t\t\t\t\t<a href=\"#\" class=\"dlo-dlbutton dlb-edit\"><i class=\"i-edit\"></i> \u041F\u0440\u0430\u0432\u0438\u0442\u044C</a>\t\t\t\t\t</div>\t\t\t\t\t<div class=\"track-duration\">"+entry.duration+"</div>\t\t\t\t\t<div class=\"track-options\">\t\t\t\t\t\t<i class=\"i-download-menu\"></i><i class=\"i-burger"+foradmin+"\"></i>\t\t\t\t\t</div>\t\t\t\t</div>"}},this),html},this.add=function(track){track=this.processList([track])[0],track.fresh=!0,this.isFlat?(this.list.push(track),this.flatList=this.list):(_.find(this.list,{sectID:track.section}).contents.push(track),this.flatList=_.flatten(_.pluck(this.list,"contents"))),this.build()},this.edit=function(track){this.del(track.original_hash,track.section_from||track.section,!0),this.add(track)},this.del=function(ohash,section,nobuild){"undefined"==typeof nobuild&&(nobuild=!1),this.isFlat?_.remove(this.list,{original_hash:ohash}):_.remove(_.find(this.list,{sectID:section}).contents,{original_hash:ohash}),_.remove(this.flatList,{original_hash:ohash}),nobuild||this.build()},this.processList=function(list){return _.each(list,function(entry){if(entry.hasOwnProperty("date")&&!entry.date instanceof Date&&(entry.date=new Date(entry.date)),entry.hasOwnProperty("duration")&&!isNaN(entry.duration)){var totalSecs=+entry.duration,minutes=Math.floor(totalSecs/60)+"";1==minutes.length&&(minutes="0"+minutes);var seconds=Math.round(totalSecs%60)+"";1==seconds.length&&(seconds="0"+seconds),entry.duration=minutes+":"+seconds}["freq","db"].forEach(function(prop){entry[prop]&&"string"==typeof entry[prop]&&(entry[prop]=entry[prop].split("~").map(function(v){return+v}))}),["smoothing","treshold"].forEach(function(prop){entry[prop]&&"string"==typeof entry[prop]&&(entry[prop]=+entry[prop])})})},this.sortOptions=[["date","desc","i-newfirst","\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435"],["date","asc","i-oldfirst","\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435"],["name","asc","i-a-z","\u041F\u043E \u0430\u043B\u0444\u0430\u0432\u0438\u0442\u0443"],["name","desc","i-z-a","\u041F\u043E \u0430\u043B\u0444\u0430\u0432\u0438\u0442\u0443"]],this.isFlat?(this.list=this.processList(tracklist),this.flatList=this.list):(this.list=_.map(tracklist,function(section){var processedSection=section;return processedSection.contents=this.processList(section.contents),processedSection},this),this.flatList=_.flatten(_.pluck(this.list,"contents"))),this.sortButton=$sortButton,this.sortButton.on("click",function(ev){ev.stopPropagation(),this.sort()}.bind(this)),this.sortState=_.findIndex(this.sortOptions,{0:sortBy,1:order}),this.sort=function(sortBy,order){var sort;"undefined"==typeof sortBy?this.sortState++:("undefined"==typeof order&&(order="asc"),this.sortState=_.findIndex(this.sortOptions,{0:sortBy,1:order})),(0>this.sortState||this.sortState>=this.sortOptions.length)&&(this.sortState=0),sort=this.sortOptions[this.sortState],this.sortBy=sort[0],this.sortOrder=sort[1],this.build(),this.sortButton.removeClass(_.pluck(this.sortOptions,2).join(" ")).addClass(sort[2]),this.sortButton.attr("title",sort[3])},this.sort(sortBy,order),this.playTrackByHash=function(hash,disableAssociation){"undefined"==typeof disableAssociation&&(disableAssociation=!1);var track=_.filter(this.flatList,{original_hash:""+hash})[0];track&&(audio.loadLoop(!0,track),$(".track").removeClass("playing"),$(".track[data-hash="+hash+"]").addClass("playing"),conf.association&&!disableAssociation&&(+track.associated_pattern?_.each(patternLibs,function(lib){lib.applyPatternByID(+track.associated_pattern,!0)}):Grid.revert()))},this.getAllHashes=function(){return{playEnabled:this.playEnabled,tracks:_.pluck(this.flatList,"original_hash")}}}var AllTracks={nameList:[],playList:[],populate:function populate(id,list,enabled){var pl=_.reject(this.playList,{lib:id}),nl=_.reject(this.nameList,{lib:id});_.each(list,function(track){nl.push({lib:id,hash:track.original_hash,name:track.name}),enabled&&pl.push({lib:id,hash:track.original_hash})}),$("#loop-toassoc option[data-lib="+id+"]").remove(),this.nameList=nl,this.playList=pl,_.each(nl,function(loop){$("#loop-toassoc").append("<option data-lib=\""+id+"\" value=\""+loop.hash+"\">"+loop.name+"</option>")})},random:function random(){if(this.playList.length||this.init(),!!this.playList.length){if(1<this.playList.length)var reduced=this.playList.filter(function(item){return item.hash!==currentLoop.original_hash});var newLoop=1<this.playList.length?reduced[Math.floor(Math.random()*reduced.length)]:this.playList[0];loopLibs[newLoop.lib].playTrackByHash(newLoop.hash)}},playTrackByHash:function playTrackByHash(hash,disableAssociation){loopLibs[_.find(this.nameList,{hash:""+hash}).lib].playTrackByHash(""+hash,disableAssociation)}};function PatternGallery(patterns,sel,id,$sortButton,sortBy,order){var _Mathceil=Math.ceil,_Mathfloor2=Math.floor;this.$el=$(sel),this.id=id,this.processList=function(list){return _.each(list,function(entry){entry.hasOwnProperty("date")&&!entry.date instanceof Date&&(entry.date=new Date(entry.date)),entry.height=+entry.height,entry.width=+entry.width,entry.id=+entry.id})},this.list=this.processList(patterns),this.patternProbe=function(width,height){var s=width>height?width:height;if(60>s){for(var n=1;60>=s*n;)n++;n--;var w=n*width,h=n*height,v_offset=60-h,h_offset=60-w;return{up:!0,width:w,height:h,margins:[_Mathfloor2(v_offset/2),_Mathceil(h_offset/2),_Mathceil(v_offset/2),_Mathfloor2(h_offset/2)]}}return{up:!1,width:width,height:height}},this.refreshAss=function(){$("#pattern-toassoc option[data-lib="+this.id+"]").remove(),_.each(this.list,function(pattern){$("#pattern-toassoc").append("<option data-lib=\""+this.id+"\" value=\""+pattern.id+"\">"+pattern.name+"</option>")},this)},this.build=function(){var order=!("undefined"!=typeof this.sortOrder)||("string"==typeof this.sortOrder?!("asc"!==this.sortOrder):this.sortOrder),sortedList=_.sortByOrder(this.list,[this.sortBy,"id"],[order,order]),html="<div class=\"gallery-section\" data-section=\""+this.id+"\" data-id=\""+this.id+"\">",foradmin="default"===this.id?" foradmin-show":"";_.each(sortedList,function(pattern){var probe=this.patternProbe(pattern.width,pattern.height),crisp=probe.up?" image-crisp":"",upstyle=probe.up?" style=\"margin: "+probe.margins.map(function(i){return i+"px"}).join(" ")+"; width:"+probe.width+"px; height:"+probe.height+"px;\"":"",src=Grid.toCanvas(pattern.string,pattern.width,pattern.height),fresh=pattern.fresh||!1?" fresh":"",safeName=_.escape(pattern.name),foradmin="default"==this.id?" foradmin-show":"";html+="<div class=\"pattern"+fresh+"\" title=\""+safeName+"\" data-id=\""+pattern.id+"\" data-lib=\""+this.id+"\" data-name=\""+safeName+"\">\t\t\t\t<img src=\""+src+"\" class=\"pattern-pic"+crisp+"\""+upstyle+" alt=\""+safeName+"\">\t\t\t\t<div class=\"pattern-name\">"+safeName+"</div>\t\t\t\t<div class=\"pattern-options\">\t\t\t\t\t<a title=\"\u041F\u0440\u0430\u0432\u0438\u0442\u044C\" href=\"#\" class=\"pattern-menu-item pmi-left"+foradmin+"\"><i class=\"i-edit\"></i></a>\t\t\t\t\t<a title=\"\u0421\u043A\u0430\u0447\u0430\u0442\u044C PNG\" target=\"_blank\" href=\""+src+"\" download=\""+safeName+".png\" class=\"pattern-menu-item pmi-mid\"><i class=\"i-download-menu\"></i></a>\t\t\t\t\t<a title=\"\u0423\u0434\u0430\u043B\u0438\u0442\u044C\" href=\"#\" class=\"pattern-menu-item pmi-right"+foradmin+"\"><i class=\"i-x-small\"></i></a>\t\t\t\t</div>\t\t\t</div>"},this),html+="</div>",this.$el.html(html),this.refreshAss()},this.add=function(pattern){pattern=this.processList([pattern])[0],pattern.fresh=!0,this.list.push(pattern),this.build()},this.edit=function(pattern){this.del(+pattern.id,!0),this.add(pattern)},this.del=function(id,nobuild){"undefined"==typeof nobuild&&(nobuild=!1),_.remove(this.list,{id:id}),nobuild||this.build()},this.sortOptions=[["date","desc","i-newfirst","\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435"],["date","asc","i-oldfirst","\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435"],["name","asc","i-a-z","\u041F\u043E \u0430\u043B\u0444\u0430\u0432\u0438\u0442\u0443"],["name","desc","i-z-a","\u041F\u043E \u0430\u043B\u0444\u0430\u0432\u0438\u0442\u0443"]],this.sortButton=$sortButton,this.sortButton.on("click",function(ev){ev.stopPropagation(),this.sort()}.bind(this)),this.sortState=_.findIndex(this.sortOptions,{0:sortBy,1:order}),this.sort=function(sortBy,order){var sort;"undefined"==typeof sortBy?this.sortState++:("undefined"==typeof order&&(order="asc"),this.sortState=_.findIndex(this.sortOptions,{0:sortBy,1:order})),(0>this.sortState||this.sortState>=this.sortOptions.length)&&(this.sortState=0),sort=this.sortOptions[this.sortState],this.sortBy=sort[0],this.sortOrder=sort[1],this.build(),this.sortButton.removeClass(_.pluck(this.sortOptions,2).join(" ")).addClass(sort[2]),this.sortButton.attr("title",sort[3])},this.sort(sortBy,order),this.applyPatternByID=function(id,disableAssociation){"undefined"==typeof disableAssociation&&(disableAssociation=!1);var pattern=_.find(this.list,{id:+id});pattern&&(pattern.osc?Grid.setOsc(pattern.osc):$("#osc-sel").val("default"),pattern.style?Grid.changeStyle(pattern.style,pattern.string):Grid.changeStyle(defaultStyle,pattern.string),pattern.associated_loop&&conf.association&&!disableAssociation&&AllTracks.playTrackByHash(pattern.associated_loop,!0))}}var is_admin=!1;cheet("\u2191 \u2191 \u2193 \u2193 \u2190 \u2192 \u2190 \u2192 b a",function(){$("body").toggleClass("is-admin"),is_admin=!!!is_admin}),Math.log2=Math.log2||function(x){return Math.log(x)/Math.LN2};var $stream=null,radioMES=null;function set_stream(url,mediaType){$stream||($("<audio style=\"display:none\" id=\"stream-victim\"></audio>").appendTo("body"),$stream=$("#stream-victim")),$stream.html("<source src=\""+url+"\" type=\""+mediaType+"\" />")}function connectStream(){radioMES=audio.context.createMediaElementSource($("#stream-victim")[0]),radioMES.connect(gainNode)}function toggleAnlzOpts(){$("#nerdmode").slideToggle("fast"),channel.debugOn=!channel.debugOn}
//# sourceMappingURL=loops.js.map